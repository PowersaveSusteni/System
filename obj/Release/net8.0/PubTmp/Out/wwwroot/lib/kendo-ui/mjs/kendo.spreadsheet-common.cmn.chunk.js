/**
 * Kendo UI v2024.4.1112 (http://www.telerik.com/kendo-ui)
 * Copyright 2024 Progress Software Corporation and/or one of its subsidiaries or affiliates. All rights reserved.
 *
 * Kendo UI commercial licenses may be obtained at
 * http://www.telerik.com/purchase/license-agreement/kendo-ui-complete
 * If you do not own a commercial license, this file shall be governed by the trial license terms.
 */
import{u as util,q as parseColor,G as Group,b as Path,R as Rect,M as Matrix$1,B as Rect$1,D as drawText$1}from"./kendo.drawing.cmn.chunk.js";const __meta__={id:"spreadsheet-common.cmn.chunk",name:"SpreadsheetCommonCmnChunk",category:"web",description:"A reusable outputed chunk of code",depends:["drawing.cmn.chunk","date-math.cmn.chunk","common.cmn.chunk","jszip-esm.cmn.chunk"],hidden:!0,chunk:!0};import{g as getDate,d as dayOfWeek,e as addDays,f as firstDayOfMonth}from"./kendo.date-math.cmn.chunk.js";import{b as browser}from"./kendo.common.cmn.chunk.js";import{J as JSZip}from"./kendo.jszip-esm.cmn.chunk.js";function columnName(e){const t=Math.floor(e/26)-1;return(t>=0?columnName(t):"")+String.fromCharCode(65+e%26)}function displaySheet(e){return/^[a-z_][a-z0-9_]*$/i.test(e)?e:"'"+e.replace(/\x27/g,"\\'")+"'"}function displayRef(e,t,r,n){let i="";return++t,isFinite(t)?null==n||2&n||(t="$"+t):t="",isFinite(r)?(i=columnName(r),null==n||1&n||(i="$"+i)):r="",e?displaySheet(e)+"!"+i+t:i+t}class Ref{constructor(){this.type="ref",this.sheet=""}clone(){return this}hasSheet(){return this._hasSheet}simplify(){return this}setSheet(e,t){return this.sheet=e,null!=t&&(this._hasSheet=t),this}absolute(e,t){return this}relative(...e){return this}adjust(e,t,r,n,i,o,s){return this}toString(){return this.relative(0,0,3,3).print(0,0)}forEach(e,t){e.call(t,this)}map(e,t){return e.call(t,this)}intersect(e){return this}intersects(e){return this.intersect(e)!==NULLREF}isCell(){return!1}toRow(e){return this}toColumn(e){return this}first(){return this}lastRange(){return this}size(){return 1}rangeAt(e){return this}nextRangeIndex(e){return 0}previousRangeIndex(e){return 0}eq(e){let t=this,r=e;if(t===NULLREF||r===NULLREF)return t===r;if((r instanceof CellRef||r instanceof RangeRef&&!(t instanceof CellRef))&&(t=e,r=this),t instanceof CellRef)return r=r.simplify(),r instanceof CellRef&&t.row==r.row&&t.col==r.col&&t.sheet==r.sheet;if(t instanceof RangeRef){if(r instanceof RangeRef)return r.topLeft.eq(t.topLeft)&&r.bottomRight.eq(t.bottomRight);if(r instanceof UnionRef)return r.single()&&t.eq(r.refs[0])}else if(t instanceof UnionRef&&r instanceof UnionRef){const e=t.refs,n=r.refs;if(e.length!=n.length)return!1;for(let t=0,r=e.length;t<r;t++)if(!e[t].eq(n[t]))return!1;return!0}return t===r}concat(e){return new UnionRef([this,e])}replaceAt(e,t){return t}forEachColumnIndex(e){this.forEachAxisIndex("col",e)}forEachRowIndex(e){this.forEachAxisIndex("row",e)}forEachRow(e){}forEachColumn(e){}forEachAxisIndex(e,t){let r=[];this["row"===e?"forEachRow":"forEachColumn"]((function(t){let n=t.first()[e];-1===r.indexOf(n)&&r.push(n)})),r.sort((function(e,t){return e>t?1:e<t?-1:0})).forEach(t)}valid(){return!1}renameSheet(e,t){if(this.sheet&&this.sheet.toLowerCase()==e.toLowerCase())return this.sheet=t,!0}}Ref.display=displayRef;class NULLREFClass extends Ref{print(){return"#NULL!"}eq(e){return e===this}forEach(){}}const NULLREF=new NULLREFClass;class NameRef extends Ref{constructor(e){super(),this.name=e,this.ref="name"}clone(){return new NameRef(this.name).setSheet(this.sheet,this.hasSheet())}print(){let e=displaySheet(this.name);return this.hasSheet()&&(e=displaySheet(this.sheet)+"!"+e),e}}class CellRef extends Ref{constructor(e,t,r){super(),this.row=e,this.col=t,this.rel=r||0,this.ref="cell"}clone(){return new CellRef(this.row,this.col,this.rel).setSheet(this.sheet,this.hasSheet())}intersect(e){return e instanceof CellRef?this.eq(e)?this:NULLREF:e.intersect(this)}print(e,t,r){let n,i=this.col,o=this.row,s=this.rel;if(null==e&&s){let e=this.hasSheet()?displaySheet(this.sheet)+"!":"";return i=isFinite(i)?1&s?"C["+i+"]":"C"+(i+1):"",o=isFinite(o)?2&s?"R["+o+"]":"R"+(o+1):"",e+o+i}return n=this.absolute(e,t),r?(o=n.row%1048576,i=n.col%16384,o<0&&(o+=1048576),i<0&&(i+=16384),displayRef(this._hasSheet&&this.sheet,o,i,s)):n.valid()?displayRef(this._hasSheet&&this.sheet,n.row,n.col,s):"#REF!"}absolute(e,t){let r=this.clone();return 3&r.rel?(1&r.rel&&(r.col=(r.col+t)%16384),2&r.rel&&(r.row=(r.row+e)%1048576),r.rel=0,r):r}toRangeRef(){return new RangeRef(this,this)}relative(e,t,r){null==r&&(r=this.rel);let n=2&r?this.row-e:this.row,i=1&r?this.col-t:this.col;return new CellRef(n,i,r).setSheet(this.sheet,this.hasSheet())}height(){return 1}width(){return 1}toString(){return displayRef(null,this.row,this.col,3)}isCell(){return!0}leftColumn(){return this}rightColumn(){return this}topRow(){return this}bottomRow(){return this}forEachRow(e){e(this.toRangeRef())}forEachColumn(e){e(this.toRangeRef())}adjust(e,t,r,n,i,o,s){let a=this.absolute(e,t);if(i){if(a.row>=o){if(s<0&&a.row<o-s)return NULLREF;a.row+=s}}else if(a.col>=o){if(s<0&&a.col<o-s)return NULLREF;a.col+=s}return null!=r&&null!=n&&(a=a.relative(r,n,this.rel)),a}valid(){if(this.rel)throw new Error("valid() called on relative reference");let e=this.col,t=this.row;return!(isFinite(e)&&e<0||isFinite(t)&&t<0)}}class RangeRef extends Ref{constructor(e,t){super(),this.ref="range",e._hasSheet&&t._hasSheet&&e.sheet.toLowerCase()!=t.sheet.toLowerCase()&&(this.endSheet=t.sheet),this.topLeft=new CellRef(e.row,e.col,e.rel),this.bottomRight=new CellRef(t.row,t.col,t.rel),this.normalize()}clone(){return new RangeRef(this.topLeft.clone(),this.bottomRight.clone()).setSheet(this.sheet,this.hasSheet())}_containsRange(e){return this._containsCell(e.topLeft)&&this._containsCell(e.bottomRight)}_containsCell(e){return e.sheet==this.sheet&&e.row>=this.topLeft.row&&e.col>=this.topLeft.col&&e.row<=this.bottomRight.row&&e.col<=this.bottomRight.col}contains(e){if(e instanceof Array){let t=this;return e.some((function(e){return Boolean(t.contains(e))}))}return e instanceof CellRef?this._containsCell(e):e instanceof RangeRef&&this._containsRange(e)}_intersectRange(e){if(this.sheet!=e.sheet)return NULLREF;let t=this.topLeft.col,r=this.topLeft.row,n=this.bottomRight.col,i=this.bottomRight.row,o=e.topLeft.col,s=e.topLeft.row,a=e.bottomRight.col,l=e.bottomRight.row;return t<=a&&o<=n&&r<=l&&s<=i?new RangeRef(new CellRef(Math.max(r,s),Math.max(t,o)),new CellRef(Math.min(i,l),Math.min(n,a))).setSheet(this.sheet,this.hasSheet()):NULLREF}intersect(e){return e instanceof CellRef?this._containsCell(e)?e:NULLREF:e instanceof RangeRef?this._intersectRange(e).simplify():e instanceof UnionRef?e.intersect(this):NULLREF}simplify(){return this.isCell()?new CellRef(this.topLeft.row,this.topLeft.col,this.topLeft.rel).setSheet(this.sheet,this.hasSheet()):this}normalize(){let e,t=this.topLeft,r=this.bottomRight,n=t.row,i=t.col,o=r.row,s=r.col,a=2&t.rel,l=1&t.rel,u=2&r.rel,c=1&r.rel,h=!1;return a===u&&l===c&&(n>o&&(h=!0,e=n,n=o,o=e,e=a,a=u,u=e),i>s&&(h=!0,e=i,i=s,s=e,e=l,l=c,c=e),h&&(this.topLeft=new CellRef(n,i,l|a),this.bottomRight=new CellRef(o,s,c|u))),this}print(e,t,r){if(r||this.absolute(e,t).valid()){let n=this.topLeft.print(e,t,r)+":"+this.bottomRight.print(e,t,r);return this.hasSheet()&&(n=displaySheet(this.sheet)+(this.endSheet?":"+displaySheet(this.endSheet):"")+"!"+n),n}return"#REF!"}absolute(e,t){return new RangeRef(this.topLeft.absolute(e,t),this.bottomRight.absolute(e,t)).setSheet(this.sheet,this.hasSheet())}relative(e,t,r,n){return null==n&&(n=r),new RangeRef(this.topLeft.relative(e,t,r),this.bottomRight.relative(e,t,n)).setSheet(this.sheet,this.hasSheet())}height(){if(this.topLeft.rel!=this.bottomRight.rel)throw new Error("Mixed relative/absolute references");return this.bottomRight.row-this.topLeft.row+1}width(){if(this.topLeft.rel!=this.bottomRight.rel)throw new Error("Mixed relative/absolute references");return this.bottomRight.col-this.topLeft.col+1}collapse(){return this.topLeft.toRangeRef()}leftColumn(){return new RangeRef(this.topLeft,new CellRef(this.bottomRight.row,this.topLeft.col))}rightColumn(){return new RangeRef(new CellRef(this.topLeft.row,this.bottomRight.col),this.bottomRight)}topRow(){return new RangeRef(this.topLeft,new CellRef(this.topLeft.row,this.bottomRight.col))}bottomRow(){return new RangeRef(new CellRef(this.bottomRight.row,this.topLeft.col),this.bottomRight)}toRangeRef(){return this}toRow(e){return e+=Math.max(0,this.topLeft.row),new RangeRef(new CellRef(e,this.topLeft.col),new CellRef(e,this.bottomRight.col)).setSheet(this.sheet,this.hasSheet())}toColumn(e){return e+=Math.max(0,this.topLeft.col),new RangeRef(new CellRef(this.topLeft.row,e),new CellRef(this.bottomRight.row,e)).setSheet(this.sheet,this.hasSheet())}toCell(e,t){return e+=Math.max(0,this.topLeft.row),t+=Math.max(0,this.topLeft.col),new CellRef(e,t,0).setSheet(this.sheet,this.hasSheet())}forEachRow(e){let t=this.topLeft.row,r=this.bottomRight.row,n=this.topLeft.col,i=this.bottomRight.col;for(let o=t;o<=r;o++)e(new RangeRef(new CellRef(o,n),new CellRef(o,i)))}forEachColumn(e){let t=this.topLeft.row,r=this.bottomRight.row,n=this.topLeft.col,i=this.bottomRight.col;for(let o=n;o<=i;o++)e(new RangeRef(new CellRef(t,o),new CellRef(r,o)))}intersecting(e){return e.filter((e=>e.toRangeRef().intersects(this)))}union(e,t){let r=this.intersecting(e),n=this.topLeft.row,i=this.topLeft.col,o=this.bottomRight.row,s=this.bottomRight.col,a=!1;r.forEach((function(e){(e=e.toRangeRef()).topLeft.row<n&&(a=!0,n=e.topLeft.row),e.topLeft.col<i&&(a=!0,i=e.topLeft.col),e.bottomRight.row>o&&(a=!0,o=e.bottomRight.row),e.bottomRight.col>s&&(a=!0,s=e.bottomRight.col),t&&t(e)}));let l=new RangeRef(new CellRef(n,i),new CellRef(o,s));return a?l.union(e,t):l}resize(e){let t=Math.max.bind(Math,0);function r(e){return e||0}let n=this.topLeft.row+r(e.top),i=this.topLeft.col+r(e.left),o=this.bottomRight.row+r(e.bottom),s=this.bottomRight.col+r(e.right);return i<0&&s<0||n<0&&o<0?NULLREF:n<=o&&i<=s?new RangeRef(new CellRef(t(n),t(i)),new CellRef(t(o),t(s))):NULLREF}move(e,t){return new RangeRef(new CellRef(this.topLeft.row+e,this.topLeft.col+t),new CellRef(this.bottomRight.row+e,this.bottomRight.col+t))}first(){return this.topLeft.clone().setSheet(this.sheet,this.hasSheet())}isCell(){return!this.endSheet&&this.topLeft.eq(this.bottomRight)}toString(){return this.topLeft+":"+this.bottomRight}adjust(e,t,r,n,i,o,s){let a=this.topLeft.adjust(e,t,r,n,i,o,s),l=this.bottomRight.adjust(e,t,r,n,i,o,s);return a===NULLREF&&l===NULLREF?NULLREF:(a===NULLREF?(a=this.topLeft.absolute(e,t),i?a.row=o:a.col=o,null!=r&&null!=n&&(a=a.relative(r,n,this.topLeft.rel))):l===NULLREF&&(l=this.bottomRight.absolute(e,t),i?l.row=o-1:l.col=o-1,null!=r&&null!=n&&(l=l.relative(r,n,this.bottomRight.rel))),new RangeRef(a,l).setSheet(this.sheet,this.hasSheet()).simplify())}valid(){return this.topLeft.valid()&&this.bottomRight.valid()}}class UnionRef extends Ref{constructor(e){super(),this.refs=e,this.length=e.length}clone(){return new UnionRef(this.refs.slice())}intersect(e){let t=[];for(let r=0;r<this.length;++r){let n=e.intersect(this.refs[r]);n!==NULLREF&&t.push(n)}return t.length>0?new UnionRef(t).simplify():NULLREF}simplify(){let e=new UnionRef(this.refs.reduce((function(e,t){return(t=t.simplify())!==NULLREF&&e.push(t),e}),[]));return e.empty()?NULLREF:e.single()?e.refs[0]:e}absolute(e,t){return new UnionRef(this.refs.map((function(r){return r.absolute(e,t)})))}forEach(e,t){this.refs.forEach((function(r){r instanceof UnionRef?r.forEach(e,t):e.call(t,r)}),t)}toRangeRef(){return this.refs[0].toRangeRef()}contains(e){return this.refs.some((function(t){return t.contains(e)}))}map(e,t){let r=[];return this.forEach((function(n){r.push(e.call(t,n))})),new UnionRef(r)}first(){return this.refs[0].first()}lastRange(){return this.refs[this.length-1]}size(){return this.length}single(){return 1==this.length}empty(){return 0===this.length}isCell(){return this.single()&&this.refs[0].isCell()}rangeAt(e){return this.refs[e]}nextRangeIndex(e){return e===this.length-1?0:e+1}previousRangeIndex(e){return 0===e?this.length-1:e-1}concat(e){return new UnionRef(this.refs.concat([e]))}print(e,t,r){return this.refs.map((function(n){return n.print(e,t,r)})).join(",")}replaceAt(e,t){let r=this.refs.slice();return r.splice(e,1,t),new UnionRef(r)}leftColumn(){return this.map((function(e){return e.leftColumn()}))}rightColumn(){return this.map((function(e){return e.rightColumn()}))}topRow(){return this.map((function(e){return e.topRow()}))}bottomRow(){return this.map((function(e){return e.bottomRow()}))}forEachRow(e){this.forEach((function(t){t.forEachRow(e)}))}forEachColumn(e){this.forEach((function(t){t.forEachColumn(e)}))}adjust(e,t,r,n,i,o,s){return this.map((function(a){return a.adjust(e,t,r,n,i,o,s)})).simplify()}toString(){return this.refs.map((function(e){return e.toString()})).join(", ")}valid(){for(let e=this.refs.length;--e>=0;)if(this.refs[e].valid())return!1;return!0}renameSheet(e,t){this.refs.forEach((function(r){r.renameSheet(e,t)}))}}const FIRSTREF=new CellRef(0,0),SHEETREF=new RangeRef(new CellRef(0,0),new CellRef(1/0,1/0));SHEETREF.print=function(){return"#SHEET"};const messages={view:{nameBox:"Name Box",errors:{modifyMerged:"Cannot change part of a merged cell.",openUnsupported:"Unsupported format. Please select an .xlsx file.",shiftingNonblankCells:"Cannot insert cells due to data loss possibility. Select another insert location or delete the data from the end of your worksheet.",insertColumnWhenRowIsSelected:"Cannot insert column when all columns are selected.",insertRowWhenColumnIsSelected:"Cannot insert row when all rows are selected.",filterRangeContainingMerges:"Cannot create a filter within a range containing merges",sortRangeContainingMerges:"Cannot sort a range containing merges",cantSortMultipleSelection:"Cannot sort multiple selection",cantSortNullRef:"Cannot sort empty selection",cantSortMixedCells:"Cannot sort range containing cells of mixed shapes",validationError:"The value that you entered violates the validation rules set on the cell.",cannotModifyDisabled:"Cannot modify disabled cells.",insertRowBelowLastRow:"Cannot insert row below the last row.",insertColAfterLastCol:"Cannot insert column to the right of the last column."},tabs:{home:"Home",insert:"Insert",data:"Data"}},menus:{cut:"Cut",copy:"Copy",paste:"Paste",merge:"Merge",unmerge:"Unmerge",delete:"Delete",hide:"Hide",unhide:"Unhide",bringToFront:"Bring to front",sendToBack:"Send to back"},workbook:{defaultSheetName:"Sheet"}},options={name:"Spreadsheet",toolbar:!0,sheetsbar:!0,rows:200,columns:50,rowHeight:20,columnWidth:64,headerHeight:20,headerWidth:32,excel:{fileName:"Workbook.xlsx",forceProxy:!1,proxyURL:""},messages:messages,pdf:{area:"workbook",fileName:"Workbook.pdf",proxyURL:"",paperSize:"a4",landscape:!0,margin:null,title:null,author:null,subject:null,keywords:null,creator:"Kendo UI PDF Generator",date:null},defaultCellStyle:{fontFamily:"Arial",fontSize:12},useCultureDecimals:!1,locale:"en"},ALL_REASONS={recalc:!0,selection:!0,activeCell:!0,layout:!0,sheetSelection:!0,resize:!0,editorChange:!1,editorClose:!1},keys={INSERT:45,DELETE:46,BACKSPACE:8,TAB:9,ENTER:13,ESC:27,LEFT:37,UP:38,RIGHT:39,DOWN:40,END:35,HOME:36,SPACEBAR:32,PAGEUP:33,PAGEDOWN:34,F2:113,F10:121,F11:122,F12:123,NUMPAD_PLUS:107,NUMPAD_MINUS:109,NUMPAD_DOT:110,B:66,I:73,U:85,N:78,H:72,A:65,R:82},RX_UNICODE_LETTER=new RegExp("[\\u0041-\\u005A\\u0061-\\u007A\\u00AA\\u00B5\\u00BA\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function isUnicodeLetter(e){return RX_UNICODE_LETTER.test(e)}function memoize(e){let t=Object.create(null);return function(){let r="";for(let e=arguments.length;--e>=0;)r+=":"+arguments[e];return r in t?t[r]:t[r]=e.apply(this,arguments)}}function arabicToRoman(e){let t={1:"i",10:"x",100:"c",2:"ii",20:"xx",200:"cc",3:"iii",30:"xxx",300:"ccc",4:"iv",40:"xl",400:"cd",5:"v",50:"l",500:"d",6:"vi",60:"lx",600:"dc",7:"vii",70:"lxx",700:"dcc",8:"viii",80:"lxxx",800:"dccc",9:"ix",90:"xc",900:"cm",1e3:"m"},r=[1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],n="";for(;e>0;)e<r[0]?r.shift():(n+=t[r[0]],e-=r[0]);return n}function romanToArabic(e){e=e.toLowerCase();let t={i:1,v:5,x:10,l:50,c:100,d:500,m:1e3},r=0,n=0;for(let i=0;i<e.length;++i){let o=t[e.charAt(i)];if(!o)return null;r+=o,o>n&&(r-=2*n),n=o}return r}function withExit(e,t){try{return e.call(t,(function(e){throw new r(e)}))}catch(e){if(e instanceof r)return e.value;throw e}function r(e){this.value=e}}const getterCache={undefined:e=>e},FIELD_REGEX=/\[(?:(\d+)|['"](.*?)['"])\]|((?:(?!\[.*?\]|\.).)+)/g;function getter(e,t){const r=e+t;if(getterCache[r])return getterCache[r];const n=[];return e.replace(FIELD_REGEX,((e,t,r,i)=>{n.push(isPresent(t)?t:r||i)})),getterCache[r]=e=>{let r=e;for(let e=0;e<n.length;e++)if(r=r[n[e]],!isPresent(r)&&t)return r;return r},getterCache[r]}function deepExtend(e){let t=1,r=arguments.length;for(t=1;t<r;t++)deepExtendOne(e,arguments[t]);return e}function deepExtendOne(e,t){let r,n,i,o;for(r in t)"__proto__"!==r&&"constructor"!==r&&(n=t[r],i=typeof n,n instanceof Date?e[r]=new Date(n.getTime()):isFunction(n?.clone)?e[r]=n.clone():"object"===i&&null!==n&&isPlainObject(n)?(o=e[r],"object"==typeof o&&null!==o||(e[r]={}),deepExtendOne(e[r],n)):"undefined"!==i&&(e[r]=n));return e}function guid(){let e,t,r="",n="abcdef";for(r+=n[Math.floor(Math.random()*Math.floor(6))],e=1;e<32;e++)t=16*Math.random()|0,8!==e&&12!==e&&16!==e&&20!==e||(r+="-"),r+=(12===e?4:16===e?3&t|8:t).toString(16);return r}const support={},scrollbar=function(e){if(!isNaN(support._scrollbar)&&!e)return support._scrollbar;let t,r=document.createElement("div");return r.style.overflow="scroll",r.style.overflowX="hidden",r.style.zoom="1",r.style.clear="both",r.style.display="block",r.innerHTML="&nbsp;",document.body.appendChild(r),support._scrollbar=t=r.offsetWidth-r.scrollWidth,document.body.removeChild(r),t};function toCamelCase(e){return e.replace(/\-(\w)/g,(function(e,t){return t.toUpperCase()}))}function size(e){let t,r=0;for(t in e)e.hasOwnProperty(t)&&"toJSON"!==t&&r++;return r}const kendoGetComputedStyles=function(e,t){let r,n={};return document.defaultView&&document.defaultView.getComputedStyle?(r=document.defaultView.getComputedStyle(e,""),t&&t.forEach((function(e){n[e]=r.getPropertyValue(e)}))):(r=e.currentStyle,t&&t.forEach((function(e){n[e]=r[toCamelCase(e)]}))),size(n)||(n=r),n},insertAfter=function(e,t){t.parentNode.insertBefore(e,t.nextSibling)},_activeElement$1=function(){try{return document.activeElement}catch(e){return document.documentElement.activeElement}},isPresent=e=>null!=e,isBlank=e=>!isPresent(e),isDate=e=>e&&e.getTime,isString=e=>"string"==typeof e,isNumeric=e=>!isNaN(e-parseFloat(e)),isFunction=e=>"function"==typeof e,isPlainObject=function(e){if(!e||"[object Object]"!==toString.call(e))return!1;const t=Object.getPrototypeOf(e);return null===t||t.constructor===Object};class CalcError{constructor(e){if(e instanceof CalcError)return e;this.code=e}toString(){return"#"+this.code+("NAME"===this.code?"?":"!")}}let intlValue={};const intl=e=>{if(!e)return intlValue;intlValue=e},culture=()=>intl().localeInfo();function createKendoObj(e,t,r,n,i){const o={};return o.spreadsheet={calc:e,CalcError:t,Ref:r,CellRef:n,RangeRef:i},o.culture=()=>culture(),o}let calc={runtime:{FUNCS:Object.create(null)}},FUNCS$1=calc.runtime.FUNCS;class Context{constructor(e,t,r,n){this.callback=e,this.formula=t,this.ss=r,this.parent=n}resolve(e){var t=this;e instanceof Ref?t.resolveCells([e],(function(){t._resolve(e)})):t._resolve(e)}error(e){return new CalcError(e)}_resolve(e){e=void 0===e?null:Array.isArray(e)?this.asMatrix(e):maybeRoundFloatErrors(e);var t=this.formula;t.arrayFormulaRange?e=this.asMatrix(e)||this.asMatrix([[e]]):e instanceof RangeRef&&(e=this._arrayArg(e)),t.value=e,this.ss.onFormula(t)&&this.callback&&this.callback.call(t,e)}resolveCells(e,t){var r=this,n=[];if(function e(t){for(var n=0;n<t.length;++n){var i=t[n];i instanceof Ref&&s(r.getRefCells(i)),Array.isArray(i)&&e(i)}}(e),!n.length)return t.call(r);for(var i=n.length,o=0;o<n.length;++o)n[o].exec(r.ss,(function(){--i||t.call(r)}),r);function s(e){for(var t=0;t<e.length;++t){var r=e[t];r.formula&&n.push(r.formula)}return!0}}cellValues(e,t){for(var r=[],n=0;n<e.length;++n){var i=e[n];i instanceof Ref?(i=this.getRefData(i,t),r=r.concat(i)):Array.isArray(i)?r=r.concat(this.cellValues(i,t)):i instanceof Matrix?r=r.concat(this.cellValues(i.data,t)):r.push(i)}return r}fetchName(e,t){var r=this.formula,n=this.ss.nameValue(e,r.sheet,r.row,r.col);if(n instanceof Formula$1){n=n.clone(r.sheet,r.row,r.col,!0);var i=new calc.ValidationFormulaContext(this.ss.workbook);n.exec(i,t,this)}else n instanceof Ref&&((n=n.absolute(r.row,r.col))instanceof RangeRef&&this.ss.isMerged(n)&&(n=n.topLeft),n.sheet||(n.sheet=r.sheet)),t(null==n?new CalcError("NAME"):n)}force(e){return e instanceof Ref?this.getRefData(e):e}func(e,t,r){e=e.toLowerCase();var n=FUNCS$1[e];if(n)return n.call(this,t,r);t(new CalcError("NAME"))}bool(e){return e instanceof Ref&&(e=this.getRefData(e)),"string"==typeof e?"true"==e.toLowerCase():"number"==typeof e?0!==e:"boolean"==typeof e?e:null!=e}_arrayArg(e){var t=this.formula;return!t.arrayFormulaRange&&e instanceof RangeRef?1==e.height()&&t.col>=e.topLeft.col&&t.col<=e.bottomRight.col?this.getRefData(new CellRef(e.topLeft.row,t.col).setSheet(e.sheet)):1==e.width()&&t.row>=e.topLeft.row&&t.row<=e.bottomRight.row?this.getRefData(new CellRef(t.row,e.topLeft.col).setSheet(e.sheet)):new CalcError("VALUE"):this.asMatrix(e)}asMatrix(e){if(e instanceof Matrix)return e;let t=this;if(e instanceof RangeRef){let r=e.topLeft,n=r.row,i=r.col,o=t.getRefCells(e),s=new Matrix(t);return isFinite(e.width())&&(s.width=e.width()),isFinite(e.height())&&(s.height=e.height()),isFinite(n)||(n=0),isFinite(i)||(i=0),o.forEach((function(e){s.set(e.row-n,e.col-i,e.value)})),s}if(Array.isArray(e)&&e.length>0){let r=new Matrix(t),n=0;return e.forEach((function(e){let i=0,o=1;e.forEach((function(e){let s=e instanceof RangeRef;e instanceof Ref&&!s&&(e=t.getRefData(e)),(s||Array.isArray(e))&&(e=t.asMatrix(e)),e instanceof Matrix?(e.each((function(e,t,o){r.set(n+t,i+o,e)})),o=Math.max(o,e.height),i+=e.width):("string"==typeof e&&e.length&&!isNaN(e)&&(e=Number(e)),r.set(n,i++,e))})),n+=o})),r}}getRefCells(e,t,r){var n=this.formula;return this.ss.getRefCells(e,t,n.sheet,n.row,n.col,r)}getRefData(e,t){var r=this.formula;return this.ss.getData(e,r.sheet,r.row,r.col,t)}workbook(){return this.ss.workbook}}function argmax(e,t,r){for(var n=r(e),i=e;++e<t;){var o=r(e);o>n&&(n=o,i=e)}return i}class Matrix{constructor(e){this.context=e,this.height=0,this.width=0,this.data=[]}clone(){var e=new Matrix(this.context);return e.height=this.height,e.width=this.width,e.data=this.data.map((function(e){return e.slice()})),e}get(e,t){var r=this.data[e],n=r?r[t]:null;return n instanceof Ref?this.context.getRefData(n):n}getNA(e,t){return 1==this.height&&(e=0),1==this.width&&(t=0),e<this.height&&t<this.width?this.get(e,t):new CalcError("N/A")}set(e,t,r){var n=this.data[e];null==n&&(n=this.data[e]=[]),n[t]=r,e>=this.height&&(this.height=e+1),t>=this.width&&(this.width=t+1)}each(e,t){for(var r=0;r<this.height;++r)for(var n=0;n<this.width;++n){var i=this.get(r,n);if((t||null!=i)&&void 0!==(i=e.call(this.context,i,r,n)))return i}}map(e,t){var r=new Matrix(this.context);return this.each((function(t,n,i){r.set(n,i,e.call(this,t,n,i))}),t),r}eachRow(e){for(var t=0;t<this.height;++t){var r=e.call(this.context,t);if(void 0!==r)return r}}eachCol(e){for(var t=0;t<this.width;++t){var r=e.call(this.context,t);if(void 0!==r)return r}}mapRow(e){var t=new Matrix(this.context);return this.eachRow((function(r){t.set(r,0,e.call(this.context,r))})),t}mapCol(e){var t=new Matrix(this.context);return this.eachCol((function(r){t.set(0,r,e.call(this.context,r))})),t}toString(){return JSON.stringify(this.data)}transpose(){var e=new Matrix(this.context);return this.each((function(t,r,n){e.set(n,r,t)})),e}unit(e){this.width=this.height=e;for(var t=this.data=new Array(e),r=e;--r>=0;)for(var n=t[r]=new Array(e),i=e;--i>=0;)n[i]=r==i?1:0;return this}multiply(e){for(var t=this,r=new Matrix(t.context),n=0;n<t.height;++n)for(var i=0;i<e.width;++i){for(var o=0,s=0;s<t.width;++s){var a=t.get(n,s),l=e.get(s,i);if("number"!=typeof a||"number"!=typeof l)throw new CalcError("VALUE");o+=a*l}r.set(n,i,o)}return r}adds(e,t){for(var r=this,n=new Matrix(r.context),i=t?-1:1,o=0;o<r.height;++o)for(var s=0;s<r.width;++s){var a=r.get(o,s),l=e.get(o,s);n.set(o,s,a+i*l)}return n}determinant(){var e,t,r,n,i=this.clone().data,o=i.length,s=1;for(e=0;e<o;e++){for(t=e;t<o&&!i[t][e];t++);if(t==o)return 0;if(t!=e)for(s=-s,n=e;n<o;n++){var a=i[e][n];i[e][n]=i[t][n],i[t][n]=a}for(r=e+1;r<o;r++)for(n=e+1;n<o;n++)i[r][n]-=i[e][n]*i[r][e]/i[e][e];s*=i[e][e]}return s}inverse(){let e,t=this.width,r=this.augment(new Matrix(this.context).unit(t)),n=r.data;for(let r=0;r<t;++r){let i=argmax(r,t,(function(e){return n[e][r]}));if(!n[i][r])return null;r!=i&&(e=n[r],n[r]=n[i],n[i]=e);for(let e=r+1;e<t;++e){for(let i=r+1;i<2*t;++i)n[e][i]-=n[r][i]*n[e][r]/n[r][r];n[e][r]=0}}for(let e=0;e<t;++e)for(let r=n[e][e],i=0;i<2*t;++i)n[e][i]/=r;for(let e=t;--e>=0;)for(let r=e;--r>=0;)if(n[r][e])for(let i=2*t;--i>=t;)n[r][i]-=n[e][i]*n[r][e];return r.slice(0,t,t,t)}augment(e){var t=this.clone(),r=t.width;return e.each((function(e,n,i){t.set(n,i+r,e)})),t}slice(e,t,r,n){for(var i=new Matrix(this.context),o=0;o<r;++o)for(var s=0;s<n;++s)i.set(o,s,this.get(e+o,t+s));return i}}function sameRef(e,t){if(e.constructor!==t.constructor)return!1;if(e instanceof CellRef)return e.sheet==t.sheet&&e.row==t.row&&e.col==t.col&&e.rel==t.rel;if(e instanceof RangeRef)return sameRef(e.topLeft,t.topLeft)&&sameRef(e.bottomRight,t.bottomRight)&&e.endSheet==t.endSheet;if(e instanceof UnionRef){var r=e.refs.length;if(r!=t.refs.length)return!1;for(;--r>=0;)if(!sameRef(e.refs[r],t.refs[r]))return!1}return!0}let Formula$1=class e{constructor(e,t,r,n,i,o,s){this.refs=e,this.handler=t,this.print=r,this.absrefs=null,this.sheet=n,this.row=i,this.col=o,this.onReady=[],this.pending=!1,this.arrayFormulaRange=s}setArrayFormulaRange(e){this.arrayFormulaRange=e.clone().setSheet(this.sheet)}clone(t,r,n,i){var o=t.toLowerCase(),s=this.refs,a=this.arrayFormulaRange;return(i||o!=this.sheet.toLowerCase())&&(s=s.map((function(e){return e.hasSheet()||e.sheet&&e.sheet.toLowerCase()==o||(e=e.clone().setSheet(t)),e})),a&&(a=a.clone().setSheet(t))),new e(s,this.handler,this.print,t,r,n,a)}deepClone(){var t=this.refs.map((function(e){return e.clone()}));return new e(t,this.handler,this.print,this.sheet,this.row,this.col,this.arrayFormulaRange)}resolve(e){this.pending=!1,this.onReady.forEach((function(t){t(e)}))}exec(e,t,r){if("value"in this)t&&t(this.value);else{t&&this.onReady.push(t);for(var n=new Context(this.resolve,this,e,r),i=0;r;){if(r.formula===this)return this.pending=!1,void n.resolve(new CalcError("CIRCULAR"));r=r.parent,++i}if(this.pending)return;this.pending=!0;var o=function(){this.absrefs||(this.absrefs=this.refs.map((function(e){return e.absolute(this.row,this.col)}),this)),this.handler.call(n)}.bind(this);i<20?o():setTimeout(o,0)}}reset(){this.onReady=[],this.pending=!1,delete this.value}renameSheet(e,t){e=e.toLowerCase(),this.absrefs=null,this.sheet.toLowerCase()==e&&(this.sheet=t),this.refs.forEach((function(r){r.renameSheet(e,t)}))}adjust(t,r,n,i){t=t.toLowerCase();var o=this.row,s=this.col,a=this.sheet.toLowerCase(),l=!1;a==t&&("row"==r&&o>=n&&(this.row+=i,l=!0),"col"==r&&s>=n&&(this.col+=i,l=!0));var u=this.row,c=this.col;this.absrefs=null;var h=this.refs,f=l;this.refs=h.map((function(e){var t=d(e);return f||sameRef(t,e)||(f=!0),t}));var p=this.arrayFormulaRange;if(p&&(this.arrayFormulaRange=d(p),f||sameRef(p,this.arrayFormulaRange)||(f=!0)),f)return new e(h,this.handler,this.print,this.sheet,o,s,p);function d(e){return e===NULLREF?e:e.sheet.toLowerCase()!=t?(l&&("row"==r&&o>=n&&(e=e.relative(i,0)),"col"==r&&s>=n&&(e=e.relative(0,i))),e):e.adjust(o,s,u,c,"row"==r,n,i)}}toString(){return this.print(this.row,this.col)}};function compileArgumentChecks(e,t){var r,n,i,o="function arrayArgs(args) { var xargs = [], width = 0, height = 0, arrays = [], i = 0; ",s="function resolve(args, callback) { var toResolve = [], i = 0; ",a="'use strict'; function check(args) { var stack = [], tmp, xargs = [], i = 0, m, err = 'VALUE'; ",l=!1,u=!1,c=!1;return a+=t.map((function e(t){r=t[0];var i="{ ";if(Array.isArray(r))o+="while (i < args.length) { ",s+="while (i < args.length) { ",i+="xargs.push(tmp = []); stack.push(xargs); xargs = tmp; ",i+="while (i < args.length) { ",i+=t.map(e).join(""),i+="} ",i+="xargs = stack.pop(); ",s+="} ",o+="} ";else if("+"==r)o+="while (i < args.length) { ",s+="while (i < args.length) { ",i+="if (i >= args.length) return new CalcError('N/A'); ",i+="xargs.push(tmp = []); stack.push(xargs); xargs = tmp; ",i+="do { ",i+=t.slice(1).map(e).join(""),i+="} while (i < args.length); ",i+="xargs = stack.pop(); ",s+="} ",o+="} ";else if("?"==r)i+="if (!("+p(t[1])+")) return new CalcError(err); ";else{var a=t[1];if(Array.isArray(a)&&/^#?collect/.test(a[0])){var l=/!$/.test(a[0]),f=a[2];h(),i+="try {var $"+r+" = this.cellValues(args.slice(i",f&&(i+=", i + "+f),i+=")"+(l?",true":"")+").reduce(function(ret, $"+r+"){ ","#"!=a[0].charAt(0)&&(i+="if ($"+r+" instanceof CalcError) throw $"+r+"; "),i+="if ("+p(a[1])+") ret.push($"+r+"); ",i+="return ret; ",i+="}.bind(this), []); ",i+=f?"i += "+f+"; ":"i = args.length; ",i+="xargs.push($"+r+")} catch(ex) { if (ex instanceof CalcError) return ex; throw ex; } ",s+="toResolve.push(args.slice(i)); "}else if("rest"==a)i+="xargs.push(args.slice(i)); i = args.length; ";else{(u=/^\*/.test(r))&&(c=!0,r=r.substr(1)),i+="var $"+r+" = args[i++]; ";var d=!1;/!$/.test(a)?(a=a.substr(0,a.length-1),d=!0):i+="if ($"+r+" instanceof CalcError) return $"+r+"; ",i+=function(e,t){n=!1;var i="if (!("+p(e)+")) { ";n&&!t&&(i+=" if ($"+r+" instanceof CalcError) return $"+r+"; ");n||(s+="i++; ");o+=u?"var $"+r+" = this._arrayArg(args[i]); if ($"+r+") { xargs.push($"+r+"); width = Math.max(width, $"+r+".width); height = Math.max(height, $"+r+".height); arrays.push(true) } else { xargs.push(args[i]); arrays.push(false); } i++; ":"xargs.push(args[i++]); arrays.push(false); ";return i+="return new CalcError(err); } "}(a,d)+"xargs.push($"+r+"); "}}return i+="} "})).join(""),a+="if (i < args.length) return new CalcError('N/A'); ",a+="return xargs; } ",o+="return { args: xargs, width: width, height: height, arrays: arrays }; } ",l?(s+="this.resolveCells(toResolve, callback); } ",i=new Function("kendo","CalcError","round",a+s+o+" return { resolve: resolve, check: check, arrayArgs: arrayArgs };")):i=new Function("kendo","CalcError","round",a+" return { check: check };"),i=i(calc.kendo,CalcError,limitPrecision$1),c||delete i.arrayArgs,i;function h(){return n?"$"+r:(l=!0,n=!0,s+="toResolve.push(args[i++]); ","($"+r+" = this.force($"+r+"))")}function f(e){return"("+(e?"(typeof "+h()+" == 'number' ? ($"+r+" = round($"+r+"), true) : false) || ":"(typeof "+h()+" == 'number') || ")+"(typeof $"+r+" == 'boolean' ? ($"+r+" = +$"+r+", true) : false) || (typeof $"+r+" == 'string' && !/^(?:=|true|false)/i.test($"+r+") ? (tmp = kendo.spreadsheet.calc.parse(0, 0, 0, $"+r+"), /^date|number|percent$/.test(tmp.type) ? ($"+r+" = +tmp.value, true) : false) : false))"}function p(e){if(Array.isArray(e)){if("or"==e[0])return"("+e.slice(1).map(p).join(") || (")+")";if("and"==e[0])return"("+e.slice(1).map(p).join(") && (")+")";if("values"==e[0])return"("+e.slice(1).map((function(e){return h()+" === "+e})).join(") || (")+")";if("null"==e[0])return"("+p("null")+" ? (($"+r+" = "+e[1]+"), true) : false)";if("between"==e[0]||"[between]"==e[0])return"("+h()+" >= "+e[1]+" && $"+r+" <= "+e[2]+" ? true : ((err = 'NUM'), false))";if("(between)"==e[0])return"("+h()+" > "+e[1]+" && $"+r+" < "+e[2]+" ? true : ((err = 'NUM'), false))";if("(between]"==e[0])return"("+h()+" > "+e[1]+" && $"+r+" <= "+e[2]+" ? true : ((err = 'NUM'), false))";if("[between)"==e[0])return"("+h()+" >= "+e[1]+" && $"+r+" < "+e[2]+" ? true : ((err = 'NUM'), false))";if("assert"==e[0]){var t=e[2]||"N/A";return"(("+e[1]+") ? true : (err = "+JSON.stringify(t)+", false))"}if("not"==e[0])return"!("+p(e[1])+")";throw new Error("Unknown array type condition: "+e[0])}if("number"==e||"datetime"==e)return f(!0);if("number!"==e)return"(typeof "+h()+" == 'number' ? ($"+r+" = round($"+r+"), true) : false)";if("integer"==e||"date"==e)return"("+f()+" && (($"+r+" |= 0), true))";if("divisor"==e)return"("+f(!0)+" && ($"+r+" == 0 ? ((err = 'DIV/0'), false) : true))";if("number+"==e)return"("+f(!0)+" && ($"+r+" >= 0 ? true : ((err = 'NUM'), false)))";if("integer+"==e)return"("+f()+" && (($"+r+" |= 0) >= 0 ? true : ((err = 'NUM'), false)))";if("number++"==e)return"("+f(!0)+" && ($"+r+" > 0 ? true : ((err = 'NUM'), false)))";if("integer++"==e)return"("+f()+" && (($"+r+" |= 0) > 0 ? true : ((err = 'NUM'), false)))";if("string"==e)return"((typeof "+h()+" == 'string' || typeof $"+r+" == 'boolean' || typeof $"+r+" == 'number') ? ($"+r+" += '', true) : ($"+r+" === undefined ? (($"+r+" = ''), true) : false))";if("boolean"==e)return"(typeof "+h()+" == 'boolean')";if("logical"==e)return"(typeof "+h()+" == 'boolean' || (typeof $"+r+" == 'number' ? ($"+r+" = !!$"+r+", true) : false))";if("matrix"==e)return h(),"((m = this.asMatrix($"+r+")) ? ($"+r+" = m) : false)";if("#matrix"==e)return"((m = this.asMatrix($"+r+")) ? ($"+r+" = m) : false)";if("ref"==e)return"($"+r+" instanceof kendo.spreadsheet.Ref)";if("area"==e)return"($"+r+" instanceof kendo.spreadsheet.CellRef || $"+r+" instanceof kendo.spreadsheet.RangeRef)";if("cell"==e)return"($"+r+" instanceof kendo.spreadsheet.CellRef)";if("null"==e)return"("+h()+" == null)";if("anyvalue"==e)return"("+h()+" != null && i <= args.length)";if("forced"==e)return"("+h()+", i <= args.length)";if("anything"==e)return"(i <= args.length)";if("blank"==e)return"("+h()+" == null || $"+r+" === '')";throw new Error("Can't check for type: "+e)}}function limitPrecision$1(e,t){return e===parseInt(e,10)?e:+e.toPrecision(t||16)}function maybeRoundFloatErrors(e,t){return"number"==typeof e?limitPrecision$1(e,t):e}function withErrorHandling(e,t,r){if(r instanceof CalcError)return r;try{return t.apply(e,r)}catch(e){if(e instanceof CalcError)return e;throw e}}function makeSyncFunction(e,t,r,n){return function(i,o){function s(){if(n){let t=n.call(this,o);if(o=t.args,t.width>0&&t.height>0){let n=new Matrix(this);for(let i=0;i<t.height;++i)for(let s=0;s<t.width;++s){let a=[];for(let e=0;e<o.length;++e)t.arrays[e]?a[e]=o[e].getNA(i,s):a[e]=o[e];a=r.call(this,a),n.set(i,s,withErrorHandling(this,e,a))}return i(n)}}let t=r.call(this,o);i(withErrorHandling(this,e,t))}t?t.call(this,o,s):s.call(this)}}function makeAsyncFunction(e,t,r,n){return function(i,o){function s(){if(n){let t=n.call(this,o);if(o=t.args,t.width>0&&t.height>0){let n=new Matrix(this),s=t.width*t.height,a=function(e,t){return function(r){if(n.set(e,t,r),--s,0===s)return i(n)}};for(let l=0;l<t.height&&s>0;++l)for(let u=0;u<t.width&&s>0;++u){let c=[];for(let e=0;e<o.length;++e)t.arrays[e]?c[e]=o[e].getNA(l,u):c[e]=o[e];if(c=r.call(this,c),c instanceof CalcError){if(n.set(l,u,c),--s,0===s)return i(n)}else c.unshift(a(l,u)),e.apply(this,c)}return}}let t=r.call(this,o);t instanceof CalcError?i(t):(t.unshift(i),e.apply(this,t))}t?t.call(this,o,s):s.call(this)}}function defineFunction(e,t){return e=e.toLowerCase(),FUNCS$1[e]=t,{args:function(r,n){var i=compileArgumentChecks(e,r);return n&&(i.arrayArgs&&window.console.log(i.arrayArgs.toString()),i.resolve&&window.console.log(i.resolve.toString()),i.check&&window.console.log(i.check.toString())),(FUNCS$1[e]=makeSyncFunction(t,i.resolve,i.check,i.arrayArgs)).kendoSpreadsheetArgs=r,this},argsAsync:function(r,n){var i=compileArgumentChecks(e,r);return n&&(i.arrayArgs&&window.console.log(i.arrayArgs.toString()),i.resolve&&window.console.log(i.resolve.toString()),i.check&&window.console.log(i.check.toString())),(FUNCS$1[e]=makeAsyncFunction(t,i.resolve,i.check,i.arrayArgs)).kendoSpreadsheetArgs=r,this}}}function defineBuiltinFunction$1(e,t,r,n){FUNCS$1[e]=t?makeAsyncFunction(n,r.resolve,r.check,r.arrayArgs):makeSyncFunction(n,r.resolve,r.check,r.arrayArgs)}function dateToJulianDays(e,t,r){return(1461*(e+4800+((++t-14)/12|0))/4|0)+(367*(t-2-12*((t-14)/12|0))/12|0)-(3*((e+4900+((t-14)/12|0))/100|0)/4|0)+r-32075}function julianDaysToDate(e){var t,r,n,i,o,s,a;return t=e+68569,s=(t=(t-=(146097*(r=4*t/146097|0)+3)/4|0)-(1461*(i=4e3*(t+1)/1461001|0)/4|0)+31)-(2447*(n=80*t/2447|0)/80|0),o=n+2-12*(t=n/11|0),{year:a=100*(r-49)+i+t,month:--o,date:s,day:(e+1)%7,ord:ORDINAL_ADD_DAYS[isLeapYear$1(a)][o]+s}}FUNCS$1.if=function(e,t){var r=this,n=t[0],i=t[1],o=t[2];this.resolveCells([n],(function(){var t=r.asMatrix(n);t?i((function(n){o((function(i){var o=r.asMatrix(n),s=r.asMatrix(i);e(t.map((function(e,t,a){return e instanceof CalcError?e:r.bool(e)?o?o.get(t,a):n:s?s.get(t,a):i})))}))})):(n=this.force(n))instanceof CalcError?e(n):r.bool(n)?i(e):o(e)}))},FUNCS$1["φ"]=function(e){e((1+Math.sqrt(5))/2)};var BASE_DATE=dateToJulianDays(1900,0,-1),DAYS_IN_MONTH=[31,28,31,30,31,30,31,31,30,31,30,31],ORDINAL_ADD_DAYS=[[0,31,59,90,120,151,181,212,243,273,304,334],[0,31,60,91,121,152,182,213,244,274,305,335]];function isLeapYear$1(e){return e%4?0:e%100?1:e%400?0:1}function daysInYear$1(e){return isLeapYear$1(e)?366:365}function daysInMonth$1(e,t){return isLeapYear$1(e)&&1==t?29:DAYS_IN_MONTH[t]}function validDate(e,t,r){return t>=1&&t<=12&&r>=1&&r<=daysInMonth$1(e,t-1)}function unpackDate$2(e){return julianDaysToDate((0|e)+BASE_DATE)}function packDate$2(e,t,r){return dateToJulianDays(e,t,r)-BASE_DATE}var MS_IN_MIN=6e4,MS_IN_HOUR=60*MS_IN_MIN,MS_IN_DAY=24*MS_IN_HOUR;function unpackTime$1(e){var t=e-(0|e);t<0&&t++;var r=Math.round(MS_IN_DAY*t),n=Math.floor(r/MS_IN_HOUR);r-=n*MS_IN_HOUR;var i=Math.floor(r/MS_IN_MIN);r-=i*MS_IN_MIN;var o=Math.floor(r/1e3);return{hours:n,minutes:i,seconds:o,milliseconds:r-=1e3*o}}function serialToDate$2(e){var t=unpackDate$2(e),r=unpackTime$1(e);return new Date(t.year,t.month,t.date,r.hours,r.minutes,r.seconds,r.milliseconds)}function packTime$1(e,t,r,n){return(e+(t+(r+n/1e3)/60)/60)/24}function dateToSerial$2(e){var t=packTime$1(e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds());return(e=packDate$2(e.getFullYear(),e.getMonth(),e.getDate()))<0?e-1+t:e+t}function parseDate(e,t){t&&(t=calc.formatting.makeDateFormat(t));const r=intl().parseDate;return r(e,t)||r(e)||r(e,["MMMM dd yyyy","MMMM dd yy","MMM dd yyyy","MMM dd yy","dd MMMM yyyy","dd MMMM yy","dd MMM yyyy","dd MMM yy","MMMM dd, yyyy","MMMM dd, yy","MMM dd, yyyy","MMM dd, yy","MMMM dd","MMM dd","MMMM yyyy","MMM yyyy","dd MMMM","dd MMM"])}function defineAlias$1(e,t){var r=FUNCS$1[t];if(!r)throw new Error("Function "+t+" is not yet defined");r.kendoSpreadsheetAliases||(r.kendoSpreadsheetAliases=[t]),r.kendoSpreadsheetAliases.push(e),FUNCS$1[e]=r}class ParseError{constructor(e,t){this.message=e,this.pos=t}toString(){return this.message}}function InputStream(e){let t=0;return{next:r,peek:n,eof:i,croak:o,readWhile:function(e){let t="";for(;!i()&&e(n(),t);)t+=r();return t},readEscaped:function(e){let t=!1,n="";for(;!i();){let i=r();if(t)n+=i,t=!1;else if("\\"===i)t=!0;else{if(i===e)break;n+=i}}return n},lookingAt:function(r){return r.exec(e.substr(t))},skip:function(r){if("string"==typeof r)e.substr(t,r.length)!==r&&o("Expected "+r),s(r.length);else if(r instanceof RegExp){let n=r.exec(e.substr(t));if(n)return s(n[0].length),n}else s(r[0].length)},forward:s,pos:function(){return t}};function r(){return e.charAt(t++)}function n(){return e.charAt(t)}function i(){return""===n()}function o(r){throw new ParseError(r+" (input: "+e+")",t)}function s(e){for(;e-- >0;)r()}}function Node(){this.node=null}function NullNode(){}calc.runtime.CalcError=CalcError,calc.runtime.Formula=Formula$1,calc.runtime.Matrix=Matrix,calc.runtime.packDate=packDate$2,calc.runtime.unpackDate=unpackDate$2,calc.runtime.packTime=packTime$1,calc.runtime.unpackTime=unpackTime$1,calc.runtime.serialToDate=serialToDate$2,calc.runtime.dateToSerial=dateToSerial$2,calc.runtime.daysInMonth=daysInMonth$1,calc.runtime.validDate=validDate,calc.runtime.isLeapYear=isLeapYear$1,calc.runtime.daysInYear=daysInYear$1,calc.runtime.parseDate=parseDate,calc.runtime.limitPrecision=limitPrecision$1,calc.runtime.defineBuiltinFunction=defineBuiltinFunction$1,calc.runtime.defineAlias=defineAlias$1,calc.runtime.InputStream=InputStream,calc.runtime.ParseError=ParseError,Node.prototype={remove:function(){this.node.parentNode&&this.node.parentNode.removeChild(this.node),this.attr={}},attr:{},text:function(){return""}},NullNode.prototype={nodeName:"#null",attr:{style:{}},children:[],remove:function(){}};let NULL_NODE=new NullNode;function Element(e,t,r){this.nodeName=e,this.attr=t||{},this.children=r||[]}function TextNode(e){this.nodeValue=String(e)}function HtmlNode(e){this.html=e}function insertHtml(e,t){const r=document.createElement("div");for(r.innerHTML=t;r.firstChild;)e.appendChild(r.firstChild)}function html(e){return new HtmlNode(e)}function element(e,t,r){return new Element(e,t,r)}function text$1(e){return new TextNode(e)}function Tree(e){this.root=e,this.children=[]}Element.prototype=new Node,Element.prototype.appendTo=function(e){let t="string"==typeof this.nodeName?document.createElement(this.nodeName):this.nodeName,r=this.children;for(let e=0;e<r.length;e++)r[e].render(t,NULL_NODE);return e.appendChild(t),t},Element.prototype.render=function(e,t){let r;if(t.nodeName!==this.nodeName)t.remove(),r=this.appendTo(e);else{let n;r=t.node;let i=this.children,o=i.length,s=t.children,a=s.length;if(Math.abs(a-o)>2)return void this.render({appendChild:function(r){e.replaceChild(r,t.node)}},NULL_NODE);for(n=0;n<o;n++)i[n].render(r,s[n]||NULL_NODE);for(n=o;n<a;n++)s[n].remove()}this.node=r,this.syncAttributes(t.attr),this.removeAttributes(t.attr)},Element.prototype.syncAttributes=function(e){let t=this.attr;for(let r in t){let n=t[r],i=e[r];"style"===r?this.setStyle(n,i):n!==i&&this.setAttribute(r,n,i)}},Element.prototype.setStyle=function(e,t){let r,n=this.node;if(t)for(r in e)e[r]!==t[r]&&(n.style[r]=e[r]);else for(r in e)n.style[r]=e[r]},Element.prototype.removeStyle=function(e){let t=this.attr.style||{},r=this.node;for(let n in e)void 0===t[n]&&(r.style[n]="")},Element.prototype.removeAttributes=function(e){let t=this.attr;for(let r in e)"style"===r?this.removeStyle(e.style):void 0===t[r]&&this.removeAttribute(r)},Element.prototype.removeAttribute=function(e){let t=this.node;"style"===e?t.style.cssText="":"className"===e?t.className="":t.removeAttribute(e)},Element.prototype.setAttribute=function(e,t){let r=this.node;void 0!==r[e]?r[e]=t:r.setAttribute(e,t)},Element.prototype.text=function(){let e="";for(let t=0;t<this.children.length;++t)e+=this.children[t].text();return e},TextNode.prototype=new Node,TextNode.prototype.nodeName="#text",TextNode.prototype.render=function(e,t){let r;t.nodeName!==this.nodeName?(t.remove(),r=document.createTextNode(this.nodeValue),e.appendChild(r)):(r=t.node,this.nodeValue!==t.nodeValue&&r.parentNode&&(r.nodeValue=this.nodeValue)),this.node=r},TextNode.prototype.text=function(){return this.nodeValue},HtmlNode.prototype={nodeName:"#html",attr:{},remove:function(){for(let e=0;e<this.nodes.length;e++){let t=this.nodes[e];t.parentNode&&t.parentNode.removeChild(t)}},render:function(e,t){if(t.nodeName!==this.nodeName||t.html!==this.html){t.remove();let r=e.lastChild;insertHtml(e,this.html),this.nodes=[];for(let t=r?r.nextSibling:e.firstChild;t;t=t.nextSibling)this.nodes.push(t)}else this.nodes=t.nodes.slice(0)}},Tree.prototype={html:html,element:element,text:text$1,render:function(e){let t,r,n=this.children;for(t=0,r=e.length;t<r;t++){let r=n[t];r?r.node&&r.node.parentNode||(r.remove(),r=NULL_NODE):r=NULL_NODE,e[t].render(this.root,r)}for(t=r;t<n.length;t++)n[t].remove();this.children=e}};const dom={html:html,text:text$1,element:element,Tree:Tree,Node:Node};let RX_COLORS=/^\[(black|green|white|blue|magenta|yellow|cyan|red)\]/i,RX_CONDITION=/^\[(<=|>=|<>|<|>|=)(-?[0-9.]+)\]/;function parse$2(e){e=calc.runtime.InputStream(e);let t,r=[],n=!1;for(;!e.eof();){let e=l();r.push(e),e.cond&&(n=!0)}return n||(1===r.length?r[0].cond="num":2===r.length?(r[0].cond={op:">=",value:0},r[1].cond={op:"<",value:0}):r.length>=3&&(r[0].cond={op:">",value:0},r[1].cond={op:"<",value:0},r[2].cond={op:"=",value:0},r.length>3&&(r[3].cond="text",r=r.slice(0,4)))),r;function i(){let t=e.skip(RX_COLORS);if(t)return t[1].toLowerCase()}function o(){let t,r=[],n=null;for(;!e.eof()&&(t=a());)"date"===t.type?n&&/^(el)?time$/.test(n.type)&&"h"===n.part&&"m"===t.part&&t.format<3&&(t.type="time"):/^(el)?time$/.test(t.type)&&"s"===t.part&&n&&"date"===n.type&&"m"===n.part&&n.format<3&&(n.type="time"),/^(?:str|space|fill)$/.test(t.type)||(n=t),r.push(t);return r}function s(t){if("date"!==t.type||"m"===t.part&&t.format<3){let r=e.skip(/^\.(0+)/);r&&(t.fraction=r[1].length,"date"===t.type&&(t.type="time"))}return t}function a(){let r,n;if(n=e.skip(/^([#0?]+)(?:,([#0?]+))+/))return{type:"digit",sep:!0,format:n[1]+n[2],decimal:t};if(n=e.skip(/^[#0?]+/))return{type:"digit",sep:!1,format:n[0],decimal:t};if(n=e.skip(/^(e)([+-])/i))return{type:"exp",ch:n[1],sign:n[2]};if(n=e.skip(/^(d{1,4}|m{1,5}|yyyy|yy|y)/i))return n=n[1].toLowerCase(),s({type:"date",part:n.charAt(0),format:n.length});if(n=e.skip(/^(hh?|ss?)/i))return n=n[1].toLowerCase(),s({type:"time",part:n.charAt(0),format:n.length});if(n=e.skip(/^\[(hh?|mm?|ss?)\]/i))return n=n[1].toLowerCase(),s({type:"eltime",part:n.charAt(0),format:n.length});if(n=e.skip(/^(a[.]?m[.]?\/p[.]?m[.]?|a\/p)/i))return n=n[1].split("/"),{type:"ampm",am:n[0],pm:n[1]};switch(r=e.next()){case";":return null;case"\\":return{type:"str",value:e.next()};case'"':return{type:"str",value:e.readEscaped(r)};case"@":return{type:"text"};case"_":return{type:"space",value:e.next()};case"*":return{type:"fill",value:e.next()};case".":return e.lookingAt(/^\s*[#0?]/)?(t=!0,{type:"dec"}):{type:"str",value:"."};case"%":return{type:"percent"};case",":return{type:"comma"}}return{type:"str",value:r}}function l(){t=!1;let r=i(),n=function(){let t=e.skip(RX_CONDITION);if(t){let e=parseFloat(t[2]);if(!isNaN(e))return{op:t[1],value:e,custom:!0}}}();return!r&&n&&(r=i()),{color:r,cond:n,body:o()}}}function print$1(e){return e.map((function(e){let t="";e.color&&(t+="["+e.color+"]");e.cond&&"text"!==e.cond&&"num"!==e.cond&&(t+="["+e.cond.op+e.cond.value+"]");return t+=e.body.map(r).join(""),t})).join(";");function t(e,t){return t.fraction&&(e+="."+padLeft("",t.fraction,"0")),e}function r(e){return"digit"===e.type?e.sep?e.format.charAt(0)+","+e.format.substr(1):e.format:"exp"===e.type?e.ch+e.sign:"date"===e.type||"time"===e.type?t(padLeft("",e.format,e.part),e):"eltime"===e.type?t("["+padLeft("",e.format,e.part)+"]",e):"ampm"===e.type?e.am+"/"+e.pm:"str"===e.type?JSON.stringify(e.value):"text"===e.type?"@":"space"===e.type?"_"+e.value:"fill"===e.type?"*"+e.value:"dec"===e.type?".":"percent"===e.type?"%":"comma"===e.type?",":void 0}}function adjustDecimals(e,t){e.forEach((function(e){let r=t;if("text"===e.cond)return;let n=e.body,i=!1,o=n.length;for(;0!==r&&--o>=0;){let e=n[o];if("digit"===e.type){if(e.decimal){if(i=!0,r>0)e.format+=padLeft("",r,"0");else if(r<0){let t=e.format.length;e.format=e.format.substr(0,t+r),r+=t-e.format.length}if(0===e.format.length)for(n.splice(o,1);--o>=0;){if(e=n[o],"digit"===e.type&&e.decimal){++o;break}if("dec"===e.type){n.splice(o,1);break}}}if(r>0)break}}!i&&r>0&&n.splice(o+1,0,{type:"dec"},{type:"digit",sep:!1,decimal:!0,format:padLeft("",r,"0")})}))}function TokenStream2(e){let t=0;return{next:function(){return e[t++]},eof:function(){return t>=e.length},ahead:function(r,n){if(t+r<=e.length){let i=n.apply(null,e.slice(t,t+r));return i&&(t+=r),i}},restart:function(){t=0}}}let runtime$1={unpackDate:calc.runtime.unpackDate,unpackTime:calc.runtime.unpackTime,date:function(e,t,r,n){switch(r){case"d":switch(n){case 1:return t.date;case 2:return padLeft(t.date,2,"0");case 3:return e.calendar.days.format.abbreviated[t.day];case 4:return e.calendar.days.format.wide[t.day]}break;case"m":switch(n){case 1:return t.month+1;case 2:return padLeft(t.month+1,2,"0");case 3:return e.calendar.months.format.abbreviated[t.month];case 4:return e.calendar.months.format.wide[t.month];case 5:return e.calendar.months.format.narrow[t.month]}break;case"y":switch(n){case 1:case 4:return t.year;case 2:return t.year%100}}return"##"},time:function(e,t,r,n,i){let o,s;switch(t){case"h":o=padLeft(n?e.hours%12||12:e.hours,r,"0"),i&&(s=(e.minutes+(e.seconds+e.milliseconds/1e3)/60)/60);break;case"m":o=padLeft(e.minutes,r,"0"),i&&(s=(e.seconds+e.milliseconds/1e3)/60);break;case"s":o=padLeft(e.seconds,r,"0"),i&&(s=e.milliseconds/1e3)}return s&&(o+=runtime$1.toFixed(s,i).replace(/^0+/,"")),o},eltime:function(e,t,r,n){let i,o;switch(t){case"h":i=24*e;break;case"m":i=24*e*60;break;case"s":i=24*e*60*60}return n&&(o=i-(0|i)),i=padLeft(0|i,r,"0"),o&&(i+=runtime$1.toFixed(o,n).replace(/^0+/,"")),i},fill:function(e){return e},formatInt:function(e,t,r,n,i){t=runtime$1.toFixed(t,n).replace(/\..*$/,"");let o=r[r.length-1];n>0&&"0"!=o[r.length-1]&&("0"===t?t="":"-0"===t&&(t="-"));let s,a=!1,l=t.length-1,u=[],c=0;function h(t,r){i&&c&&c%3==0&&/^[0-9]$/.test(t)&&(s=e.numbers.symbols.group+s),r&&"-"===t&&(a=!0,t="0"),s=t+s,c++}for(let e=r.length;--e>=0;){let n=r[e];s="";for(let e=n.length;--e>=0;){let r=n.charAt(e);l<0?"0"==r?h("0"):"?"==r&&h(" "):("0"==t&&"?"==r?h(" "):"0"==r?h(t.charAt(l),!0):h(t.charAt(l)),l--)}if(0===e)for(;l>=0;)h(t.charAt(l--));u.unshift(s)}return a&&(u[0]="-"+u[0]),u},formatDec:function(e,t,r){let n=(e=runtime$1.toFixed(e,r)).indexOf(".");e=n>=0?e.substr(n+1).replace(/0+$/,""):"";let i=0,o=[];for(let r=0;r<t.length;++r){let n=t[r],s="";for(let t=0;t<n.length;++t){let r=n.charAt(t);i<e.length?s+=e.charAt(i++):"0"==r?s+="0":"?"==r&&(s+=" ")}o.push(s)}return o},toFixed:function(e,t){return function e(r,n){if(!isFinite(r))return"#NUM!";if(r<0)return"-"+e(-r);if(0===t)return String(Math.round(r));if(r===Math.round(r)&&!/e/i.test(String(r)))return r.toFixed(t);let i=digNumber(r),o=i.intpart,s=i.decpart;if(s.length<=t){for(;s.length<t;)s+="0";return o+"."+s}if(n)return o+"."+s.substr(0,t);let a=Math.pow(10,t);return e(Math.round(r*a)/a,!0)}(Number(e.toFixed(14)))}};function checkCondition(e,t,r){switch(e.op){case"=":return t==r;case"<":return t<r;case">":return t>r;case"<=":return t<=r;case">=":return t>=r}throw new Error(`Unknown condition operator: ${JSON.stringify(e)}`)}function compileFormatPart(e){let t=TokenStream2(e.body),r=!1,n=!1,i=!1,o=0,s=/[\$\xA2-\xA5\u058F\u060B\u09F2\u09F3\u09FB\u0AF1\u0BF9\u0E3F\u17DB\u20A0-\u20BD\uA838\uFDFC\uFE69\uFF04\uFFE0\uFFE1\uFFE5\uFFE6]/,a=0,l=!1,u=0,c=[],h=[],f=e.cond;function p(e,t){("digit"===e.type&&"comma"===t.type||"comma"===e.type&&e.hidden&&"comma"===t.type)&&(t.hidden=!0,a++)}for(;!t.eof();){t.ahead(2,p);let e=t.next();"percent"===e.type?o++:"digit"===e.type?e.decimal?(u+=e.format.length,h.push(e.format)):(c.push(e.format),e.sep&&(l=!0)):"time"===e.type?n=!0:"date"===e.type?r=!0:"ampm"===e.type&&(i=n=!0)}return function(p,d,m){let g,C,v,y,E;if("text"===f){if(!("string"==typeof d||d instanceof CalcError))return!1}else if("num"===f){if("number"!=typeof d)return!1}else if(f){if("number"!=typeof d)return!1;if(!checkCondition(f,d,f.value))return!1;f.custom||(d=Math.abs(d))}if((o>0||a>0||c.length||h.length||r||n)&&"number"!=typeof d)return!1;e.color&&(p.color=e.color),o>0&&(d*=Math.pow(100,o)),a>0&&(d/=Math.pow(1e3,a)),c.length&&(g=runtime$1.formatInt(m,d,c,u,l),v=parseInt(g[0])<0),h.length&&(C=runtime$1.formatDec(d,h,u)),(c.length||h.length)&&(p.type="number"),r&&(y=runtime$1.unpackDate(d)),n&&(E=runtime$1.unpackTime(d)),(r||n)&&(p.type="date");let w=!1,b="";for(t.restart();!t.eof();){let e=t.next();"dec"===e.type?b+=m.numbers.symbols.decimal:"comma"!==e.type||e.hidden?"percent"===e.type?(p.type="percent",b+=m.numbers.symbols.percentSign):"str"===e.type?(s.test(e.value)&&(p.type="currency",v&&(b+="-",w=!0)),b+=e.value):"text"===e.type?(p.type="text",b+=d):"space"===e.type?(b&&p.body.push(b),b="",p.body.push(e)):"fill"===e.type?b+=runtime$1.fill(e.value):"digit"===e.type?(v&&g[0]&&w&&(g[0]=g[0].replace("-","")),b+=e.decimal?C.shift():g.shift()):"date"===e.type?b+=runtime$1.date(m,y,e.part,e.format):"time"===e.type?b+=runtime$1.time(E,e.part,e.format,i,e.fraction):"eltime"===e.type?b+=runtime$1.eltime(d,e.part,e.format,e.fraction):"ampm"===e.type&&(b+=E.hours<12?e.am:e.pm):b+=","}return b&&p.body.push(b),!0}}let TEXT=compileFormatPart({cond:"text",body:[{type:"text"}]}),compile=memoize((function(e){let t=parse$2(e).map(compileFormatPart);return t.push(TEXT),function(e,r=culture()){let n={body:[]};for(let i=0;i<t.length&&!t[i](n,e,r);++i);return n}})),makeDateFormat=memoize((function(e){let t,r=parse$2(e),n=!1,i=!1;for(let e=0;e<r.length;++e){t=r[e];for(let e=0;e<t.body.length;++e)/^(?:date|time|ampm)$/.test(t.body[e].type)&&(n=!0,"ampm"===t.body[e].type&&(i=!0));if(n)break}return n?t.body.map((function(e){if("digit"===e.type)return e.sep?e.format.charAt(0)+","+e.format.substr(1):e.format;if("exp"===e.type)return e.ch+e.sign;if("date"===e.type||"time"===e.type){let t=e.part;return"date"===e.type&&/^m/.test(t)?t="M":"time"===e.type&&/^h/.test(t)&&(i||(t=t.toUpperCase())),function(e,t){t.fraction&&(e+=padLeft("",Math.max(t.fraction,3),"f"));return e}(padLeft("",e.format,t),e)}return"ampm"===e.type?"tt":"str"===e.type?e.value:"space"===e.type?" ":"dec"===e.type?".":"percent"===e.type?"%":"comma"===e.type?",":""})).join(""):null}));function padLeft(e,t,r){for(e+="";e.length<t;)e=r+e;return e}function padRight(e,t,r){for(e+="";e.length<t;)e+=r;return e}function digNumber(e){let t,r,n,i=String(e).toLowerCase(),o=i.indexOf(".");if(o<0?(o=i.indexOf("e"),o<0?(t=i,r=""):(t=i.substr(0,o),r=i.substr(o))):(t=i.substr(0,o),r=i.substr(o+1)),n=/(\d*)e([-+]?\d+)/.exec(r)){let e=parseInt(n[2],10);e>=0?(r=padRight(n[1],e,"0"),t+=r.substr(0,e),r=r.substr(e)):(t=padLeft(t,-e,"0"),r=t.substr(e)+n[1],t=t.substr(0,t.length+e))}return{intpart:t||"0",decpart:r}}function text(e){let t=e.body,r="";for(let e=0;e<t.length;++e){let n=t[e];"string"==typeof n?r+=n:"space"===n.type&&(r+=" ")}return r}const formatting={compile:compile,parse:parse$2,format:function(e,t,r){let n=compile(t)(e,r),i=dom.element("span");i.__dataType=n.type;let o=n.body;n.color&&(i.attr.style={color:n.color});for(let e=0;e<o.length;++e){let t=o[e];"string"==typeof t?i.children.push(dom.text(t)):"space"===t.type&&i.children.push(dom.element("span",{style:{visibility:"hidden"}},[dom.text(t.value)]))}return i},text:function(e,t,r){return text(compile(t)(e,r))},textAndColor:function(e,t,r){let n=compile(t)(e,r);return{text:text(n),color:n.color,type:n.type}},type:function(e,t,r){return compile(t)(e,r).type},adjustDecimals:function(e,t){let r=parse$2(e);return adjustDecimals(r,t),print$1(r)},makeDateFormat:makeDateFormat},kendo=createKendoObj(calc,CalcError,Ref,CellRef,RangeRef);calc.kendo=kendo,calc.formatting=formatting;let OPERATORS_STANDARD=Object.create(null),OPERATORS_COMMA=Object.create(null);!function(e){e.forEach((function(t,r){t.forEach((function(t){OPERATORS_STANDARD[t]=e.length-r,OPERATORS_COMMA[","===t?";":t]=e.length-r}))}))}([[":"],[" "],[","],["%"],["^"],["*","/"],["+","-"],["&"],["=","<",">","<=",">=","<>"]]);let OPERATORS=OPERATORS_STANDARD,SEPARATORS={DEC:".",ARG:",",COL:","};function setDecimalSeparator(e){SEPARATORS.DEC=e,SEPARATORS.ARG=","===e?";":",",SEPARATORS.COL=","===e?"\\":",",OPERATORS=","===e?OPERATORS_COMMA:OPERATORS_STANDARD}calc.withDecimalSeparator=function(e,t){if(SEPARATORS.DEC===e)return t();let r=SEPARATORS.DEC;setDecimalSeparator(e);try{return t()}finally{setDecimalSeparator(r)}},calc._separators=SEPARATORS;let TRUE={type:"bool",value:!0},FALSE={type:"bool",value:!1};function getcol(e){e=e.toUpperCase();let t=0;for(let r=0;r<e.length;++r)t=26*t+e.charCodeAt(r)-64;return t-1}function getrow(e){return parseInt(e,10)-1}function parseReference(e,t){if("#sheet"===e.toLowerCase())return SHEETREF;e:{let t;if(t=/^(\$)?([a-z]+)(\$)?(\d+)$/i.exec(e)){let e=getrow(t[4]),r=getcol(t[2]);if(e<1048576&&r<16384)return new CellRef(getrow(t[4]),getcol(t[2]));break e}let r=TokenStream(e,{}),n=[];for(;;){let e=r.next();if(e instanceof CellRef)e.rel=0;else{if(!(e instanceof RangeRef))break e;e.topLeft.rel=0,e.bottomRight.rel=0}if(n.push(e),r.eof())break;if(!r.is("op",SEPARATORS.ARG))break e;r.next()}return 1===n.length?n[0]:new UnionRef(n)}if(!t)throw new Error("Cannot parse reference: "+e)}function parseFormula(e,t,r,n){let i=[],o=(n=TokenStream(n,{row:t,col:r})).is;return{type:"exp",ast:l(!0),refs:i,sheet:e,row:t,col:r};function s(e){return e.index=i.length,i.push(e),e}function a(e,t,r){if(o(e,t))return n.next();{let i=n.peek();i?n.croak("Expected "+e+" «"+t+"» but found "+i.type+" «"+i.value+"»"):r||n.croak("Expected "+e+" «"+t+"»")}}function l(e){return h((t=u(),o("punc","(")||o("ref")||o("num")||o("func")?{type:"binary",op:" ",left:t,right:l(!1)}:t),0,e);var t}function u(){let t;var r,i;return o("ref")?((i=n.next()).hasSheet()||i.setSheet(e),t=s(i)):o("func")?t=function(){let e=n.next();e=e.value,a("punc","(");let t=[];for(;!o("punc",")");)if(o("op",SEPARATORS.ARG))t.push({type:"null"}),n.next();else{if(t.push(l(!1)),n.eof()||o("punc",")"))break;a("op",SEPARATORS.ARG)}return a("punc",")",!0),{type:"func",func:e,args:t}}():o("punc","(")?(n.next(),t=l(!0),a("punc",")",!0)):o("punc","{")?(n.next(),t=function(){let e=[],t=[e],r=!0;for(;!n.eof()&&!o("punc","}");)r?r=!1:o(null,";")?(t.push(e=[]),n.next()):a(null,SEPARATORS.COL),e.push(l(!1));return{type:"matrix",value:t}}(),a("punc","}",!0)):o("num")||o("str")||o("error")?t=n.next():o("sym")?t="TRUE"===(r=n.next()).upper||"FALSE"===r.upper?"TRUE"===r.upper?TRUE:FALSE:s(new NameRef(r.value)):o("op","+")||o("op","-")?t={type:"prefix",op:n.next().value,exp:u()}:n.peek()?o("punc","[")?n.croak("External reference not supported"):n.croak("Parse error"):n.croak("Incomplete expression"),c(t)}function c(e){return o("op","%")?(n.next(),c({type:"postfix",op:"%",exp:e})):e}function h(e,t,r){let i=o("op");if(i&&(r||i.value!==SEPARATORS.ARG)){let o=OPERATORS[i.value];if(o>t){n.next();let s=h(u(),o,r);return h({type:"binary",op:";"===i.value?",":i.value,left:e,right:s},t,r)}}return e}}function parseNameDefinition(e,t){let r=parseFormula(null,0,0,e);if(!(r.ast instanceof NameRef))throw new calc.runtime.ParseError("Invalid name: "+e);if(r=r.ast,!(t instanceof Ref)){let e=parseFormula(r.sheet,0,0,t);t=e.ast instanceof Ref?e.ast:/^(?:str|num|bool|error)$/.test(e.ast.type)?e.ast.value:makeFormula(e)}return{name:r,value:t}}function print(e,t,r,n,i){return function e(s,a,l){switch(s.type){case"num":return"."==calc._separators.DEC?JSON.stringify(s.value):JSON.stringify(s.value).replace(".",calc._separators.DEC);case"bool":return s.value;case"error":return"#"+s.value;case"str":return JSON.stringify(s.value);case"ref":return u((()=>t[s.index].print(r,n,i)));case"prefix":return u((()=>s.op+e(s.exp,s,OPERATORS[s.op])));case"postfix":return u((()=>e(s.exp,s,OPERATORS[s.op])+s.op));case"binary":return u((()=>{let t=o(e(s.left,s,OPERATORS[s.op]),s.left instanceof NameRef&&":"===s.op),r=o(e(s.right,s,OPERATORS[s.op]),s.right instanceof NameRef&&":"===s.op);return/^[,;]/.test(s.op)?t+calc._separators.ARG+r:t+s.op+r}));case"func":return s.func+"("+s.args.map((t=>e(t,s,0))).join(calc._separators.ARG+" ")+")";case"matrix":return"{ "+s.value.map((t=>t.map((t=>e(t,s,0))).join(calc._separators.COL))).join("; ")+" }";case"null":return""}throw new Error("Cannot print node "+s.type);function u(e){let t=s.op,r=OPERATORS[t]<l||!l&&","===t||"prefix"===a.type&&l===OPERATORS[t]&&"-"===a.op||"binary"===a.type&&l===OPERATORS[t]&&s===a.right;return o(e(),r)}}(e.ast,e,0);function o(e,t){return t?"("+e+")":e}}function makePrinter(e){return function(t,r,n){return print(e,this.refs,t,r,n)}}function evRef(e,t,r){return"name"===t.ref?e.fetchName(t,r):r(e.formula.absrefs[t.index])}function evFuncIf(e,t,r,n,i){return evaluate(e,t,(t=>e.func("if",i,[t,t=>evaluate(e,r,t),t=>evaluate(e,n,t)])))}function evFuncAnd(e,t,r){return 0===t.length?r(!0):1===t.length?evaluate(e,t[0],(t=>r(e.bool(t)))):evaluate(e,t[0],(n=>e.bool(n)?evFuncAnd(e,t.slice(1),r):r(!1)))}function evFuncOr(e,t,r){return 0===t.length?r(!1):1===t.length?evaluate(e,t[0],(t=>r(e.bool(t)))):evaluate(e,t[0],(n=>e.bool(n)?r(!0):evFuncOr(e,t.slice(1),r)))}function evFunc(e,t,r){switch(t.func.toLowerCase()){case"if":return evFuncIf(e,t.args[0],t.args[1]||TRUE,t.args[2]||FALSE,r);case"and":return evFuncAnd(e,t.args,r);case"or":return evFuncOr(e,t.args,r);case"true":return r(!0);case"false":return r(!1)}return evArguments(e,t.args,0,(n=>e.func(t.func,r,n)))}function evArguments(e,t,r,n,i=[]){return r===t.length?n(i):evaluate(e,t[r],(o=>(i[r]=o,evArguments(e,t,r+1,n,i))))}function evBinary(e,t,r){return evaluate(e,t.left,(n=>evaluate(e,t.right,(i=>e.func("binary"+t.op,r,[n,i])))))}function evUnary(e,t,r){return evaluate(e,t.exp,(n=>e.func("unary"+t.op,r,[n])))}function evMatrix(e,{value:t},r){let n=[];return function i(o){return o===t.length?r(n):evArguments(e,t[o],0,(e=>(n[o]=e,i(o+1))))}(0)}function evaluate(e,t,r){switch(t.type){case"ref":return evRef(e,t,r);case"num":case"str":case"null":case"bool":return r(t.value);case"error":return r(e.error(t.value));case"prefix":case"postfix":return evUnary(e,t,r);case"binary":return evBinary(e,t,r);case"func":return evFunc(e,t,r);case"matrix":return evMatrix(e,t,r)}throw new Error("Cannot evaluate "+t.type)}function makeInterpreter({ast:e}){return function(){return evaluate(this,e,(e=>this.resolve(e)))}}let FORMULA_CACHE=Object.create(null);function makeFormula(e){let t=makePrinter(e),r=t.call(e),n=FORMULA_CACHE[r];return n?n.clone(e.sheet,e.row,e.col):(n=new calc.runtime.Formula(e.refs,makeInterpreter(e),t,e.sheet,e.row,e.col),FORMULA_CACHE[r]=n.clone(e.sheet,e.row,e.col),n)}function identity$1(e){return e}function TokenStream(e,t){let r=(e=RawTokenStream(calc.runtime.InputStream(e),t)).ahead,n=e.skip,i=null,o=null!=t.row&&null!=t.col?function(e){return 1&e.rel&&(e.col-=t.col),2&e.rel&&(e.row-=t.row),e}:identity$1,s=t.forEditor?function(e,t,r){return e.begin=t.begin,e.end=r.end,e}:identity$1;return{peek:a,next:function(){if(null!=i){let e=i;return i=null,e}return l()},croak:e.croak,eof:e.eof,is:function(e,t){let r=a();return null==r||null!=e&&r.type!==e||null!=t&&r.value!==t?null:r}};function a(){return null==i&&(i=l()),i}function l(){let t,n=e.peek();return n&&("sym"!==n.type&&"rc"!==n.type&&"num"!==n.type||(t=r(8,c)||r(6,h)||r(6,f)||r(4,p)||r(4,d)||r(2,m)||r(2,g)),t||(t=e.next())),t}function u(r,n){if("rc"===r.type)return!r.rel||t.forEditor||null!=t.row&&null!=t.col||e.croak("Cannot read relative cell in RC notation"),new CellRef(r.row,r.col,r.rel);if("num"===r.type)return r.value<=1048577?o(new CellRef(getrow(r.value),n?-1/0:1/0,2)):null;let i=r.value,s=/^(\$)?([a-z]+)(\$)?(\d+)$/i.exec(i);if(s){let e=getrow(s[4]),t=getcol(s[2]);return e<=1048576&&t<=16383?o(new CellRef(getrow(s[4]),getcol(s[2]),(s[1]?0:1)|(s[3]?0:2))):null}let a="$"===i.charAt(0);if(a&&(i=i.substr(1)),/^\d+$/.test(i)){if(getrow(i)<=1048576)return o(new CellRef(getrow(i),n?-1/0:1/0,a?0:2))}else{if(getcol(i)<=16383)return o(new CellRef(n?-1/0:1/0,getcol(i),a?0:1))}}function c(e,t,r,i,o,a,l,c){if("sym"===e.type&&"op"===t.type&&":"===t.value&&"sym"===r.type&&"punc"===i.type&&"!"===i.value&&("sym"===o.type||"rc"===o.type||"num"===o.type&&o.value==o.value|0)&&"op"===a.type&&":"===a.value&&("sym"===l.type||"rc"===l.type||"num"===l.type&&l.value==l.value|0)&&l.type===o.type&&("punc"!==c.type||"("!==c.value||l.space)){let t=u(o,!0),i=u(l,!1);if(t&&i)return n(7),s(new RangeRef(t.setSheet(e.value,!0),i.setSheet(r.value,!0)).setSheet(e.value,!0),e,l)}}function h(e,t,r,i,o,a){if("sym"===e.type&&"op"===t.type&&":"===t.value&&"sym"===r.type&&"punc"===i.type&&"!"===i.value&&("sym"===o.type||"rc"===o.type||"num"===o.type&&o.value==o.value|0)&&("punc"!==a.type||"("!==a.value||o.space)){let t=u(o);if(t){n(5);let i=t.clone();return s(new RangeRef(t.setSheet(e.value,!0),i.setSheet(r.value,!0)).setSheet(e.value,!0),e,o)}}}function f(e,t,r,i,o,a){if("sym"===e.type&&"punc"===t.type&&"!"===t.value&&("sym"===r.type||"rc"===r.type||"num"===r.type&&r.value==r.value|0)&&"op"===i.type&&":"===i.value&&("sym"===o.type||"rc"===o.type||"num"===o.type&&o.value==o.value|0)&&("punc"!==a.type||"("!==a.value||o.space)){let t=u(r,!0),i=u(o,!1);if(t&&i)return n(5),s(new RangeRef(t,i).setSheet(e.value,!0),e,o)}}function p(e,t,r,i){if("sym"===e.type&&"punc"===t.type&&"!"===t.value&&("sym"===r.type||"rc"===r.type||"num"===r.type&&r.value==r.value|0)&&("punc"!==i.type||"("!==i.value||r.space)){n(3);let t=u(r);return t&&isFinite(t.row)||(t=new NameRef(r.value)),s(t.setSheet(e.value,!0),e,r)}}function d(e,t,r,i){if(("sym"===e.type||"rc"===e.type||"num"===e.type&&e.value==e.value|0)&&"op"===t.type&&":"===t.value&&("sym"===r.type||"rc"===r.type||"num"===r.type&&r.value==r.value|0)&&("punc"!==i.type||"("!==i.value||r.space)){let t=u(e,!0),i=u(r,!1);if(t&&i)return n(3),s(new RangeRef(t,i),e,r)}}function m(e,t){if(("sym"===e.type||"rc"===e.type)&&("punc"!==t.type||"("!==t.value||e.space)){let t=u(e);if(t&&isFinite(t.row)&&isFinite(t.col))return n(1),s(t,e,e)}}function g(e,t){if("sym"===e.type&&"punc"===t.type&&"("===t.value&&!e.space)return e.type="func",n(1),e}}function isWhitespace(e){return" \t\r\n ​".indexOf(e)>=0}let EOF={type:"eof"};function RawTokenStream(e,t){let r=[],n=0,i=e.readWhile;return{next:f,peek:h,eof:function(){return null==h()},croak:e.croak,ahead:function(e,t){let r=n,i=[];for(;e-- >0;)i.push(f()||EOF);return n=r,t.apply(i,i)},skip:function(e){n+=e}};function o(e){return/[0-9]/i.test(e)}function s(e){return/[a-z$_]/i.test(e)||isUnicodeLetter(e)}function a(e){return s(e)||o(e)||"."===e}function l(t,r){return{type:"sym",value:t,upper:t.toUpperCase(),space:isWhitespace(e.peek()),quote:r}}function u(e,t,r){if(!e&&!t&&!r)return null;if(!e&&!r||e&&r){let r=t?parseInt(t,10):0;return e?r:r-1}}function c(){if(e.eof())return null;let r,n=e.peek();return'"'===n?(e.next(),{type:"str",value:e.readEscaped('"')}):"'"===n?(e.next(),l(e.readEscaped("'"),!0)):o(n)||n===SEPARATORS.DEC?function(){let e=!1,t=i((function(t){return t===SEPARATORS.DEC?!e&&(e=!0,!0):o(t)}));return t===SEPARATORS.DEC?{type:"punc",value:SEPARATORS.DEC}:{type:"num",value:parseFloat(t.replace(SEPARATORS.DEC,"."))}}():s(n)?function(){let t=e.lookingAt(/^R(\[)?(-?[0-9]+)?(\])?C(\[)?(-?[0-9]+)?(\])?/i);if(t){let r=u(t[1],t[2],t[3]),n=u(t[4],t[5],t[6]);if(null!=r&&null!=n)return e.skip(t),{type:"rc",row:r,col:n,rel:(t[4]||!(t[4]||t[5]||t[6])?1:0)|(t[1]||!(t[1]||t[2]||t[3])?2:0)}}return l(i(a))}():function(e){return e in OPERATORS}(n)?{type:"op",value:i((function(e,t){return t+e in OPERATORS}))}:function(e){return"\\!;(){}[]".indexOf(e)>=0}(n)?{type:"punc",value:e.next()}:(r=e.lookingAt(/^#([a-z\/]+)[?!]?/i))?(e.skip(r),{type:"error",value:r[1]}):(t.forEditor||e.croak("Can't handle character with code: "+n.charCodeAt(0)),{type:"error",value:e.next()})}function h(){for(;r.length<=n;){i(isWhitespace);let n=e.pos(),o=c();t.forEditor&&o&&(o.begin=n,o.end=e.pos()),r.push(o)}return r[n]}function f(){let e=h();return e&&n++,e}}let FORMAT_PARSERS=[],registerFormatParser=calc.registerFormatParser=function(e){FORMAT_PARSERS.push(e)};function tokenize(e,t,r){let n=[];for(e=TokenStream(e,{forEditor:!0,row:t,col:r});!e.eof();)n.push(o());let i=n[0];return"op"===i.type&&"="===i.value&&(i.type="startexp"),n;function o(){let n=e.next();return"sym"===n.type?"TRUE"===n.upper?(n.type="bool",n.value=!0):"FALSE"===n.upper&&(n.type="bool",n.value=!1):"ref"===n.type&&(n={type:"ref",ref:null!=t&&null!=r?n.absolute(t,r):n,begin:n.begin,end:n.end}),n}}function parseSqref(e,t,r){e=TokenStream(e,{row:t=t||0,col:r=r||0});let n=[];for(;!e.eof();){let i=e.next();if("ref"!==i.type)throw new calc.runtime.ParseError("Expecting a reference but got: "+JSON.stringify(i));n.push(i.absolute(t,r))}return n}calc.parse=function(e,t,r,n,i){if(n instanceof Date)return{type:"date",value:calc.runtime.dateToSerial(n)};if("number"==typeof n)return{type:"number",value:n};if("boolean"==typeof n)return{type:"boolean",value:n};if(/^'/.test(n+=""))return{type:"string",value:n.substr(1)};if(/^-?[0-9]+%$/.test(n)){let e=n.substr(0,n.length-1),t=parseFloat(e);if(!isNaN(t)&&t===e)return{type:"percent",value:t/100}}if(/^=/.test(n))return n=n.substr(1),/\S/.test(n)?parseFormula(e,t,r,n):{type:"string",value:"="+n};for(let e=0;e<FORMAT_PARSERS.length;++e){let t=FORMAT_PARSERS[e](n,i);if(t)return t}if("true"===n.toLowerCase())return{type:"boolean",value:!0};if("false"===n.toLowerCase())return{type:"boolean",value:!1};let o=calc.runtime.parseDate(n,i);if(o)return{type:"date",value:calc.runtime.dateToSerial(o)};let s=parseFloat(n);return!isNaN(s)&&n.length>0&&s===n?(i=null,s!==Math.floor(s)&&(i="0."+String(s).split(".")[1].replace(/\d/g,"0")),{type:"number",value:s,format:i}):{type:"string",value:n}},calc.parseNameDefinition=parseNameDefinition,calc.parseFormula=parseFormula,calc.parseReference=parseReference,calc.compile=makeFormula,calc.parseSqref=parseSqref,calc.tokenize=tokenize,registerFormatParser((function(e,t){let r,n=0,i="";if(t||(t=culture().calendar.patterns.d),r=/^(\d+)([-/.])(\d+)\2(\d{2}(?:\d{2})?)(\s*)/.exec(e)){let o=parseInt(r[1],10),s=r[2],a=parseInt(r[3],10),l=parseInt(r[4],10);l<30?l+=2e3:l<100&&(l+=1900);let u=!t||t.indexOf("M")<t.indexOf("d");if(o>12||!u){let e=o;o=a,a=e,u=!1}if(!calc.runtime.validDate(l,o,a))return null;n=calc.runtime.packDate(l,o-1,a),n<0&&n--,i=u?["mm","dd","yyyy"].join(s):["dd","mm","yyyy"].join(s),i+=r[5],e=e.substr(r[0].length)}if(r=/^(\d+):(\d+)$/.exec(e)){let e=parseInt(r[1],10),t=parseInt(r[2],10);return{type:"date",format:i+"hh:mm",value:n+calc.runtime.packTime(e,t,0,0)}}if(r=/^(\d+):(\d+)(\.\d+)$/.exec(e)){let e=parseInt(r[1],10),t=parseInt(r[2],10),o=1e3*parseFloat(r[3]);return{type:"date",format:i+"mm:ss.00",value:n+calc.runtime.packTime(0,e,t,o)}}if(r=/^(\d+):(\d+):(\d+)$/.exec(e)){let e=parseInt(r[1],10),t=parseInt(r[2],10),o=parseInt(r[3],10);return{type:"date",format:i+"hh:mm:ss",value:n+calc.runtime.packTime(e,t,o,0)}}if(r=/^(\d+):(\d+):(\d+)(\.\d+)$/.exec(e)){let e=parseInt(r[1],10),t=parseInt(r[2],10),o=parseInt(r[3],10),s=1e3*parseFloat(r[4]);return{type:"date",format:i+"hh:mm:ss.00",value:n+calc.runtime.packTime(e,t,o,s)}}})),registerFormatParser((function(e){let t,r;const n=intl();var i=n.localeInfo().numbers;let o=i.symbols.group,s=i.symbols.decimal,a=i.localeCurrency;!a&&n.localeCurrency&&(a=n.localeCurrency());let l=i.currencies[a].symbol,u=getNumberRegexp(o,s),c=new RegExp("^\\s*\\"+l+"\\s*"),h=1,f="",p="",d=!1,m=!1;if((e=calc.runtime.InputStream(e.replace(/^\s+|\s+$/g,""))).skip(/^-\s*/)&&(h=-1),(t=e.skip(c))&&(d=!0,f+='"'+t[0]+'"'),e.skip(/^-\s*/)){if(h<0)return null;h=-1}if(!(r=e.skip(u)))return null;if(f+="0",t=e.skip(c)){if(d)return null;d=!0,p='"'+t[0]+'"'}if(!d&&(t=e.skip(/^\s*%\s*/))&&(m=!0,p=t[0]),!e.eof())return null;(r[2]||d)&&(f=f.replace("0","#"),f+=",0"),r[3]&&(f+="."+repeat("0",r[3].length-1));let g=r[0].replace(new RegExp("\\"+o,"g"),"").replace(new RegExp("\\"+s,"g"),".");return g=parseFloat(g),m&&(g/=100),f+=p,d&&(f+=";-"+f),{type:"number",currency:d,format:f,value:h*g}})),registerFormatParser((function(e){let t;if(t=/^([0-9]*)\.([0-9]+)(\s*%)$/.exec(e))return{type:"number",value:parseFloat(e)/100,format:"0."+repeat("0",t[2].length)+t[3]}}));let NUMBER_FORMAT_RX={};function getNumberRegexp(e,t){let r=e+t,n=NUMBER_FORMAT_RX[r];return n||(n="^(\\d+(COM\\d{3})*(DOT\\d+)?)",n=n.replace(/DOT/g,"\\"+t).replace(/COM/g,"\\"+e),n=new RegExp(n),NUMBER_FORMAT_RX[r]=n),n}function repeat(e,t){let r="";for(;t-- >0;)r+=e;return r}class FormulaContext{constructor(e){this.workbook=e}getRefCells(e,t,r,n,i,o){let s,a,l,u;if(e instanceof CellRef)return s=this.workbook.sheetByName(e.sheet),s&&e.valid()?(a=s.formula(e),l=s.range(e.row,e.col).value(),o||null!=a||null!=l?[{formula:a,value:l,row:e.row,col:e.col,sheet:e.sheet,hidden:!!t&&(0===s.columnWidth(e.col)||0===s.rowHeight(e.row))}]:[]):[{value:new CalcError("REF")}];if(e instanceof RangeRef){u=this.workbook.sheetIndex(e.sheet);let r=[],n=u;if(e.endSheet&&(n=this.workbook.sheetIndex(e.endSheet),u>n)){let e=u;u=n,n=e}if(u<0||n<0||!e.valid())return[{value:new CalcError("REF")}];for(;u<=n;){s=this.workbook.sheetByIndex(u++);let n=s._grid.normalize(e.topLeft),i=s._grid.normalize(e.bottomRight),c=s._grid.cellRefIndex(n),h=s._grid.cellRefIndex(i),f=s._properties.iterator("value",c,h);for(let e=n.col;e<=i.col;++e)for(let u=n.row;u<=i.row;++u){let n=s._grid.index(u,e);a=s._properties.get("formula",n),l=f.at(n),(o||null!=a||null!=l)&&r.push({formula:a,value:l,row:u,col:e,sheet:s.name(),hidden:!!t&&(0===s.columnWidth(e)||0===s.rowHeight(u))})}}return r}if(e instanceof UnionRef){let o=[];for(u=0;u<e.refs.length;++u)o=o.concat(this.getRefCells(e.refs[u],t,r,n,i));return o}if(e instanceof NameRef){let o=this.nameValue(e,r,n,i);return o instanceof Ref?this.getRefCells(o,t,r,n,i):[{value:null==o?new CalcError("NAME"):o}]}return[]}isMerged(e){return this.workbook.sheetByName(e.sheet).isMerged(e)}nameValue(e,t,r,n){let i;return e.hasSheet()?i=this.workbook.nameValue(this._displayString(e.print())):(e=e.clone().setSheet(t,!0),i=this.workbook.nameValue(this._displayString(e.print())),null==i&&(i=this.workbook.nameValue(this._displayString(e.name))),null==i&&(i=this.workbook.nameValue(e.print())||this.workbook.nameValue(e.name))),i instanceof Ref&&(i=i.absolute(r,n)),i}getData(e,t,r,n,i){let o=e instanceof CellRef;e instanceof NameRef&&(o=this.workbook.nameValue(e.name)instanceof CellRef);let s=this.getRefCells(e,!1,t,r,n,i).map((function(e){let t=e.value;return t instanceof calc.runtime.Formula&&(t=t.value),t}));return o?s[0]:s}onFormula(e){let t=this.workbook.sheetByName(e.sheet),r=e.row,n=e.col,i=e.value;if(t.formula({row:r,col:n})!==e)return!1;let o=e.arrayFormulaRange;if(o){let e,r,n=i.width,s=i.height;t.forEach(o,(function(o,a){void 0===e&&(e=o,r=a);let l,u=o-e,c=a-r;l=u<s&&c<n?i.get(u,c):new CalcError("N/A"),t._value(o,a,l)}))}else i instanceof Ref&&(i=this.getData(i,e.sheet,r,n),Array.isArray(i)&&(i=i[0]),void 0===i&&(i=null)),i instanceof calc.runtime.Matrix&&(i=i.get(0,0)),t._value(r,n,i);return clearTimeout(t._formulaContextRefresh),t._formulaContextRefresh=setTimeout((function(){t.batch((function(){}),{layout:!0})}),50),!0}_displayString(e){return/^[a-z_][a-z0-9_]*$/i.test(e)?e:"'"+e.replace(/\x27/g,"\\'")+"'"}}class ValidationFormulaContext extends FormulaContext{onFormula(){return!0}}calc.ValidationFormulaContext=ValidationFormulaContext;let KEY_NAMES$1={8:"backspace",9:"tab",13:"enter",27:"esc",37:"left",38:"up",39:"right",40:"down",35:"end",36:"home",32:"spacebar",33:"pageup",34:"pagedown",46:"delete",113:":edit"};const Mac=()=>navigator.platform.toUpperCase().indexOf("MAC")>=0;let isAlphaNum=function(e){return e>47&&e<58||e>64&&e<91||e>95&&e<112||e>185&&e<193||e>218&&e<223||229===e},keyName=function(e){let t=e.keyCode,r=KEY_NAMES$1[t];return!r&&isAlphaNum(t)&&(r=":alphanum"),!r&&e.key&&1===e.key.length&&(r=":alphanum"),r};class EventListener{constructor(e,t,r){if(this._handlers={},this.target=e,this._observer=t||window,this.keyDownProxy=this.keyDown.bind(this),this.mouseProxy=this.mouse.bind(this),this.touchProxy=this.touch.bind(this),this.threshold=5,this._pressLocation=null,this._attachEvent(e,"keydown",this.keyDownProxy),this._attachEvent(e,"contextmenu mousedown cut copy paste scroll wheel click dblclick focus",this.mouseProxy),this._attachEvent(e,"touchmove touchend",this.touchProxy),this._attachEvent(document.documentElement,"mousemove mouseup",this.mouseProxy),this._attachEvent(document.documentElement,"touchmove touchend",this.touchProxy),r)for(let e in r)this.on(e,r[e])}_attachEvent(e,t,r){t.split(" ").forEach((t=>{e.addEventListener(t,r)}))}_removeEvent(e,t,r){t.split(" ").forEach((t=>{e.removeEventListener(t,r)}))}keyDown(e){(!e.altKey||"n"!==e.key&&"h"!==e.key&&"a"!==e.key)&&this.handleEvent(e,keyName(e))}touch(e){this.handleEvent(e,e.type)}mouse(e){let t;e.which?t=3===e.which:e.button&&(t=2===e.button);let r=e.type;if("mousedown"===r&&(t?r="rightmousedown":this._pressLocation={x:e.pageX,y:e.pageY}),"mouseup"===r&&(t||(this._pressLocation=null)),"mousemove"===r&&this._pressLocation){let t=this._pressLocation.x-e.pageX,n=this._pressLocation.y-e.pageY;Math.sqrt(t*t+n*n)>this.threshold&&(r="mousedrag")}this.handleEvent(e,r)}handleEvent(e,t){let r="";e.mod=Mac()?e.metaKey:e.ctrlKey&&!e.altKey,e.altKey&&(r+="alt+"),e.shiftKey&&(r+="shift+"),e.ctrlKey&&(r+="ctrl+"),r+=t;let n=this._handlers["*+"+t];n&&n.call(this._observer,e,r);let i=this._handlers[r];i&&i.call(this._observer,e,r)}on(e,t){let r=this._handlers;"string"==typeof t&&(t=this._observer[t]),"string"==typeof e&&(e=e.split(",")),e.forEach((function(e){r[e]=t}))}destroy(){this._removeEvent(this.target,"keydown",this.keyDownProxy),this._removeEvent(this.target,"contextmenu mousedown cut copy paste scroll wheel click dblclick focus",this.mouseProxy),this._removeEvent(this.target,"touchmove touchend",this.touchProxy),this._removeEvent(document.documentElement,"mousemove mouseup",this.mouseProxy),this._removeEvent(document.documentElement,"touchmove touchend",this.touchProxy)}}let alphaNumRegExp=/:alphanum$/,ACTIONS={up:"up",down:"down",left:"left",right:"right",home:"first-col",end:"last-col","ctrl+left":"word-left","ctrl+right":"word-right","ctrl+up":"word-up","ctrl+down":"word-down","ctrl+home":"first","ctrl+end":"last",pageup:"prev-page",pagedown:"next-page"},ENTRY_ACTIONS={tab:"next","shift+tab":"previous",enter:"lower","shift+enter":"upper",delete:"clearContents",backspace:"clearContents","shift+:alphanum":"edit","alt+:alphanum":"edit",":alphanum":"edit","ctrl+:alphanum":"ctrl","alt+ctrl+:alphanum":"edit",":edit":"edit"},CONTAINER_EVENTS={wheel:"onWheel","*+mousedown":"onMouseDown",contextmenu:"onContextMenu","*+mousedrag":"onMouseDrag","*+mouseup":"onMouseUp","*+dblclick":"onDblClick",mousemove:"onMouseMove"},CLIPBOARD_EVENTS={pageup:"onPageUp",pagedown:"onPageDown",mouseup:"onMouseUp","*+cut":"onCut","*+paste":"onPaste","*+copy":"onCopy"},EDITOR_EVENTS={esc:"onEditorEsc",enter:"onEditorBlur","alt+enter":"insertNewline","shift+enter":"onEditorBlur",tab:"onEditorBlur","shift+tab":"onEditorBlur","shift+ctrl+enter":"onEditorArrayFormula"},FORMULABAR_EVENTS=Object.assign({focus:"onEditorBarFocus"},EDITOR_EVENTS),FORMULAINPUT_EVENTS=Object.assign({focus:"onEditorCellFocus"},EDITOR_EVENTS),SELECTION_MODES={cell:"range",rowheader:"row",columnheader:"column",topcorner:"sheet",autofill:"autofill"},ACTION_KEYS=[],SHIFT_ACTION_KEYS=[],ENTRY_ACTION_KEYS=[];for(let e in ACTIONS)ACTION_KEYS.push(e),SHIFT_ACTION_KEYS.push("shift+"+e);for(let e in ENTRY_ACTIONS)ENTRY_ACTION_KEYS.push(e);CLIPBOARD_EVENTS[ACTION_KEYS]="onAction",CLIPBOARD_EVENTS[SHIFT_ACTION_KEYS]="onShiftAction",CLIPBOARD_EVENTS[ENTRY_ACTION_KEYS]="onEntryAction",FORMULAINPUT_EVENTS[ACTION_KEYS]="onEditorAction",FORMULAINPUT_EVENTS[SHIFT_ACTION_KEYS]="onEditorShiftAction";class Controller{constructor(e,t){this.view=e,this.workbook(t),this.container=e.container,this.clipboardElement=e.clipboard,this.scroller=e.scroller,this.tabstrip=e.tabstrip,this.sheetsbar=e.sheetsbar,e.nameEditor.bind("enter",this.onNameEditorEnter.bind(this)),e.nameEditor.bind("cancel",this.onNameEditorCancel.bind(this)),e.nameEditor.bind("select",this.onNameEditorSelect.bind(this)),e.nameEditor.bind("delete",this.onNameEditorDelete.bind(this)),this.editor=e.editor,this.editor.bind("change",this.onEditorChange.bind(this)),this.editor.bind("activate",this.onEditorActivate.bind(this)),this.editor.bind("deactivate",this.onEditorDeactivate.bind(this)),this.editor.bind("update",this.onEditorUpdate.bind(this)),this.listener=new EventListener(this.container,this,CONTAINER_EVENTS),this.scrollHandler=this.onScroll.bind(this),this.mouseDownHandler=this.onMouseDown.bind(this),e.scroller.addEventListener("scroll",this.scrollHandler),e.scroller.addEventListener("mousedown",this.mouseDownHandler),this._enableEditorEvents(),this.sheetsbar&&(this.sheetsbar.bind("select",this.onSheetBarSelect.bind(this)),this.sheetsbar.bind("reorder",this.onSheetBarReorder.bind(this)),this.sheetsbar.bind("rename",this.onSheetBarRename.bind(this)),this.sheetsbar.bind("remove",this.onSheetBarRemove.bind(this)))}executeCommand(e){return this._execute(e)}_enableEditorEvents(e){void 0===e||e?(this.keyListener=new EventListener(this.clipboardElement,this,CLIPBOARD_EVENTS),this.barKeyListener=new EventListener(this.editor.barElement(),this,FORMULABAR_EVENTS),this.inputKeyListener=new EventListener(this.editor.cellElement(),this,FORMULAINPUT_EVENTS)):(this.keyListener.destroy(),this.barKeyListener.destroy(),this.inputKeyListener.destroy())}_execute(e){let t=this._workbook.execute(e);return"EditCommand"!==e.command||t||this._workbook.trigger("change",{editorClose:!0}),t&&(this._preventNavigation=!0,"error"===t.reason?(this.editor.deactivate(!0),this.view.showError(t,function(){}.bind(this))):this.view.openDialog(t.reason)),t}_activeTooltip(){return this._workbook.activeSheet().activeCell().simplify().toString()}onContextMenuSelect(e){let t;switch(e.item.getAttribute("data-action")){case"cut":t={command:"ToolbarCutCommand",options:{workbook:this._workbook}};break;case"copy":t={command:"ToolbarCopyCommand",options:{workbook:this._workbook}};break;case"paste":t={command:"ToolbarPasteCommand",options:{workbook:this._workbook}};break;case"delete-drawing":t={command:"DeleteDrawingCommand",options:{drawing:this.navigator._sheet._activeDrawing}};break;case"bring-to-front":t={command:"BringToFrontCommand",options:{drawing:this.navigator._sheet._activeDrawing}};break;case"send-to-back":t={command:"SendToBackCommand",options:{drawing:this.navigator._sheet._activeDrawing}};break;case"unmerge":t={command:"MergeCellCommand",options:{value:"unmerge"}};break;case"merge":this.view.openDialog("merge");break;case"hide-row":t={command:"HideLineCommand",options:{axis:"row"}};break;case"hide-column":t={command:"HideLineCommand",options:{axis:"column"}};break;case"unhide-row":t={command:"UnHideLineCommand",options:{axis:"row"}};break;case"unhide-column":t={command:"UnHideLineCommand",options:{axis:"column"}};break;case"delete-row":t={command:"DeleteRowCommand"};break;case"delete-column":t={command:"DeleteColumnCommand"}}t&&this._execute(t)}onSheetBarRemove(e){let t=this._workbook.sheetByName(e.name);t&&this._workbook.removeSheet(t)}destroy(){this.view.scroller.removeEventListener("scroll",this.scrollHandler),this.view.scroller.removeEventListener("mousedown",this.mouseDownHandler),this.listener.destroy(),this._enableEditorEvents(!1),this.keyListener.destroy(),this.inputKeyListener.destroy()}onSheetBarSelect(e){let t,r=this._workbook;if(e.isAddButton){if(this._workbook.trigger("insertSheet"))return;t=r.insertSheet()}else t=r.sheetByName(e.name);if(r.activeSheet().name()!==t.name()){if(this._workbook.trigger("selectSheet",{sheet:t}))return;this.editor.canInsertRef(!1)||this.editor.deactivate(),r.activeSheet(t)}}onSheetBarReorder(e){let t=this._workbook,r=t.sheetByIndex(e.oldIndex),n=t.activeSheet(),i=n.name();if(t.moveSheetToIndex(r,e.newIndex),i!==r.name()){if(t.trigger("selectSheet",{sheet:r}))return void t.activeSheet(n);this.editor.canInsertRef(!1)||this.editor.deactivate(),t.activeSheet(r)}}onSheetBarRename(e){let t=this._workbook.sheetByIndex(e.sheetIndex);this._workbook.sheetByName(e.name)?this.view.showError({reason:"error",type:"duplicateSheetName"}):(this._workbook.renameSheet(t,e.name),this.clipboardElement.focus())}sheet(e){this.navigator=e.navigator(),this.axisManager=e.axisManager()}workbook(e){this._workbook=e,this.clipboard=e.clipboard(),e.bind("commandRequest",this.onCommandRequest.bind(this))}refresh(){let e=this.editor,t=this._workbook.activeSheet();this._viewPortHeight=this.view.scroller.clientHeight,this.navigator.height(this._viewPortHeight),e.isActive()||this.isEditorDisabled||(e.enable(!1!==t.selection().enable()),this.resetEditorValue());let r=t.selection()._ref.simplify(),n=this._workbook.nameForRef(r,t.name());this.view.nameEditor.value(n.name)}onScroll(){this.view.render({scroll:!0})}onWheel(e){let t=e.deltaX,r=e.deltaY;1===e.deltaMode&&(t*=10,r*=10),this.scrollWith(t,r),e.preventDefault()}onAction(e,t){this._workbook.activeSheet()._activeDrawing=null,this.navigator.moveActiveCell(ACTIONS[t]),e.preventDefault()}onPageUp(){this.scrollDown(-this._viewPortHeight)}onPageDown(){this.scrollDown(this._viewPortHeight)}onEntryAction(e,t){let r=this._workbook.activeSheet();if(e.mod){let t=!0;switch(String.fromCharCode(e.keyCode)){case"A":r._activeDrawing=null,this.navigator.selectAll();break;case"Y":this._workbook.undoRedoStack.redo();break;case"Z":this._workbook.undoRedoStack.undo();break;default:t=!1}t&&e.preventDefault()}else{let n=!1===r.selection().enable(),i=":edit"!==t;if("delete"==t||"backspace"==t)r._activeDrawing?this._execute({command:"DeleteDrawingCommand",options:{drawing:r._activeDrawing}}):n||this._execute({command:"ClearContentCommand"}),e.preventDefault();else if(alphaNumRegExp.test(t)||!i){if(r._activeDrawing=null,n)return void e.preventDefault();i&&this.editor.value(""),this.activateEditor(i)}else this.navigator.navigateInSelection(ENTRY_ACTIONS[t]),e.preventDefault()}}onShiftAction(e,t){this.navigator.modifySelection(ACTIONS[t.replace("shift+","")],this.appendSelection),e.preventDefault()}onMouseMove(e){let t=this._workbook.activeSheet();if(t.resizingInProgress()||t.selectionInProgress())return;let r=this.objectAt(e);"columnresizehandle"===r.type||"rowresizehandle"===r.type?t.positionResizeHandle(r.ref):t.removeResizeHandle(),t._renderComment("cell"==r.type?r.ref:null)}onMouseDown(e){let t=this.objectAt(e);if(t.pane&&(this.originFrame=t.pane),this._startResizingDrawing(e,t))return void e.stopPropagation();let r=this._workbook.activeSheet();if(r._activeDrawing=null,"drawing"===t.type)return r._activeDrawing=t.drawing,t.copy=t.drawing.clone(),t.startBox=r.drawingBoundingBox(t.copy),r.startDragging(t),r.triggerChange({dragging:!0}),void e.preventDefault();if("outside"===t.type)return e.preventDefault(),void e.stopPropagation();if("editor"===t.type)return this.onEditorEsc(),this.openCustomEditor(),void e.preventDefault();if(this.editor.canInsertRef(!1)&&t.ref)return this._workbook.activeSheet()._setFormulaSelections(this.editor.highlightedRefs()),this.navigator.startSelection(t.ref,this._selectionMode,this.appendSelection,e.shiftKey,this.view),void e.preventDefault();if(this._preventNavigation=!1,this.editor.deactivate(),!this._preventNavigation){if("columnresizehandle"===t.type||"rowresizehandle"===t.type)return r.startResizing({x:t.x,y:t.y}),void e.preventDefault();if("filtericon"===t.type)return this.openFilterMenu(e),void e.preventDefault();this._selectionMode=SELECTION_MODES[t.type],this.appendSelection=e.mod,this.navigator.startSelection(t.ref,this._selectionMode,this.appendSelection,e.shiftKey,this.view)}}_startResizingDrawing(e){let t=e.target.closest(".k-spreadsheet-drawing-handle");if(t){let r=this.translateCoords(e),n=t.getAttribute("data-direction"),i=this._workbook.activeSheet(),o=i._activeDrawing;return i.startDragging({pane:this.originFrame,drawing:o,copy:o.clone(),startBox:i.drawingBoundingBox(o),resize:n,startX:r.x,startY:r.y}),!0}}onContextMenu(e){let t=this._workbook.activeSheet();if(e.preventDefault(),t.resizingInProgress()||t.draggingInProgress())return;let r=this.objectAt(e);if("columnresizehandle"===r.type||"rowresizehandle"===r.type)return;r.ref?this.navigator.selectForContextMenu(r.ref,SELECTION_MODES[r.type]):"drawing"==r.type&&this.navigator.selectDrawingForContextMenu(r.drawing);let n=this.navigator._sheet.select()instanceof UnionRef,i=!1,o=!1;"columnheader"==r.type?i=!n&&this.axisManager.selectionIncludesHiddenColumns():"rowheader"==r.type?i=!n&&this.axisManager.selectionIncludesHiddenRows():"drawing"==r.type||(o=this.navigator.selectionIncludesMergedCells()),this._workbook.trigger("contextmenu",{objectRef:r.ref,targetType:r.type,isComposite:n,showUnhide:i,showUnmerge:o,originalEvent:e})}prevent(e){e.preventDefault()}constrainResize(e,t){let r=this._workbook.activeSheet().resizeHandlePosition();return!r||"outside"===e||"topcorner"===e||t.col<r.col||t.row<r.row}_dragDrawing(e){let t=this._workbook.activeSheet(),r=t.draggingInProgress();if(!r)return!1;let n=this.translateCoords(e),i=r.drawing,o=n.x-r.startX,s=n.y-r.startY;return"SE"==r.resize?r.aspect?Math.abs(o)>Math.abs(s)?(i.width=Math.max(r.copy.width+o,20),i.height=i.width/r.aspect):(i.height=Math.max(r.copy.height+s,20),i.width=i.height*r.aspect):(i.width=Math.max(r.copy.width+o,20),i.height=Math.max(r.copy.height+s,20)):"E"==r.resize?i.width=Math.max(r.copy.width+o,20):"S"==r.resize?i.height=Math.max(r.copy.height+s,20):"N"==r.resize?r.copy.height-s>20&&(i.height=r.copy.height-s,i.offsetY=r.copy.offsetY+s):"W"==r.resize?r.copy.width-o>20&&(i.width=r.copy.width-o,i.offsetX=r.copy.offsetX+o):"NE"==r.resize?(i.width=Math.max(r.copy.width+o,20),r.copy.height-s>20&&(i.height=r.copy.height-s,i.offsetY=r.copy.offsetY+s)):"SW"==r.resize?(i.height=Math.max(r.copy.height+s,20),r.copy.width-o>20&&(i.width=r.copy.width-o,i.offsetX=r.copy.offsetX+o)):"NW"==r.resize?(r.copy.height-s>20&&(i.height=r.copy.height-s,i.offsetY=r.copy.offsetY+s),r.copy.width-o>20&&(i.width=r.copy.width-o,i.offsetX=r.copy.offsetX+o)):(i.offsetX=r.copy.offsetX+o,i.offsetY=r.copy.offsetY+s),t.triggerChange({dragging:!0}),!0}onMouseDrag(e){if("sheet"===this._selectionMode)return;let t={clientX:e.clientX,clientY:e.clientY},r=this._workbook.activeSheet();if(this._dragDrawing(e))return;let n=this.objectAt(t);if(r.resizingInProgress())this.constrainResize(n.type,n.ref)||r.resizeHintPosition({x:n.x,y:n.y});else if("outside"!==n.type){if(this.originFrame===n.pane)this.selectToLocation(t);else{let e=this.originFrame._grid;n.x,e.right,n.y>e.bottom&&this.scrollTop(),n.y<e.top||n.x<e.left?this.startAutoScroll(n,t):this.selectToLocation(t)}e.preventDefault()}else this.startAutoScroll(n)}onMouseUp(e){let t=this._workbook.activeSheet();t.completeResizing(),t.completeDragging(),this.navigator.completeSelection(),this.stopAutoScroll();let r=this.editor.activeEditor();if(!r)return;let n=e.target;for(;n;){if(n===r.element)return;n=n.parentNode}let i=this.objectAt(e);i&&i.ref&&r.canInsertRef(!1)&&(r.refAtPoint(t),t._setFormulaSelections(r.highlightedRefs()))}onDblClick(e){let t=this.objectAt(e),r=!1===this._workbook.activeSheet().selection().enable();if("cell"!==t.type||r)return;let n=this._workbook.activeSheet().selection();this.activateEditor(!n.value()&&!n.formula()),this.onEditorUpdate()}onCut(e){let t=this;setTimeout((function(){t.clipboard.menuInvoked=void 0===e,t._execute({command:"CutCommand",options:{workbook:t.view._workbook,event:e}})}))}clipBoardValue(){return this.clipboardElement.html()}_pasteImage(e){let t=this,r=new window.Image;r.src=window.URL.createObjectURL(e),r.onload=function(){t._execute({command:"InsertImageCommand",options:{blob:e,width:r.width,height:r.height}})},setTimeout((function(){window.URL.revokeObjectURL(r.src)}),10)}onPaste(e){let t=this,r="",n="";if(t.clipboard.menuInvoked=void 0===e,e){let i=e.clipboardData;if(!i||!i.getData){if(window.clipboardData.files&&window.clipboardData.files.length){let e=window.clipboardData.files[0];if(/^image\/(?:png|jpe?g|gif)$/i.test(e.type))return t._pasteImage(e)}return n=window.clipboardData.getData("Text"),n&&(n=n.trim()),t.clipboardElement.empty(),void setTimeout((function(){r=t.clipboardElement.html(),(r||n)&&(t.clipboard.external({html:r,plain:n}),t._execute({command:"PasteCommand",options:{workbook:t.view._workbook,event:e}}))}))}{e.preventDefault();let o=!1,s=!1;if(window.DOMStringList&&i.types instanceof window.DOMStringList?(o=i.types.contains("text/html"),s=i.types.contains("text/plain")):Array.isArray(i.types)?(o=i.types.indexOf("text/html")>=0,s=i.types.indexOf("text/plain")>=0):(o=/text\/html/.test(i.types),s=/text\/plain/.test(i.types)),o&&(r=i.getData("text/html").trim()),s&&(n=i.getData("text/plain").trim()),!r&&!n&&i.items&&i.items.length)for(let e=0;e<i.items.length;++e){let r=i.items[e];if("file"===r.kind&&/^image\/(?:png|jpe?g|gif)$/i.test(r.type))return t._pasteImage(r.getAsFile())}}}else t.clipboard.menuInvoked=!0;(r||n)&&(t.clipboard.external({html:r,plain:n}),t._execute({command:"PasteCommand",options:{workbook:t.view._workbook,event:e}}))}onCopy(e){this.clipboard.menuInvoked=void 0===e,this._execute({command:"CopyCommand",options:{workbook:this.view._workbook,event:e}})}scrollTop(){this.scroller.scrollTop=0}scrollLeft(){this.scroller.scrollLeft=0}scrollDown(e){this.scroller.scrollTop+=e}scrollRight(e){this.scroller.scrollLeft+=e}scrollWith(e,t){this.scroller.scrollTop+=t,this.scroller.scrollLeft+=e}translateCoords(e){let t=this.container.getBoundingClientRect();return{x:e.clientX-t.left,y:e.clientY-t.top}}objectAt(e,t){if(!e)return;const r=this.translateCoords(e);return this.view.objectAt(r.x,r.y,t)}selectToLocation(e){let t=this.objectAt(e,!0);t.pane&&t.ref&&(this.extendSelection(t),this.lastKnownCellLocation=e,this.originFrame=t.pane),this.stopAutoScroll()}extendSelection(e){this.navigator.extendSelection(e.ref,this._selectionMode)}autoScroll(){let e=this._autoScrollTarget.x,t=this._autoScrollTarget.y,r=this.originFrame._grid,n=this.view.scroller,i=n.scrollLeft,o=n.scrollTop;e<r.left&&this.scrollRight(-8),e>r.right&&this.scrollRight(8),t<r.top&&this.scrollDown(-8),t>r.bottom&&this.scrollDown(8),o===n.scrollTop&&i===n.scrollLeft?this.selectToLocation(this.finalLocation):this.extendSelection(this.objectAt(this.lastKnownCellLocation))}startAutoScroll(e,t){this._scrollInterval||(this._scrollInterval=setInterval(this.autoScroll.bind(this),50)),this.finalLocation=t||this.lastKnownCellLocation,this._autoScrollTarget=e}stopAutoScroll(){clearInterval(this._scrollInterval),this._scrollInterval=null}openCustomEditor(){this.view.openCustomEditor()}openFilterMenu(e){let t=this.objectAt(e),r=this._workbook.activeSheet().filterColumn(t.ref),n=this.view.createFilterMenu(r);n.bind("action",this.onCommandRequest.bind(this)),n.bind("action",n.close.bind(n)),n.openFor(e.target,e)}_saveEditorValue(e){let t=this.editor._range.sheet(),r=this.editor.value();this._workbook.activeSheet()!==t&&(this._workbook.activeSheet()._setFormulaSelections(),this._workbook.activeSheet(t)),t.isInEditMode(!1),this._lastEditorValue=r,this._execute({command:"EditCommand",options:{value:r,arrayFormula:e}})}onEditorChange(){this._saveEditorValue(!1)}onEditorArrayFormula(){this._saveEditorValue(!0),this.editor.deactivate(!0)}onEditorActivate(){let e=this._workbook.activeSheet();e._setFormulaSelections(this.editor.highlightedRefs()),e.isInEditMode(!0)}onEditorDeactivate(){let e=this._workbook.activeSheet();e.isInEditMode(!1),e._setFormulaSelections([])}onEditorUpdate(){this._workbook.activeSheet()._setFormulaSelections(this.editor.highlightedRefs())}onEditorBarFocus(){!1===this._workbook.activeSheet().selection().enable()||this.editor.activate({range:this._workbook.activeSheet().selection(),rect:this.view.activeCellRectangle(),tooltip:this._activeTooltip()})}onEditorCellFocus(){this.editor.scale()}onEditorEsc(){this.resetEditorValue(),this.editor.deactivate(),this.clipboardElement.focus()}insertNewline(e){e.preventDefault(),this.editor.insertNewline()}onEditorBlur(e,t){e.defaultPrevented||this.editor.isFiltered()||(this._preventNavigation=!1,this.editor.deactivate(),this._preventNavigation||(this.clipboardElement.focus(),this.navigator.navigateInSelection(ENTRY_ACTIONS[t])),"tab"===t&&e.preventDefault())}onEditorAction(e,t){if(e.defaultPrevented)return;let r=this.editor,n=this._workbook.activeSheet();this._casualEditing&&/^(?:up|right|down|left)$/.test(t)?(this.deactivateEditor(),this.navigator.moveActiveCell(ACTIONS[t]),e.preventDefault()):r.canInsertRef(!0)&&(this.navigator.moveActiveCell(ACTIONS[t]),r.activeEditor().refAtPoint(n),n._setFormulaSelections(r.highlightedRefs()),e.preventDefault())}onEditorShiftAction(e,t){let r=this.editor,n=this._workbook.activeSheet();r.canInsertRef(!0)&&(this.navigator.modifySelection(ACTIONS[t.replace("shift+","")],this.appendSelection),r.activeEditor().refAtPoint(n),n._setFormulaSelections(r.highlightedRefs()),e.preventDefault())}resetEditorValue(){let e=this._workbook.activeSheet(),t=e.activeCell(),r=this._workbook._inputForRef(t),n=e.range(t).intersectingArrayFormula();n&&(r="="+n.formula),this.editor.value(r,Boolean(n))}activateEditor(e){this._casualEditing=e,this.editor.activate({range:this._workbook.activeSheet().selection(),rect:this.view.activeCellRectangle(),tooltip:this._activeTooltip()}).focus()}deactivateEditor(){this.view.editor.deactivate()}onCommandRequest(e){e.command?this._execute(e):this._workbook.undoRedoStack[e.action]()}onDialogRequest(e){let t={pdfExport:this._workbook.options.pdf,excelExport:this._workbook.options.excel};e.options?deepExtend(e.options,t):e.options=t,this.view.openDialog(e.name,e.options)}onNameEditorEnter({value:e}){let t,r=this._workbook,n=r.activeSheet(),i=void 0!==e?e:this.view.nameEditor.value();if(t=calc.parseReference(i,!0)||r.nameValue(i),t instanceof Ref){if(t.sheet&&t.sheet.toLowerCase()!==n.name().toLowerCase()){let e=r.sheetByName(t.sheet);e&&(r.activeSheet(e),n=e)}n.range(t).select()}else t=n.selection()._ref.clone().simplify().setSheet(n.name(),!0),this._execute({command:"DefineNameCommand",options:{name:i,value:t}}),this.clipboardElement.focus()}onNameEditorCancel(){this.clipboardElement.focus()}onNameEditorSelect(e){let t=e.name,r=this._workbook,n=r.activeSheet(),i=r.nameValue(t);if(i instanceof Ref){if(i.sheet&&i.sheet.toLowerCase()!==n.name().toLowerCase()){let e=r.sheetByName(i.sheet);e&&(r.activeSheet(e),n=e)}n.range(i).select()}else this.clipboardElement.focus()}onNameEditorDelete(e){this._execute({command:"DeleteNameCommand",options:{name:e.name}}),this.clipboardElement.focus()}}class RangeTreeNode{constructor(e,t,r,n){this.level=e,this.value=t,this.left=r,this.right=n}}const NilNode={left:void 0,right:void 0,level:0};function skew(e){let t=e;if(t.left.level===t.level){let e=t;t=t.left,e.left=t.right,t.right=e}return t}function split(e){let t=e;if(t.right.right.level===t.level){let e=t;t=t.right,e.right=t.left,t.left=e,t.level+=1}return t}function insert(e,t){return e===NilNode?new RangeTreeNode(1,t,NilNode,NilNode):(e.value.start>t.start?e.left=insert(e.left,t):e.right=insert(e.right,t),split(skew(e)))}function remove(e,t){let r=e;if(r===NilNode)return r;let n=r.value.start-t.start;if(0===n)if(r.left!==NilNode&&r.right!==NilNode){let e=r.left;for(;e.right!==NilNode;)e=e.right;r.value=e.value,r.left=remove(r.left,r.value)}else r=r.left===NilNode?r.right:r.left;else n>0?r.left=remove(r.left,t):r.right=remove(r.right,t);return(r.left.level<r.level-1||r.right.level<r.level-1)&&(r.level-=1,r.right.level>r.level&&(r.right.level=r.level),r=skew(r),r.right=skew(r.right),r.right.right=skew(r.right.right),r=split(r),r.right=split(r.right)),r}NilNode.left=NilNode,NilNode.right=NilNode;class ValueRange{constructor(e,t,r){this.start=e,this.end=t,this.value=r}intersects(e){return e.start<=this.end&&e.end>=this.start}clone(){return new ValueRange(this.start,this.end,this.value)}}class RangeTree{constructor(){this.root=NilNode}insert(e){this.root=insert(this.root,e)}remove(e){this.root=remove(this.root,e)}findrange(e){let t=this.root;for(;t!==NilNode;)if(e<t.value.start)t=t.left;else{if(!(e>t.value.end))return t.value;t=t.right}return null}values(){let e=[];return values(this.root,e),e}intersecting(e,t){let r=[];return intersecting(this.root,new ValueRange(e,t),r),r}map(e){let t=new RangeTree;return map(t,this.root,e),t}forEach(e){forEach(this.root,e)}clone(){return this.map((function(e){return e.clone()}))}first(){let e=this.root;for(;e.left!==NilNode;)e=e.left;return e}last(){let e=this.root;for(;e.right!==NilNode;)e=e.right;return e}}function values(e,t){e!==NilNode&&(values(e.left,t),t.push(e.value),values(e.right,t))}function intersecting(e,t,r){if(e===NilNode)return;let n=e.value;t.start<n.start&&intersecting(e.left,t,r),n.intersects(t)&&r.push(n),t.end>n.end&&intersecting(e.right,t,r)}function map(e,t,r){t!==NilNode&&(map(e,t.left,r),e.insert(r(t.value)),map(e,t.right,r))}function forEach(e,t){e!==NilNode&&(forEach(e.left,t),t(e.value),forEach(e.right,t))}class RangeList{constructor(e,t,r){void 0===t?this.tree=e:(this.tree=new RangeTree,this.tree.insert(new ValueRange(e,t,r)))}values(){return this.tree.values()}map(e){return new RangeList(this.tree.map(e))}forEach(e){this.tree.forEach(e)}intersecting(e,t){return this.tree.intersecting(e,t)}first(){return this.tree.first().value}last(){return this.tree.last().value}insert(e,t,r){return this.tree.insert(new ValueRange(e,t,r))}value(e,t,r){let n=e,i=t;if(void 0===r)return void 0===i&&(i=n),this.intersecting(n,i)[0].value;let o=this.tree.intersecting(n-1,i+1);if(o.length){let e=o[0],t=o[o.length-1];e.end<n&&(e.value===r?n=e.start:o.shift()),t.start>i&&(t.value===r?i=t.end:o.pop());for(let e=0,t=o.length;e<t;e++){let t=o[e],s=t.value,a=t.start,l=t.end;this.tree.remove(t),a<n&&(s!==r?this.insert(a,n-1,s):n=a),l>i&&(s!==r?this.insert(i+1,l,s):i=l)}}this.insert(n,i,r)}expandedValues(e,t){let r=this.intersecting(e,t),n=[],i=0;for(let o=e;o<=t;o++)r[i].end<o&&i++,n.push({index:o-e,value:r[i].value});return n}sortedIndices(e,t,r,n){let i=this.expandedValues(e,t),o=function(e,t){return e.value===t.value?e.index-t.index:r(e.value,t.value)};return n&&(o=function(e,t){let i=n[e.index],o=n[t.index];return i.value===o.value?r(e.value,t.value):e.index-t.index}),i.sort(o),i}sort(e,t,r){if(1===this.intersecting(e,t).length)return;let n=this.expandedValues(e,t);for(let t=0,i=r.length;t<i;t++)this.value(t+e,t+e,n[r[t].index].value)}copy(e,t,r){let n,i=this.intersecting(e,t),o=r;for(let r=0,s=i.length;r<s;r++){let s=i[r].start;s<e&&(s=e);let a=i[r].end;a>t&&(a=t),n=o+(a-s),this.value(o,n,i[r].value),o=++n}}iterator(e,t){return new Iterator(e,t,this.intersecting(e,t))}getState(){return this.tree.clone()}setState(e){this.tree=e.clone()}toJSON(){return this.values()}fromJSON(e){e.forEach((e=>{this.value(e.start,e.end,e.value)}))}}class Iterator{constructor(e,t,r){this.start=e,this.end=t,this.index=0,this.ranges=r}unique(){return this.ranges.map((function(e){return e.value}))}at(e){for(;this.ranges[this.index]&&this.ranges[this.index].end<e;)this.index++;return this.ranges[this.index]&&this.ranges[this.index].value}forEach(e){for(let t=this.start;t<=this.end;t++)e(this.at(t),t);this.index=0}}class SparseRangeList extends RangeList{constructor(e,t,r){super(e,t,r),this._defaultValue=r,this.tree=new RangeTree,this.range=new ValueRange(e,t,r)}intersecting(e,t){let r,n=e,i=this.tree.intersecting(n,t),o=[];if(!i.length)return[this.range];for(let e=0,t=i.length;e<t;e++)r=i[e],r.start>n&&o.push(new ValueRange(n,r.start-1,this.range.value)),o.push(r),n=r.end+1;return r.end<t&&o.push(new ValueRange(r.end+1,t,this.range.value)),o}insert(e,t,r){let n=r;null==n&&(n=this._defaultValue),n!==this.range.value&&this.tree.insert(new ValueRange(e,t,n))}lastRangeStart(){let e=this.tree.root;if(e===NilNode)return this.range.start;for(;e.right!==NilNode;)e=e.right;return e.value.end+1}}class Property{constructor(e){this.list=e}get(e){return this.parse(this.list.value(e,e))}set(e,t,r){void 0===r&&(r=t,t=e),this.list.value(e,t,r)}parse(e){return e}copy(e,t,r){this.list.copy(e,t,r)}iterator(e,t){return this.list.iterator(e,t)}}class JsonProperty extends Property{set(e,t,r){this.list.value(e,t,JSON.stringify(r))}parse(e){return JSON.parse(e)}}class ValueProperty extends Property{constructor(e,t){super(e),this.formats=t}set(e,t,r){r instanceof Date?(r=calc.runtime.dateToSerial(r),this.formats.value(e,t)||this.formats.value(e,t,toExcelFormat$1(culture().calendar.patterns.d))):"number"==typeof r&&(r=calc.runtime.limitPrecision(r)),this.list.value(e,t,r)}}function toExcelFormat$1(e){return e.replace(/M/g,"m").replace(/'/g,'"').replace(/tt/,"am/pm")}const propertyBagSpec=[{property:Property,name:"format",value:null,sortable:!0,serializable:!0},{property:ValueProperty,name:"value",value:null,sortable:!0,serializable:!0,depends:"format"},{property:Property,name:"formula",value:null,sortable:!0,serializable:!0},{property:Property,name:"background",value:null,sortable:!0,serializable:!0},{property:JsonProperty,name:"vBorders",value:null,sortable:!1,serializable:!1},{property:JsonProperty,name:"hBorders",value:null,sortable:!1,serializable:!1},{property:JsonProperty,name:"dBorders",value:null,sortable:!1,serializable:!0},{property:Property,name:"color",value:null,sortable:!0,serializable:!0},{property:Property,name:"fontFamily",value:null,sortable:!0,serializable:!0},{property:Property,name:"underline",value:null,sortable:!0,serializable:!0},{property:Property,name:"fontSize",value:null,sortable:!0,serializable:!0},{property:Property,name:"italic",value:null,sortable:!0,serializable:!0},{property:Property,name:"bold",value:null,sortable:!0,serializable:!0},{property:Property,name:"textAlign",value:null,sortable:!0,serializable:!0},{property:Property,name:"indent",value:null,sortable:!0,serializable:!0},{property:Property,name:"verticalAlign",value:null,sortable:!0,serializable:!0},{property:Property,name:"wrap",value:null,sortable:!0,serializable:!0},{property:Property,name:"validation",value:null,sortable:!1,serializable:!0},{property:Property,name:"enable",value:null,sortable:!1,serializable:!0},{property:Property,name:"link",value:null,sortable:!0,serializable:!0},{property:Property,name:"editor",value:null,sortable:!0,serializable:!0},{property:Property,name:"comment",value:null,sortable:!0,serializable:!0},{property:Property,name:"html",value:null,sortable:!0,serializable:!0}];class PropertyBag{constructor(e,t,r){r=r||{};let n=e*t-1;this.specs=propertyBagSpec,this.rowCount=e,this.columnCount=t,this.cellCount=n,this.properties={},this.lists={},this.specs.forEach((function(e){let t=e.name,i=r[t];void 0===i&&(i=e.value),this.lists[t]=new SparseRangeList(0,n,i),(this.properties[t]=new e.property(this.lists[t],this.lists[e.depends])).spec=e}),this),this.lists.formula.tree.clone=cloneFormulaTree,this.lists.validation.tree.clone=cloneFormulaTree}_resize(e,t){let r=this,n=r.rowCount,i=e*t-1;function o(t){return(t/n|0)*e+t%n}function s(e){e.start=o(e.start),e.end=o(e.end)}Object.keys(r.lists).forEach((function(t){let o=r.lists[t];e!==n&&o.forEach(s),o.range.end=i})),r.rowCount=e,r.columnCount=t,r.cellCount=i}getState(){let e={};return this.specs.forEach((function(t){e[t.name]=this.lists[t.name].getState()}),this),e}setState(e){this.specs.forEach((function(t){this.lists[t.name].setState(e[t.name])}),this)}get(e,t){if(void 0===t)return this.lists[e];switch(e){case"borderRight":t+=this.rowCount;case"borderLeft":e="vBorders";break;case"borderBottom":t++;case"borderTop":e="hBorders"}return t>this.cellCount?null:this.properties[e].get(t)}set(e,t,r,n){switch(e){case"borderRight":t+=this.rowCount,r+=this.rowCount;case"borderLeft":e="vBorders";break;case"borderBottom":t++,r++;case"borderTop":e="hBorders"}t<=r&&r<=this.cellCount&&this.properties[e].set(t,r,n)}fromJSON(e,t){for(let r=0;r<this.specs.length;r++){let n=this.specs[r];n.serializable&&void 0!==t[n.name]&&this.set(n.name,e,e,t[n.name],!1)}["borderLeft","borderRight","borderTop","borderBottom"].forEach((function(r){void 0!==t[r]&&this.set(r,e,e,t[r])}),this)}copy(e,t,r){this.specs.forEach((function(n){this.properties[n.name].copy(e,t,r)}),this)}iterator(e,t,r){let n=this.properties[e],i=n.iterator(t,r),o=i.at,s=this.cellCount;return i.at=function(e){return e>s?null:n.parse(o.call(i,e))},i.name=e,i.value=n.spec.value,i}sortable(){return this.specs.filter((function(e){return e.sortable})).map((function(e){return this.lists[e.name]}),this)}iterators(e,t){return this.specs.reduce(function(r,n){return n.serializable&&r.push(this.iterator(n.name,e,t)),r}.bind(this),[])}forEach(e,t,r){let n,i,o=this.iterators(e,t),s=this.iterator("hBorders",e,t+1),a=this.iterator("vBorders",e,t),l=this.iterator("vBorders",e+this.rowCount,t+this.rowCount);function u(e,t,r){let i=t.at(r);i!==t.value&&(n[e]=i)}for(i=e;i<=t;i++){n={};for(let e=0;e<o.length;e++){let t=o[e],r=t.at(i);r!==t.value&&(n[t.name]=r)}u("borderLeft",a,i),u("borderRight",l,i+this.rowCount),u("borderTop",s,i),(i+1)%this.rowCount&&u("borderBottom",s,i+1),r(n)}}forEachProperty(e){for(let t in this.properties)e(this.properties[t])}}function cloneFormulaValue(e){return(e=e.clone()).value=e.value.deepClone(),e}function cloneFormulaTree(){let e=this.map(cloneFormulaValue);return e.clone=cloneFormulaTree,e}const ALL_PROPERTIES=propertyBagSpec.reduce((function(e,t){return t.serializable&&e.push(t.name),e}),["borderTop","borderRight","borderBottom","borderLeft"]);let TRANSPOSE_FORMAT="_matrix({0})",DATE_FORMAT='DATEVALUE("{0}")';function compileValidation(e,t,r,n){let i,o,s,a;if("string"==typeof n&&(n=JSON.parse(n)),n.from&&("list"!==n.dataType||n.fromIsListValue||(n.from.indexOf("{")>-1&&(n.from=n.from.replace(/\"/g,"").replace("{",'"').replace("}",'"')),n.from=intl().format(TRANSPOSE_FORMAT,n.from),n.fromIsListValue=!0),"date"===n.dataType&&(s=calc.runtime.parseDate(n.from),s&&(n.from=intl().format(DATE_FORMAT,n.from),n.fromIsDateValue=!0)),n.from=calc.compile(calc.parseFormula(e,t,r,n.from))),n.to&&("date"===n.dataType&&(a=calc.runtime.parseDate(n.to),a&&(n.to=intl().format(DATE_FORMAT,n.to),n.toIsDateValue=!0)),n.to=calc.compile(calc.parseFormula(e,t,r,n.to))),o="custom"===n.dataType?validationExport.validationComparers.custom:"list"===n.dataType?validationExport.validationComparers.list:validationExport.validationComparers[n.comparerType],!o)throw intl().format("'{0}' comparer is not implemented.",n.comparerType);i=function(e){let t=this.to&&(this.to_value||0===this.to_value)?this.to_value:void 0;if(null===e||""===e)this.allowNulls?this.value=!0:this.value=!1;else if("custom"===this.dataType)this.value=o(e,this.from_value,t);else if("list"===this.dataType){let r=this._getListData();this.value=o(e,r,t)}else this.value=o(e,this.from_value,t);return this.value};const l=Object.assign({},n);return l.handler=i,l.sheet=e,l.row=t,l.col=r,new Validation(l)}class Validation{constructor(e){this.handler=e.handler,this.from=e.from,this.to=e.to,this.dataType=e.dataType,this.comparerType=e.comparerType,this.type=e.type?e.type:"warning",this.allowNulls=!!e.allowNulls,this.fromIsDateValue=!!e.fromIsDateValue,this.toIsDateValue=!!e.toIsDateValue,this.showButton=e.showButton,this.fromIsListValue=!!e.fromIsListValue,this.sheet=e.sheet,this.row=e.row,this.col=e.col,e.tooltipMessageTemplate&&(this.tooltipMessageTemplate=e.tooltipMessageTemplate),e.tooltipTitleTemplate&&(this.tooltipTitleTemplate=e.tooltipTitleTemplate),e.messageTemplate&&(this.messageTemplate=e.messageTemplate),e.titleTemplate&&(this.titleTemplate=e.titleTemplate)}_formatMessages(e){let t=this.from?this.from_value:"",r=this.to?this.to_value:"",n=this.from?this.from.toString():"",i=this.to?this.to.toString():"",o=this.dataType,s=this.type,a=this.comparerType;return intl().format(e,t,r,n,i,o,s,a)}_setMessages(){this.title="",this.message="",this.tooltipTitleTemplate&&(this.tooltipTitle=this._formatMessages(this.tooltipTitleTemplate)),this.tooltipMessageTemplate&&(this.tooltipMessage=this._formatMessages(this.tooltipMessageTemplate)),this.titleTemplate&&(this.title=this._formatMessages(this.titleTemplate)),this.messageTemplate&&(this.message=this._formatMessages(this.messageTemplate))}_getListData(){if(!this.from_value||!this.from_value.data)return[];let e,t,r=this.from_value.data,n=[];for(e=0;e<r.length;e++){let i=r[e];if(i)for(t=0;t<i.length;t++)n.push(i[t])}return n}clone(e,t,r){let n=this._getOptions();n.from&&(n.from=n.from.clone(e,t,r)),n.to&&(n.to=n.to.clone(e,t,r));const i=Object.assign({},n);return i.handler=this.handler,i.sheet=e,i.row=t,i.col=r,new Validation(i)}deepClone(){let e=new Validation(this);return e.from=e.from.deepClone(),e.to&&(e.to=e.to.deepClone()),e}exec(e,t,r,n){let i=this;function o(t){return t instanceof Ref&&(t=e.getData(t),Array.isArray(t)&&(t=t[0])),t}let s=function(e){i.from_value=o(e),i.value=i.handler.call(i,t,r),i._setMessages(),n&&n(i.value)};i.to?i.to.exec(e,(function(t){i.to_value=o(t),i.from.exec(e,s)})):i.from.exec(e,s)}reset(){this.from&&this.from.reset(),this.to&&this.to.reset(),delete this.value}adjust(e,t,r,n){let i,o,s,a=this.row,l=this.col;if(this.from&&(i=this.from.adjust(e,t,r,n)),this.to&&(o=this.to.adjust(e,t,r,n)),this.sheet.toLowerCase()===e.toLowerCase())switch(t){case"row":a>=r&&(s=!0,this.row+=n);break;case"col":l>=r&&(s=!0,this.col+=n)}if(s||i||o){let e=new Validation(this);return e.from=i,e.to=o,e.row=a,e.col=l,e}}toJSON(){let e=this._getOptions();return e.from&&(e.from=e.from.toString(),"list"===e.dataType&&(e.from=e.from.replace(/^_matrix\((.*)\)$/i,"$1"),delete e.fromIsListValue),"date"===e.dataType&&this.fromIsDateValue&&(e.from=e.from.replace(/^DATEVALUE\("(.*)"\)$/i,"$1"),delete e.fromIsDateValue)),e.to&&(e.to=e.to.toString(),"date"===e.dataType&&this.toIsDateValue&&(e.to=e.to.replace(/^DATEVALUE\("(.*)"\)$/i,"$1"),delete e.toIsDateValue)),e}_getOptions(){return{from:this.from,to:this.to,dataType:this.dataType,type:this.type,comparerType:this.comparerType,row:this.row,col:this.col,sheet:this.sheet,allowNulls:this.allowNulls,fromIsListValue:this.fromIsListValue,fromIsDateValue:this.fromIsDateValue,toIsDateValue:this.toIsDateValue,tooltipMessageTemplate:this.tooltipMessageTemplate,tooltipTitleTemplate:this.tooltipTitleTemplate,messageTemplate:this.messageTemplate,titleTemplate:this.titleTemplate,showButton:this.showButton}}}const validationExport={};validationExport.compile=compileValidation,validationExport.validationComparers={greaterThan:function(e,t){return e>t},lessThan:function(e,t){return e<t},between:function(e,t,r){return e>=t&&e<=r},equalTo:function(e,t){return e===t},notEqualTo:function(e,t){return e!==t},greaterThanOrEqualTo:function(e,t){return e>=t},lessThanOrEqualTo:function(e,t){return e<=t},notBetween:function(e,t,r){return e<t||e>r},custom:function(e,t){return t},list:function(e,t){return t.indexOf(e)>-1}},validationExport.Validation=Validation;const{measureText:measureText}=util;let PROPERTIES=["color","fontFamily","underline","italic","bold","textAlign","indent","verticalAlign","background","format","link","editor","borderTop","borderRight","borderBottom","borderLeft","comment","html"],Range$1=class e{constructor(e,t){this._sheet=t,this._ref=e}clone(){return new e(this._ref.clone(),this._sheet)}skipHiddenCells(){let e=[],t=this,r=t._sheet,n=r.isHiddenRow.bind(r),i=r.isHiddenColumn.bind(r);return t._ref.forEach((function(r){let o=(r=t._normalize(r.toRangeRef())).topLeft,s=r.bottomRight,a=partition(o.row,s.row,n),l=partition(o.col,s.col,i);for(let t=0;t<a.length;++t)for(let r=0;r<l.length;++r)e.push(new RangeRef(new CellRef(a[t].begin,l[r].begin),new CellRef(a[t].end,l[r].end)))})),r.range(e.length>1?new UnionRef(e):e[0])}_normalize(e){return this._sheet._grid.normalize(e)}_set(e,t,r){let n=this,i=n._sheet;return n._ref.forEach((function(r){let n=r;if(("value"===e||"formula"===e||"link"===e)&&r.topLeft){let e=new CellRef(r.topLeft.row,r.topLeft.col);i.forEachMergedCell((function(t){t.intersects(e)&&(n=e)}))}i._set(n.toRangeRef(),e,t)})),r||i.triggerChange({recalc:"formula"===e||"value"===e||"validation"===e,value:t,range:n,ref:n._ref,isValue:"value"===e}),n}_get(e){return this._sheet._get(this._ref.toRangeRef(),e)}_property(e,t){return void 0===t?this._get(e):this._set(e,t)}value(e){return void 0!==e&&this._set("formula",null,!0),this._property("value",e)}html(e){return this._property("html",e)}resize(t){let r=this._resizedRef(t);return new e(r,this._sheet)}_resizedRef(e){return this._ref.map((function(t){return t.toRangeRef().resize(e)}))}input(e,t){t=Object.assign({arrayFormula:!1},t);let r,n=this._get("format");if(void 0!==e){let i=this._ref.toRangeRef().topLeft;return r=calc.parse(this._sheet.name(),i.row,i.col,e,n),this._sheet.batch(function(){let i=null;if("exp"===r.type)i=calc.compile(r);else if("@"!==n){let e=n&&formatting.type(r.value,n);"date"===r.type&&"date"!==e?this.format(r.format||toExcelFormat(culture().calendar.patterns.d)):"percent"===r.type&&"percent"!==e?this.format(100*r.value==(100*r.value|0)?"0%":"0.00%"):r.format&&(!n||r.currency||"number"===e&&"number"===r.type&&r.format.length>n.length)&&this.format(r.format)}else"string"!==r.type&&(r.value=e);this.formula(i,t.arrayFormula),i||this.value(r.value)}.bind(this),{recalc:!0,value:e,ref:this._ref,editorChange:this._sheet.isInEditMode(),isValue:!0}),this}{e=this._get("value");let t=this._get("formula"),i=n&&!t&&formatting.type(e,n);if(t)e="="+t;else e:{if(n&&"date"===i){let t=formatting.text(e,n);if(r=calc.parse(null,null,null,t,n),t===formatting.text(r.value,n)){e=t;break e}}if("date"===i){const t=intl();e=t.toString(calc.runtime.serialToDate(e),culture().calendar.patterns.d,t.locale)}else"percent"===i?e=calc.runtime.limitPrecision(100*e)+"%":"string"==typeof e&&(/^[=']/.test(e)||/^(?:true|false)$/i.test(e)||looksLikeANumber(e))?e="'"+e:this._sheet._useCultureDecimals()&&"number"==typeof e&&e!==Math.floor(e)&&(e=String(e).replace(".",culture().numbers.symbols.decimal))}return e}}enable(e){return void 0===e?!withExit((function(e){this._sheet.forEach(this._ref,(function(t,r,n){!1===n.enable&&e(!0)}))}),this):this._property("enable",e)}formula(e,t){let r=this;if(void 0===e){let e=r._get("formula");return e?""+e:null}if(t){let t=this._ref.toRangeRef();(e=r._sheet.range(t.topLeft)._set("formula",e)._get("formula"))&&e.setArrayFormulaRange(t)}else r._set("formula",e);return r}intersectingArrayFormula(){let e=this._ref.clone().simplify().setSheet(this._sheet.name());return withExit((function(t){this._sheet._forFormulas((function(r){let n=r.arrayFormulaRange;n&&(n=e.intersect(n))!==NULLREF&&t({formula:r,intersection:n})}))}),this)}canEditArrayFormula(){let e=this.intersectingArrayFormula();return!e||e.formula.arrayFormulaRange.eq(e.intersection)}validation(e){if(void 0===e){let e=this._get("validation");return e?e.toJSON():null}return this._property("validation",e)}_getValidationState(){let e,t,r=this._ref.toRangeRef(),n=r.topLeft.row,i=r.topLeft.col,o=r.bottomRight.row,s=r.bottomRight.col;for(e=i;e<=s;e++)for(t=n;t<=o;t++){let r=this._sheet._validation(t,e);if(r&&"reject"===r.type&&!1===r.value)return r}return!1}merge(){return this._ref=this._sheet._merge(this._ref),this}unmerge(){let e=this._sheet._mergedCells;return this._ref.forEach((function(t){t.toRangeRef().intersecting(e).forEach((function(t){e.splice(e.indexOf(t),1)}))})),this._sheet.triggerChange({}),this}select(){return this._sheet.select(this._ref),this}values(e){if(this._ref instanceof UnionRef)throw new Error("Unsupported for multiple ranges.");if(this._ref===NULLREF){if(void 0!==e)throw new Error("Unsupported for NULLREF.");return[]}let t,r,n=this._ref.toRangeRef(),i=n.topLeft.row,o=n.topLeft.col,s=n.bottomRight.row,a=n.bottomRight.col;if(void 0===e){e=new Array(n.height());for(let t=0;t<e.length;t++)e[t]=new Array(n.width());for(t=o;t<=a;t++)for(r=i;r<=s;r++)e[r-i][t-o]=this._sheet._value(r,t);return e}for(this._sheet._set(n,"formula",null),t=o;t<=a;t++)for(r=i;r<=s;r++){let n=e[r-i];if(n){let e=n[t-o];void 0!==e&&this._sheet._value(r,t,e)}}return this._sheet.triggerChange({recalc:!0,ref:n}),this}_properties(e,t){if(this._ref instanceof UnionRef)throw new Error("Unsupported for multiple ranges.");if(this._ref===NULLREF){if(void 0!==e)throw new Error("Unsupported for NULLREF.");return[]}let r,n,i=this._ref.toRangeRef(),o=i.topLeft.row,s=i.topLeft.col,a=i.bottomRight.row,l=i.bottomRight.col,u=this._sheet;if(void 0===e)return e=new Array(i.height()),u.forEach(i,(function(t,r,n){r-=s,(e[t-=o]||(e[t]=[]))[r]=n})),e;{let c;i=i.clone();let h=function(e){let t=c[e];i.topLeft.row=i.bottomRight.row=n,i.topLeft.col=i.bottomRight.col=r,"value"===e&&u._set(i,"formula",null),u._set(i,e,t)},f=!1;for(r=s;r<=l;r++)if(t||!u.isHiddenColumn(r))for(n=o;n<=a;n++){if(!t&&u.isHiddenRow(n))continue;if(t&&u.isFilteredRow(n))continue;let i=e[n-o];if(i&&(c=i[r-s],c)){const e=Object.keys(c);e.forEach(h),f=f||e.includes("value")}}return u.triggerChange({recalc:!0,ref:this._ref,isValue:f}),this}}clear(e){let t=(e=e||{}).clearAll||!Object.keys(e).length,r=this._sheet,n={recalc:t||e.contentsOnly,ref:this._ref,isValue:!0};return r.batch(function(){n.recalc&&this.formula(null),t&&this.validation(null),(t||e.formatOnly)&&(PROPERTIES.forEach(function(t){e.keepBorders&&/^border/i.test(t)||this[t](null)}.bind(this)),this.fontSize(null),this.wrap(null),this.unmerge())}.bind(this),n),this}clearContent(){return this.clear({contentsOnly:!0})}clearFormat(){return this.clear({formatOnly:!0})}isSortable(){return!this.cantSort()}cantSort(){if(this._ref instanceof UnionRef)return{code:"cantSortMultipleSelection",message:"Unsupported for multiple ranges."};if(this._ref===NULLREF)return{code:"cantSortNullRef",message:"Unsupported for NULLREF."};let e=this._sheet._getMergedCells(this._ref.toRangeRef()),t=e.primary,r=e.secondary,n=null,i=null,o={};try{this._sheet.forEach(this,(function(s,a){let l=new CellRef(s,a).print(),u=t[l];if(u){if(null===n)n=u.width(),i=u.height();else if(n!==u.width()||i!==u.height())throw o}else if(!r[l]&&e.hasMerged)throw o}))}catch(e){if(e!==o)throw e;return{code:"cantSortMixedCells",message:"Unsupported for range containing cells of different shapes."}}return!1}sort(e){let t=this.cantSort();if(t)throw new Error(t.message);return void 0===e&&(e={column:0}),e=e instanceof Array?e:[e],this._sheet._sortBy(this._ref.toRangeRef(),e.map((function(e,t){return"number"==typeof e&&(e={column:e}),{index:void 0===e.column?t:e.column,ascending:void 0===e.ascending||e.ascending}}))),this}isFilterable(){return!(this._ref instanceof UnionRef)}filter(e){if(this._ref instanceof UnionRef)throw new Error("Unsupported for multiple ranges.");return!1===e?this.clearFilters():(e=!0===e?[]:e instanceof Array?e:[e],this._sheet._filterBy(this._ref.toRangeRef(),e.map((function(e,t){return{index:void 0===e.column?void 0===e.index?t:e.index:e.column,filter:e.filter}})))),this}clearFilter(e){this._sheet.clearFilter(e)}clearFilters(){let e=this._sheet.filter(),t=[];if(e){for(let r=0;r<e.columns.length;r++)t.push(e.columns[r].index);this._sheet.batch((function(){this.clearFilter(t),this._filter=null}),{layout:!0,filter:!0})}}hasFilter(){let e=this._sheet.filter();return Boolean(e)}leftColumn(){return new e(this._ref.leftColumn(),this._sheet)}rightColumn(){return new e(this._ref.rightColumn(),this._sheet)}topRow(){return new e(this._ref.topRow(),this._sheet)}bottomRow(){return new e(this._ref.bottomRow(),this._sheet)}column(t){return new e(this._ref.toColumn(t),this._sheet)}row(t){return new e(this._ref.toRow(t),this._sheet)}forEachRow(t){this._ref.forEachRow(function(r){t(new e(r,this._sheet))}.bind(this))}forEachColumn(t){this._ref.forEachColumn(function(r){t(new e(r,this._sheet))}.bind(this))}sheet(){return this._sheet}topLeft(){return this._ref.toRangeRef().topLeft}intersectingMerged(){let e=this._sheet,t=[];return e._mergedCells.forEach(function(e){e.intersects(this._ref)&&t.push(e.toString())}.bind(this)),t}getState(e){let t,r=this._ref.first(),n={ref:r,data:[],origRef:this._ref,rows:this._sheet._rows.getState()};e?t="input"===e?["value","formula"]:"border"===e?["borderLeft","borderTop","borderRight","borderBottom"]:[e]:(t=ALL_PROPERTIES,n.mergedCells=this.intersectingMerged());let i=n.data;return this.forEachCell((function(e,n,o){let s={},a=e-r.row,l=n-r.col;i[a]||(i[a]=[]),i[a][l]=s,t.forEach((function(e){let t=void 0===o[e]?null:o[e];(t instanceof calc.runtime.Formula||t instanceof validationExport.Validation)&&(t=t.deepClone()),s[e]=t}))})),n}setState(e,t){let r=this._sheet,n=this._ref.first(),i=e.ref.row-n.row,o=e.ref.col-n.col,s=t&&!t.isExternal(),a=t&&!s;r.batch(function(){e.mergedCells&&this.unmerge(),t||this._sheet._rows.setState(e.rows);let l=n.row,u=this.hasFilter();e.data.forEach((function(i,o){if(u&&s&&r.isHiddenRow(e.ref.row+o))return;let c=n.col;i.forEach((function(i,h){if(u&&s&&r.isHiddenColumn(e.ref.col+h))return;let f=t?r.range(l,c):r.range(n.row+o,n.col+h);if(f.enable()){for(let e in i)"value"!==e&&(t&&"enable"===e||f._set(e,i[e]));if(!i.formula)if(a)try{null==i.value?f._set("value",null):f.input(i.value)}catch(e){f._set("value",i.value)}else f._set("value",i.value)}c++})),l++})),e.mergedCells&&e.mergedCells.forEach((function(e){e=r._ref(e).relative(i,o,3),r.range(e).merge()}),this)}.bind(this),{recalc:!0,ref:this._ref})}_adjustRowHeight(){let e=this,t=e._sheet,r=t._getMergedCells(e._ref.toRangeRef()),n=r.primary,i=r.secondary;t.batch((function(){e.forEachRow((function(e){let r=e._ref.topLeft.row,o=t.rowHeight(r);o&&(e.forEachCell((function(e,r,s){let a=new CellRef(e,r).print();if(i[a])return;let l,u=n[a];l=u?t._columns.sum(u.topLeft.col,u.bottomRight.col):t.columnWidth(r);let c=s.value;s.format&&null!=c&&(c=formatting.format(c,s.format));let h=getTextHeight(c,l,s.fontFamily,s.fontSize,s.wrap);o=Math.max(o,h)})),t.rowHeight(r,o))}))}),{layout:!0})}forEachCell(e){this._ref.forEach(function(t){this._sheet.forEach(t.toRangeRef(),e.bind(this))}.bind(this))}hasValue(){let e=this._sheet._defaultCellStyle;return withExit((function(t){this.forEachCell((function(r,n,i){for(let r in i){let n=i[r];null!=n&&n!==e[r]&&t(!0)}}))}),this)}wrap(e){return void 0===e?Boolean(this._property("wrap")):(this._property("wrap",e),null!==e&&this._adjustRowHeight(),this)}fontSize(e){return void 0===e?this._property("fontSize"):(this._property("fontSize",e),null!==e&&this._adjustRowHeight(),this)}draw(e,t){this._sheet.draw(this,e,t)}insideBorders(e){return this.insideVerticalBorders(e).insideHorizontalBorders(e)}insideVerticalBorders(e){return this._ref.forEach((function(t){t instanceof RangeRef&&t.width()>1&&((t=t.clone()).topLeft.col++,this._sheet.range(t)._set("vBorders",e))}),this),this}insideHorizontalBorders(e){return this._ref.forEach((function(t){t instanceof RangeRef&&t.height()>1&&((t=t.clone()).topLeft.row++,this._sheet.range(t)._set("hBorders",e))}),this),this}};function partition(e,t,r){for(;e<=t&&r(e);)e++;if(e>t)return[];for(let n=e+1;n<=t;++n)if(r(n))return[{begin:e,end:n-1}].concat(partition(n+1,t,r));return[{begin:e,end:t}]}function toExcelFormat(e){return e.replace(/M/g,"m").replace(/'/g,'"').replace(/tt/,"am/pm")}function looksLikeANumber(e){return!/^=/.test(e)&&/number|percent/.test(calc.parse(null,0,0,e).type)}function getTextHeight(e,t,r,n,i){const o=document.createElement("div");return o.style.setProperty("position","absolute","important"),o.style.setProperty("top","-4000px","important"),o.style.setProperty("height","auto","important"),o.style.setProperty("padding","1px 3px","important"),o.style.setProperty("box-sizing","border-box","important"),o.style.setProperty("margin","0","important"),o.style.setProperty("border","1px solid black","important"),o.style.setProperty("line-height","normal","important"),o.style.setProperty("visibility","hidden","important"),o.style.setProperty("white-space","pre-wrap"),measureText(e,{baselineMarkerSize:0,width:!0===i?t+"px":"auto","font-size":(n||12)+"px","font-family":r||"Arial","white-space":!0===i?"pre-wrap":"pre","overflow-wrap":!0===i?"break-word":"normal","word-wrap":!0===i?"break-word":"normal"},{box:o,normalizeText:!1}).height}PROPERTIES.forEach((function(e){Range$1.prototype[e]=function(t){return this._property(e,t)}}));var runtime=calc.runtime,Formula=runtime.Formula,ERR_INCOMPATIBLE="incompatibleRanges",ERR_NO_DIRECTION="noFillDirection",FillError=Range$1.FillError=function(e){this.code=e};function linearRegression(e){for(var t=e.length,r=(t+1)/2,n=e.reduce((function(e,t){return e+t}),0)/t,i=0,o=0,s=0;s<t;s++){var a=s+1-r;i+=a*(e[s]-n),o+=a*a}if(!o)return function(t){return e[t%e.length]};var l=i/o,u=n-l*r;return function(e){return u+l*(e+1)}}function findSeries(e){function t(e){return e.map((function(e){return e.number}))}var r=[],n=e.map((function(e){return e.formula||e.value}));return forEachSeries(n,(function(e,i,o,s){var a,l;if("number"==o)a=linearRegression(l=t(s));else if("string"==o||"formula"==o||"boolean"==o)a=function(e,t){return n[t]};else if(Array.isArray(o))if(1==s.length)a=function(e){return o[(s[0].number+e)%o.length]};else{var u=function(e){for(var t=e[1]-e[0],r=2;r<e.length;++r)if(e[r]-e[r-1]!=t)return null;return t}(t(s));a=null==u?function(e){return s[e%s.length].value}:function(e){var t=s[0].number+u*e;return o[t%o.length]}}else"null"!=o?(1==(l=t(s)).length&&l.push(l[0]+1),l=linearRegression(l),a=function(e,t){return n[t].replace(/^(.*[\D0]+)\d+/,"$1"+l(e,t))}):a=function(){return null};for(var c={f:a,begin:e,end:i,len:i-e},h=e;h<i;++h)r[h]=c})),function(t,i){var o=r[i],s=t/n.length|0,a=t%n.length,l=s*o.len+a-o.begin,u=o.f(l,i),c=clone$1(e[i]);return delete c.enable,u instanceof Formula?c.formula=u:c.value=u,c}}function clone$1(e){var t={};return Object.keys(e||{}).forEach((function(r){t[r]=e[r]})),t}function forEachSeries(e,t){for(var r,n=null,i=0,o=[],s=0;s<e.length;++s)r=getType(e[s]),o.push(r),null!=n&&r.type!==n.type&&(t(i,s,n.type,o.slice(i,s)),i=s),n=r;t(i,s,n.type,o.slice(i,s))}function getType(e){if("number"==typeof e)return{type:"number",number:e};if("string"==typeof e){var t=findStringList(e);if(t)return t;var r=/^(.*\D)(\d+)/.exec(e);return r?{type:e=e.replace(/^(.*\D)\d+/,"$1-######"),match:r,number:parseFloat(r[2])}:{type:"string"}}if("boolean"==typeof e)return{type:"boolean"};if(null==e)return{type:"null"};if(e instanceof Formula)return{type:"formula"};throw window.console.error(e),new Error("Cannot fill data")}function stringLists(){const e=culture().calendar;return[e.days.format.abbreviated,e.days.format.wide,e.months.format.abbreviated,e.months.format.wide]}function findStringList(e){for(var t=e.toLowerCase(),r=stringLists(),n=0;n<r.length;++n)for(var i=r[n],o=i.length;--o>=0;){if(i[o].toLowerCase()==t)return{type:i,number:o,value:e}}}function transpose(e){for(var t=e.length,r=e[0].length,n=[],i=0;i<r;++i){n[i]=[];for(var o=0;o<t;++o)n[i][o]=e[o][i]}return n}Range$1.prototype._previewFillFrom=function(e,t){var r=this,n=r._sheet;"string"==typeof e&&(e=n.range(e));var i=e._ref.toRangeRef().clone().setSheet(n.name()),o=r._ref.toRangeRef().clone().setSheet(n.name());if(i.intersects(o)){if(i.eq(o))return null;if(o=o.clone(),i.topLeft.eq(o.topLeft))if(i.width()==o.width())o.topLeft.row+=i.height(),t=0;else{if(i.height()!=o.height())throw new FillError(ERR_INCOMPATIBLE);o.topLeft.col+=i.width(),t=1}else{if(!i.bottomRight.eq(o.bottomRight))throw new FillError(ERR_INCOMPATIBLE);if(i.width()==o.width())o.bottomRight.row-=i.height(),t=2;else{if(i.height()!=o.height())throw new FillError(ERR_INCOMPATIBLE);o.bottomRight.col-=i.width(),t=3}}return n.range(o)._previewFillFrom(e,t)}if(null==t)if(i.topLeft.col==o.topLeft.col)t=i.topLeft.row<o.topLeft.row?0:2;else{if(i.topLeft.row!=o.topLeft.row)throw new FillError(ERR_NO_DIRECTION);t=i.topLeft.col<o.topLeft.col?1:3}var s=1&t,a=2&t;if(s&&i.height()!=o.height()||!s&&i.width()!=o.width())throw new FillError(ERR_INCOMPATIBLE);var l,u=e._properties();s?l=o.width():(u=transpose(u),l=o.height());for(var c=new Array(u.length),h=null,f=0;f<u.length;++f)for(var p=u[f],d=findSeries(p),m=c[f]=new Array(l),g=0;g<l;++g){var C=a?-g-1:p.length+g,v=a?p.length-g%p.length-1:g%p.length,y=m[a?l-g-1:g]=d(C,v);null!=y.value&&(h=y.value)}return s||(c=transpose(c)),{props:c,direction:t,dest:r,hint:h}},Range$1.prototype.fillFrom=function(e,t){var r=this._previewFillFrom(e,t);return r.dest._properties(r.props,!0),r.dest};const STRING$1="string",FUNCTION="function";let preventDefault=function(){this._defaultPrevented=!0},isDefaultPrevented=function(){return!0===this._defaultPrevented};class Observable{constructor(){this._events={}}bind(e,t,r){let n,i,o,s,a,l=this,u="string"==typeof e?[e]:e,c=typeof t===FUNCTION;if(void 0===t){for(n in e)l.bind(n,e[n]);return l}for(n=0,i=u.length;n<i;n++)e=u[n],s=c?t:t[e],s&&(r&&(o=s,s=function(){l.unbind(e,s),o.apply(l,arguments)},s.original=o),a=l._events[e]=l._events[e]||[],a.push(s));return l}one(e,t){return this.bind(e,t,!0)}first(e,t){let r,n,i,o,s=this,a="string"==typeof e?[e]:e,l=typeof t===FUNCTION;for(r=0,n=a.length;r<n;r++)e=a[r],i=l?t:t[e],i&&(o=s._events[e]=s._events[e]||[],o.unshift(i));return s}trigger(e,t){let r,n,i=this,o=i._events[e];if(o){for((t=t||{}).sender=i,t._defaultPrevented=!1,t.preventDefault=preventDefault,t.isDefaultPrevented=isDefaultPrevented,o=o.slice(),r=0,n=o.length;r<n;r++)o[r].call(i,t);return!0===t._defaultPrevented}return!1}unbind(e,t){let r,n=this,i=n._events[e];if(void 0===e)n._events={};else if(i)if(t)for(r=i.length-1;r>=0;r--)i[r]!==t&&i[r].original!==t||i.splice(r,1);else n._events[e]=[];return n}}class Widget extends Observable{constructor(e,t){super(),this.element=e,this.events=[],this.options=t}setOptions(e){this._setEvents(e),deepExtend({},this.options,e)}_setEvents(e){let t,r=this,n=0,i=r.events.length;for(;n<i;n++)t=r.events[n],r.options[t]&&e[t]&&(r.unbind(t,r.options[t]),r._events&&r._events[t]&&delete r._events[t]);r.bind(r.events,e)}resize(e){const t=this.getSize(),r=this._size;(e||(t.width>0||t.height>0)&&(!r||t.width!==r.width||t.height!==r.height))&&(this._size=t,this._resize(t,e),this.trigger("resize",t))}getSize(){return{width:this.element.offsetWidth,height:this.element.offsetHeight}}destroy(){this.unbind()}}const _activeElement=function(){try{return document.activeElement}catch(e){return document.documentElement.activeElement}};class SheetEditor extends Observable{constructor(e){super(),this.events=["activate","deactivate","change","update"],this.view=e,this.formulaBar=e.formulaBar,this._active=!1,this.barInput=e.formulaBar.formulaInput,this.cellInput=e.formulaInput,this.barInput.syncWith(this.cellInput),this.cellInput.syncWith(this.barInput),this.barInput.bind("keyup",this._triggerUpdate.bind(this)),this.cellInput.bind("keyup",this._triggerUpdate.bind(this)),this.barInput.bind("blur",this._blur.bind(this)),this.cellInput.bind("blur",this._blur.bind(this))}_blur(){this.deactivate()}_triggerUpdate(){this.trigger("update",{value:this.value()})}activeEditor(){let e=null,t=_activeElement();return this.barElement()===t?e=this.barInput:this.cellElement()===t&&(e=this.cellInput),e}activate(e){let t,r,n,i=this.view.element;return this._active=!0,this._rect=e.rect,this._range=e.range,this.cellInput.position(e.rect),this.cellInput.resize(e.rect),this.cellInput.tooltip(e.tooltip),this.cellInput.activeCell=this.barInput.activeCell=this._range.topLeft(),this.cellInput.activeSheet=this.barInput.activeSheet=this._range._sheet,i&&(t=i.offsetWidth,r=i.querySelector(".k-spreadsheet-scroller"),n=r.offsetWidth-r.clientWidth,this.cellInput.element.style.maxWidth=t-n-parseFloat(this.cellInput.element.style.left)+"px"),this.trigger("activate"),this}deactivate(e){let t=this.cellInput;this._active&&(this._active=!1,e||t.value()===this._value||this.trigger("change",{value:t.value(),range:this._range}),this._rect=null,t.hide(),this.trigger("deactivate"))}enable(e){this.barInput.enable(e),this.cellInput.enable(e)}barElement(){return this.barInput.element}cellElement(){return this.cellInput.element}focus(e){"cell"===(e=e||"cell")?(this.cellInput.element.focus(),this.cellInput.end()):this.barInput.focus()}isActive(){return this._active}isFiltered(){return this.barInput.popup.visible()||this.cellInput.popup.visible()}canInsertRef(e){let t=this.activeEditor();return t&&t.canInsertRef(e)}highlightedRefs(){let e=this.activeEditor(),t=[];return e&&(t=e.highlightedRefs()),t}scale(){this.cellInput.scale()}toggleTooltip(e){this.cellInput.toggleTooltip(notEqual(this._rect,e))}value(e,t){if(void 0===e)return this.barInput.value();null===e&&(e=""),this._value=e,this.barInput.value(e),this.cellInput.value(e),this.barInput.element.classList.toggle("k-spreadsheet-array-formula",Boolean(t))}insertNewline(){this.activeEditor().insertNewline(),this.scale()}select(){this.activeEditor().select()}}function notEqual(e,t){return e&&(e.top!==t.top||e.left!==t.left)}const ampRegExp=/&/g,ltRegExp=/</g,quoteRegExp=/"/g,aposRegExp=/'/g,gtRegExp=/>/g,htmlEncode=function(e){return String(e).replace(ampRegExp,"&amp;").replace(ltRegExp,"&lt;").replace(gtRegExp,"&gt;").replace(quoteRegExp,"&quot;").replace(aposRegExp,"&#39;")};class Axis{constructor(e,t){this._value=t,this._count=e,this.values=new RangeList(0,e-1,t),this._hidden=new RangeList(0,e-1,0),this.scrollBarSize=scrollbar(),this._refresh()}_resize(e){e>this._count?(this.values.value(this._count,e-1,this._value),this._hidden.value(this._count,e-1,0)):e<this._count&&(this.values.value(e,this._count-1,0),this._hidden.value(e,this._count-1,0)),this._count=e,this._refresh()}adjust(e,t){t<0?(this.values.copy(e-t,this._count-1,e),this._hidden.copy(e-t,this._count-1,e)):(this.values.copy(e,this._count,e+t),this._hidden.copy(e,this._count,e+t),this.values.value(e,e+t-1,this._value),this._hidden.value(e,e+t-1,0)),this._refresh()}toJSON(e,t){let r=[],n=this.values.iterator(0,this._count-1);for(let i=0;i<this._count;i++){let o=n.at(i),s=this._hidden.value(i,i);if(o===this._value&&!s)continue;let a=t[i];if(void 0===a){a=r.length;let n={index:i};n[e]=o,s&&(n.hidden=s),r.push(n),t[i]=a}}return r}fromJSON(e,t){for(let r=0;r<t.length;r++){let n=t[r],i=n.index;void 0===i&&(i=r);let o=n[e];0===o?(this._hidden.value(i,i,n.hidden||this._value),this.value(i,i,0)):this.value(i,i,o)}}hide(e){if(!this.hidden(e)){let t=this.value(e,e);this._hidden.value(e,e,t),this.value(e,e,0)}}hidden(e){return 0!==this._hidden.value(e,e)}includesHidden(e,t){return this._hidden.intersecting(e,t).length>1}nextVisible(e){let t=this._count-1,r=e;for(;++r<=t;)if(!this.hidden(r))return r;return e}nextUntil(e,t){let r=this._count-1,n=e,i=!1;for(;++n<=r;){let e=t(n,i,this.hidden(n));if("number"==typeof e)return e;if(e)break;i=!0}return n-1}nextPage(e,t){return this.index(this.sum(0,e-1)+t)}prevPage(e,t){return this.index(this.sum(0,e)-t)}firstVisible(){let e=this._hidden.first();return 0===e.value?0:e.end+1}lastVisible(){let e=this._hidden.last();return 0===e.value?this._count-1:e.start-1}prevVisible(e){let t=e;for(;--t>=0;)if(!this.hidden(t))return t;return e}prevUntil(e,t){let r=e,n=!1;for(;--r>=0;){let e=t(r,n,this.hidden(r));if("number"==typeof e)return e;if(e)break;n=!0}return r+1}unhide(e){if(this.hidden(e)){let t=this._hidden.value(e,e);this._hidden.value(e,e,0),this.value(e,e,t)}}value(e,t,r){if(void 0===r)return this.values.iterator(e,t).at(0);this.values.value(e,t,r),this._refresh()}sum(e,t){let r=this.values.iterator(e,t),n=0;for(let i=e;i<=t;i++)n+=r.at(i);return n}locate(e,t,r){let n=this.values.iterator(e,t),i=0;for(let o=e;o<=t;o++){if(i+=n.at(o),r(i))return o}return null}visible(e,t){let r=null,n=null,i=!1;t>=this.total+this.scrollBarSize&&(i=!0);let o=this._pixelValues.intersecting(e,t);if(r=o[0],n=o[o.length-1],!r)return{values:this.values.iterator(0,0),offset:0};let s=e-r.start,a=(s/r.value.value|0)+r.value.start,l=s-(a-r.value.start)*r.value.value,u=t-n.start,c=(u/n.value.value|0)+n.value.start;return c>n.value.end&&(c=n.value.end),i&&(l+=n.value.value-(u-(c-n.value.start)*n.value.value)),l=Math.min(-l,0),{values:this.values.iterator(a,c),offset:l}}index(e){let t=0,r=this.values.iterator(0,this._count-1),n=r.at(0);for(;n<e&&t<this._count-1;)n+=r.at(++t);return t}indexVisible(e){let t=this.index(e);return this.hidden(t)&&(t=this.prevVisible(t)),t}_refresh(){let e=0;this._pixelValues=this.values.map((function(t){let r=e;return e+=(t.end-t.start+1)*t.value,new ValueRange(r,e-1,t)})),this.total=e}getState(){return{values:this.values.getState(),hidden:this._hidden.getState(),count:this._count}}setState(e){this.values.setState(e.values),this._hidden.setState(e.hidden);let t=this._count;t>e.count?(this._count=e.count,this._resize(t)):this._refresh()}}class PaneAxis{constructor(e,t,r,n){this._axis=e,this._start=t,this._count=r,this.hasHeader=0===t,this.headerSize=n,this.defaultValue=e._value,this.frozen=r>0}viewSize(e){this._viewSize=e}sum(e,t){return this._axis.sum(e,t-1)}start(){return this.sum(0,this._start)}size(){return this.sum(this._start,this._start+this._count)}index(e,t){return this._axis.index(e+(this.frozen?0:t)-this.headerSize)}indexVisible(e,t){return this._axis.indexVisible(e+(this.frozen?0:t)-this.headerSize)}paneSegment(){let e,t=this.start();return this.hasHeader||(t+=this.headerSize),this.frozen?(e=this.size(),this.hasHeader?e+=this.headerSize:e-=this.headerSize):e=this._viewSize-t,{offset:t,length:e}}visible(e){let t,r=this.start();this.frozen?(t=this.size(),this.hasHeader||(t-=this.headerSize)):(t=this._viewSize-r-this.headerSize,r+=e);let n=this._axis.visible(r,r+t-1);return this.frozen&&(n.offset=0),n.start=r,this.hasHeader&&(n.offset+=this.headerSize,n.start-=this.headerSize),n}contains(e,t){return this.frozen?!(e>this._start+this._count)&&!(t<this._start):t>=this._start}}class Rectangle{constructor(e,t,r,n){this.left=e,this.top=t,this.width=r,this.height=n,this.right=this.left+this.width,this.bottom=this.top+this.height}offset(e,t){return new Rectangle(this.left+e,this.top+t,this.width,this.height)}resize(e,t){return new Rectangle(this.left,this.top,this.width+e,this.height+t)}intersects(e,t){return e instanceof Rectangle?this.intersectsRect(e):this.left<e&&e<this.left+this.width&&this.top<t&&t<this.top+this.height}intersectsRect(e){let t=this;return t.left<=e.right&&e.left<=t.right&&t.top<=e.bottom&&e.top<=t.bottom}toDiv(e){return dom.element("div",{className:e,style:{width:this.width+"px",height:this.height+"px",top:this.top+"px",left:this.left+"px"}})}}class Grid{constructor(e,t,r,n,i,o){this.rowCount=r,this.columnCount=n,this._columns=t,this._rows=e,this._headerHeight=i,this._headerWidth=o}_resize(e,t){this.rowCount=e,this.columnCount=t}isAxis(e){let t=(e=e.toRangeRef()).topLeft,r=e.bottomRight;return 0===t.row&&r.row===this.rowCount-1||0===t.col&&r.col===this.columnCount-1}width(e,t){return this._columns.sum(e,t)}height(e,t){return this._rows.sum(e,t)}totalHeight(){return this._rows.total+this._headerHeight}totalWidth(){return this._columns.total+this._headerWidth}index(e,t){return t*this.rowCount+e}cellRef(e){return new CellRef(e%this.rowCount,e/this.rowCount|0)}rowRef(e){return new RangeRef(new CellRef(e,0),new CellRef(e,this.columnCount-1))}colRef(e){return new RangeRef(new CellRef(0,e),new CellRef(this.rowCount-1,e))}cellRefIndex(e){return this.index(e.row,e.col)}normalize(e){return e instanceof RangeRef?new RangeRef(this.normalize(e.topLeft),this.normalize(e.bottomRight)).setSheet(e.sheet,e.hasSheet()):e instanceof UnionRef?e.map((function(e){return this.normalize(e)}),this):(e instanceof CellRef&&((e=e.clone()).col=Math.max(0,Math.min(this.columnCount-1,e.col)),e.row=Math.max(0,Math.min(this.rowCount-1,e.row))),e)}rectangle(e){let t=this.normalize(e.topLeft),r=this.normalize(e.bottomRight);return new Rectangle(this.width(0,t.col-1),this.height(0,t.row-1),this.width(t.col,r.col),this.height(t.row,r.row))}pane(e){return new PaneGrid(new PaneAxis(this._rows,e.row,e.rowCount,this._headerHeight),new PaneAxis(this._columns,e.column,e.columnCount,this._headerWidth),this)}rangeDimensions(e){return{rows:this._rows.values.iterator(e.topLeft.row,e.bottomRight.row),columns:this._columns.values.iterator(e.topLeft.col,e.bottomRight.col)}}forEach(e,t){let r=this.normalize(e.topLeft),n=this.normalize(e.bottomRight);for(let e=r.col;e<=n.col;e++)for(let i=r.row;i<=n.row;i++)t(new CellRef(i,e))}trim(e,t){let r=this.normalize(e.topLeft),n=this.normalize(e.bottomRight),i=r.row,o=r.col;for(let e=r.col;e<=n.col;e++){let s=this.index(r.row,e),a=this.index(n.row,e),l=t.tree.intersecting(s,a);if(l.length){let t=this.cellRef(l[l.length-1].end);i=Math.max(i,t.row),o=e}}return new RangeRef(e.topLeft,new CellRef(Math.min(i,e.bottomRight.row),o))}}class PaneGrid{constructor(e,t,r){this.rows=e,this.columns=t,this._grid=r,this.headerHeight=e.headerSize,this.headerWidth=t.headerSize,this.hasRowHeader=t.hasHeader,this.hasColumnHeader=e.hasHeader}refresh(e,t){this.columns.viewSize(e),this.rows.viewSize(t);let r=this.columns.paneSegment(),n=this.rows.paneSegment();this.left=r.offset,this.top=n.offset,this.right=r.offset+r.length,this.bottom=n.offset+n.length,this.style={top:n.offset+"px",left:r.offset+"px",height:n.length+"px",width:r.length+"px"}}view(e,t){let r=this.rows.visible(t),n=this.columns.visible(e);return{rows:r,columns:n,rowOffset:r.offset,columnOffset:n.offset,mergedCellLeft:n.start,mergedCellTop:r.start,ref:new RangeRef(new CellRef(r.values.start,n.values.start),new CellRef(r.values.end,n.values.end))}}contains(e){return this.rows.contains(e.topLeft.row,e.bottomRight.row)&&this.columns.contains(e.topLeft.col,e.bottomRight.col)}index(e,t){return this._grid.index(e,t)}boundingRectangle(e){return this._grid.rectangle(e)}cellRefIndex(e){return this._grid.cellRefIndex(e)}scrollBoundaries(e){let t=this.boundingRectangle(e),r={top:Math.max(0,t.top-this.top+(this.hasColumnHeader?0:this.headerHeight)),left:Math.max(0,t.left-this.left+(this.hasRowHeader?0:this.headerWidth)),right:t.right-this.columns._viewSize+this.headerWidth,bottom:t.bottom-this.rows._viewSize+this.headerHeight},n=this.columns.defaultValue/2,i=this.rows.defaultValue/2;return r.scrollTop=r.top-i,r.scrollBottom=r.bottom+i,r.scrollLeft=r.left-n,r.scrollRight=r.right+n,r}}class Sorter{constructor(e,t){this._grid=e,this._lists=t}indices(e,t,r,n){let i=Sorter.ascendingComparer;return!1===r&&(i=Sorter.descendingComparer),t.sortedIndices(this._grid.cellRefIndex(e.topLeft),this._grid.cellRefIndex(e.bottomRight),i,n)}sortBy(e,t,r,n,i){let o=this.indices(e.toColumn(t),r,n,i);for(let t=e.topLeft.col;t<=e.bottomRight.col;t++){let r=this._grid.index(e.topLeft.row,t),n=this._grid.index(e.bottomRight.row,t);for(let e=0;e<this._lists.length;e++)r<this._lists[e].lastRangeStart()&&this._lists[e].sort(r,n,o)}return o}}Sorter.ascendingComparer=function(e,t){if(null===e&&null===t)return 0;if(null===e)return 1;if(null===t)return-1;let r=typeof e,n=typeof t;if("number"===r)return"number"===n?e-t:-1;if("string"===r)switch(n){case"number":return 1;case"string":return e.localeCompare(t);default:return-1}if("boolean"===r)switch(n){case"number":case"string":return 1;case"boolean":return e-t;default:return-1}if(e instanceof CalcError)return t instanceof CalcError?0:1;throw new Error("Cannot compare "+e+" and "+t)},Sorter.descendingComparer=function(e,t){return null===e&&null===t?0:null===e?1:null===t?-1:Sorter.ascendingComparer(t,e)};class AxisManager{constructor(e){this._sheet=e}forEachSelectedColumn(e){let t=this._sheet;t.batch((function(){t.select().forEachColumnIndex((function(r,n){e(t,r,n)}))}),{layout:!0,recalc:!0})}forEachSelectedRow(e){let t=this._sheet;t.batch((function(){t.select().forEachRowIndex((function(r,n){e(t,r,n)}))}),{layout:!0,recalc:!0})}includesHiddenColumns(e){return this._sheet._grid._columns.includesHidden(e.topLeft.col,e.bottomRight.col)}includesHiddenRows(e){return this._sheet._grid._rows.includesHidden(e.topLeft.row,e.bottomRight.row)}selectionIncludesHiddenColumns(){return this.includesHiddenColumns(this._sheet.select())}selectionIncludesHiddenRows(){return this.includesHiddenRows(this._sheet.select())}deleteSelectedColumns(){let e=[],t=0;return this.forEachSelectedColumn((function(r,n){if(n-=t,r.isHiddenColumn(n))return;t++;let i=[];e.unshift({index:n,formulas:i,width:r.columnWidth(n)}),r._saveModifiedFormulas(i,(function(){r.deleteColumn(n)}))})),e}deleteSelectedRows(){let e=[],t=0;return this.forEachSelectedRow((function(r,n){if(n-=t,r.isHiddenRow(n))return;t++;let i=[];e.unshift({index:n,formulas:i,height:r.rowHeight(n)}),r._saveModifiedFormulas(i,(function(){r.deleteRow(n)}))})),e}hideSelectedColumns(){this.forEachSelectedColumn((function(e,t){e.hideColumn(t)}));let e=this._sheet,t=e.select().toRangeRef(),r=t.topLeft.col,n=t.bottomRight.col,i=null;for(;;){let t=n<e._columns._count,o=r>=0;if(!o&&!t)break;if(t&&!e.isHiddenColumn(n)){i=n;break}if(o&&!e.isHiddenColumn(r)){i=r;break}r--,n++}null!==i&&(t=new RangeRef(new CellRef(0,i),new CellRef(e._rows._count-1,i)),e.range(t).select())}hideSelectedRows(){this.forEachSelectedRow((function(e,t){e.hideRow(t)}));let e=this._sheet,t=e.select().toRangeRef(),r=t.topLeft.row,n=t.bottomRight.row,i=null;for(;;){let t=n<e._rows._count,o=r>=0;if(!o&&!t)break;if(t&&!e.isHiddenRow(n)){i=n;break}if(o&&!e.isHiddenRow(r)){i=r;break}r--,n++}null!==i&&(t=new RangeRef(new CellRef(i,0),new CellRef(i,e._columns._count-1)),e.range(t).select())}unhideSelectedColumns(){this.forEachSelectedColumn((function(e,t){e.unhideColumn(t)}))}unhideSelectedRows(){this.forEachSelectedRow((function(e,t){e.unhideRow(t)}))}addColumnLeft(){let e,t=this._sheet,r=0;return t.batch((function(){t.select().forEachColumnIndex((function(n){e||(e=n),t.insertColumn(e),++r}))}),{recalc:!0,layout:!0}),{base:e,count:r}}addColumnRight(){let e,t=this._sheet,r=0;return t.batch((function(){t.select().forEachColumnIndex((function(t){e=t+1,++r}));for(let n=0;n<r;++n)t.insertColumn(e)}),{recalc:!0,layout:!0}),{base:e,count:r}}addRowAbove(){let e,t=this._sheet,r=0,n=t.select();return t.batch((function(){n.forEachRowIndex((function(n){e||(e=n),t.insertRow(e),++r}))}),{recalc:!0,layout:!0}),{base:e,count:r}}addRowBelow(){let e,t=this._sheet,r=0;return t.batch((function(){t.select().forEachRowIndex((function(t){e=t+1,++r}));for(let n=0;n<r;++n)t.insertRow(e)}),{recalc:!0,layout:!0}),{base:e,count:r}}}class AutoFillCalculator{constructor(e){this._grid=e}rectIsVertical(e,t,r,n){let i=this._grid.rectangle(e.toRangeRef()),o=this._grid.rectangle(t.toRangeRef());return Math.abs(o[n]-i[n])>Math.abs(i[r]-o[r])}autoFillDest(e,t){let r,n,i,o,s,a=e.topLeft,l=e.bottomRight,u=t.row>=a.row,c=t.col>=a.col;if(r=u?c?4:3:c?2:1,4===r)n=a,i=l,s=t.row>i.row||t.col>i.col,s&&(t=new CellRef(Math.max(t.row,i.row),Math.max(t.col,i.col))),o=this.rectIsVertical(i,t,"right","bottom")?new CellRef(t.row,i.col):new CellRef(i.row,t.col);else if(3===r){let e=new CellRef(a.col,l.row);t.row>l.row&&this.rectIsVertical(e,t,"left","bottom")?(n=a,o=new CellRef(t.row,l.col)):(n=l,o=new CellRef(a.row,t.col))}else if(2===r){let e=new CellRef(a.row,l.col);t.col>l.col&&!this.rectIsVertical(e,t,"right","top")?(n=a,o=new CellRef(l.row,t.col)):(n=l,o=new CellRef(t.row,a.col))}else n=l,o=this.rectIsVertical(a,t,"left","top")?new CellRef(t.row,a.col):new CellRef(a.row,t.col);return this._grid.normalize(new RangeRef(n,o))}}class EdgeNavigator{constructor(e,t,r,n){this.rangeGetter=r,this.prevLeft=function(r){var i=n(this.range(r)),o=this.range(t.prevVisible(i.topLeft[e]));return n(o).topLeft[e]},this.nextRight=function(r){var i=n(this.range(r)),o=this.range(t.nextVisible(i.bottomRight[e]));return n(o).bottomRight[e]},this.nextLeft=function(r){var i=n(this.range(r));return t.nextVisible(i.bottomRight[e])},this.prevRight=function(r){var i=n(this.range(r));return t.prevVisible(i.topLeft[e])}}boundary(e,t){this.top=e,this.bottom=t}range(e){return this.rangeGetter(e,this.top,this.bottom)}}class SheetNavigator{constructor(e){this._sheet=e,this.autoFillCalculator=new AutoFillCalculator(e._grid),this.colEdge=new EdgeNavigator("col",this._sheet._grid._columns,this.columnRange.bind(this),this.union.bind(this)),this.rowEdge=new EdgeNavigator("row",this._sheet._grid._rows,this.rowRange.bind(this),this.union.bind(this))}height(e){this._viewPortHeight=e}union(e){return this._sheet.unionWithMerged(e)}columnRange(e,t,r){return this._sheet._ref(t,e,r-t,1)}rowRange(e,t,r){return this._sheet._ref(e,t,1,r-t)}selectionIncludesMergedCells(){return this._sheet.select().contains(this._sheet._mergedCells)}setSelectionValue(e){var t=this._sheet.selection();setTimeout((function(){t.value(e())}))}selectAll(){this._sheet.select(this._sheet._sheetRef)}select(e,t,r){e=this.refForMode(e,t),r&&(e=this._sheet.select().concat(e)),this._sheet.select(e)}refForMode(e,t){var r=this._sheet._grid;switch(t){case"range":e=r.normalize(e);break;case"row":e=r.rowRef(e.row);break;case"column":e=r.colRef(e.col);break;case"sheet":e=this._sheet._sheetRef}return e}startSelection(e,t,r,n,i){if("autofill"===t)this._sheet.startAutoFill();else if(n&&"range"===t){var o=new RangeRef(this._sheet.activeCell().first(),e);this._sheet.select(o,!1,!1),this._sheet.startSelection(i)}else this._sheet.startSelection(i),this.select(e,t,r)}completeSelection(){this._sheet.completeSelection()}selectForContextMenu(e,t){var r=this._sheet;r._activeDrawing=null,r.select().contains(this.refForMode(e,t))||this.select(e,t)}selectDrawingForContextMenu(e){var t=this._sheet;t._activeDrawing=e,t.triggerChange({selection:!0})}modifySelection(e){var t,r=this.determineDirection(e),n=this._sheet,i=this._viewPortHeight,o=n._grid._rows,s=n._grid._columns,a=n.currentOriginalSelectionRange(),l=n.select().toRangeRef(),u=n.activeCell(),c=a.topLeft.clone(),h=a.bottomRight.clone(),f=new CellRef(h.row,c.col);switch(this.colEdge.boundary(l.topLeft.row,l.bottomRight.row),this.rowEdge.boundary(l.topLeft.col,l.bottomRight.col),r){case"expand-left":c.col=this.colEdge.prevLeft(c.col),t=c;break;case"shrink-right":c.col=this.colEdge.nextLeft(c.col),t=c;break;case"expand-right":h.col=this.colEdge.nextRight(h.col),t=h;break;case"shrink-left":h.col=this.colEdge.prevRight(h.col),t=h;break;case"expand-up":c.row=this.rowEdge.prevLeft(c.row),t=c;break;case"shrink-down":c.row=this.rowEdge.nextLeft(c.row),t=c;break;case"expand-down":h.row=this.rowEdge.nextRight(h.row),t=h;break;case"shrink-up":h.row=this.rowEdge.prevRight(h.row),t=h;break;case"expand-page-up":c.row=o.prevPage(c.row,i);break;case"shrink-page-up":h.row=o.prevPage(h.row,i);break;case"expand-page-down":h.row=o.nextPage(h.row,i);break;case"shrink-page-down":c.row=o.nextPage(c.row,i);break;case"first-col":c.col=s.firstVisible(),h.col=u.bottomRight.col,t=c;break;case"last-col":h.col=s.lastVisible(),c.col=u.topLeft.col,t=h;break;case"first-row":c.row=o.firstVisible(),h.row=u.bottomRight.row,t=c;break;case"last-row":h.row=o.lastVisible(),c.row=u.topLeft.row,t=h;break;case"last":h.row=o.lastVisible(),h.col=s.lastVisible(),c=u.topLeft,t=h;break;case"first":c.row=o.firstVisible(),c.col=s.firstVisible(),h=u.bottomRight,t=c;break;case"expand-word-right":h.col=s.nextUntil(h.col,makeWordMovement(n,h,!0)),t=h;break;case"shrink-word-right":c.col=s.nextUntil(f.col,makeWordMovement(n,f,!0)),t=c;break;case"expand-word-left":c.col=s.prevUntil(f.col,makeWordMovement(n,f,!0)),t=c;break;case"shrink-word-left":h.col=s.prevUntil(h.col,makeWordMovement(n,h,!0)),t=h;break;case"expand-word-up":c.row=o.prevUntil(c.row,makeWordMovement(n,c,!1)),t=c;break;case"shrink-word-up":h.row=o.prevUntil(h.row,makeWordMovement(n,h,!1)),t=h;break;case"expand-word-down":h.row=o.nextUntil(h.row,makeWordMovement(n,h,!1)),t=h;break;case"shrink-word-down":c.row=o.nextUntil(c.row,makeWordMovement(n,c,!1)),t=c}var p=new RangeRef(c,h);this.union(p).intersects(u)?(t&&n.focus(t),this.updateCurrentSelectionRange(p)):this.modifySelection(r.replace("shrink","expand"))}moveActiveCell(e){var t=this._sheet,r=t.activeCell(),n=r.topLeft,i=r.bottomRight,o=t.originalActiveCell(),s=t._grid._rows,a=t._grid._columns,l=o.row,u=o.col;switch(e){case"left":u=a.prevVisible(n.col);break;case"up":l=s.prevVisible(n.row);break;case"right":u=a.nextVisible(i.col);break;case"down":l=s.nextVisible(i.row);break;case"first-col":u=a.firstVisible();break;case"last-col":u=a.lastVisible();break;case"first-row":l=s.firstVisible();break;case"last-row":l=s.lastVisible();break;case"last":l=s.lastVisible(),u=a.lastVisible();break;case"first":l=s.firstVisible(),u=a.firstVisible();break;case"next-page":l=s.nextPage(i.row,this._viewPortHeight);break;case"prev-page":l=s.prevPage(i.row,this._viewPortHeight);break;case"word-right":u=a.nextUntil(u,makeWordMovement(t,i,!0));break;case"word-left":u=a.prevUntil(u,makeWordMovement(t,i,!0));break;case"word-up":l=s.prevUntil(l,makeWordMovement(t,i,!1));break;case"word-down":l=s.nextUntil(l,makeWordMovement(t,i,!1))}t.select(new CellRef(l,u))}navigateInSelection(e){var t,r,n,i=this._sheet,o=i.activeCell().topLeft,s=i.originalActiveCell(),a=i._grid._rows,l=i._grid._columns,u=s.row,c=s.col,h=!1,f=!1,p=o.col,d=o.row;function m(e){t=e.topLeft,r=e.bottomRight}m(i.currentNavigationRange());for(var g=!1,C=!1;!g&&!C;){var v=new CellRef(u,c);switch(i.singleCellSelection()&&(h=t.eq(v)&&i._sheetRef.topLeft.eq(v),f=r.eq(v)&&i._sheetRef.bottomRight.eq(v),h||(h=l.firstVisible()===c&&a.firstVisible()===u),f||(f=l.lastVisible()===c&&a.lastVisible()===u)),e){case"next":f?C=!0:r.eq(v)?(m(i.nextNavigationRange()),u=t.row,c=t.col):((c=l.nextVisible(p))===p||c>r.col)&&(c=t.col,u=(n=a.nextVisible(u))===u||n>r.row?t.row:n);break;case"previous":h?(C=!0,this._sheet._workbook._view.element.querySelector(".k-spreadsheet-name-editor .k-input-inner").focus()):t.eq(v)?(m(i.previousNavigationRange()),u=r.row,c=r.col):((c=l.prevVisible(p))===p||c<t.col)&&(c=r.col,u=(n=a.prevVisible(u))===u||n<t.row?r.row:n);break;case"lower":r.eq(v)?(m(i.nextNavigationRange()),u=t.row,c=t.col):((u=a.nextVisible(d))===d||u>r.row)&&(u=t.row,c=(n=l.nextVisible(c))===c||n>r.col?t.col:n);break;case"upper":t.eq(v)?(m(i.previousNavigationRange()),u=r.row,c=r.col):((u=a.prevVisible(d))===d||u<t.row)&&(u=r.row,c=(n=l.prevVisible(c))===c||n<t.col?r.col:n);break;default:throw new Error("Unknown entry navigation: "+e)}g=!this.shouldSkip(u,c),p=c,d=u}g&&(i.singleCellSelection()?i.select(new CellRef(u,c)):i.activeCell(new CellRef(u,c)))}extendSelection(e,t){var r=this._sheet,n=r._grid;if("autofill"!==t){"range"===t?e=n.normalize(e):"row"===t?e=n.rowRef(e.row).bottomRight:"column"===t&&(e=n.colRef(e.col).bottomRight);var i=r.originalActiveCell().toRangeRef();this.updateCurrentSelectionRange(new RangeRef(i.topLeft,e))}else this.resizeAutoFill(e)}shouldSkip(e,t){if(this._sheet.isHiddenRow(e)||this._sheet.isHiddenColumn(t))return!0;var r=new CellRef(e,t),n=!1;return this._sheet.forEachMergedCell((function(e){e.intersects(r)&&!e.collapse().eq(r)&&(n=!0)})),n}resizeAutoFill(e){var t,r,n=this._sheet,i=n.select(),o=n._autoFillOrigin,s=this.autoFillCalculator.autoFillDest(i,e),a=this.punch(i,s);if(!a){var l=n.range(s)._previewFillFrom(n.range(o));l&&(r=l.direction,t=l.hint)}n.updateAutoFill(s,a,t,r)}determineDirection(e){var t=this._sheet.currentSelectionRange(),r=this._sheet.activeCell(),n=r.topLeft.col===t.topLeft.col,i=r.bottomRight.col===t.bottomRight.col,o=r.topLeft.row===t.topLeft.row,s=r.bottomRight.row===t.bottomRight.row;switch(e){case"left":e=i?"expand-left":"shrink-left";break;case"right":e=n?"expand-right":"shrink-right";break;case"up":e=s?"expand-up":"shrink-up";break;case"down":e=o?"expand-down":"shrink-down";break;case"prev-page":e=s?"expand-page-up":"shrink-page-up";break;case"next-page":e=o?"expand-page-down":"shrink-page-down";break;case"word-left":e=i?"expand-word-left":"shrink-word-left";break;case"word-right":e=n?"expand-word-right":"shrink-word-right";break;case"word-up":e=s?"expand-word-up":"shrink-word-up";break;case"word-down":e=o?"expand-word-down":"shrink-word-down"}return e}updateCurrentSelectionRange(e){var t=this._sheet;t.select(t.originalSelect().replaceAt(t.selectionRangeIndex(),e),!1)}punch(e,t){var r;if(t.topLeft.eq(e.topLeft))if(t.bottomRight.row<e.bottomRight.row){var n=this.rowEdge.nextRight(t.bottomRight.row);r=new RangeRef(new CellRef(n,e.topLeft.col),e.bottomRight)}else if(t.bottomRight.col<e.bottomRight.col){var i=this.colEdge.nextRight(t.bottomRight.col);r=new RangeRef(new CellRef(e.topLeft.row,i),e.bottomRight)}return r}}function makeWordMovement(e,t,r){var n=e.range(t).value();return function(i,o,s){if(s)return!0;var a=(r?e.range(t.row,i):e.range(i,t.col)).value();return null===n?null!==a&&i:o||null!==a?null===a:(n=null,!1)}}function numberToDate(e){return null==e?null:calc.runtime.serialToDate(e)}function dateToNumber(e){return null==e?null:calc.runtime.dateToSerial(e)}var identity=function(e){return e};class SheetDataSourceBinder{constructor(e){this.options=Object.assign({columns:[]},this.options,Object.keys(e).reduce(((t,r)=>(void 0!==e[r]&&(t[r]=e[r]),t)),{})),this.columns=this._normalizeColumns(this.options.columns),this._sheet(),this._dataSource(),this._header(),this._boundRowsCount=0,this.dataSource.fetch()}_sheet(){this.sheet=this.options.sheet,this._sheetChangeHandler=this._sheetChange.bind(this),this._sheetDeleteRowHandler=this._sheetDeleteRow.bind(this),this._sheetInsertRowHandler=this._sheetInsertRow.bind(this),this.sheet.bind("change",this._sheetChangeHandler).bind("afterDeleteRow",this._sheetDeleteRowHandler).bind("afterInsertRow",this._sheetInsertRowHandler)}_sheetInsertRow(e){void 0!==e.index&&this.dataSource.insert(Math.max(e.index-1,0),{})}_sheetDeleteRow(e){if(void 0!==e.index){var t=this.dataSource,r=t.view()[e.index-1];r&&t.remove(r)}}_header(){this.sheet.batch(function(){this.columns.forEach(function(e,t){this.sheet.range(0,t).value(e.title)}.bind(this))}.bind(this))}_sheetChange(e){if(!e.insertRow&&!e.deleteRow&&e.recalc&&e.ref&&e.isValue){var t,r,n,i,o,s=this.dataSource,a=s.view(),l=this.columns,u=[],c=this.sheet,h=function(e){for(var t,n=0,o=(e=e.toRangeRef()).topLeft.row;o<=e.bottomRight.row;o++){(t=a[o-1])||(t=s.insert(o-1,{}),a=s.view());for(var c=0,h=e.topLeft.col;h<=e.bottomRight.col&&h<l.length;h++){var f=u[i][n][c++];t.set(l[h].field,r[h](f))}n++}};for(s.reader.model&&(t=s.reader.model.fields),!l.length&&a.length&&(l=Object.keys(a[0].toJSON())),r=l.map((function(e){var r=e.field;return r&&t&&t[r]&&"date"===t[r].type?numberToDate:identity})),this._skipRebind=!0,(n=c._grid.normalize(e.ref))instanceof UnionRef||(n=new UnionRef([n])),(o=n.refs).forEach((function(e){u.push(c.range(e).values())})),i=0;i<o.length;i++)o[i].forEach(h);this._boundRowsCount=s.view().length,this._skipRebind=!1}}_normalizeColumns(e){return e.map((function(e){var t=e.field||e;return{field:t,title:e.title||t}}))}_dataSource(){var e=this.options.dataSource;e=Array.isArray(e)?{data:e}:e,this.dataSource&&this._changeHandler?this.dataSource.unbind("change",this._changeHandler).unbind("progress",this._progressHandler).unbind("error",this._errorHandler):(this._changeHandler=this._change.bind(this),this._progressHandler=this._requestStart.bind(this),this._errorHandler=this._error.bind(this)),this.dataSource=this.options.sheet.createSheetDataSource?.(e).bind("change",this._changeHandler).bind("progress",this._progressHandler).bind("error",this._errorHandler)}_error(){this._progress(!1)}_requestStart(){this._progress(!0)}_progress(e){this.sheet.trigger("progress",{toggle:e})}_change(){if(!this._skipRebind&&!this.sheet.trigger("dataBinding")){var e=this.dataSource.view(),t=this.columns;!t.length&&e.length&&(this.columns=t=this._normalizeColumns(Object.keys(e[0].toJSON())),this._header());var r=t.map((function(e){return getter(e.field)}));this.sheet.batch(function(){for(var t=Math.max(e.length,this._boundRowsCount,this.sheet._grid.rowCount-1),n=0;n<t;n++)for(var i=0;i<r.length;i++){var o=e[n]?r[i](e[n]):null;this.sheet.range(n+1,i).value(o)}}.bind(this)),this._boundRowsCount=e.length,this._progress(!1),this.sheet.trigger("dataBound")}}destroy(){this.dataSource.unbind("change",this._changeHandler).unbind("progress",this._progressHandler).unbind("error",this._errorHandler),this.sheet.unbind("change",this._sheetChangeHandler).unbind("deleteRow",this._sheetDeleteRowHandler).unbind("insertRow",this._sheetInsertRowHandler)}}const kendoDate=function(){function e(){return getDate(new Date)}return{dayOfWeek:dayOfWeek,getDate:getDate,isToday:function(t){return getDate(t).getTime()===e().getTime()},addDays:addDays,today:e,firstDayOfMonth:firstDayOfMonth}}(),logic={or:{concat:(e,t)=>r=>e(r)||t(r),identity:()=>!1},and:{concat:(e,t)=>r=>e(r)&&t(r),identity:()=>!0}},operatorsMap={contains:(e,t)=>(e||"").indexOf(t)>=0,doesnotcontain:(e,t)=>-1===(e||"").indexOf(t),doesnotendwith:(e,t)=>(e||"").indexOf(t,(e||"").length-(t||"").length)<0,doesnotstartwith:(e,t)=>-1===(e||"").lastIndexOf(t,0),endswith:(e,t)=>(e||"").indexOf(t,(e||"").length-(t||"").length)>=0,eq:(e,t)=>e===t,gt:(e,t)=>e>t,gte:(e,t)=>e>=t,isempty:e=>""===e,isnotempty:e=>""!==e,isnotnull:e=>isPresent(e),isnull:e=>isBlank(e),lt:(e,t)=>e<t,lte:(e,t)=>e<=t,neq:(e,t)=>e!=t,startswith:(e,t)=>0===(e||"").lastIndexOf(t,0)},dateRegExp=/^\/Date\((.*?)\)\/$/,convertValue=(e,t,r)=>{if(null!=e&&isString(e)){const n=dateRegExp.exec(e);if(n)return new Date(+n[1]).getTime();if(t)return r?e.toLocaleLowerCase(r):e.toLowerCase()}else if(null!=e&&isDate(e))return e.getTime();return e},transformFilter=({field:e,ignoreCase:t,value:r,operator:n,accentFoldingFiltering:i})=>{e=isPresent(e)?e:e=>e,t=!isPresent(t)||t;const o=typedGetter(isFunction(e)?e:getter(e,!0),r,t,i);r=convertValue(r,t,i);const s=isFunction(n)?n:operatorsMap[n];return e=>s(o(e),r,t)},typedGetter=(e,t,r,n)=>{if(!isPresent(t))return e;let i=e;if(isString(t)){const o=dateRegExp.exec(t);o?t=new Date(+o[1]):i=t=>{const i=e(t);return"string"==typeof i&&r?n?i.toLocaleLowerCase(n):i.toLowerCase():isNumeric(i)?i+"":i}}return isDate(t)?e=>{const t=i(e);return isDate(t)?t.getTime():t}:i},transformCompositeFilter=function(e){const t=e.accentFoldingFiltering,r=logic[e.logic||"and"];return e.filters.filter(isPresent).map((e=>{const r=isPresent(t)?deepExtend({},e,{accentFoldingFiltering:t}):e;return isPresent(e.filters)?transformCompositeFilter(r):transformFilter(r)})).reduce(r.concat,r.identity)};let filtersObj={};const dateToSerial$1=calc.runtime.dateToSerial,serialToDate$1=calc.runtime.serialToDate;class Filter{prepare(){}value(e){return e.value}matches(){throw new Error("The 'matches' method is not implemented.")}toJSON(){throw new Error("The 'toJSON' method is not implemented.")}}Filter.create=function(e){var t=e.filter;if(!t)throw new Error("Filter type not specified.");var r=filtersObj[t.charAt(0).toUpperCase()+t.substring(1)+"Filter"];if(!r)throw new Error("Filter type not recognized.");return new r(e)};class ValueFilter extends Filter{constructor(e){super(e),this._values=[],this._dates=[],this._blanks=!1,void 0!==e.values&&(this._values=e.values),void 0!==e.blanks&&(this._blanks=e.blanks),void 0!==e.dates&&(this._dates=e.dates)}value(e){var t=e.value;this._dates.length>0&&e.format&&"number"==typeof t&&("date"===formatting.type(t,e.format)&&(t=serialToDate$1(t)));return t}matches(e){return null==e?this._blanks:e instanceof Date?this._dates.some((function(t){return!(t.year!==e.getFullYear()||void 0!==t.month&&t.month!==e.getMonth()||void 0!==t.day&&t.day!==e.getDate()||void 0!==t.hours&&t.hours!==e.getHours()||void 0!==t.minutes&&t.minutes!==e.getMinutes()||void 0!==t.seconds&&t.seconds!==e.getSeconds())})):this._values.indexOf(e)>=0}toJSON(){return{filter:"value",blanks:this._blanks,values:this._values.slice(0)}}}class CustomFilter extends Filter{constructor(e){if(super(e),this._logic="and",void 0!==e.logic&&(this._logic=e.logic),void 0===e.criteria)throw new Error("Must specify criteria.");this._criteria=e.criteria,this._matches=transformCompositeFilter({logic:this._logic,filters:this._criteria,accentFoldingFiltering:culture().name})}matches(e){return null!==e&&this._matches(e)}value(e){var t=e.value,r=this._criteria[0].value,n=r instanceof Date?"date":typeof r,i=typeof t;return e.format&&(i=formatting.type(t,e.format)),i!=n?"string"==n&&(e.format&&(t=formatting.text(t,e.format)),t+=""):"date"==i&&(t=serialToDate$1(t)),t}toJSON(){return{filter:"custom",logic:this._logic,criteria:this._criteria}}}class TopFilter extends Filter{constructor(e){super(e),this._type=e.type,this._value=e.value,this._values=[]}prepare(e){var t=e.map(this.value).sort().filter((function(e,t,r){return 0===t||e!==r[t-1]}));"topNumber"===this._type||"topPercent"==this._type?t.sort((function(e,t){return t-e})):t.sort((function(e,t){return e-t}));var r=this._value;"topPercent"!==this._type&&"bottomPercent"!==this._type||(r=t.length*r/100|0),this._values=t.slice(0,r)}matches(e){return this._values.indexOf(e)>=0}toJSON(){return{filter:"top",type:this._type,value:this._value}}}class DynamicFilter extends Filter{constructor(e){if(super(e),this._type=e.type,this._predicate=this[e.type],"function"!=typeof this._predicate)throw new Error("DynamicFilter type '"+e.type+"' not recognized.")}value(e){var t=e.value;e.format&&("date"===formatting.type(t,e.format)&&(t=serialToDate$1(t)));return t}prepare(e){for(var t=0,r=0,n=0;n<e.length;n++){var i=this.value(e[n]);"number"==typeof i&&(t+=i,r++)}this._average=r>0?t/r:0}matches(e){return this._predicate(e)}aboveAverage(e){return e instanceof Date&&(e=dateToSerial$1(e)),"number"==typeof e&&e>this._average}belowAverage(e){return e instanceof Date&&(e=dateToSerial$1(e)),"number"==typeof e&&e<this._average}tomorrow(e){if(e instanceof Date){var t=kendoDate.addDays(kendoDate.today(),1);return kendoDate.getDate(e).getTime()===t.getTime()}return!1}today(e){return e instanceof Date&&kendoDate.isToday(e)}yesterday(e){if(e instanceof Date){var t=kendoDate.addDays(kendoDate.today(),-1);return kendoDate.getDate(e).getTime()===t.getTime()}return!1}nextWeek(e){return sameWeek(kendoDate.addDays(kendoDate.today(),7),e)}thisWeek(e){return sameWeek(kendoDate.today(),e)}lastWeek(e){return sameWeek(kendoDate.addDays(kendoDate.today(),-7),e)}nextMonth(e){return sameMonth(e,1)}thisMonth(e){return sameMonth(e,0)}lastMonth(e){return sameMonth(e,-1)}nextQuarter(e){if(e instanceof Date){var t=kendoDate.today(),r=quarter(e)-quarter(t);return 1===r&&t.getFullYear()===e.getFullYear()||-3==r&&t.getFullYear()+1===e.getFullYear()}return!1}thisQuarter(e){if(e instanceof Date){var t=kendoDate.today();return 0===quarter(e)-quarter(t)&&t.getFullYear()===e.getFullYear()}return!1}lastQuarter(e){if(e instanceof Date){var t=kendoDate.today(),r=quarter(t)-quarter(e);return 1===r&&t.getFullYear()===e.getFullYear()||-3==r&&t.getFullYear()-1===e.getFullYear()}return!1}nextYear(e){return sameYear(e,1)}thisYear(e){return sameYear(e,0)}lastYear(e){return sameYear(e,-1)}yearToDate(e){if(e instanceof Date){var t=kendoDate.today();return e.getFullYear()===t.getFullYear()&&e<=t}return!1}toJSON(){return{filter:"dynamic",type:this._type}}}filtersObj={Filter:Filter,ValueFilter:ValueFilter,CustomFilter:CustomFilter,TopFilter:TopFilter},[1,2,3,4].forEach((function(e){DynamicFilter.prototype["quarter"+e]=function(t){return t instanceof Date&&quarter(t)===e}}));const initDynamicFilter=()=>{culture().calendar.months.format.wide.forEach((function(e,t){DynamicFilter.prototype[e.toLowerCase()]=function(e){return e instanceof Date&&e.getMonth()===t}}))};function quarter(e){var t=e.getMonth()+1;return t>=1&&t<=3?1:t>=4&&t<=6?2:t>=7&&t<=9?3:4}function sameYear(e,t){if(e instanceof Date){var r=kendoDate.today();return r.setFullYear(r.getFullYear()+t),r.getFullYear()===e.getFullYear()}return!1}function sameMonth(e,t){if(e instanceof Date){var r=kendoDate.firstDayOfMonth(kendoDate.today());return r.setMonth(r.getMonth()+t,1),r.getTime()===kendoDate.firstDayOfMonth(e).getTime()}return!1}function sameWeek(e,t){if(t instanceof Date){var r=kendoDate.dayOfWeek(kendoDate.getDate(e),1),n=kendoDate.dayOfWeek(kendoDate.getDate(t),1);return r.getTime()===n.getTime()}return!1}var MODIFIED_FORMULAS;const DEFAULT_SHEET_STATE="visible";class Selection{constructor(e){this._sheet=e,this.selection=FIRSTREF.toRangeRef(),this.originalSelection=FIRSTREF.toRangeRef(),this._activeCell=FIRSTREF.toRangeRef(),this.originalActiveCell=FIRSTREF}currentSelectionRange(){return this.selection.rangeAt(this.selectionRangeIndex).toRangeRef()}currentOriginalNavigationRange(){return this.originalSelection.rangeAt(this.selectionRangeIndex).toRangeRef()}currentNavigationRange(){return this.singleCellSelection()?this._sheet._sheetRef:this.selection.rangeAt(this.selectionRangeIndex).toRangeRef()}nextNavigationRange(){return this.singleCellSelection()||(this.selectionRangeIndex=this.selection.nextRangeIndex(this.selectionRangeIndex)),this.currentNavigationRange()}previousNavigationRange(){return this.singleCellSelection()||(this.selectionRangeIndex=this.selection.previousRangeIndex(this.selectionRangeIndex)),this.currentNavigationRange()}activeCell(e){return e&&(this.originalActiveCell=e.first(),this._activeCell=this._sheet.unionWithMerged(e.toRangeRef()),this._sheet.focus(e),this._sheet.triggerChange({activeCell:!0,selection:!0})),this._activeCell}select(e,t,r,n){if(e){if(e.eq(this.originalSelection))return;if(this._sheet.triggerSelect(new Range$1(e,this._sheet)),this.originalSelection=e,this.selection=t,!1!==r){if(e.isCell())this._sheet.forEachMergedCell(e,(function(t){e=t.topLeft})),this.activeCell(e);else{if(e=this.selection.lastRange(),n&&n._sheet===this._sheet&&n.panes[0]){var i,o,s,a,l,u,c=n.panes;for(i=0;i<c.length&&(!(o=c[i])._currentView||(s=o._currentView.rows.values,a=o._currentView.columns.values,l=new RangeRef(new CellRef(s.start,a.start),new CellRef(s.end,a.end)),(u=e.intersect(l))===NULLREF));i++);u&&u!==NULLREF&&(e=u)}this.activeCell(e.first())}this.selectionRangeIndex=this.selection.size()-1}else this._sheet.triggerChange({selection:!0})}return this.selection}singleCellSelection(){return this._activeCell.eq(this.selection)}}let EDITORS={};function registerEditor(e,t){EDITORS[e]=t}class Sheet extends Observable{constructor(){super(),this.events=["changing","commandRequest","afterInsertRow","afterDeleteRow","insertRow","insertColumn","deleteRow","deleteColumn","hideRow","hideColumn","unhideRow","unhideColumn","select","dataBinding","dataBound","progress"],this.createSheetDataSource=Array.from(arguments).pop(),this._reinit.apply(this,arguments)}activeCellCustomEditor(){let e=this.activeCell().first();if(this.range(e).enable()){let t,r=this.validation(e),n=this._properties.get("editor",this._grid.cellRefIndex(e));return null!=n?t=EDITORS[n]:r&&r.showButton&&(n="_validation_"+r.dataType,t=EDITORS[n]),"function"==typeof t&&(t=EDITORS[n]=t()),t}}_reinit(e,t,r,n,i,o,s){s=s||{},this._defaultCellStyle={background:s.background,color:s.color,fontFamily:s.fontFamily,fontSize:s.fontSize,italic:s.italic,bold:s.bold,underline:s.underline,wrap:s.wrap,verticalAlign:s.verticalAlign,textAlign:s.textAlign},this._rows=new Axis(e,r),this._columns=new Axis(t,n),this._filteredRows=new RangeList(0,e-1,!1),this._mergedCells=[],this._frozenRows=0,this._frozenColumns=0,this._suspendChanges=!1,this._filter=null,this._showGridLines=!0,this._gridLinesColor=null,this._grid=new Grid(this._rows,this._columns,e,t,i,o),this._sheetRef=this._grid.normalize(SHEETREF),this._properties=new PropertyBag(e,t,this._defaultCellStyle),this._sorter=new Sorter(this._grid,this._properties.sortable()),this._viewSelection=new Selection(this),this._editSelection=new Selection(this),this._formulaSelections=[],this._drawings=[]}resize(e,t){e=Math.max(e,1),t=Math.max(t,1);var r=this._rows._count,n=this._columns._count;e<r&&this.range(e,0,r-e,n).clear(),t<n&&this.range(0,t,r,n-t).clear(),this._rows._resize(e),this._columns._resize(t),this._grid._resize(e,t),this._properties._resize(e,t),this._sheetRef=this._grid.normalize(SHEETREF),e>r&&(this.range(r,0,e-r,t).clear(),this._filteredRows.value(r,e-1,!1)),t>n&&this.range(0,n,e,t-n).clear(),this.triggerChange({layout:!0})}_resizeAddRow(e){this.resize(this._rows._count+(e||1),this._columns._count)}_resizeAddColumn(e){this.resize(this._rows._count,this._columns._count+(e||1))}_resizeDeleteRow(e){this._resizeAddRow(-(e||1))}_resizeDeleteColumn(e){this._resizeAddColumn(-(e||1))}_resizeForJSON(e){for(var t=e.length,r=0,n=0;n<e.length;++n){var i=e[n];if(null!=i.index&&(t=Math.max(t,i.index+1)),i.cells){r=Math.max(r,i.cells.length);for(var o=0;o<i.cells.length;++o){var s=i.cells[o];null!=s.index&&(r=Math.max(r,s.index+1))}}}this.resize(Math.max(t,this._rows._count),Math.max(r,this._columns._count))}_selectionState(){return this._inEdit?this._editSelection:this._viewSelection}navigator(){return this._navigator||(this._navigator=new SheetNavigator(this)),this._navigator}axisManager(){return this._axisManager||(this._axisManager=new AxisManager(this)),this._axisManager}_name(e){return e?(this._sheetName=e,this):this._sheetName}name(){return this._name()}_state(e){return e?(this._sheetState=e,this):this._sheetState||"visible"}state(){return this._state()}_property(e,t,r){return void 0===t?e():(e(t),this.triggerChange(r))}_field(e,t,r){return void 0===t?this[e]:(this[e]=t,this.triggerChange(r))}suspendChanges(e){return void 0===e?this._suspendChanges:(this._suspendChanges=e,this)}triggerChange(e){return this._suspendChanges?e&&e.isValue&&(this._valueChanged=!0):this.trigger("change",e),this}triggerSelect(e){this.trigger("select",{range:e})}setDataSource(e,t){this.dataSourceBinder&&this.dataSourceBinder.destroy(),this.dataSourceBinder=new SheetDataSourceBinder({dataSource:e,sheet:this,columns:t,createSheetDataSource:this.createSheetDataSource}),this.dataSource=this.dataSourceBinder.dataSource}hideColumn(e){if(!this.trigger("hideColumn",{index:e}))return this._property(this._columns.hide.bind(this._columns),e,{layout:!0})}unhideColumn(e){if(!this.trigger("unhideColumn",{index:e}))return this._property(this._columns.unhide.bind(this._columns),e,{layout:!0})}isHiddenColumn(e){return this._grid._columns.hidden(e)}_copyRange(e,t){var r=this._grid,n=r.rowCount,i=r.normalize(e.topLeft),o=r.normalize(e.bottomRight),s=i.col*n+i.row,a=o.col*n+o.row,l=t.col*n+t.row;this._properties.copy(s,a,l)}_saveModifiedFormulas(e,t){var r=MODIFIED_FORMULAS;MODIFIED_FORMULAS=e;var n=t();return MODIFIED_FORMULAS=r,n}_restoreModifiedFormulas(e){var t=this._workbook;e.forEach((function(e){var r,n=t.sheetByName(e.sheet);e instanceof calc.runtime.Formula&&(r=n._grid.cellRefIndex(e),n._properties.set("formula",r,r,e)),e instanceof validationExport.Validation&&(r=n._grid.cellRefIndex(e),n._properties.set("validation",r,r,e))}))}_adjustReferences(e,t,r,n){if(this._mergedCells=n.reduce((function(n,i){return(i=i.adjust(null,null,null,null,"row"===e,t,r))instanceof RangeRef&&n.push(i),n}),[]),this._workbook){var i=this._name();this._workbook._sheets.forEach((function(n){n._forFormulas((function(n){var o=n.adjust(i,e,t,r);o&&MODIFIED_FORMULAS&&MODIFIED_FORMULAS.push(o)})),n._forValidations((function(n){var o=n.adjust(i,e,t,r);o&&MODIFIED_FORMULAS&&MODIFIED_FORMULAS.push(o)}))})),this._workbook.adjustNames(i,"row"===e,t,r)}var o=this.select();(o=o.adjust(null,null,null,null,"row"===e,t,r))!==NULLREF&&this.select(o),("col"===e?this._columns:this._rows).adjust(t,r),"row"===e&&(r<0?this._filteredRows.copy(t-r,this._rows._count-1,t):(this._filteredRows.copy(t,this._rows._count,t+r),this._filteredRows.value(t,t+r-1,!1))),this._drawings.forEach((function(n){n.topLeftCell&&(n.topLeftCell=n.topLeftCell.adjust(null,null,null,null,"row"===e,t,r))}))}_forFormulas(e){var t=this._properties.get("formula").values(),r=t.length;t.forEach((function(t,n){e.call(this,t.value,n,r)}),this)}_forValidations(e){this._properties.get("validation").values().forEach((function(t){e.call(this,t.value)}),this)}insertRow(e,t){if(!this.trigger("insertRow",{index:e}))return this.batch((function(){this._resizeAddRow();var t=this._grid,r=t.columnCount,n=t.rowCount;if(e+1!==n){var i=this.frozenRows();e<i&&this.frozenRows(i+1);for(var o=this._mergedCells.slice(),s=0;s<r;s++){var a=new RangeRef(new CellRef(e,s),new CellRef(e,s)),l=t.normalize(a.topLeft),u=t.normalize(a.bottomRight),c=new RangeRef(new CellRef(l.row,l.col),new CellRef(n-2,u.col));this._copyRange(c,new CellRef(l.row+1,l.col)),new Range$1(a,this).clear({clearAll:!0,keepBorders:!0})}this._adjustReferences("row",e,1,o)}}),{recalc:!0,layout:!0,insertRow:{index:e},ref:new RangeRef(new CellRef(e,0),new CellRef(1/0,1/0))}),t||this.trigger("afterInsertRow",{index:e}),this}isEnabledRow(e){var t=new RangeRef(new CellRef(e,0),new CellRef(e,this._grid.columnCount));return new Range$1(t,this).enable()}deleteRow(e,t){return this.isEnabledRow(e)?this.trigger("deleteRow",{index:e})?void 0:(this.batch((function(){var t=this._grid,r=t.columnCount,n=this.frozenRows();e<n&&this.frozenRows(n-1);for(var i=this._mergedCells.slice(),o=0;o<r;o++){var s=new RangeRef(new CellRef(e,o),new CellRef(e,o));new Range$1(s,this).clear({clearAll:!0,keepBorders:!0});var a=t.normalize(s.topLeft),l=t.normalize(s.bottomRight),u=new RangeRef(new CellRef(a.row+1,a.col),new CellRef(1/0,l.col));this._copyRange(u,a);var c=t.normalize(u.bottomRight);new Range$1(new RangeRef(c,c),this).clear()}this._adjustReferences("row",e,-1,i),this._resizeDeleteRow()}),{recalc:!0,layout:!0,deleteRow:{index:e},ref:new RangeRef(new CellRef(e,0),new CellRef(1/0,1/0))}),t||this.trigger("afterDeleteRow",{index:e}),this):this}insertColumn(e){if(!this.trigger("insertColumn",{index:e}))return this.batch((function(){this._resizeAddColumn();var t=this._grid,r=t.columnCount;if(e+1!==r){var n=this.frozenColumns();e<n&&this.frozenColumns(n+1);for(var i=this._mergedCells.slice(),o=r;o>=e;o--){var s=new RangeRef(new CellRef(0,o),new CellRef(1/0,o));if(new Range$1(s,this).clear({clearAll:!0,keepBorders:!0}),o===e)break;var a=t.normalize(s.topLeft),l=t.normalize(s.bottomRight),u=new RangeRef(new CellRef(a.row,a.col-1),new CellRef(l.row,l.col-1));this._copyRange(u,a)}this._adjustReferences("col",e,1,i)}}),{recalc:!0,layout:!0,insertColumn:{index:e},ref:new RangeRef(new CellRef(0,e),new CellRef(1/0,1/0))}),this}isEnabledColumn(e){var t=new RangeRef(new CellRef(0,e),new CellRef(1/0,e));return new Range$1(t,this).enable()}deleteColumn(e){return this.isEnabledColumn(e)?this.trigger("deleteColumn",{index:e})?void 0:(this.batch((function(){var t=this._grid,r=t.columnCount,n=this.frozenColumns();e<n&&this.frozenColumns(n-1);for(var i=this._mergedCells.slice(),o=e;o<r;o++){var s=new RangeRef(new CellRef(0,o),new CellRef(1/0,o));if(new Range$1(s,this).clear({clearAll:!0,keepBorders:!0}),o===r-1)break;var a=t.normalize(s.topLeft),l=t.normalize(s.bottomRight),u=new RangeRef(new CellRef(a.row,a.col+1),new CellRef(l.row,l.col+1));this._copyRange(u,a)}this._adjustReferences("col",e,-1,i),this._resizeDeleteColumn()}),{recalc:!0,layout:!0,deleteColumn:{index:e},ref:new RangeRef(new CellRef(0,e),new CellRef(1/0,1/0))}),this):this}_filterRow(e){this._rows.hide(e),this._filteredRows.value(e,e,!0),this.triggerChange({layout:!0})}hideRow(e){if(!this.trigger("hideRow",{index:e}))return this._property(this._rows.hide.bind(this._rows),e,{layout:!0})}unhideRow(e){if(!this.trigger("unhideRow",{index:e}))return this._property(this._rows.unhide.bind(this._rows),e,{layout:!0})}isHiddenRow(e){return this._grid._rows.hidden(e)}isFilteredRow(e){return this._filteredRows.value(e)}columnWidth(e,t){return this._property(this._columns.value.bind(this._columns,e,e),t,{layout:!0})}rowHeight(e,t){return this._property(this._rows.value.bind(this._rows,e,e),t,{layout:!0})}frozenRows(e){return this._field("_frozenRows",e,{layout:!0})}frozenColumns(e){return this._field("_frozenColumns",e,{layout:!0})}showGridLines(e){return this._field("_showGridLines",e,{layout:!0})}gridLinesColor(e){return this._field("_gridLinesColor",e,{layout:!0})}_ref(e,t,r,n){var i=null;return e instanceof Ref?e:e instanceof Range$1?e._ref.toRangeRef():("string"==typeof e?i=calc.parseReference(e):(r||(r=1),n||(n=1),i=new RangeRef(new CellRef(e,t),new CellRef(e+r-1,t+n-1))),i)}range(e,t,r,n){return new Range$1(this._ref(e,t,r,n),this)}_getMergedCells(e){var t=this._grid,r={},n={},i=!1;return this.forEachMergedCell(e,(function(o){var s=o.topLeft;t.forEach(o,(function(t){s.eq(t)?(r[t.print()]=o,i=!0):e.contains(t)&&(n[t.print()]=s,i=!0)}))})),{primary:r,secondary:n,hasMerged:i}}forEachMergedCell(e,t){var r=!1;void 0===t&&(t=e,r=!0),this._mergedCells.forEach((function(n){(r||n.intersects(e))&&t(n)}))}forEachFilterHeader(e,t){var r=!1;if(void 0===t&&(t=e,r=!0),this._filter){var n=[];this._filter.ref.forEachColumn((function(t){(r||t.intersects(e))&&n.push(t.topLeft)})),this._mergedCells.forEach((function(e){n=n.map((function(t){return e.intersects(t)?e:t}))})),n.reduce((function(e,t){return e.indexOf(t)<0&&e.push(t),e}),[]).forEach(t)}}forEach(e,t){var r=this;function n(e){e instanceof RangeRef||(e=e.toRangeRef());var n,i,o=r._grid.normalize(e.topLeft),s=r._grid.normalize(e.bottomRight);function a(e){t(i++,n,e)}for(n=o.col;n<=s.col;n++){i=o.row;var l=r._grid.index(i,n),u=r._grid.index(s.row,n);r._properties.forEach(l,u,a)}}e instanceof RangeRef||(e=r._ref(e)),e instanceof UnionRef?e.forEach(n):n(e)}startResizing(e){this._initialPosition=e,this._resizeInProgress=!0}startAutoFill(){this._autoFillInProgress=!0;var e=this.select();this._autoFillOrigin=e,this._autoFillDest=e,this.triggerChange({selection:!0})}updateAutoFill(e,t,r,n){this._autoFillDest=e,this._autoFillPunch=t,this._autoFillHint=r,this._autoFillDirection=n,this.triggerChange({selection:!0})}autoFillRef(){return this._autoFillDest}autoFillPunch(){return this._autoFillPunch}autoFillInProgress(){return this._autoFillInProgress}resizingInProgress(){return this._resizeInProgress}draggingInProgress(){return this._draggingInProgress}completeResizing(){if(this._resizeInProgress){this._resizeInProgress=!1;var e=this.resizeHintPosition();if(this._initialPosition&&e){var t=this.resizeHandlePosition();t.col!==-1/0?this.trigger("commandRequest",{command:"ColumnWidthCommand",options:{target:t.col,value:this.columnWidth(t.col)-(this._initialPosition.x-e.x)}}):this.trigger("commandRequest",{command:"RowHeightCommand",options:{target:t.row,value:this.rowHeight(t.row)-(this._initialPosition.y-e.y)}})}else this.trigger("change",{resize:!0})}}_visualRange(e){for(var t=this._mergedCells,r=t.length;--r>=0;)if(t[r].intersects(e))return this.range(t[r]);return this.range(e)}_renderComment(e){var t=null;if(e){var r=this._visualRange(e);t=r.comment(),e=r._ref.toRangeRef().topLeft}t?this._commentRef&&e.eq(this._commentRef)||(this._commentRef=e,this.trigger("change",{comment:!0})):this._commentRef&&(this._commentRef=null,this.trigger("change",{comment:!0}))}resizeHandlePosition(){return this._resizeHandlePosition}resizeHintPosition(e){return void 0!==e&&(this._resizeHintPosition=e,this.trigger("change",{resize:!0})),this._resizeHintPosition}removeResizeHandle(){this._resizeHandlePosition&&(this._resizeHintPosition=void 0,this._resizeHandlePosition=void 0,this._initialPosition=void 0,this.trigger("change",{resize:!0}))}positionResizeHandle(e){this._resizeHandlePosition=e,this.trigger("change",{resize:!0})}startDragging(e){this._draggingInProgress=e}completeDragging(){var e=this._draggingInProgress;if(e){this._draggingInProgress=null;var t=e.drawing;if(t.eq(e.copy))return;if(t.topLeftCell){var r=this.drawingBoundingBox(t),n=this._rows.indexVisible(r.top),i=this._columns.indexVisible(r.left),o=new CellRef(n,i),s=this.refBoundingBox(o);t.offsetX=r.left-s.left,t.offsetY=r.top-s.top,t.topLeftCell=o,this.triggerChange({dragging:!0})}this.trigger("commandRequest",{command:"DrawingUpdateCommand",options:{sheet:this,drawing:t,previous:e.copy}})}}startSelection(e){this.frozenRows()||this.frozenColumns()?this._currentView=null:e&&e._sheet===this&&(this._currentView=e),this._selectionInProgress=!0}completeSelection(){if(this._selectionInProgress&&(this._selectionInProgress=!1,this._resizeHintPosition=void 0,this.trigger("change",{selection:!0})),this._autoFillInProgress){this._autoFillInProgress=!1;var e=this._autoFillDest,t=this._autoFillOrigin;this._autoFillPunch?this.trigger("commandRequest",{command:"ClearContentCommand",options:{operatingRange:this.range(this._autoFillPunch)}}):e.eq(t)?this.triggerChange({selection:!0}):this.trigger("commandRequest",{command:"AutoFillCommand",options:{operatingRange:this.range(e),origin:this.range(t)}}),this._autoFillDest=null,this._autoFillPunch=null,this._autoFillOrigin=null,this.select(e)}}selectionInProgress(){return this._selectionInProgress}select(e,t){var r,n=this._selectionState();return e&&(e=this._ref(e),e=this._grid.normalize(e),r=this._grid.isAxis(e)?e:this.unionWithMerged(e)),n.select(e,r,t,this._currentView)}originalSelect(){return this._selectionState().originalSelection}currentSelectionRange(){return this._selectionState().currentSelectionRange()}currentOriginalSelectionRange(){return this._selectionState().currentOriginalNavigationRange()}currentNavigationRange(){return this._selectionState().currentNavigationRange()}nextNavigationRange(){return this._selectionState().nextNavigationRange()}previousNavigationRange(){return this._selectionState().previousNavigationRange()}selectionRangeIndex(){return this._selectionState().selectionRangeIndex}activeCell(e){return this._selectionState().activeCell(e)}originalActiveCell(){return this._selectionState().originalActiveCell}singleCellSelection(){return this._selectionState().singleCellSelection()}unionWithMerged(e){var t=this._mergedCells;return e.map((function(e){return e.toRangeRef().union(t)}))}trim(e){var t=[],r=this._grid;return this._properties.forEachProperty((function(n){t.push(r.trim(e,n.list))})),this.unionWithMerged(e.topLeft.toRangeRef().union(t))}focus(e){if(!e){var t=this._focus;return this._focus=null,t}this._focus=e.toRangeRef()}activeCellSelection(){return new Range$1(this._grid.normalize(this.activeCell()),this)}selection(){return new Range$1(this._grid.normalize(this._selectionState().selection),this)}selectedHeaders(){var e=this.select(),t={},r={},n=!1,i=!1,o=this._grid.rowCount-1,s=this._grid.columnCount-1;return e.forEach((function(e){var a,l="partial",u="partial",c=(e=e.toRangeRef()).bottomRight,h=e.topLeft,f=h.col<=0&&c.col>=s,p=h.row<=0&&c.row>=o;if(p&&(i=!0,u="full"),f&&(n=!0,l="full"),!p)for(a=h.row;a<=c.row;a++)"full"!==t[a]&&(t[a]=l);if(!f)for(a=h.col;a<=c.col;a++)"full"!==r[a]&&(r[a]=u)})),{rows:t,cols:r,allRows:i,allCols:n,all:i&&n}}isInEditMode(e){if(void 0===e)return this._inEdit;this._inEdit=e,e&&(this._editSelection.selection=this._viewSelection.selection.clone(),this._editSelection.originalSelection=this._viewSelection.originalSelection.clone(),this._editSelection._activeCell=this._viewSelection._activeCell.clone(),this._editSelection.originalActiveCell=this._viewSelection.originalActiveCell.clone())}_setFormulaSelections(e){this._formulaSelections=(e||[]).slice(),this.triggerChange({selection:!0})}_viewActiveCell(){return this._viewSelection._activeCell.toRangeRef()}toJSON(){var e={},t=this._rows.toJSON("height",e),r=this._columns.toJSON("width",{}),n=this._viewSelection,i=[],o=this._defaultCellStyle||{};this.forEach(SHEETREF,(function(r,n,s){if(function(e){Object.keys(o).forEach((function(t){e[t]===o[t]&&delete e[t]}))}(s),0!==Object.keys(s).length){s.link&&i.push({ref:Ref.display(null,r,n),target:s.link});var a=e[r];void 0===a&&(a=t.length,t.push({index:r}),e[r]=a),r=t[a],s.index=n,void 0===r.cells&&(r.cells=[]),s.formula&&(s.formula.arrayFormulaRange?s.formula={src:s.formula.toString(),ref:s.formula.arrayFormulaRange.toString()}:s.formula=s.formula.toString()),s.validation&&(s.validation=s.validation.toJSON()),s.color&&(s.color=parseColor(s.color).toCss()),s.background&&(s.background=parseColor(s.background).toCss()),s.borderTop&&s.borderTop.color&&(s.borderTop.color=parseColor(s.borderTop.color).toCss()),s.borderBottom&&s.borderBottom.color&&(s.borderBottom.color=parseColor(s.borderBottom.color).toCss()),s.borderRight&&s.borderRight.color&&(s.borderRight.color=parseColor(s.borderRight.color).toCss()),s.borderLeft&&s.borderLeft.color&&(s.borderLeft.color=parseColor(s.borderLeft.color).toCss()),r.cells.push(s)}}));var s={name:this._name(),state:this._state(),rows:t,columns:r,selection:n.selection.toString(),activeCell:n.activeCell().toString(),frozenRows:this.frozenRows(),frozenColumns:this.frozenColumns(),showGridLines:this.showGridLines(),gridLinesColor:this.gridLinesColor(),mergedCells:this._mergedCells.map((function(e){return e.toString()})),hyperlinks:i,defaultCellStyle:o,drawings:this._drawings.map((function(e){return e.toJSON()}))};return this._sort&&(s.sort={ref:this._sort.ref.toString(),columns:this._sort.columns.map((function(e){return{index:e.index,ascending:e.ascending}}))}),this._filter&&(s.filter={ref:this._filter.ref.toString(),columns:this._filter.columns.map((function(e){var t=e.filter.toJSON();return t.index=e.index,t}))}),s}fromJSON(e){this.batch((function(){if(void 0!==e.name&&this._name(e.name),void 0!==e.frozenColumns&&this.frozenColumns(e.frozenColumns),void 0!==e.frozenRows&&this.frozenRows(e.frozenRows),void 0!==e.columns&&this._columns.fromJSON("width",e.columns),void 0!==e.rows){this._resizeForJSON(e.rows),this._rows.fromJSON("height",e.rows);for(var t=0;t<e.rows.length;t++){var r=e.rows[t],n=r.index;if(void 0===n&&(n=t),r.cells)for(var i=0;i<r.cells.length;i++){var o=r.cells[i],s=o.index;if(void 0===s&&(s=i),o.formula){var a="string"!=typeof o.formula,l=a?o.formula.src:o.formula,u=this._compileFormula(n,s,l);a&&u.setArrayFormulaRange(calc.parseReference(o.formula.ref)),o.formula=u}o.validation&&(o.validation=this._compileValidation(n,s,o.validation)),this._properties.fromJSON(this._grid.index(n,s),o)}}}if(e.drawings&&(this._drawings=e.drawings.map(Drawing.fromJSON)),e.selection&&(this._viewSelection.selection=this._viewSelection.originalSelection=this._ref(e.selection)),e.activeCell){var c=this._ref(e.activeCell);this._viewSelection._activeCell=c.toRangeRef(),this._viewSelection.originalActiveCell=c.first()}if(e.mergedCells&&e.mergedCells.forEach((function(e){this.range(e).merge()}),this),e.filter){var h=e.filter.ref,f=void 0===e.filter.columns?[]:e.filter.columns;h&&(this._filter={ref:this._ref(h),columns:f.map((function(e){return{index:e.index,filter:Filter.create(e)}}))},this._refreshFilter())}void 0!==e.showGridLines&&(this._showGridLines=e.showGridLines),this._gridLinesColor=e.gridLinesColor,e.sort&&this._sortBy(this._ref(e.sort.ref),e.sort.columns.slice(0))})),this._rows._refresh(),this._columns._refresh()}formula(e){return this._properties.get("formula",this._grid.cellRefIndex(e))}validation(e){return this._properties.get("validation",this._grid.cellRefIndex(e))}resetFormulas(){this._forFormulas((function(e){e.reset()}))}resetValidations(){this._forValidations((function(e){e.reset()}))}recalc(e,t){var r=this._properties.get("formula").values(),n=r.length,i=0,o=0;if(!n&&t)return t();function s(){i--,o!==n||i||t()}for(;o<n;)i++,r[o++].value.exec(e,t?s:null)}revalidate(e){var t=this;this._forValidations((function(r){var n=new CellRef(r.row,r.col),i=new RangeRef(n,n);r.exec(e,t._get(i,"value"),t._get(i,"format"))}))}_value(e,t,r){var n=this._grid.index(e,t);if(void 0===r)return this._properties.get("value",n);this._properties.set("value",n,n,r)}_validation(e,t){var r=this._grid.index(e,t);return this._properties.get("validation",r)}_compileValidation(e,t,r){return r instanceof validationExport.Validation?r.clone(this._name(),e,t):(null!=r.from&&(r.from=(r.from+"").replace(/^=/,"")),null!=r.to&&(r.to=(r.to+"").replace(/^=/,"")),validationExport.compile(this._name(),e,t,r))}_compileFormula(e,t,r){return r=r.replace(/^=/,""),r=calc.parseFormula(this._name(),e,t,r),calc.compile(r)}_copyValuesInRange(e,t,r,n){var i,o,s;for(i=e.col;i<=t.col;i++){o=this._grid.index(e.row,i),s=this._grid.index(t.row,i);for(var a=o,l=e.row;a<=s;++a,++l)r=r.clone(this._name(),l,i),this._properties.set(n,a,a,r)}return r}_set(e,t,r){var n,i,o,s=this._grid.normalize(e.topLeft),a=this._grid.normalize(e.bottomRight);if("number"==typeof r&&(r=calc.runtime.limitPrecision(r)),r&&"formula"===t)"string"==typeof r&&(r=this._compileFormula(s.row,s.col,r)),r=this._copyValuesInRange(s,a,r,"formula");else if(r&&"validation"===t)r=this._compileValidation(s.row,s.col,r),r=this._copyValuesInRange(s,a,r,"validation");else for(n=s.col;n<=a.col;n++)i=this._grid.index(s.row,n),o=this._grid.index(a.row,n),this._properties.set(t,i,o,r),"formula"===t&&this._properties.set("value",i,o,null)}_get(e,t){var r=this._grid.normalize(e.topLeft),n=this._grid.index(r.row,r.col);return this._properties.get(t,n)}batch(e,t){var r=this.suspendChanges();return this.suspendChanges(!0),this._valueChanged=!1,e.call(this),t||(t={recalc:!0}),this._valueChanged&&(t.isValue=!0),this.suspendChanges(r).triggerChange(t)}_sortBy(e,t){var r=null;t.forEach((function(t){r=this._sorter.sortBy(e,t.index,this._properties.get("value"),t.ascending,r)}),this),this._sort={ref:e,columns:t},this._refreshFilter(),this.forEach(e,function(e,t,r){var n=r.formula;if(n){var i=e-n.row;if(0!==i){var o=i>0?n.row:n.row+i;n.adjust(this.name(),"row",o,i)}}}.bind(this)),this.triggerChange({recalc:!0})}_refreshFilter(){this._filter&&this._filterBy(this._filter.ref,this._filter.columns)}_filterBy(e,t){this.batch((function(){for(var r=e.topLeft.row;r<=e.bottomRight.row;r++)this.isFilteredRow(r)&&(this._filteredRows.value(r,r,!1),this._rows.unhide(r));t.forEach((function(t){var r=e.resize({top:1}).toColumn(t.index),n=[];if(r!==NULLREF){this.forEach(r,(function(e,t,r){r.row=e,n.push(r)})),t.filter.prepare(n);for(var i=0;i<n.length;i++){var o=n[i],s=t.filter.value(o);!1===t.filter.matches(s)&&this._filterRow(o.row)}}}),this),this._filter={ref:e,columns:t}}),{recalc:!0,layout:!0,filter:!0})}filterColumn(e){var t=this.filter().ref;return e.toRangeRef().topLeft.col-t.topLeft.col}filter(){return this._filter}clearFilter(e){this._clearFilter(e instanceof Array?e:[e])}_clearFilter(e){this._filter&&this.batch((function(){this._filter.columns=this._filter.columns.filter((function(t){return e.indexOf(t.index)<0})),this._refreshFilter()}),{recalc:!0,layout:!0,filter:!0})}getAxisState(){return{rows:this._rows.getState(),columns:this._columns.getState()}}setAxisState(e){this._rows.setState(e.rows),this._columns.setState(e.columns),this.triggerChange({layout:!0})}getState(){return{rows:this._rows.getState(),columns:this._columns.getState(),mergedCells:this._mergedCells.map((function(e){return e.clone()})),properties:this._properties.getState()}}setState(e){this._rows.setState(e.rows),this._columns.setState(e.columns),this._mergedCells=e.mergedCells,this._properties.setState(e.properties),this.triggerChange(ALL_REASONS)}_merge(e){var t,r=this._mergedCells,n=this;return this.batch((function(){t=e.map((function(e){if(e instanceof CellRef)return e;var t=e.toRangeRef().union(r,(function(e){r.splice(r.indexOf(e),1)})),i=new Range$1(t,n),o=i._get("formula"),s=i.value(),a=i.format(),l=i.background();i.value(null),i.format(null),i.background(null);var u=new Range$1(t.collapse(),n);return o?u._set("formula",o):u.value(s),u.format(a),u.background(l),r.push(t),t}));var i=n._viewSelection;i.selection=n.unionWithMerged(i.originalSelection),i._activeCell=n.unionWithMerged(i.originalActiveCell)}),{activeCell:!0,selection:!0}),t}_useCultureDecimals(){return this._workbook&&this._workbook.options.useCultureDecimals}withCultureDecimals(e){var t=".";return this._useCultureDecimals()&&(t=culture().numbers.symbols.decimal),calc.withDecimalSeparator(t,e)}drawingBoundingBox(e){var t=e.offsetX,r=e.offsetY;return e.topLeftCell&&(t+=this._columns.sum(0,e.topLeftCell.col-1),r+=this._rows.sum(0,e.topLeftCell.row-1)),new Rectangle(t,r,e.width,e.height)}refBoundingBox(e){return this._grid.rectangle(e.toRangeRef())}addDrawing(e,t){return e instanceof Drawing||(e=new Drawing(e)),this._drawings.push(e),t&&(this._activeDrawing=e),this.triggerChange({layout:!0}),e}removeDrawing(e){var t=this._drawings.indexOf(e);t>=0&&(this._drawings.splice(t,1),this.triggerChange({layout:!0}))}usesImage(e){for(var t=this._drawings.length;--t>=0;)if(this._drawings[t].image===e)return!0;return!1}isMerged(e){for(var t=this._mergedCells,r=t.length;--r>=0;)if(t[r].eq(e))return!0;return!1}}class Drawing{constructor(e){this.reset(e)}toJSON(){return{topLeftCell:this.topLeftCell.toString(),offsetX:this.offsetX,offsetY:this.offsetY,width:this.width,height:this.height,image:this.image,opacity:this.opacity}}clone(){return new Drawing(this)}reset(e){var t=e.topLeftCell;"string"==typeof t&&(t=calc.parseReference(t)),this.topLeftCell=t,this.offsetX=e.offsetX||0,this.offsetY=e.offsetY||0,this.width=e.width,this.height=e.height,this.image=e.image,this.opacity=null!=e.opacity?e.opacity:1}eq(e){return(!this.topLeftCell&&!e.topLeftCell||this.topLeftCell&&e.topLeftCell&&this.topLeftCell.eq(e.topLeftCell))&&this.offsetX===e.offsetX&&this.offsetY===e.offsetY&&this.width===e.width&&this.height===e.height&&this.image===e.image&&this.opacity===e.opacity}}Drawing.fromJSON=function(e){return new Drawing(e)};let PAPER_SIZE={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],executive:[521.86,756],folio:[612,936],legal:[612,1008],letter:[612,792],tabloid:[792,1224]};function mm2pt(e){return e*(72/25.4)}function cm2pt(e){return mm2pt(10*e)}function in2pt(e){return 72*e}function unitsToPoints(e,t){if("number"==typeof e)return e;if("string"==typeof e){let t;if(t=/^\s*([0-9.]+)\s*(mm|cm|in|pt)\s*$/.exec(e),t){let e=parseFloat(t[1]);if(!isNaN(e))return"pt"===t[2]?e:{mm:mm2pt,cm:cm2pt,in:in2pt}[t[2]](e)}}if(null!=t)return t;throw new Error("Can't parse unit: "+e)}function getPaperOptions(e){if("function"!=typeof e){let t=e;e=function(e,r){return e in t?t[e]:r}}let t=e("paperSize",PAPER_SIZE.a4);if(!t)return{};if("string"==typeof t&&(t=PAPER_SIZE[t.toLowerCase()],null==t))throw new Error("Unknown paper size");t[0]=unitsToPoints(t[0]),t[1]=unitsToPoints(t[1]),e("landscape",!1)&&(t=[Math.max(t[0],t[1]),Math.min(t[0],t[1])]);let r=e("margin");return r&&("string"==typeof r||"number"==typeof r?(r=unitsToPoints(r,0),r={left:r,top:r,right:r,bottom:r}):r={left:unitsToPoints(r.left,0),top:unitsToPoints(r.top,0),right:unitsToPoints(r.right,0),bottom:unitsToPoints(r.bottom,0)},e("addMargin")&&(t[0]+=r.left+r.right,t[1]+=r.top+r.bottom)),{paperSize:t,margin:r}}let CONT,GUIDELINE_WIDTH=.8;function distributeCoords(e,t,r,n,i){let o=0,s=[],a=t,l=0;return t&&r&&(r*=t),e.forEach((function(e,u){null!=n&&u<n&&(l+=e),t&&o+e>a&&(a-o<r&&(o=t*Math.ceil(o/t)+l,l>0&&i.push(o-l)),a+=t*Math.ceil(e/t)),s.push(o),o+=e})),s.push(o),s}function doLayout(e,t,r){let n=e._grid;t=n.normalize(t);let i=n.rectangle(t),o=[];e._drawings.forEach((function(t){let r=e.drawingBoundingBox(t);r.intersects(i)&&o.push({drawing:t,box:r.offset(-i.left,-i.top)})}));let s=[],a=[],l=[],u=e._getMergedCells(t),c=-1,h=-1;e.forEach(t,(function(n,i,f){let p=n-t.topLeft.row,d=i-t.topLeft.col,m=e.rowHeight(n),g=e.columnWidth(i);r.forScreen||(f.drawings=o.filter((function(t){let r=t.drawing.topLeftCell;if(r&&r.row==n&&r.col==i)return c=Math.max(c,e._rows.index(t.box.bottom)),h=Math.max(h,e._columns.index(t.box.right)),!0}))),d||a.push(m),p||l.push(g);let C=new CellRef(n,i).print();if(u.secondary[C])return;f.row=p,f.col=d;let v=u.primary[C];if(v?(delete u.primary[C],f.merged=!0,f.rowspan=v.height(),f.colspan=v.width(),r.forScreen&&(f.width=e._columns.sum(v.topLeft.col,v.bottomRight.col),f.height=e._rows.sum(v.topLeft.row,v.bottomRight.row))):(f.rowspan=1,f.colspan=1),!e._grid._columns.sum(i,i+f.colspan-1)||!e._grid._rows.sum(n,n+f.rowspan-1))return;let y=r.forScreen||shouldDrawCell(f);(r.emptyCells||y)&&(y?(c=Math.max(c,p+f.rowspan-1),h=Math.max(h,d+f.colspan-1)):f.empty=!0,s.push(f))})),r.forScreen||(a=a.slice(0,c+1),l=l.slice(0,h+1));let f=r.pageWidth,p=r.pageHeight,d=r.scale||1;if(r.fitWidth){let e=l.reduce(sum,0);e>f&&(d=f/e)}f=Math.ceil(f/d),p=Math.ceil(p/d);let m=[],g=distributeCoords(a,p||0,r.maxEmpty,r.headerRows,m),C=distributeCoords(l,f||0,r.maxEmpty),v=0,y=0,E=[];return s=s.filter((function(e){return(!e.empty||!(e.row>c||e.col>h))&&(r.headerRows&&e.row<r.headerRows&&E.push(e),e.left=C[e.col],e.top=g[e.row],e.merged?r.forScreen?(e.right=e.left+e.width,e.bottom=e.top+e.height):(e.right=orlast(C,e.col+e.colspan),e.bottom=orlast(g,e.row+e.rowspan),e.width=e.right-e.left,e.height=e.bottom-e.top):(e.width=l[e.col],e.height=a[e.row],e.bottom=e.top+e.height,e.right=e.left+e.width),r.forScreen||e.drawings.forEach((function(t){let r=t.box;r.left=e.left+t.drawing.offsetX,r.top=e.top+t.drawing.offsetY,r.right=r.left+r.width,r.bottom=r.top+r.height})),v=Math.max(v,e.right),y=Math.max(y,e.bottom),!0)})),Object.keys(u.primary).forEach((function(r){let n=u.primary[r];e.forEach(n.topLeft.toRangeRef(),(function(r,i,o){let a=r-t.topLeft.row,l=i-t.topLeft.col;o.merged=!0,o.colspan=n.width(),o.rowspan=n.height(),o.top=a<0?-e._rows.sum(r,r-a-1):g[a],o.left=l<0?-e._columns.sum(i,i-l-1):C[l],o.height=e._rows.sum(n.topLeft.row,n.bottomRight.row),o.width=e._columns.sum(n.topLeft.col,n.bottomRight.col),o.height>0&&o.width>0&&(o.right=o.left+o.width,o.bottom=o.top+o.height,o.row=a,o.col=l,s.push(o))}))})),r.headerRows&&(m.forEach((function(e){E.forEach((function(t){(t=clone(t)).top+=e,t.bottom=t.top+t.height,s.push(t)})),g.push(e)})),g.sort(orderCoords)),{width:v,height:y,cells:s.sort(orderCells),scale:d,xCoords:C,yCoords:g,drawings:o}}function clone(e,t){return t||(t={}),Object.assign?Object.assign(t,e):Object.keys(e).reduce((function(t,r){return t[r]=e[r],t}),t)}function sameBorder(e,t){return e.size===t.size&&e.color===t.color}function sum(e,t){return e+t}function orlast(e,t){return t<e.length?e[t]:e[e.length-1]}function shouldDrawCell(e){return null!=e.value||e.merged||null!=e.background||null!=e.borderRight||null!=e.borderBottom||null!=e.dBorders||null!=e.validation&&!e.validation.value||e.drawings&&e.drawings.length}function orderCells(e,t){return e.top<t.top?-1:e.top==t.top?e.left<t.left?-1:e.left==t.left?0:1:1}function orderCoords(e,t){return e<t?-1:e>t?1:0}function drawLayout(e,t,r,n){let i=Math.ceil(t.width/n.pageWidth),o=Math.ceil(t.height/n.pageHeight),s=Math.ceil(n.pageWidth/t.scale),a=Math.ceil(n.pageHeight/t.scale);for(let e=0;e<o;++e)for(let t=0;t<i;++t)l(e,t);function l(i,o){let l=o*s,u=l+s,c=i*a,h=c+a,f=0,p=0;function d(e){return!(e.right<=l||e.left>=u||e.bottom<=c||e.top>=h)&&(f=Math.max(e.bottom,f),p=Math.max(e.right,p),!0)}let m=t.cells.filter(d),g=t.drawings.filter((function(e){return d(e.box)}));if(f=Math.min(f,h),p=Math.min(p,u),m.length||g.length){let i=new Group;r.append(i);let o=new Group;i.append(o),o.clip(Path.fromRect(new Rect([l-1,c-1],[p+1,f+1])));let s=Matrix$1.scale(t.scale,t.scale).multiplyCopy(Matrix$1.translate(-l,-c));if((n.hCenter||n.vCenter)&&(s=s.multiplyCopy(Matrix$1.translate(n.hCenter?(u-p)/2:0,n.vCenter?(h-f)/2:0))),o.transform(s),n.guidelines){let e=null;t.xCoords.forEach((function(t){(t=Math.min(t,p))!==e&&t>=l&&t<=u&&(e=t,o.append((new Path).moveTo(t,c).lineTo(t,f).close().stroke(n.guideColor,GUIDELINE_WIDTH)))})),e=null,t.yCoords.forEach((function(t){(t=Math.min(t,f))!==e&&t>=c&&t<=h&&(e=t,o.append((new Path).moveTo(l,t).lineTo(p,t).close().stroke(n.guideColor,GUIDELINE_WIDTH)))}))}let a=Borders();m.forEach((function(t){drawCell$1(t,o,n),a.add(t,e)}));let d=new Group;a.vert.forEach((function(e){e.forEach((function(e){e.rendered||(e.rendered=!0,d.append((new Path).moveTo(e.x,e.top).lineTo(e.x,e.bottom).close().stroke(e.color,e.size)))}))})),a.horiz.forEach((function(e){e.forEach((function(e){e.rendered||(e.rendered=!0,d.append((new Path).moveTo(e.left,e.y).lineTo(e.right,e.y).close().stroke(e.color,e.size)))}))})),o.append(d),g.forEach((function(t){let r=t.drawing,n=r.image;if(null!=n){let i=t.box,s=e._workbook.imageUrl(n);o.append(new r.Image(s,new Rect([i.left,i.top],[i.width,i.height])).opacity(r.opacity))}}))}}}function drawCell$1(e,t,r){let n=new Group;t.append(n);let i=new Rect([e.left,e.top],[e.width,e.height]);if(e.background||e.merged){let t=i;r.guidelines&&(t=i.clone(),t.origin.x+=GUIDELINE_WIDTH/2+.1,t.origin.y+=GUIDELINE_WIDTH/2+.1,t.size.width-=GUIDELINE_WIDTH+.2,t.size.height-=GUIDELINE_WIDTH+.2),n.append(new Rect$1(t).fill(e.background||"#fff").stroke(null))}e.dBorders&&(2&e.dBorders.type&&n.append((new Path).moveTo(e.left,e.bottom).lineTo(e.right,e.top).stroke(e.dBorders.color,e.dBorders.size)),1&e.dBorders.type&&n.append((new Path).moveTo(e.left,e.top).lineTo(e.right,e.bottom).stroke(e.dBorders.color,e.dBorders.size)));let o=e.value;if(null!=o){let t="number"==typeof o?"number":null,r=new Group;r.clip(Path.fromRect(i)),n.append(r);let s,a=e.format;if(a||"number"!=t||o==Math.floor(o)||(a="0.##############"),a?(s=formatting.textAndColor(o,a),o=s.text,s.type&&(t=s.type)):o+="",!e.textAlign)switch(t){case"number":case"date":case"percent":case"currency":e.textAlign="right";break;case"boolean":e.textAlign="center"}drawText(o,s&&s.color||e.color||"#000",e,r)}}function applyIndent(e,t){if(e.indent){let r=1.4*e.indent;switch(t.textAlign){case null:case"left":t.paddingLeft=r+"ch";break;case"right":t.paddingRight=r+"ch";break;case"center":t.paddingLeft=r/2+"ch",t.paddingRight=r/2+"ch"}}}function drawText(e,t,r,n){CONT||(CONT=document.createElement("div"),CONT.style.position="fixed",CONT.style.left="0px",CONT.style.top="0px",CONT.style.visibility="hidden",CONT.style.overflow="hidden",CONT.style.boxSizing="border-box",CONT.style.lineHeight="normal",document.body.appendChild(CONT)),CONT.firstChild&&CONT.removeChild(CONT.firstChild),CONT.style.padding="2px 4px",CONT.style.color=t,CONT.style.font=makeFontDef(r),CONT.style.width=r.width+"px",CONT.style.textAlign=r.textAlign||"left",CONT.style.textDecoration=r.underline?"underline":"none",applyIndent(r,CONT.style),r.wrap?(CONT.style.whiteSpace="pre-wrap",CONT.style.overflowWrap=CONT.style.wordWrap="break-word"):(CONT.style.whiteSpace="pre",CONT.style.overflowWrap=CONT.style.wordWrap="normal"),CONT.appendChild(document.createTextNode(e));let i=0;switch(r.verticalAlign){case"center":i=r.height-CONT.offsetHeight>>1;break;case void 0:case null:case"bottom":i=r.height-CONT.offsetHeight}i<0&&(i=0);let o=drawText$1(CONT);o.transform(Matrix$1.translate(r.left,r.top+i)),n.append(o)}function makeFontDef(e){let t=[];return e.italic&&t.push("italic"),e.bold&&t.push("bold"),t.push((e.fontSize||12)+"px"),t.push(e.fontFamily||"Arial"),t.join(" ")}function drawFn(e,t,r,n){null==r&&null==n&&(n=t,r={},t=SHEETREF),null==n&&(n=r,t instanceof Range||t instanceof Ref||"string"==typeof t?r={}:(r=t,t=SHEETREF)),r=Object.assign({},{paperSize:"A4",landscape:!0,margin:"1cm",guidelines:!0,guideColor:"#aaa",emptyCells:!0,fitWidth:!1,center:!1,headerRows:null,maxEmpty:.2,scale:1},r);let i=new Group,o=getPaperOptions(r);i.options.set("pdf",{author:r.author,creator:r.creator,date:r.date,keywords:r.keywords,margin:o.margin,multiPage:!0,paperSize:o.paperSize,subject:r.subject,title:r.title,autoPrint:r.autoPrint});let s=o.paperSize[0],a=o.paperSize[1];o.margin&&(s-=o.margin.left+o.margin.right+1,a-=o.margin.top+o.margin.bottom+1),r.pageWidth=s,r.pageHeight=a;let l=doLayout(e,e._ref(t),r);drawLayout(e,l,i,r),n(i)}function Container(){}function Borders(){let e=new Container,t=new Container;function r(e,r,n,i,o,s){let a=t[r]||(t[r]=new Container),l=e>0&&a[e-1];l&&sameBorder(l,n)?(a[e]=l,l.bottom=s):a[e]={size:n.size,color:n.color||"#000",x:i,top:o,bottom:s}}function n(t,r,n,i,o,s){let a=e[t]||(e[t]=new Container),l=r>0&&a[r-1];l&&sameBorder(l,n)?(a[r]=l,l.right=s):a[r]={size:n.size,color:n.color||"#000",y:i,left:o,right:s}}return{add:function(e,t){if(t){let r=t._properties,n=t._grid;e.borderLeft=r.get("vBorders",n.index(e.row,e.col)),e.borderRight=r.get("vBorders",n.index(e.row,e.col+e.colspan)),e.borderTop=r.get("hBorders",n.index(e.row,e.col)),e.borderBottom=r.get("hBorders",n.index(e.row+e.rowspan,e.col))}e.borderLeft&&r(e.row,e.col,e.borderLeft,e.left,e.top,e.bottom),e.borderRight&&r(e.row,e.col+e.colspan,e.borderRight,e.right,e.top,e.bottom),e.borderTop&&n(e.row,e.col,e.borderTop,e.top,e.left,e.right),e.borderBottom&&n(e.row+e.rowspan,e.col,e.borderBottom,e.bottom,e.left,e.right)},horiz:e,vert:t}}Sheet.prototype.draw=function(e,t,r){let n=this;n._workbook?n.recalc(n._workbook._context,(function(){drawFn(n,e,t,r)})):drawFn(n,e,t,r)},Container.prototype={forEach:function(e){Object.keys(this).forEach((function(t){e(this[t],t,this)}),this)}};const draw={Borders:Borders,doLayout:doLayout,applyIndent:applyIndent},RESIZE_HANDLE_WIDTH=7,EDIT_BUTTON_WIDTH=20,DOT=".",viewClassNames={view:"k-spreadsheet-view",fixedContainer:"k-spreadsheet-fixed-container",editContainer:"k-spreadsheet-edit-container",scroller:"k-spreadsheet-scroller",viewSize:"k-spreadsheet-view-size",clipboard:"k-spreadsheet-clipboard",cellEditor:"k-spreadsheet-cell-editor",barEditor:"k-spreadsheet-editor",topCorner:"k-spreadsheet-top-corner",filterHeadersWrapper:"k-filter-wrapper",filterRange:"k-filter-range",filterButton:"k-spreadsheet-filter",filterButtonSelected:"k-selected",horizontalResize:"k-horizontal-resize",verticalResize:"k-vertical-resize",icon:"k-icon",iconFilterDefault:"k-i-caret-alt-down",sheetsBar:"k-spreadsheet-sheets-bar",sheetsBarActive:"k-spreadsheet-sheets-bar-active",sheetsBarInactive:"k-spreadsheet-sheets-bar-inactive",cellContextMenu:"k-spreadsheet-cell-context-menu",rowHeaderContextMenu:"k-spreadsheet-row-header-context-menu",colHeaderContextMenu:"k-spreadsheet-col-header-context-menu",drawingContextMenu:"k-spreadsheet-drawing-context-menu"},paneClassNames={cell:"k-spreadsheet-cell",vaxis:"k-spreadsheet-vaxis",haxis:"k-spreadsheet-haxis",vborder:"k-spreadsheet-vborder",hborder:"k-spreadsheet-hborder",rowHeader:"k-spreadsheet-row-header",columnHeader:"k-spreadsheet-column-header",pane:"k-spreadsheet-pane",data:"k-spreadsheet-data",mergedCell:"k-spreadsheet-merged-cell",mergedCellsWrapper:"k-merged-cells-wrapper",activeCell:"k-spreadsheet-active-cell",selection:"k-spreadsheet-selection",selectionWrapper:"k-selection-wrapper",autoFillWrapper:"k-auto-fill-wrapper",single:"k-single",top:"k-top",right:"k-right",bottom:"k-bottom",left:"k-left",resizeHandle:"k-resize-handle",columnResizeHandle:"k-column-resize-handle",rowResizeHandle:"k-row-resize-handle",resizeHint:"k-resize-hint",resizeHintHandle:"k-resize-hint-handle",resizeHintMarker:"k-resize-hint-marker",resizeHintVertical:"k-resize-hint-vertical",selectionHighlight:"k-spreadsheet-selection-highlight",series:["k-series-a","k-series-b","k-series-c","k-series-d","k-series-e","k-series-f"]};function cellBorder(e){return(e.size||1)+"px solid "+(e.color||"#000")}function asURL(e){return/:\/\//.test(e)||(e="http://"+e),e}function drawCell(e,t,r,n){function i(e){let r=t.link;if(r||"object"==typeof t.value&&(r=t.value.link),r){let n={textDecoration:"none"};return t.color&&(n.color=t.color),t.underline&&(n.textDecoration="underline"),dom.element("a",{href:asURL(r),style:n,target:"_blank"},e?[e]:[])}return e}let o=null!=t.value||null!=t.validation&&!t.validation.value||t.background||t.merged||t.comment||t.dBorders;if(!r&&!o)return;let s={background:[]},a=t.background;if(a){let e=a;n&&(e=parseColor(e).toHSV(),e.v*=.9,e=e.toCssRgba()),e=cellBorder({color:e}),s.outline=e}t.dBorders&&(2&t.dBorders.type&&s.background.push("linear-gradient(to top left, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0) calc(50% - "+t.dBorders.size+"px), "+t.dBorders.color+" 50%, rgba(0, 0, 0, 0) calc(50% + "+t.dBorders.size+"px), rgba(0, 0, 0, 0) 100%)"),1&t.dBorders.type&&s.background.push("linear-gradient(to top right, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0) calc(50% - "+t.dBorders.size+"px), "+t.dBorders.color+" 50%, rgba(0, 0, 0, 0) calc(50% + "+t.dBorders.size+"px), rgba(0, 0, 0, 0) 100%)")),a&&s.background.push(a),t.color&&(s.color=t.color),t.fontFamily&&(s.fontFamily=t.fontFamily),t.underline&&(s.textDecoration="underline"),t.italic&&(s.fontStyle="italic"),t.textAlign&&(s.textAlign=t.textAlign),t.bold&&(s.fontWeight="bold"),t.fontSize&&(s.fontSize=t.fontSize+"px"),!0===t.wrap?(s.whiteSpace="pre-wrap",s.overflowWrap="break-word",s.wordWrap="break-word"):(s.whiteSpace="pre",s.overflowWrap="normal",s.wordWrap="normal"),s.left=t.left+1+"px",s.top=t.top+1+"px",s.width=t.width-1+"px",s.height=t.height-1+"px";let l=t.value,u=typeof l,c=t.format;if(c||"number"!==u||l===Math.floor(l)||(c="0.##############"),c&&null!=l?(l=formatting.format(l,c),l.__dataType&&(u=l.__dataType)):null!=l&&(l=t.html?dom.html(l):dom.text(l)),!s.textAlign)switch(u){case"number":case"date":case"percent":case"currency":s.textAlign="right";break;case"boolean":s.textAlign="center"}draw.applyIndent(t,s);let h=[paneClassNames.cell];r&&h.push(r),!1===t.enable&&h.push("k-disabled"),t.merged&&(h.push("k-spreadsheet-merged-cell"),t.enable||e.push(dom.element("div",{className:"k-spreadsheet-disabled-mask",style:{left:t.left+1+"px",top:t.top+1+"px",width:t.width-1+"px",height:t.height-1+"px"}}))),t.comment&&h.push("k-spreadsheet-has-comment");let f=t.verticalAlign||"bottom";l=f&&l?dom.element("div",{className:"k-vertical-align-"+f},[i(l)]):i(l),s.background.length?s.background=s.background.join(","):delete s.background;let p=l?[l]:[],d={style:s},m=t.validation;m&&!m.value&&(p.push(dom.element("span",{className:"k-dirty"})),h.push("k-dirty-cell"),d.title=m.message),d.className=h.join(" ");let g=dom.element("div",d,p);return e.push(g),g}class Pane{constructor(e,t,r){this._sheet=e,this._grid=t,this.getIconHTMLString=r}refresh(e,t){this._grid.refresh(e,t)}isVisible(e,t,r){return this._grid.view(e,t).ref.intersects(r)}render(e){let t=e.scroller,r=t.scrollLeft,n=t.scrollTop;n<0&&(n=0),r<0&&(r=0);let i=Pane.classNames,o=this._sheet,s=this._grid,a=s.view(r,n);this._currentView=a,this._currentRect=this._rectangle(a.ref),this._selectedHeaders=o.selectedHeaders();let l=[];if(l.push(this.renderData(e)),o._activeDrawing||l.push(this.renderSelection(t)),l.push(this.renderAutoFill()),l.push(this.renderEditorSelection()),l.push(this.renderFilterHeaders()),s.hasRowHeader){let e=dom.element("div",{className:i.rowHeader,style:{width:s.headerWidth+"px",top:a.rowOffset+"px"}});l.push(e),o.forEach(a.ref.leftColumn(),function(t){if(!o.isHiddenRow(t)){let r=t+1,n=o.rowHeight(t);e.children.push(dom.element("div",{className:this.headerClassName(t,"row"),style:{width:s.headerWidth+"px",height:n+"px"}},[dom.element("div",{className:"k-vertical-align-center"},[dom.text(r+"")])]))}}.bind(this))}if(s.hasColumnHeader){let e=dom.element("div",{className:i.columnHeader,style:{top:"0px",left:a.columnOffset+"px",width:this._currentRect.width+"px",height:s.headerHeight+"px"}});l.push(e);let t=0;o.forEach(a.ref.topRow(),function(r,n){if(!o.isHiddenColumn(n)){let r=Ref.display(null,1/0,n),i=o.columnWidth(n);e.children.push(dom.element("div",{className:this.headerClassName(n,"col"),style:{position:"absolute",left:t+"px",width:i+"px",height:s.headerHeight+"px"}},[dom.element("div",{className:"k-vertical-align-center"},[dom.text(r+"")])])),t+=i}}.bind(this))}o.resizeHandlePosition()&&(s.hasColumnHeader||s.hasRowHeader)&&(o.resizeHintPosition()||this.renderResizeHandle(l));let u=[i.pane];return s.hasColumnHeader&&u.push(i.top),s.hasRowHeader&&u.push(i.left),dom.element("div",{style:s.style,className:u.join(" ")},l)}headerClassName(e,t){let r,n,i=this._selectedHeaders;"row"===t?(r=i.rows[e],n=i.allRows):(r=i.cols[e],n=i.allCols);let o=r||(i.all?"full":n?"partial":"none");return o&&(o="k-selection-"+o),o}renderData(e){let t,r=this._sheet,n=this._currentView,i=dom.element("div",{className:Pane.classNames.data,style:{position:"relative",left:n.columnOffset+"px",top:n.rowOffset+"px"}}),o=this._currentRect,s=draw.doLayout(r,n.ref,{forScreen:!0}),a=this._grid,l=r._showGridLines;l&&(t=null,s.xCoords.forEach((function(e){e!==t&&(t=e,i.children.push(dom.element("div",{className:paneClassNames.vaxis,style:{left:e+"px",height:o.height+"px",borderColor:r.gridLinesColor()}})))})),t=null,s.yCoords.forEach((function(e){e!==t&&(t=e,i.children.push(dom.element("div",{className:paneClassNames.haxis,style:{top:e+"px",width:o.width+"px",borderColor:r.gridLinesColor()}})))})));let u=draw.Borders(),c=r.activeCell().toRangeRef(),h=c.topLeft;return s.cells.forEach((function(t){let o=null,s=t.row+n.ref.topLeft.row,f=t.col+n.ref.topLeft.col;if(r._activeDrawing){let e=r._activeDrawing.topLeftCell;e&&e.row===s&&e.col===f&&(o="k-spreadsheet-drawing-anchor-cell")}else s===h.row&&f===h.col&&(o=[Pane.classNames.activeCell].concat(this._activeFormulaColor(),this._directionClasses(c)),r.singleCellSelection()&&o.push(Pane.classNames.single),o=o.join(" "));if(u.add(t),drawCell(i.children,t,o,l),t.comment&&r._commentRef&&s===r._commentRef.row&&f===r._commentRef.col){let r=4,i=t.right+a.left+n.columnOffset+r,o={top:t.top+a.top+n.rowOffset+"px"};i+200>e.contentWidth?o.right=e.contentWidth-a.left-t.left-n.columnOffset+r+"px":o.left=i+"px";let s=dom.element("div",{className:"k-tooltip k-spreadsheet-cell-comment",style:o},[dom.text(t.comment)]);e.toplevelElements.push(s)}}),this),u.vert.forEach((function(e){e.forEach((function(e){if(!e.rendered){e.rendered=!0;let t={left:e.x+"px",top:e.top+"px",height:e.bottom-e.top+1+"px",borderWidth:e.size+"px",borderColor:e.color};1!==e.size&&(t.transform="translateX(-"+(e.size-1)/2+"px)"),i.children.push(dom.element("div",{className:paneClassNames.vborder,style:t}))}}))})),u.horiz.forEach((function(e){e.forEach((function(e){if(!e.rendered){e.rendered=!0;let t={top:e.y+"px",left:e.left+"px",width:e.right-e.left+"px",borderWidth:e.size+"px",borderColor:e.color};1!==e.size&&(t.transform="translateY(-"+(e.size-1)/2+"px)"),i.children.push(dom.element("div",{className:paneClassNames.hborder,style:t}))}}))})),this.renderDrawings(s,i.children),i}renderDrawings(e,t){let r=this._sheet,n=r._workbook;e.drawings.forEach((function(e){let i=e.drawing,o=e.box.toDiv("k-spreadsheet-drawing");i.image&&o.children.push(dom.element("div",{className:"k-spreadsheet-drawing-image",style:{backgroundImage:"url('"+n.imageUrl(i.image)+"')",opacity:i.opacity}})),i===r._activeDrawing&&(o.attr.className+=" k-spreadsheet-active-drawing",drawingResizeHandles(o.children)),t.push(o)}))}renderResizeHandle(e){let t,r=this._sheet.resizeHandlePosition(),n=this._rectangle(r),i=[Pane.classNames.resizeHandle];if(r.col!==-1/0){if(this._grid.rows._start>0)return;t={height:this._grid.headerHeight+"px",width:"7px",left:n.right-3.5+"px",top:"0px"},i.push(viewClassNames.horizontalResize)}else{if(this._grid.columns._start>0)return;t={height:"7px",width:this._grid.headerWidth+"px",top:n.bottom-3.5+"px",left:"0px"},i.push(viewClassNames.verticalResize)}e.push(dom.element("div",{className:i.join(" "),style:t}))}filterIconRect(e){return new Rectangle(e.right-16-3,e.top+3,16,16)}icon(e){return"function"==typeof this.getIconHTMLString?dom.element(this.getIconHTMLString(e)):dom.element("span",{className:viewClassNames.icon+" "+e})}renderFilterHeaders(){let e=this,t=this._sheet,r=[],n=viewClassNames,i=t.filter();return i&&this._addDiv(r,i.ref,n.filterRange),t.forEachFilterHeader(this._currentView.ref,function(t){let o=this._rectangle(t),s=this.filterIconRect(o),a=this._sheet.filterColumn(t),l=function(t,r,n){let o={left:r.left+"px",top:r.top+"px"},s=i&&i.columns.some((function(e){return e.index===n})),a=t.filterButton;return s&&(a+=" "+t.filterButtonSelected),dom.element("span",{className:a,style:o},[e.icon(t.iconFilterDefault)])}(n,s,a);r.push(l)}.bind(this)),dom.element("div",{className:n.filterHeadersWrapper},r)}renderEditorSelection(){let e=Pane.classNames,t=this._sheet,r=[];return t._formulaSelections.forEach(function(t){let n=t.ref;n!==NULLREF&&this._addDiv(r,n,e.selectionHighlight+" "+t.colorClass)}.bind(this)),dom.element("div",{className:e.selectionWrapper},r)}renderSelection(e){let t=Pane.classNames,r=[],n=[t.selection],i=this._sheet,o=i.activeCell().toRangeRef(),s=i.select();return n=n.concat(this._activeFormulaColor()),1===s.size()&&n.push("k-single-selection"),this._sheet.autoFillPunch()&&n.push("k-dim-auto-fill-handle"),s.forEach(function(e){e!==NULLREF&&this._addDiv(r,e,n.join(" "))}.bind(this)),this._renderCustomEditorButton(r,o,e),dom.element("div",{className:t.selectionWrapper},r)}renderAutoFill(){let e=[];if(this._sheet.autoFillInProgress()){let t=this._sheet.autoFillRef(),r=this._sheet.autoFillPunch(),n=this._sheet._autoFillDirection;if(this._addDiv(e,t,"k-auto-fill"),r)this._addDiv(e,r,"k-auto-fill-punch");else if(void 0!==n){let r,i;switch(n){case 0:case 1:r=t.bottomRight,i="k-auto-fill-br-hint";break;case 2:r=new CellRef(t.topLeft.row,t.bottomRight.col),i="k-auto-fill-tr-hint";break;case 3:r=new CellRef(t.bottomRight.row,t.topLeft.col),i="k-auto-fill-bl-hint"}let o=this._addDiv(e,r,i);if(o){let e=dom.element("span",{className:"k-tooltip"},[dom.text(this._sheet._autoFillHint)]);o.children.push(e)}}}return dom.element("div",{className:Pane.classNames.autoFillWrapper},e)}_addDiv(e,t,r){let n;return this._currentView.ref.intersects(t)&&(n=this._rectangle(t).resize(1,1).toDiv(r),e.push(n)),n}_renderCustomEditorButton(e,t,r){let n=this,i=n._sheet,o=n._currentView,s=n._grid.columns._axis._count,a=i.activeCellCustomEditor();if(a&&o.ref.intersects(t)){let o=n._rectangle(t);i.forEach(t.collapse(),(function(t,i,l){l.left=o.left,l.top=o.top,l.width=o.width,l.height=o.height;let u="k-button k-button-md k-rounded-md k-button-solid k-button-solid-base k-spreadsheet-editor-button",c=i===s-1||n._buttonOutOfVisiblePane(t,i,r);c&&(u+=" k-spreadsheet-last-column"),n._editorInLastColumn=c;let h=dom.element("div",{className:u,style:{left:l.left+(c?0:l.width)+"px",top:l.top+"px",height:l.height+"px"}});a.icon&&h.children.push(n.icon(a.icon)),e.push(h)}))}}_activeFormulaColor(){let e,t=[];return this._sheet.isInEditMode()&&(e=this._sheet._formulaSelections.filter((function(e){return e.active&&"ref"===e.type}))[0],e&&t.push(e.colorClass)),t}_directionClasses(e){let t=[],r=Pane.classNames,n=this._currentView.ref;return e.move(0,-1).intersects(n)||t.push(r.left),e.move(-1,0).intersects(n)||t.push(r.top),e.move(0,1).intersects(n)||t.push(r.right),e.move(1,0).intersects(n)||t.push(r.bottom),t}_rectangle(e){return this._grid.boundingRectangle(e.toRangeRef()).offset(-this._currentView.mergedCellLeft,-this._currentView.mergedCellTop)}_buttonOutOfVisiblePane(e,t,r){let n=this._grid,i=this._sheet,o=i.range(e,t)._ref,s=n.scrollBoundaries(o),a=n.columns.frozen?0:r.scrollLeft;if(s.right+20>a||t+1===i.frozenColumns())return!0}}function drawingResizeHandles(e){["N","NE","E","SE","S","SW","W","NW"].forEach((function(t){e.push(dom.element("div",{className:"k-spreadsheet-drawing-handle "+t,"data-direction":t}))}))}Pane.classNames=paneClassNames;let styles=["font-family","font-size","font-stretch","font-style","font-weight","letter-spacing","text-transform","line-height"],KEY_NAMES={27:"esc",37:"left",39:"right",35:"end",36:"home",32:"spacebar"},PRIVATE_FORMULA_CHECK=/(^_|[^a-z0-9]$)/i;class FormulaInput extends Widget{constructor(e,t){const r=Object.assign({},{name:"FormulaInput",autoScale:!1,filterOperator:"startswith",scalePadding:30,minLength:1,formulaBarWidth:null},t);super(e,r),this.events=["keyup","focus"],this.input=t.input,e&&(this.bind(this.events,this.options),e.classList.add(FormulaInput.classNames.wrapper),r&&r.formulaBarWidth,this._highlightedRefs=[],this._formulaSource(),this._formulaList(),this._tooltip(),this._sync=this._sync.bind(this),this.scale=this.scale.bind(this),this._keydown=this._keydown.bind(this),this._keyup=this._keyup.bind(this),this._blur=this._blur.bind(this),this._input=this._input.bind(this),this._focus=this._focus.bind(this),this._paste=this._paste.bind(this),this.options.autoScale&&e.addEventListener("input",this.scale),e.addEventListener("keydown",this._keydown),e.addEventListener("keyup",this._keyup),e.addEventListener("blur",this._blur),e.addEventListener("input",this._input),e.addEventListener("click",this._input),e.addEventListener("focus",this._focus),e.addEventListener("paste",this._paste))}enable(e){if(void 0===e)return"true"===this.element.getAttribute("contenteditable");e?this.element.setAttribute("contenteditable",e):this.element.removeAttribute("contenteditable"),this.element.classList.toggle("k-disabled",!e)}getPos(){let e=this.element,t=window.getSelection(),r=i(t.focusNode,t.focusOffset),n=i(t.anchorNode,t.anchorOffset);if(null!=r&&null!=n){if(r>n){let e=r;r=n,n=e}return{begin:r,end:n,collapsed:r===n}}function i(t,r){try{!function e(n){if(n===t)throw r;if(1===n.nodeType)for(let t=n.firstChild;t;t=t.nextSibling)e(t);else 3===n.nodeType&&(r+=n.nodeValue.length)}(e)}catch(e){return e}}}setPos(e,t){let r=this.element;function n(e,t){try{!function e(r){if(3===r.nodeType){let e=r.nodeValue.length;if(e>=t)throw r;t-=e}else if(1===r.nodeType)for(let t=r.firstChild;t;t=t.nextSibling)e(t)}(e)}catch(e){return{node:e,pos:t}}}e=n(r,e),t=null!=t?n(r,t):e,e&&t&&this._setRange(e,t)}end(){this.setPos(this.length())}home(){this.setPos(0)}select(){this.setPos(0,this.length())}length(){return this.value().length}_setRange(e,t){let r=document.createRange();r.setStart(e.node,e.pos),r.setEnd(t.node,t.pos);let n=window.getSelection(),i=n.getRangeAt(0);var o,s;s=i,((o=r).startOffset!==s.startOffset||o.endOffset!==s.endOffset||o.startContainer!==s.endContainer||o.endContainer!==s.endContainer)&&(n.removeAllRanges(),n.addRange(r))}_formulaSource(){let e,t=[];for(let r in calc.runtime.FUNCS)PRIVATE_FORMULA_CHECK.test(r)||(e=r.toUpperCase(),t.push({value:e,text:e}));this.formulaSource=t}get list(){return this.input.current.list}get popup(){return this.input.current.popup}_formulaList(){this.list.data(this.formulaSource),this.list.itemClick((e=>{this._formulaListChange(e)}))}_formulaListChange(e){let t=this._tokenContext();if(!t||this._mute)return;let r=t.token,n=e,i={replace:!0,token:r,end:r.end};t.nextToken&&"("===t.nextToken.value||(n+="("),this._replaceAt(i,n),this.popup.close()}_blur(){this.popup.close(),clearTimeout(this._focusId),this.trigger("blur")}_isFormula(){return/^=/.test(this.value())}_keydown(e){let t=e.keyCode,r=this;KEY_NAMES[t]?(r.popup.close(),r._navigated=!0):r._move(t)&&(r._navigated=!0,e.preventDefault()),r._keyDownTimeout=setTimeout(r._syntaxHighlight.bind(r))}_keyup(){let e,t=this.popup;if(this._isFormula()&&!this._navigated){e=((this._tokenContext()||{}).token||{}).value;const r=this.filter(e);e&&r.length?(t[t.visible()?"position":"open"](),setTimeout((()=>{this.list.focusFirst()}),0)):t.close()}this._navigated=!1,this._syntaxHighlight(),this.trigger("keyup")}_input(){this._syntaxHighlight()}_focus(){setTimeout(this._sync.bind(this)),this._focusTimeout=setTimeout(this._syntaxHighlight.bind(this)),this.trigger("focus")}_paste(e){e.preventDefault();let t,r=this.getPos();t=e.clipboardData.getData("text/plain");let n=this.value();n=n.substr(0,r.begin)+t+n.substr(r.end),this.value(n),this.setPos(r.begin+t.length),this.scale()}_move(e){let t=this.list,r=this.popup;if(r.visible()){if(e===keys.DOWN)return t.focusNext(),!0;if(e===keys.UP)return t.focusPrev(),!0;if(e===keys.ENTER||e===keys.TAB){let e="function"==typeof t.focusIndex?t.focusIndex():t.focus();return t.data()[e]&&this._formulaListChange(t.data()[e].value),r.close(),!0}if(e===keys.PAGEUP)return t.focusFirst(),!0;if(e===keys.PAGEDOWN)return t.focusLast(),!0}return!1}_tokenContext(){let e=this.getPos(),t=this.value();if(!t||!e||!e.collapsed)return null;let r,n=calc.tokenize(t,this.row(),this.col());for(let t=0;t<n.length;++t)if(r=n[t],touches(r,e)&&/^(?:str|sym|func)$/.test(r.type))return{token:r,nextToken:n[t+1]};return null}_sync(){this._editorToSync&&this.isActive()&&this._editorToSync.value(this.value())}_textContainer(){let e=kendoGetComputedStyles(this.element,styles);e.position="absolute",e.visibility="hidden",e.whiteSpace="pre",e.top=-3333,e.left=-3333,this._span=document.createElement("span"),this._span.style.whiteSpace="pre";for(const t in e)Object.hasOwnProperty.call(e,t)&&(this._span.style[t]=e[t]);insertAfter(this._span,this.element)}_tooltip(){this._cellTooltip=document.createElement("div"),this._cellTooltip.className="k-widget k-tooltip",this._cellTooltip.style.position="absolute",this._cellTooltip.style.display="none",this._cellTooltip.appendChild(document.createTextNode("A1")),insertAfter(this._cellTooltip,this.element)}tooltip(e){for(;this._cellTooltip.firstChild;)this._cellTooltip.removeChild(this._cellTooltip.firstChild);this._cellTooltip.appendChild(document.createTextNode(e))}toggleTooltip(e){this._cellTooltip.style.display=e?"":"none"}isActive(){return this.element===_activeElement$1()}filter(e){if(!e||e.length<this.options.minLength)return;const t=this.formulaSource.filter((t=>String(t.value).toLowerCase().startsWith(e.toLowerCase())));return this.list.data(t),t}hide(){this.enable(!1),this.element.style.display="none",this._cellTooltip.style.display="none"}show(){this.enable(!0),this.element.style.display="block"}row(){if(this.activeCell)return this.activeCell.row}col(){if(this.activeCell)return this.activeCell.col}position(e){e&&(this.show(),this.element.style.top=e.top+1+"px",this.element.style.left=e.left+1+"px",this._cellTooltip.style.top=e.top-this._cellTooltip.offsetHeight-10+"px",this._cellTooltip.style.left=e.left+"px")}resize(e){e&&(this.element.style.width=e.width-1+"px",this.element.style.height=e.height-1+"px")}canInsertRef(e){return this._canInsertRef(e)}_canInsertRef(e){if(this.popup.visible())return null;let t,r,n,i=e,o=this.getPos();if(o&&this._isFormula()){if(0===o.begin)return null;for(t=calc.tokenize(this.value(),this.row(),this.col()),n=0;n<t.length;++n){if(r=t[n],touches(r,o))return a(r);if(s(r))return l(t[n-1],r)}return l(r,null)}return null;function s(e){return e.begin>o.begin}function a(e){if(e){if(/^(?:num|str|bool|sym|ref)$/.test(e.type))return{replace:!0,token:e,end:e.end};if(/^(?:op|punc|startexp)$/.test(e.type))return e.end===o.end?l(e,t[n+1]):l(t[n-1],e)}}function l(e,t){if(null==e)return null;if(null==t)return/^(?:op|startexp)$/.test(e.type)||isOpenParen(e.value)?{token:e,end:o.end}:null;if(i){if("op"===e.type&&/^(?:punc|op)$/.test(t.type))return{token:e,end:o.end}}else{if("startexp"===e.type)return{token:e,end:o.end};if(/^(?:op|punc)$/.test(e.type)&&/^[,;({]$/.test(e.value))return{token:e,end:o.end};if(/^(?:ref|sym)/.test(e.type))return{token:e,replace:!0,end:e.end};if(/^(?:ref|sym)/.test(t.type))return{token:t,replace:!0,end:t.end}}return!1}}refAtPoint(e){let t=this._canInsertRef();if(t){let r=e.selection()._ref.simplify().clone().relative(0,0,3);e.isMerged(r)&&(r=r.topLeft),e!==this.activeSheet&&(r=r.setSheet(e.name(),!0)),this._replaceAt(t,r.print(0,0))}}_replaceAt(e,t){let r=this.value(),n=e.token,i=r.substr(e.end);r=r.substr(0,e.replace?n.begin:e.end)+t;let o=r.length;r+=i,this._value(r),this.setPos(o),this.scale(),this._syntaxHighlight()}syncWith(e){this._editorToSync=e,this.element&&(this.element.removeEventListener("input",this._sync),this.element.addEventListener("input",this._sync))}scale(){let e,t,r=this.element;this._span||this._textContainer(),this._span.innerHTML=r.innerHTML,e=this._span.offsetWidth+this.options.scalePadding,t=this._span.offsetHeight,e>r.offsetWidth&&(r.style.width=e+"px");t-1>r.offsetHeight&&(r.style.height=t-1+"px"),this._sync()}_value(e){if((this.element.innerText||this.element.textContent).replace(/\n$/,"")!==e){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.element.appendChild(document.createTextNode(e))}}value(e){let t=(this.element.innerText||this.element.textContent).replace(/\n$/,"");if(void 0===e)return t;t!==e&&(this._value(e),this._syntaxHighlight())}highlightedRefs(){return this._highlightedRefs.slice()}_syntaxHighlight(){let e=this.getPos(),t=this.value(),r=Pane.classNames.series,n=[],i=0,o=[],s=[];e&&!e.collapsed||(/^=/.test(t)?(s=calc.tokenize(t,this.row(),this.col()),s.forEach((function(t){if(t.active=!1,t.cls=["k-syntax-"+t.type],"ref"===t.type&&(t.colorClass=r[i++%r.length],t.cls.push(t.colorClass),n.push(t)),e&&"punc"===t.type)if(isOpenParen(t.value))o.unshift(t);else if(isCloseParen(t.value)){let r=o.shift();r?isMatchingParen(t.value,r.value)?(touches(t,e)||touches(r,e))&&(t.cls.push("k-syntax-paren-match"),r.cls.push("k-syntax-paren-match")):(t.cls.push("k-syntax-error"),r.cls.push("k-syntax-error")):t.cls.push("k-syntax-error")}e&&touches(t,e)&&(t.cls.push("k-syntax-at-point"),t.active=!0),"func"!==t.type||knownFunction(t.value)||e&&touches(t,e)||t.cls.push("k-syntax-error")})),s.reverse().forEach((function(e){let r=e.begin,n=e.end,i=htmlEncode(t.substring(r,n));t=t.substr(0,r)+"<span class='"+e.cls.join(" ")+"'>"+i+"</span>"+t.substr(n)})),this.element.innerHTML=t,e&&this.setPos(e.begin,e.end),this._highlightedRefs=n):this._highlightedRefs.length&&(this._highlightedRefs=[],this._value(t)))}destroy(){this._editorToSync=null,this.element.removeEventListener("input",this.scale),this.element.removeEventListener("keydown",this._keydown),this.element.removeEventListener("keyup",this._keyup),this.element.removeEventListener("blur",this._blur),this.element.removeEventListener("input",this._input),this.element.removeEventListener("click",this._input),this.element.removeEventListener("focus",this._focus),this.element.removeEventListener("paste",this._paste),clearTimeout(this._focusTimeout),clearTimeout(this._keyDownTimeout),this._cellTooltip=null,this._span=null,super.destroy()}insertNewline(){let e=this.value(),t=this.getPos(),r=t.end===e.length;e=e.substr(0,t.begin)+(r?"\n\n":"\n"+e.substr(t.end)),this.value(e),this.setPos(t.begin+1)}}function isOpenParen(e){return"("===e||"["===e||"{"===e}function isCloseParen(e){return")"===e||"]"===e||"}"===e}function isMatchingParen(e,t){return"("===t?")"===e:"["===t?"]"===e:"{"===t&&"}"===e}function touches(e,t){return e.begin<=t.begin&&e.end>=t.end}function knownFunction(e){return calc.runtime.FUNCS[e.toLowerCase()]}FormulaInput.classNames={wrapper:"k-spreadsheet-formula-input",listWrapper:"k-spreadsheet-formula-list"};class FormulaBar extends Widget{constructor(e,t){super(e,t);const r=e&&e.querySelector(".k-spreadsheet-formula-input:not(.k-spreadsheet-cell-editor)");this.formulaInput=new FormulaInput(r,this.options)}destroy(){this.formulaInput&&this.formulaInput.destroy(),this.formulaInput=null}}class NameEditor extends Widget{readData(){const e=[];return this._workbook.forEachName((function(t){!t.hidden&&t.value instanceof Ref&&e.push({name:t.name})})),e}value(e){if(this.options.combobox.current)return this.options.combobox.current.value(e)}}class SheetsBar extends Widget{constructor(e,t){super(e,Object.assign({},{name:"SheetsBar"},t)),this.events=["select","reorder","rename"]}onSheetReorderEnd(e){this.trigger("reorder",{oldIndex:e.oldIndex,newIndex:e.newIndex})}onSheetRemove(e){this.trigger("remove",{name:e,confirmation:!0})}onSheetSelect(e){this.trigger("select",{name:e,isAddButton:!1})}onSheetRename(e,t){this.trigger("rename",{name:e,sheetIndex:t})}onAddSelect(){this.trigger("select",{isAddButton:!0})}destroy(){super.destroy()}}function selectElementContents(e){let t=window.getSelection();t.removeAllRanges();let r=document.createRange();r.selectNodeContents(e),t.addRange(r)}function cellBefore(e,t){let r=e.trs[t].children;return r[r.length-2]}function cellAbove(e,t){let r=e.trs[t-1],n=e.trs[t].children.length-1;if(r&&n>=0)return r.children[n]}function addCell(e,t,r){let n={};r.background&&(n.backgroundColor=r.background),r.color&&(n.color=r.color),r.fontFamily&&(n.fontFamily=r.fontFamily),r.underline&&(n.textDecoration="underline"),r.italic&&(n.fontStyle="italic"),r.textAlign&&(n.textAlign=r.textAlign),r.verticalAlign&&(n.verticalAlign="center"===r.verticalAlign?"middle":r.verticalAlign),r.bold&&(n.fontWeight="bold"),r.fontSize&&(n.fontSize=r.fontSize+"px"),!0===r.wrap&&(n.whiteSpace="pre-wrap"),r.borderRight?n.borderRight=cellBorder(r.borderRight):r.background&&(n.borderRightColor=r.background),r.borderBottom?n.borderBottom=cellBorder(r.borderBottom):r.background&&(n.borderBottomColor=r.background);let i=r.value,o=typeof i,s=r.format;s||"number"!==o||i===Math.floor(i)||(s="0.##############"),s&&null!=i&&(i=formatting.format(i,s),i.__dataType&&(o=i.__dataType));let a={style:n};if(!n.textAlign)switch(o){case"number":case"date":case"percent":case"currency":n.textAlign="right";break;case"boolean":n.textAlign="center"}/^(?:string|undefined)$/.test(o)||(a.sdval=r.value,a["data-sheets-value"]=JSON.stringify({1:3,3:r.value}),s&&(a.sdnum=s,a["data-sheets-numberformat"]=JSON.stringify({1:2,2:s,3:1}))),r.formula&&(a["data-sheets-formula"]="="+r.formula.print());let l=null;!1===r.enable&&(l="k-disabled");let u,c,h=e.addCell(t,i,a,l,r.validation);return r.borderLeft?(c=cellBefore(e,t),u=cellBorder(r.borderLeft),c&&u&&(c.attr.style.borderRight=u)):r.background&&(n.borderLeftColor=r.background),r.borderTop?(c=cellAbove(e,t),u=cellBorder(r.borderTop),c&&u&&(c.attr.style.borderBottom=u)):r.background&&(n.borderTopColor=r.background),h}class HtmlTable{constructor(){this.cols=[],this.trs=[],this._height=0,this._width=0}addColumn(e){this._width+=e;let t=dom.element("col",{style:{width:e+"px"}});t.visible=e>0,this.cols.push(t)}addRow(e){let t=null;t={style:{height:e+"px"}},this._height+=e;let r=dom.element("tr",t);r.visible=e>0,this.trs.push(r)}addCell(e,t,r,n,i){null==t&&(t=""),t instanceof dom.Node||(t=dom.text(t));let o=[t];i&&!i.value&&(o.push(dom.element("span",{className:"k-dirty"})),n=(n||"")+(n?" ":"")+"k-dirty-cell",r.title=i.message),n&&(r.className=n);let s=dom.element("td",r,o);return this.trs[e].children.push(s),s}toDomTree(e,t,r){this.trs=this.trs.filter((function(e){return e.visible}));let n=0;return this.cols=this.cols.filter((function(e,t){return e.visible||(this.trs.forEach((function(e){e.children.splice(t-n,1)})),n++),e.visible}),this),dom.element("table",{style:{left:e+"px",top:t+"px",height:this._height+"px",width:this._width+"px"},className:r,role:"presentation"},[dom.element("colgroup",null,this.cols),dom.element("tbody",null,this.trs)])}}function within(e,t,r){return e>=t&&e<=r}class View extends Observable{constructor(e,t){super();let r=View.classNames;if(this.element=e,this.options=deepExtend({},{messages:messages.view},this.options,t),this.events=["update","message"],this._chrome(),this._dialogs=[],this._formulaInput(),this.wrapper=e.querySelector("."+r.view),this.container=e.querySelector("."+r.fixedContainer),this.scroller=e.querySelector("."+r.scroller),this.clipboard=e.querySelector("."+r.clipboard),this.viewSize=this.scroller?this.scroller.querySelector(".k-spreadsheet-view-size")||this.scroller.firstElementChild:null,!this.viewSize)throw new Error("The scroller element does not contain a view size element.");this.tree=new dom.Tree(this.container),this.clipboardContents=new dom.Tree(this.clipboard),this.editor=new SheetEditor(this),this._sheetsbar(),this.options.createContextMenus?.()}enableClipboard(e){this.isClipboardDeactivated=!e,e?this.clipboard.setAttribute("contenteditable",e):this.clipboard.removeAttribute("contenteditable")}_resize(){}_chrome(){let e=this.element.querySelector(".k-spreadsheet-name-editor");this.nameEditor=new NameEditor(e,{combobox:this.options.nameBoxRef});let t=this.element.querySelector(".k-spreadsheet-formula-bar");this.formulaBar=new FormulaBar(t,{input:this.options.formulaBarInputRef}),this._tabstrip()}_formulaInput(){let e=this.element.querySelector("."+View.classNames.cellEditor);this.formulaInput=new FormulaInput(e,{autoScale:!0,input:this.options.formulaCellInputRef})}_sheetsbar(){this.options.sheetsbar&&(this.sheetsbar=new SheetsBar(this.element.querySelector("."+View.classNames.sheetsBar),this.options.sheetsbar),this.options.createSheetBar?.(this.options.openDialogCallback))}_tabstrip(){this.tabstrip=this.options.createTabStrip?.()}_executeCommand(e){this._sheet.trigger("commandRequest",e)}workbook(e){this._workbook=e,e._view=this,this.nameEditor._workbook=e}sheet(e){this._sheet=e}activeCellRectangle(){return this.cellRectangle(this._sheet._viewActiveCell())}_rectangle(e,t){return e._grid.boundingRectangle(t.toRangeRef())}isColumnResizer(e,t,r){return e-=this._sheet._grid._headerWidth,t._grid.columns.frozen||(e+=this.scroller.scrollLeft),null===(r=this._sheet._grid._columns.locate(0,r,(function(t){return Math.abs(e-t)<=3.5})))||this._sheet.isHiddenColumn(r)?null:r}isRowResizer(e,t,r){return e-=this._sheet._grid._headerHeight,t._grid.rows.frozen||(e+=this.scroller.scrollTop),null===(r=this._sheet._grid._rows.locate(0,r,(function(t){return Math.abs(e-t)<=3.5})))||this._sheet.isHiddenRow(r)?null:r}isFilterIcon(e,t,r,n){let i=this,o=r._grid,s=o.rows.frozen?0:i.scroller.scrollTop,a=o.columns.frozen?0:i.scroller.scrollLeft;return e-=i._sheet._grid._headerWidth-a,t-=i._sheet._grid._headerHeight-s,withExit((function(o){i._sheet.forEachFilterHeader(n,(function(n){let s=i._rectangle(r,n);r.filterIconRect(s).intersects(e,t)&&o(!0)}))}))}isAutoFill(e,t,r){let n=this._sheet.select();if(n.size>1)return!1;e-=this._sheet._grid._headerWidth,t-=this._sheet._grid._headerHeight,r._grid.columns.frozen||(e+=this.scroller.scrollLeft),r._grid.rows.frozen||(t+=this.scroller.scrollTop);let i=this._rectangle(r,n);return Math.abs(i.right-e)<8&&Math.abs(i.bottom-t)<8}isEditButton(e,t,r){if(this._sheet.activeCellCustomEditor()){let n=this.activeCellRectangle();if(t>=n.top&&t<=n.bottom)return r._editorInLastColumn?e<n.left&&e>=n.left-20:e>n.right&&e<=n.right+20}}drawingAt(e,t,r){e-=this._sheet._grid._headerWidth,t-=this._sheet._grid._headerHeight,r._grid.columns.frozen||(e+=this.scroller.scrollLeft),r._grid.rows.frozen||(t+=this.scroller.scrollTop);let n=this._sheet,i=this._sheet._drawings;for(let r=i.length;--r>=0;){let o=i[r],s=n.drawingBoundingBox(o);if(s.intersects(e,t))return{drawing:o,drx:s.left-e,dry:s.top-t}}}objectAt(e,t,r){let n,i,o=this._sheet._grid;if(e<0||t<0||e>this.scroller.clientWidth||t>this.scroller.clientHeight)n={type:"outside"};else if(e<o._headerWidth&&t<o._headerHeight)n={type:"topcorner"};else if(i=this.paneAt(e,t),i){if(!r){let r=this.drawingAt(e,t,i);if(r)return{type:"drawing",drawing:r.drawing,drx:r.drx,dry:r.dry,pane:i,startX:e,startY:t}}let s=i._grid.rows.indexVisible(t,this.scroller.scrollTop),a=i._grid.columns.indexVisible(e,this.scroller.scrollLeft),l="cell",u=new CellRef(s,a),c=this._sheet.selectionInProgress();this.isAutoFill(e,t,i)?l="autofill":this.isFilterIcon(e,t,i,u)?l="filtericon":!c&&e<o._headerWidth?(l="rowheader",null!==(s=this.isRowResizer(t,i,s))&&(u=new CellRef(s,-1/0),l="rowresizehandle")):!c&&t<o._headerHeight?(l="columnheader",null!==(a=this.isColumnResizer(e,i,a))&&(u=new CellRef(-1/0,a),l="columnresizehandle")):this.isEditButton(e,t,i)&&(l="editor"),n={type:l,ref:u}}else n={type:"outside"};return n.pane=i,n.x=e,n.y=t,n}paneAt(e,t){return this.panes.filter((function(r){let n=r._grid;return within(t,n.top,n.bottom)&&within(e,n.left,n.right)}))[0]}containingPane(e){return this.panes.filter((function(t){return!!t._grid.contains(e)}))[0]}cellRectangle(e){let t=this.containingPane(e)._grid;return this._sheet._grid.rectangle(e).offset(t.headerWidth-(t.columns.frozen?0:this.scroller.scrollLeft),t.headerHeight-(t.rows.frozen?0:this.scroller.scrollTop))}refresh(e){let t=this._sheet;if(this.trigger("update",{reason:e,range:t.range(t.activeCell()),sheet:t}),this._resize(),this.viewSize.style.height=t._grid.totalHeight()+"px",this.viewSize.style.width=t._grid.totalWidth()+"px",e.layout){let e=t.frozenColumns(),r=t.frozenRows();this.panes=[this._pane(r,e)],e>0&&this.panes.push(this._pane(r,0,null,e)),r>0&&this.panes.push(this._pane(0,e,r,null)),r>0&&e>0&&this.panes.push(this._pane(0,0,r,e))}e.filter&&this._destroyFilterMenu(),e.activeCell&&(this._focus=t.activeCell().toRangeRef())}createFilterMenu(e){this._destroyFilterMenu();let t=this._sheet,r=t.filter().ref,n={column:e,range:new Range$1(r,t)};return this._filterMenu=this.options.createFilterMenu(n),this._filterMenu}selectClipboardContents(){this.isClipboardDeactivated||(this.clipboard.focus({preventScroll:!0}),selectElementContents(this.clipboard))}scrollIntoView(e){let t=!1,r=this.containingPane(e)._grid,n=r.scrollBoundaries(e),i=this.scroller,o=r.rows.frozen?0:i.scrollTop,s=r.columns.frozen?0:i.scrollLeft;return n.top<o&&(t=!0,i.scrollTop=n.scrollTop),n.bottom>o&&(t=!0,i.scrollTop=n.scrollBottom),n.left<s&&(t=!0,i.scrollLeft=n.scrollLeft),n.right>s&&(t=!0,i.scrollLeft=n.scrollRight),t}_destroyDialog(){this._dialogs.pop()}openCustomEditor(){let e=this,t=e._sheet.activeCell().first(),r=e._sheet.activeCellCustomEditor(),n=e._sheet.range(t);r.edit({range:n,rect:e.activeCellRectangle(),view:this,validation:this._sheet.validation(t),callback:function(t,r){e._executeCommand({command:"EditCommand",options:{operatingRange:n,editRange:n,property:r?"input":"value",value:t}})}})}openDialog(e,t){let r=this._sheet;return r.withCultureDecimals(function(){let n=r.activeCell(),i=new Range$1(n,r),o={...t,name:e,ref:n,range:i};return this.trigger("message",o),o.dialog}.bind(this))}showError(e,t){let r=this._dialogs,n=this.options.messages.errors;if(r.length>0)return;let i=function(){r.pop(),this.selectClipboardContents(),t&&t()}.bind(this);const o={title:e.title||"Error",text:e.body?e.body:n[e.type],close:i};r.push(o),this.openDialog(e.type||"message",o)}destroy(){this.unbind(),[this.tree,this.clipboardContents].forEach((e=>{for(;e&&e.root&&e.root.lastChild;)e.root.removeChild(e.root.lastChild)})),this.tree=this.clipboardContents=null,this.tabstrip&&(this.tabstrip.destroy(),this.tabstrip=null),this._destroyFilterMenu()}_destroyFilterMenu(){this._filterMenu&&(this._filterMenu.destroy(),this._filterMenu=void 0)}render(e){let t=this._sheet,r=t.focus(),n=scrollbar(),i=this.wrapper.clientWidth-n,o=this.wrapper.clientHeight-n;if(r&&this.scrollIntoView(r))return;let s=t.resizingInProgress()?t.resizeHandlePosition().col===-1/0?"column":"row":"none";this.wrapper.classList.toggle(viewClassNames.editContainer,this.editor.isActive()),this.wrapper.classList.toggle(viewClassNames.horizontalResize,"row"===s),this.wrapper.classList.toggle(viewClassNames.verticalResize,"column"===s);let a=t._grid,l=[],u={scroller:this.scroller,toplevelElements:l,contentWidth:i,contentHeight:o};this.panes.forEach((function(e){l.push(e.render(u))}));let c=dom.element("div",{style:{width:a._headerWidth+"px",height:a._headerHeight+"px"},className:View.classNames.topCorner});l.push(c),t.resizeHandlePosition()&&t.resizeHintPosition()&&l.push(this.renderResizeHint()),this.tree.render(l),this.container.style.width=i+"px",this.container.style.height=o+"px",this.editor.isActive()?this.editor.toggleTooltip(this.activeCellRectangle()):e.resize||e.comment||t.selectionInProgress()||t.resizingInProgress()||t.draggingInProgress()||t.isInEditMode()||this.renderClipboardContents()}renderResizeHint(){let e,t=this._sheet,r=t.resizeHandlePosition().col!==-1/0;e=r?{height:this.scroller.clientHeight+"px",width:"7px",left:t.resizeHintPosition().x+"px",top:"0px"}:{height:"7px",width:this.scroller.clientWidth+"px",top:t.resizeHintPosition().y+"px",left:"0px"};let n=Pane.classNames;return dom.element("div",{className:n.resizeHint+(r?"":" "+n.resizeHintVertical),style:e},[dom.element("div",{className:n.resizeHintHandle}),dom.element("div",{className:n.resizeHintMarker})])}renderClipboardContents(){let e=this._sheet,t=e._grid,r=t.normalize(e.select().toRangeRef()),n=this._workbook.clipboard().canCopy();if(!1===n.canCopy&&n.multiSelection)return this.clipboardContents.render([]),void this.selectClipboardContents();r=e.trim(r);let i=new HtmlTable,o=t.rangeDimensions(r);o.rows.forEach((function(e){i.addRow(e)})),o.columns.forEach((function(e){i.addColumn(e)}));let s=e._getMergedCells(r),a=s.primary,l=s.secondary;e.forEach(r,(function(e,t,n){let o=new CellRef(e,t).print();if(!l[o]){let t=addCell(i,e-r.topLeft.row,n),s=a[o];s&&(t.attr.colspan=s.width(),t.attr.rowspan=s.height())}})),this.clipboardContents.render([i.toDomTree(0,0,"kendo-clipboard-"+this._workbook.clipboard()._uid)]),this.selectClipboardContents()}_pane(e,t,r,n){let i=new Pane(this._sheet,this._sheet._grid.pane({row:e,column:t,rowCount:r,columnCount:n}),this.options.getIconHTMLString);return i.refresh(this.scroller.clientWidth,this.scroller.clientHeight),i}}View.classNames=viewClassNames;const reTable=/<table[^>]+>/gim,tables=e=>(e||"").match(reTable)||[];class Clipboard{constructor(e){this._content={},this._externalContent={},this._internalContent={},this.workbook=e,this.origin=NULLREF,this.iframe=document.createElement("iframe"),this.iframe.className="k-spreadsheet-clipboard-paste",this.iframe.setAttribute("title","Spreadsheet clipboard iframe"),this.menuInvoked=!1,this._uid=guid(),document.body.appendChild(this.iframe)}destroy(){this.iframe&&this.iframe.parentNode&&this.iframe.parentNode.removeChild(this.iframe)}canCopy(){let e={canCopy:!0},t=this.workbook.activeSheet().select();return t===NULLREF&&(e.canCopy=!1),t instanceof UnionRef&&(e.canCopy=!1,e.multiSelection=!0),this.menuInvoked&&(e.canCopy=!1,e.menuInvoked=!0),e}canPaste(){let e=this.workbook.activeSheet(),t=this.pasteRef(),r={canPaste:!0,pasteOnMerged:!1,pasteOnDisabled:!1};return e.range(t).enable()||(r.canPaste=!1,r.pasteOnDisabled=!0),t.eq(e.unionWithMerged(t))||(r.canPaste=!1,r.pasteOnMerged=!0),this.menuInvoked&&(r.canPaste=!1,r.menuInvoked=!0),r}intersectsMerged(){let e=this.workbook.activeSheet();this.parse(),this.origin=this._content.origRef;let t=this.pasteRef();return!t.eq(e.unionWithMerged(t))}copy(){let e=this.workbook.activeSheet();this.origin=e.select(),this._internalContent=e.selection().getState(),delete this._externalContent.html,delete this._externalContent.plain}cut(){let e=this.workbook.activeSheet();this.copy(),e.range(e.select()).clear()}pasteRef(){let e=this.workbook.activeSheet();if(this.origin===NULLREF)return e.select();let t=e.activeCell().first(),r=this.origin.first(),n=r.row-t.row,i=r.col-t.col;return this.origin.relative(n,i,3)}paste(){let e=this.workbook.activeSheet(),t=this.pasteRef();(t.bottomRight.row>=e._rows._count||t.bottomRight.col>=e._columns._count)&&e.resize(Math.max(t.bottomRight.row+1,e._rows._count),Math.max(t.bottomRight.col+1,e._columns._count)),e.range(t).setState(this._content,this),e.triggerChange({recalc:!0,ref:t})}external(e){if(!e||!e.html&&!e.plain)return this._externalContent;this._externalContent=e}isExternal(){return!this._isInternal()}parse(){let e;if(this._isInternal())e=this._internalContent;else{let t=this._externalContent;if(e=t.plain?parseTSV(t.plain):newState(),t.html){let r=this.iframe.contentWindow.document;r.open(),r.write(t.html),r.close();let n=r.querySelector("table"),i=r.head.querySelector("meta[name=ProgId]")?.getAttribute("content");if(n){let t=parseHTML(n,i);t.data.forEach((function(t,r){t.forEach((function(t,n){/^\s*#+\s*$/.test(t.value)&&(t.value=e.data[r][n].value)}))})),e=t}}this.origin=e.origRef}this._content=e}_isInternal(){if(void 0===this._externalContent.html)return!0;const e="kendo-clipboard-"+this._uid,t=t=>t.some((t=>t.includes(e)));return t(tables(this._externalContent.html))||t(tables(this._externalContent.plain))}}function newState(){let e=new CellRef(0,0,0);return{ref:e,mergedCells:[],data:[],foreign:!0,origRef:e.toRangeRef()}}function setStateData(e,t,r,n){let i=e.data||(e.data=[]);i[t]||(i[t]=[]),i[t][r]=n;let o=e.origRef.bottomRight;o.row=Math.max(o.row,t),o.col=Math.max(o.col,r)}function stripStyle(e){return e.replace(/^-(?:ms|moz|webkit)-/,"")}function borderObject(e,t){e.className||(t=e.style);let r={};return["borderBottom","borderRight","borderLeft","borderTop"].forEach((function(e){let n=t[e+"Width"];n&&(n=parseInt(n,10)),n&&(r[e]={size:n,color:t[e+"Color"]||"#000"})})),r}function cellState(e,t,r,n,i,o){let s,a,l,u=window.getComputedStyle(r),c="string"==typeof o&&o.indexOf("Excel")>-1;!c&&(s=r.getAttribute("data-sheets-value"))&&(s=JSON.parse(s),s=s[s[1]]),!c&&(a=r.getAttribute("data-sheets-numberformat"))&&(a=JSON.parse(a),a=a[a[1]]),l=r.getAttribute("data-sheets-formula"),c||null!=s||null!=a||null!=l||(s=r.getAttribute("sdval"),a=r.getAttribute("sdnum"),a&&(a=a.replace(/^1033;(?:0;)?/,""))),null==s&&(s=(r.innerText||r.textContent).replace(/\t$/,""));let h=borderObject(r,u),f={value:""===s?null:s,formula:l,borderTop:h.borderTop||n.get(e,t)||null,borderBottom:h.borderBottom||n.get(e+1,t)||null,borderLeft:h.borderLeft||i.get(e,t)||null,borderRight:h.borderRight||i.get(e,t+1)||null,fontSize:parseInt(u.fontSize,10)};null!=a&&(f.format=a),n.set(e,t,f.borderTop),n.set(e+1,t,f.borderBottom),i.set(e,t,f.borderLeft),i.set(e,t+1,f.borderRight),"rgb(0, 0, 0)"!==u.backgroundColor&&"rgba(0, 0, 0, 0)"!==u.backgroundColor&&(f.background=u.backgroundColor),"right"!==stripStyle(u.textAlign)&&(f.textAlign=stripStyle(u.textAlign)),"middle"!==u.verticalAlign&&(f.verticalAlign=u.verticalAlign),"normal"!==u.wordWrap&&(f.wrap=!0);const p=r.querySelector("font");return p&&(u=window.getComputedStyle(p)),"rgb(0, 0, 0)"!==u.color&&"rgba(0, 0, 0, 0)"!==u.color&&(f.color=u.color),/^underline/.test(u.textDecoration)&&(f.underline=!0),"italic"==u.fontStyle&&(f.italic=!0),/^(?:bold|[67]00)$/i.test(u.fontWeight)&&(f.bold=!0),f}function parseHTML(e,t){let r=newState(),n=[],i=0,o=0;for(let t=0;t<e.rows.length;++t)n.push([]);let s=new calc.runtime.Matrix,a=new calc.runtime.Matrix;for(let l=0;l<e.rows.length;++l,++i){let u=e.rows[l];o=0;for(let e=0;e<u.cells.length;++e){let l=u.cells[e],c=l.rowSpan,h=l.colSpan;for(;n[i][o];)o++;let f=l.getAttribute("style"),p=/mso-ignore:colspan/.test(f);setStateData(r,i,o,cellState(i,o,l,s,a,t)),(c>1||h>1&&!p)&&r.mergedCells.push(new RangeRef(new CellRef(i,o),new CellRef(i+c-1,o+h-1)).toString());for(let e=i+c;--e>=i;)for(let t=o+h;--t>=o;)e<n.length&&(n[e][t]=!0,e===i&&t===o||setStateData(r,e,t,{}))}}return r}function parseTSV(e){let t=newState();if(-1===e.indexOf("\t")&&-1===e.indexOf("\n"))setStateData(t,0,0,{value:e});else{let r=e.split("\n");for(let e=0;e<r.length;e++){let n=r[e].split("\t");for(let r=0;r<n.length;r++)setStateData(t,e,r,{value:n[r]})}}return t}let COMMAND_TYPES={AUTO_FILL:"autoFill",CLEAR:"clear",CUT:"cut",EDIT:"edit",PASTE:"paste",VALIDATION:"validation"};const noop=()=>{};class Command{constructor(e){this.options=e,this._workbook=e.workbook,this._property=e&&e.property,this._state={}}range(e){return void 0!==e&&this._setRange(e),this._range}_setRange(e){this._range=e}redo(){this.range().select(),this.exec()}undo(){this.setState(this._state)}getState(){this._state=this.range().getState(this._property)}setState(e){this.range().setState(e)}rejectState(e){return this.undo(),{title:e.title,body:e.message,reason:"error",type:"validationError"}}_forEachCell(e){let t=this.range();t._ref.forEach(function(r){t.sheet().forEach(r.toRangeRef(),e.bind(this))}.bind(this))}usesImage(){return!1}}class DrawingUpdateCommand extends Command{constructor(e){super(e),this._sheet=e.sheet,this._drawing=e.drawing,this._orig=this._drawing.clone(),this._previous=e.previous}exec(){}undo(){this._drawing.reset(this._previous),this._sheet._activeDrawing=this._drawing,this._sheet.triggerChange({layout:!0})}redo(){this._drawing.reset(this._orig),this._sheet._activeDrawing=this._drawing,this._sheet.triggerChange({layout:!0})}usesImage(e){return this._drawing.image===e||this._orig.image===e||this._previous.image===e}}class DrawingCommand extends Command{constructor(e){super(e),this._drawing=e.drawing}usesImage(e){return this._drawing.image===e}}class InsertImageCommand extends DrawingCommand{constructor(e){super(e),this._blob=e.blob,this._width=e.width,this._height=e.height}exec(){let e=this.range(),t=e.sheet(),r=this._width,n=this._height,i=r/n;r>n?(r=Math.min(r,300),n=r/i):(n=Math.min(n,300),r=n*i),this._drawing=t.addDrawing({topLeftCell:e.topLeft(),offsetX:5,offsetY:5,width:r,height:n,opacity:1,image:this._workbook.addImage(this._blob)},!0),this._blob=null}undo(){let e=this.range().sheet();e._activeDrawing=null,e.removeDrawing(this._drawing)}redo(){let e=this.range().sheet();e._activeDrawing=this._drawing,e.addDrawing(this._drawing)}}class DeleteDrawingCommand extends DrawingCommand{exec(){let e=this.range().sheet();e._activeDrawing=null,e.removeDrawing(this._drawing)}undo(){let e=this.range().sheet();e._activeDrawing=this._drawing,e.addDrawing(this._drawing)}redo(){this.exec()}}class ReorderDrawingsCommand extends DrawingCommand{exec(){let e=this.range().sheet();this._origIndex=e._drawings.indexOf(this._drawing),e._drawings.splice(this._origIndex,1),this._newIndex=this._reorder(),e._drawings.splice(this._newIndex,0,this._drawing),e.triggerChange({drawings:!0})}undo(){let e=this.range().sheet();e._drawings.splice(this._newIndex,1),e._drawings.splice(this._origIndex,0,this._drawing),e.triggerChange({drawings:!0})}}class BringToFrontCommand extends ReorderDrawingsCommand{_reorder(){return this.range().sheet()._drawings.length}}class SendToBackCommand extends ReorderDrawingsCommand{_reorder(){return 0}}class TargetValueCommand extends Command{constructor(e){super(e),this._target=e.target,this._value=e.value}exec(){this.getState(),this.setState(this._value)}}class ColumnWidthCommand extends TargetValueCommand{getState(){this._state=this.range().sheet().columnWidth(this._target)}setState(e){this.range().sheet().columnWidth(this._target,e)}}class RowHeightCommand extends TargetValueCommand{getState(){this._state=this.range().sheet().rowHeight(this._target)}setState(e){this.range().sheet().rowHeight(this._target,e)}}class HyperlinkCommand extends Command{constructor(e){super(e),this._link=e.link}exec(){let e=this.range();this._prevLink=e.link(),this._prevUnderline=e.underline(),e.link(this._link),e.underline(!0),null==e.value()&&(this._hasSetValue=!0,e.value(this._link))}undo(){let e=this.range();e.link(this._prevLink),e.underline(this._prevUnderline),this._hasSetValue&&e.value(null)}}class GridLinesChangeCommand extends TargetValueCommand{getState(){this._state=this._range.sheet().showGridLines()}setState(e){this._range.sheet().showGridLines(e)}}class PropertyChangeCommand extends Command{_setRange(e){Command.prototype._setRange.call(this,e.skipHiddenCells())}constructor(e){super(e),this._value=e.value}exec(){let e=this.range();e.enable()&&(this.getState(),"format"===this.options.property&&this._workbook.trigger("changeFormat",{range:e}),e[this._property](this._value))}}class PropertyCleanCommand extends PropertyChangeCommand{exec(){let e=this.range();e.enable()&&(this.getState(),e.clearFormat())}}class ClearContentCommand extends Command{exec(){let e,t,r,n,i,o=[];return this.range().enable()?this.range().canEditArrayFormula()?(this.getState(),e=this.range().skipHiddenCells(),e._ref.refs&&e._ref.refs.length>1?e._ref.refs.forEach((function(t){i=e.sheet().range(t),o=o.concat(i.values())})):o=e.values(),r=[],o.forEach((function(e){t=[],e.forEach((function(){t.push(null)})),r.push(t)})),e.sheet().trigger("changing",{data:r,range:e,changeType:COMMAND_TYPES.CLEAR})?void 0:(e.clearContent(),n=e._getValidationState(),n?this.rejectState(n):void 0)):{reason:"error",type:"intersectsArray"}:{reason:"error",type:"cannotModifyDisabled"}}undo(){let e,t=this.range().skipHiddenCells(),r=t.sheet(),n=this._state.data,i=[];n.forEach((function(t){e=[],t.forEach((function(t){e.push(t.value)})),i.push(e)})),r.trigger("changing",{data:i,range:t,changeType:COMMAND_TYPES.CLEAR})||this.setState(this._state)}}class EditCommand extends PropertyChangeCommand{constructor(e){e.property=e.property||"input",super(e)}_setRange(e){PropertyChangeCommand.prototype._setRange.apply(this,arguments),this._editRange=this.options.arrayFormula?e:e.sheet().activeCellSelection()}getState(){this._state=this.range().getState()}exec(){return this.range().sheet().withCultureDecimals(this._exec.bind(this))}undo(){let e=this._editRange,t=this._state;e.sheet().trigger("changing",{data:t.data[0][0].value,range:e,changeType:COMMAND_TYPES.EDIT})||this.setState(this._state)}_exec(){let e=this.options.arrayFormula,t=this._editRange;if(!t.enable())return{reason:"error",type:"rangeDisabled"};if(!t.canEditArrayFormula())return{reason:"error",type:"intersectsArray"};let r=this._value;if(this.getState(),!this.range().sheet().trigger("changing",{data:r,range:this._editRange,changeType:COMMAND_TYPES.EDIT}))if("value"!==this._property)try{t.link(null),""===r?t.value(null):(t.input(r,{arrayFormula:e}),/\n/.test(t.value())&&t.wrap(!0)),t._adjustRowHeight();let n=t._getValidationState();if(n)return this.rejectState(n)}catch(e){if(e instanceof calc.runtime.ParseError)return{title:"Error in formula",body:e+"",reason:"error"};throw e}else t.value(r)}}class InsertCommentCommand extends PropertyChangeCommand{constructor(e){e.property="comment",super(e)}}class TextWrapCommand extends PropertyChangeCommand{constructor(e){e.property="wrap",super(e),this._value=e.value}getState(){let e={};this.range().forEachRow((function(t){let r=t.topLeft().row;e[r]=t.sheet().rowHeight(r)})),this._state=this.range().getState(this._property),this._rowHeight=e}undo(){let e=this.range().sheet(),t=this._rowHeight;this.range().setState(this._state);for(let r in t)e.rowHeight(r,t[r])}}class AdjustDecimalsCommand extends Command{constructor(e){e.property="format",super(e),this._delta=e.value}exec(){let e=this.range().sheet(),t=this._delta;this.getState(),e.batch(function(){this.range().forEachCell((function(r,n,i){let o=i.format;if(!o){let e=i.value;"number"==typeof e&&/\./.test(e)&&(o="0."+String(e).split(".")[1].replace(/\d/g,"0"))}(o||t>0)&&(o=formatting.adjustDecimals(o||"0",t),e.range(r,n).format(o))}))}.bind(this))}}class BorderChangeCommand extends Command{constructor(e){e.property="border",super(e),this._type=e.border,this._style=e.style}_batch(e){return this.range().sheet().batch(e,{})}exec(){let e=this;e._type&&(e.getState(),e._batch((function(){e[e._type](e._style)})))}noBorders(){this.range().insideBorders(null),this.outsideBorders(null)}allBorders(e){this.range().insideBorders(e),this.outsideBorders(e)}leftBorder(e){this.range().leftColumn().borderLeft(e)}rightBorder(e){this.range().rightColumn().borderRight(e)}topBorder(e){this.range().topRow().borderTop(e)}bottomBorder(e){this.range().bottomRow().borderBottom(e)}outsideBorders(e){let t=this.range();t.leftColumn().borderLeft(e),t.topRow().borderTop(e),t.rightColumn().borderRight(e),t.bottomRow().borderBottom(e)}insideBorders(e){this.range().insideBorders(e),this.outsideBorders(null)}insideHorizontalBorders(e){this.range().insideHorizontalBorders(e)}insideVerticalBorders(e){this.range().insideVerticalBorders(e)}}class MergeCellCommand extends Command{constructor(e){super(e),this._type=e.value}exec(){this.getState(),this[this._type](),this.range().sheet().triggerChange({recalc:!0})}activate(e){this.range().sheet().activeCell(e)}getState(){this._state=this.range().getState()}undo(){"unmerge"!==this._type&&(this.range().unmerge(),this.activate(this.range().topLeft())),this.range().setState(this._state)}cells(){let e=this.range(),t=e._ref;e.merge(),this.activate(t)}horizontally(){let e=this.range().topRow()._ref;this.range().forEachRow((function(e){e.merge()})),this.activate(e)}vertically(){let e=this.range().leftColumn()._ref;this.range().forEachColumn((function(e){e.merge()})),this.activate(e)}unmerge(){let e=this.range(),t=e._ref.topLeft;e.unmerge(),this.activate(t)}}class FreezePanesCommand extends Command{constructor(e){super(e),this._type=e.value}exec(){this.getState(),this._topLeft=this.range().topLeft(),this[this._type]()}getState(){this._state=this.range().sheet().getState()}undo(){this.range().sheet().setState(this._state)}panes(){let e=this._topLeft;this.range().sheet().frozenColumns(e.col).frozenRows(e.row)}rows(){let e=this._topLeft;this.range().sheet().frozenRows(e.row)}columns(){let e=this._topLeft;this.range().sheet().frozenColumns(e.col)}unfreeze(){this.range().sheet().frozenRows(0).frozenColumns(0)}}class PasteCommand extends Command{constructor(e){super(e),this._clipboard=e.workbook.clipboard(),this._clipboard.parse(),this._event=e.event,this._clipboardContent=this._clipboard._content,this._sheet=this._workbook.activeSheet(),this._range=this._sheet.selection?this._sheet.selection():this._sheet.range(this._clipboard.pasteRef()),this._state=this._range.getState(),this._targetRangeRefs=(this._range._ref instanceof UnionRef?this._range._ref.refs:[this._range._ref]).map((function(e){return e.toRangeRef()}))}exec(){return this.range().sheet().withCultureDecimals(this._exec.bind(this))}undo(){let e=this._sheet,t=this._range;e.trigger("changing",{data:this._state.data,range:t,changeType:COMMAND_TYPES.PASTE})||this.setState(this._state)}_exec(){let e=this._clipboard.canPaste();if(!e.canPaste)return e.menuInvoked?{reason:"error",type:"useKeyboard"}:e.pasteOnMerged?{reason:"error",type:"modifyMerged"}:e.pasteOnDisabled?(this._event.preventDefault(),{reason:"error",type:"cannotModifyDisabled"}):{reason:"error"};let t=this._sheet,r=this._range;this._workbook.trigger("paste",{range:r,clipboardContent:this._clipboardContent})||t.trigger("changing",{data:this._clipboardContent.data,range:r,changeType:COMMAND_TYPES.PASTE})?this._event.preventDefault():this._processPaste()}_adjustPasteTarget(e,t,r){let n,i,o,s,a,l,u,c=this,h=c._targetRangeRefs,f=c._sheet,p=[],d=function(e,t){let r=0,n=e.topLeft,i=t.topLeft;return n.row>i.row?r=1:n.row<i.row?r=-1:n.col>i.col?r=1:n.col<i.col&&(r=-1),r};for(l=0;l<h.length;l+=1)o=h[l],a=e[l],s=o.topLeft,u={row:a.rows*t+s.row-1,col:a.cols*r+s.col-1},n=new RangeRef(s,u),p.push(n);1===p.length?i=f.range(n):(p.sort(d),i=f.range(new UnionRef(p))),i.select(),c._range=i,c._state=c._range.getState()}_processPaste(){let e,t=this,r=t._sheet,n=t._clipboardContent,i=t._range,o=n.data,s=o.length,a=o[0].length,l=t._targetRangeRefs,u=t._targetRanges(s,a),c=this._clipboard.pasteRef();(c.bottomRight.row>=r._rows._count||c.bottomRight.col>=r._columns._count)&&r.resize(Math.max(c.bottomRight.row+1,r._rows._count),Math.max(c.bottomRight.col+1,r._columns._count)),t._adjustPasteTarget(u,s,a),r.batch((function(){for(e=0;e<l.length;e++)t._populateTargetRange(l[e],s,a,u[e])}),{recalc:!0,ref:t._range._ref}),i._adjustRowHeight()}_populateTargetRange(e,t,r,n){let i,o,s,a=e.topLeft;for(o=0;o<n.rows;o++)for(s=0;s<n.cols;s++)i=this._sheet.range(a.row+t*o,a.col+r*s),i.setState(this._clipboardContent,this._clipboard)}_targetRangeDimensions(e,t,r){let n=e.topLeft,i=e.bottomRight,o=i.row-n.row+1,s=i.col-n.col+1,a=1,l=1;return o%t==0&&s%r==0&&(a=o/t,l=s/r),{rows:a,cols:l}}_targetRanges(e,t){let r,n=this._targetRangeRefs,i=[];for(r=0;r<n.length;r++)i.push(this._targetRangeDimensions(n[r],e,t));return i}}class AdjustRowHeightCommand extends Command{exec(){let e=this.options,t=this._workbook.activeSheet();(e.range||t.range(e.rowIndex))._adjustRowHeight()}}class ToolbarPasteCommand extends Command{exec(){if(!detectClipboardAccess().paste)return{reason:"error",type:"useKeyboard"};this._workbook._view.clipboard.focus(),document.execCommand("paste")}}class CutCommand extends Command{constructor(e){super(e),this._eventType="cut",this._clipboard=e.workbook.clipboard(),this._event=e.event}exec(){let e,t,r=this._clipboard.canCopy(),n=[];if(!r.canCopy)return r.menuInvoked?{reason:"error",type:"useKeyboard"}:r.multiSelection?{reason:"error",type:"unsupportedSelection"}:void 0;let i=this._workbook.activeSheet().selection();if("cut"===this._eventType){if(!i.enable())return this._event.preventDefault(),{reason:"error",type:"cannotModifyDisabled"};this.getState()}if(this._workbook.trigger(this._eventType,{range:i}))this._event.preventDefault();else if("cut"===this._eventType){if(e=i.values(),e.forEach((function(e){t=[],e.forEach((function(){t.push({})})),n.push(t)})),i.sheet().trigger("changing",{data:n,range:i,changeType:COMMAND_TYPES.CUT}))return;this._clipboard.cut()}else this._clipboard.copy()}undo(){let e=this.range();e.sheet().trigger("changing",{data:this._state.data,range:e,changeType:COMMAND_TYPES.CUT})||this.setState(this._state)}}class CopyCommand extends CutCommand{constructor(e){super(e),this._eventType="copy",this.undo=noop}}function detectClipboardAccess(){return{copy:!!document.queryCommandSupported&&document.queryCommandSupported("copy"),cut:!!document.queryCommandSupported&&document.queryCommandSupported("cut"),paste:!!document.queryCommandSupported&&document.queryCommandSupported("paste")}}class ToolbarCopyCommand extends Command{constructor(e){super(e),this._clipboard=e.workbook.clipboard(),this.cannotUndo=!0}exec(){if(!detectClipboardAccess().copy)return{reason:"error",type:"useKeyboard"};document.execCommand("copy")}}class AutoFillCommand extends Command{constructor(e){super(e)}origin(e){this._origin=e}exec(){let e,t=this.range();if(!t.enable())return{reason:"error",type:"rangeDisabled"};if(t.intersectingArrayFormula())return{reason:"error",type:"intersectsArray"};this.getState();try{if(e=t._previewFillFrom(this._origin),t.sheet().trigger("changing",{data:e.props,range:e.dest,changeType:COMMAND_TYPES.AUTO_FILL}))return;e.dest._properties(e.props,!0)}catch(e){if(e instanceof Range$1.FillError)return{reason:"error",type:e.code};throw e}}undo(){let e=this.range(),t=this._state;e.sheet().trigger("changing",{data:t.data,range:e,changeType:COMMAND_TYPES.AUTO_FILL})||this.setState(this._state)}}class ToolbarCutCommand extends Command{constructor(e){super(e),this._clipboard=e.workbook.clipboard(),this.cannotUndo=!0}exec(){if(!detectClipboardAccess().copy)return{reason:"error",type:"useKeyboard"};document.execCommand("cut")}}class FilterCommand extends Command{undo(){this.range().filter(this._state)}exec(){let e=this.range();this._state=e.hasFilter(),e.filter(!this._state)}}class SortCommand extends Command{undo(){this.range().sheet().setState(this._state)}exec(){let e=this.range(),t=e.sheet(),r=t.activeCell(),n=this.options.sheet?r.topLeft.col:this.options.column||0,i="asc"===this.options.value;this._state=t.getState(),this.options.sheet&&(e=this.expandRange());let o=e.cantSort();if(o)return{reason:"error",type:o.code};e.sort({column:n,ascending:i})}expandRange(){let e=this.range().sheet();return new Range$1(e._sheetRef,e)}}class ApplyFilterCommand extends Command{column(){return this.options.column||0}undo(){this.range().sheet().clearFilter(this.column()),this._state.length&&this.range().filter(this._state)}getState(){let e=this.range().sheet().filter();e&&(this._state=e.columns.filter(function(e){return e.index===this.column()}.bind(this)))}exec(){let e,t,r=this.range(),n=this.column(),i=r.sheet().filter(),o=!1;this.options.valueFilter?t={column:n,filter:new ValueFilter(this.options.valueFilter)}:this.options.customFilter&&(t={column:n,filter:new CustomFilter(this.options.customFilter)}),this.getState(),i&&i.ref.eq(r._ref)&&i.columns.length?(i.columns.forEach((function(e){e.index===n&&(o=!0)})),e=i.columns.map((function(e){return e.index===n?t:{column:e.index,filter:e.filter}})),o||e.push(t)):e=t,r.filter(e)}}class ClearFilterCommand extends ApplyFilterCommand{exec(){let e=this.range(),t=this.column();this.getState(),e.clearFilter(t)}}class HideLineCommand extends Command{constructor(e){super(e),this.axis=e.axis}undo(){this.range().sheet().setAxisState(this._state)}exec(){let e=this.range().sheet();this._state=e.getAxisState(),"row"===this.axis?e.axisManager().hideSelectedRows():e.axisManager().hideSelectedColumns()}}class UnHideLineCommand extends HideLineCommand{exec(){let e=this.range().sheet();this._state=e.getAxisState(),"row"===this.axis?e.axisManager().unhideSelectedRows():e.axisManager().unhideSelectedColumns()}}class DeleteCommand extends Command{exec(){this._expandedRange=this._expand(this.range()),this._state=this._expandedRange.getState(),this._indexes=this._exec(this._expandedRange.sheet())}undo(){let e=this,t=e._expandedRange,r=t.sheet();r.batch((function(){e._indexes.forEach((function(t){e._undoOne(r,t),r._restoreModifiedFormulas(t.formulas)})),t.setState(e._state)}),{layout:!0,recalc:!0,ref:t._ref,isValue:!0})}}class DeleteRowCommand extends DeleteCommand{_expand(e){return e.resize({left:-1/0,right:1/0})}_exec(e){return e.axisManager().deleteSelectedRows()}_undoOne(e,t){e.insertRow(t.index),e.rowHeight(t.index,t.height)}}class DeleteColumnCommand extends DeleteCommand{_expand(e){return e.resize({top:-1/0,bottom:1/0})}_exec(e){return e.axisManager().deleteSelectedColumns()}_undoOne(e,t){e.insertColumn(t.index),e.columnWidth(t.index,t.width)}}class AddCommand extends Command{constructor(e){super(e),this._value=e.value}undo(){let e=this,t=e.range().sheet();t.batch((function(){for(let r=e._pos.count;--r>=0;)e._undoOne(t,e._pos.base)}),{layout:!0,recalc:!0})}}class AddColumnCommand extends AddCommand{exec(){let e=this._value,t=this.range().sheet();this._pos="left"===e?t.axisManager().addColumnLeft():t.axisManager().addColumnRight()}_undoOne(e,t){e.deleteColumn(t)}}class AddRowCommand extends AddCommand{exec(){let e=this._value,t=this.range().sheet();this._pos="above"===e?t.axisManager().addRowAbove():t.axisManager().addRowBelow()}_undoOne(e,t){e.deleteRow(t)}}class EditValidationCommand extends Command{constructor(e){super(e),this._value=e.value}exec(){let e=this,t=e.range().sheet();if(this.getState(),!t.trigger("changing",{data:e._value,range:e.range(),changeType:COMMAND_TYPES.VALIDATION}))try{t.withCultureDecimals((function(){e.range().validation(e._value)}))}catch(e){if(e instanceof calc.runtime.ParseError)return{title:"Error in formula",body:e+"",reason:"error"};throw e}}undo(){let e=this.range(),t=this._state;e.sheet().trigger("changing",{data:t.data[0][0].validation,range:e,changeType:COMMAND_TYPES.VALIDATION})||this.setState(this._state)}}class OpenCommand extends Command{constructor(e){super(e),this.cannotUndo=!0}exec(){if(null===this.options.file.name.match(/.xlsx$/i))return{reason:"error",type:"openUnsupported"};let e=this.options.workbook;e.fromFile(this.options.file);let t=e.excelImportErrors;t&&t.length&&e._view.openDialog("importError",{errors:t})}}class SaveAsCommand extends Command{constructor(e){super(e),this.cannotUndo=!0}exec(){let e=this.options.name+this.options.extension;if(".xlsx"===this.options.extension)return this.options.workbook.saveAsExcel({fileName:e});".pdf"===this.options.extension&&this.options.workbook.saveAsPDF(deepExtend(this.options.pdf,{workbook:this.options.workbook,fileName:e}))}}class NameCommand extends Command{constructor(e){super(e),this._name=e.name,this._value=e.value}getState(){this._state=this._workbook.nameDefinition(this._name)}setState(){this._workbook.nameDefinition(this._name,this._state),this._workbook.trigger("change",{recalc:!0})}}class DefineNameCommand extends NameCommand{exec(){this.getState();try{this._workbook.defineName(this._name,this._value),this._workbook.trigger("change",{recalc:!0})}catch(e){return{title:"Error",body:e+"",reason:"error"}}}}class DeleteNameCommand extends NameCommand{exec(){this.getState(),this._workbook.undefineName(this._name),this._workbook.trigger("change",{recalc:!0})}}var commands=Object.freeze({__proto__:null,AddColumnCommand:AddColumnCommand,AddCommand:AddCommand,AddRowCommand:AddRowCommand,AdjustDecimalsCommand:AdjustDecimalsCommand,AdjustRowHeightCommand:AdjustRowHeightCommand,ApplyFilterCommand:ApplyFilterCommand,AutoFillCommand:AutoFillCommand,BorderChangeCommand:BorderChangeCommand,BringToFrontCommand:BringToFrontCommand,ClearContentCommand:ClearContentCommand,ClearFilterCommand:ClearFilterCommand,ColumnWidthCommand:ColumnWidthCommand,Command:Command,CopyCommand:CopyCommand,CutCommand:CutCommand,DefineNameCommand:DefineNameCommand,DeleteColumnCommand:DeleteColumnCommand,DeleteCommand:DeleteCommand,DeleteDrawingCommand:DeleteDrawingCommand,DeleteNameCommand:DeleteNameCommand,DeleteRowCommand:DeleteRowCommand,DrawingCommand:DrawingCommand,DrawingUpdateCommand:DrawingUpdateCommand,EditCommand:EditCommand,EditValidationCommand:EditValidationCommand,FilterCommand:FilterCommand,FreezePanesCommand:FreezePanesCommand,GridLinesChangeCommand:GridLinesChangeCommand,HideLineCommand:HideLineCommand,HyperlinkCommand:HyperlinkCommand,InsertCommentCommand:InsertCommentCommand,InsertImageCommand:InsertImageCommand,MergeCellCommand:MergeCellCommand,NameCommand:NameCommand,OpenCommand:OpenCommand,PasteCommand:PasteCommand,PropertyChangeCommand:PropertyChangeCommand,PropertyCleanCommand:PropertyCleanCommand,ReorderDrawingsCommand:ReorderDrawingsCommand,RowHeightCommand:RowHeightCommand,SaveAsCommand:SaveAsCommand,SendToBackCommand:SendToBackCommand,SortCommand:SortCommand,TargetValueCommand:TargetValueCommand,TextWrapCommand:TextWrapCommand,ToolbarCopyCommand:ToolbarCopyCommand,ToolbarCutCommand:ToolbarCutCommand,ToolbarPasteCommand:ToolbarPasteCommand,UnHideLineCommand:UnHideLineCommand});class UndoRedoStack extends Observable{constructor(e){super(),this.options=e,this.events=["undo","redo"],this.clear()}push(e){this.stack=this.stack.slice(0,this.currentCommandIndex+1),this.currentCommandIndex=this.stack.push(e)-1}undo(){if(this.canUndo()){let e=this.stack[this.currentCommandIndex--];e.undo(),this.trigger("undo",{command:e})}}redo(){if(this.canRedo()){let e=this.stack[++this.currentCommandIndex];e.redo(),this.trigger("redo",{command:e})}}clear(){this.stack=[],this.currentCommandIndex=-1}canUndo(){return this.currentCommandIndex>=0}canRedo(){return this.currentCommandIndex!==this.stack.length-1}}let STRING=String.fromCharCode,ENTITIES={amp:38,lt:60,gt:62,quot:34,apos:39,nbsp:160};function CODE(e){let t=[];for(let r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t}function UCS2(e,t){t>65535?(t-=65536,e.push(t>>>10&1023|55296,56320|1023&t)):e.push(t)}let START_CDATA=CODE("<![CDATA["),END_CDATA=CODE("]]>"),END_COMMENT=CODE("--\x3e"),START_COMMENT=CODE("!--"),END_SHORT_TAG=CODE("/>"),END_TAG=CODE("</"),END_DECLARATION=CODE("?>"),QUESTION_MARK=CODE("?"),LESS_THAN=CODE("<"),GREATER_THAN=CODE(">"),SEMICOLON=CODE(";"),EQUAL=CODE("="),AMPERSAND=CODE("&"),QUOTE=CODE('"'),APOSTROPHE=CODE("'"),SHARP=CODE("#"),LOWERCASE_X=CODE("x"),UPPERCASE_X=CODE("X"),EXIT={};function parse$1(e,t){let r=0,n=[],i={is:function(e){let t=n.length,r=e.length;for(;--t>=0&&--r>=0;)if(n[t].$tag!==e[r]&&"*"!==e[r])return!1;return r<0?n[n.length-1]:null},exit:function(){throw EXIT},stack:n};function o(t){let n=e[r++];240&n^240?224&n^224?192&n^192?t.push(n):UCS2(t,(31&n)<<6|63&e[r++]):UCS2(t,(15&n)<<12|(63&e[r++])<<6|63&e[r++]):UCS2(t,(3&n)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++])}function s(e){throw new Error(e+", at "+r)}function a(t){let n=[];for(;r<e.length&&t(e[r]);)n.push(e[r++]);return n}function l(e){return STRING.apply(0,a(e))}function u(){a(f)}function c(t){let n=r;for(let i=0;i<t.length;++i)if(e[r++]!==t[i])return r=n,!1;return t}function h(e){c(e)||s("Expecting "+e.join(", "))}function f(e){return 9===e||10===e||13===e||32===e}function p(e){return e>=48&&e<=57}function d(e){return e>=48&&e<=57||(e|=32)>=97&&e<=102}function m(e){return 58===e||95===e||(e|=32)>=97&&e<=122}function g(e){return 45===e||p(e)||m(e)}function C(){let t,i;c(QUESTION_MARK)?(b("decl",v(),w()),h(END_DECLARATION)):c(START_COMMENT)?function(){let t=[];for(;r<e.length;){if(c(END_COMMENT))return b("comment",STRING.apply(0,t));o(t)}}():(t=v(),i=w(t),n.push(i),c(END_SHORT_TAG)?b("enter",t,i,!0):(h(GREATER_THAN),b("enter",t,i),function(t){let n=[];for(;r<e.length;){if(c(END_TAG))return n.length&&b("text",STRING.apply(0,n));if(c(START_CDATA))for(;r<e.length&&!c(END_CDATA);)o(n);else c(LESS_THAN)?(n.length&&b("text",STRING.apply(0,n)),C(),n=[]):c(AMPERSAND)?E(n):o(n)}s("Unclosed tag "+t)}(t),t!==v()&&s("Bad closing tag"),b("leave",t,i),u(),h(GREATER_THAN)),n.pop())}function v(){return m(e[r])||s("Expecting XML name"),l(g)}function y(){let t=c(QUOTE)||c(APOSTROPHE);t||s("Expecting string");let n=[];for(;r<e.length;){if(c(t))return STRING.apply(0,n);c(AMPERSAND)?E(n):o(n)}s("Unfinished string")}function E(e){let t;if(c(SHARP))t=c(LOWERCASE_X)||c(UPPERCASE_X)?parseInt(l(d),16):parseInt(l(p),10),isNaN(t)&&s("Bad numeric entity");else{let e=v();t=ENTITIES[e],void 0===t&&s("Unknown entity "+e)}UCS2(e,t),h(SEMICOLON)}function w(t){let n={$tag:t};for(;r<e.length;){u();let t=e[r];if(63===t||62===t||47===t)break;n[v()]=(h(EQUAL),y())}return n}function b(e,r,n,o){let s=t&&t[e];s&&s.call(i,r,n,o)}let _=[];for(o(_),65279!==_[0]&&(r=0);r<e.length;)u(),h(LESS_THAN),C(),u()}const parseXML=function(){try{return parse$1.apply(this,arguments)}catch(e){if(e!==EXIT)throw e}};class Deferred{constructor(){this._progressHandlers=[],this._resolved=!1,this._rejected=!1,this.promise=new window.Promise(((e,t)=>{this._resolve=t=>{this._resolved||this._rejected||(this._resolved=!0,e(t))},this._reject=e=>{this._resolved||this._rejected||(this._rejected=!0,t(e))}}))}resolve(e){return this._resolve(e),this}reject(e){return this._reject(e),this}notify(e){this._resolved||this._rejected||this._progressHandlers.forEach((t=>t(e)))}progress(e){return this._progressHandlers.push(e),this}then(e,t,r){return r&&this.progress(r),this.promise.then(e,t)}promise(){return this.promise}}let MAP_EXCEL_OPERATOR={greaterThanOrEqual:"greaterThanOrEqualTo",lessThanOrEqual:"lessThanOrEqualTo"},ERROR_LOG=null;function readExcel(e,t,r){let n=new FileReader;n.onload=async function(e){JSZip.loadAsync(e.target.result).then((async e=>await readWorkbook(e,t,r)))},n.readAsArrayBuffer(e)}let SEL_CELL=["sheetData","row","c"],SEL_COL=["cols","col"],SEL_DEFINED_NAME=["definedNames","definedName"],SEL_FORMULA=["sheetData","row","c","f"],SEL_MERGE=["mergeCells","mergeCell"],SEL_PANE=["sheetViews","sheetView","pane"],SEL_ROW=["sheetData","row"],SEL_SELECTION=["sheetViews","sheetView","selection"],SEL_SHEET=["sheets","sheet"],SEL_STRING=["sheetData","row","c","is"],SEL_TEXT=["t"],SEL_SHARED_STRING=["si"],SEL_VALUE=["sheetData","row","c","v"],SEL_VIEW=["bookViews","workbookView"],SEL_SHEET_VIEW=["sheetViews","sheetView"],SEL_HYPERLINK=["hyperlinks","hyperlink"],SEL_PROTECTION=["sheetProtection"],SEL_VALIDATION=["dataValidations","dataValidation"],SEL_VALIDATION_FORMULA1=["dataValidations","dataValidation","formula1"],SEL_VALIDATION_FORMULA2=["dataValidations","dataValidation","formula2"],SEL_VALIDATION_INSANE=["x14:dataValidations","x14:dataValidation"],SEL_VALIDATION_SQREF_INSANE=["x14:dataValidations","x14:dataValidation","xm:sqref"],SEL_VALIDATION_FORMULA1_INSANE=["x14:dataValidations","x14:dataValidation","x14:formula1","xm:f"],SEL_VALIDATION_FORMULA2_INSANE=["x14:dataValidations","x14:dataValidation","x14:formula2","xm:f"],SEL_COMMENT=["commentList","comment"],SEL_AUTHOR=["authors","author"],SEL_COMMENT_TEXT=["t"];function xl(e){return/^\//.test(e)?e=e.substr(1):/^xl\//.test(e)||(e="xl/"+e),e}async function readWorkbook(e,t,r){ERROR_LOG=t.excelImportErrors=[];let n=await readStrings(e),i=await readRelationships(e,"_rels/workbook.xml"),o=await readTheme(e,i.byType.theme[0]),s=await readStyles(e,o),a=[],l=0;await parse(e,"xl/workbook.xml",{enter:function(r,o){if(this.is(SEL_SHEET)){let r=o["r:id"],l=i.byId[r],u=o.name,c=o.state,h=sheetDimensions(i.bytes[l]);t.options.columnWidth=h.columnWidth||t.options.columnWidth,t.options.rowHeight=h.rowHeight||t.options.rowHeight,a.push({workbook:t,zip:e,strings:n,styles:s,file:l,options:{state:c,name:u,rows:Math.max(t.options.rows||0,h.rows),columns:Math.max(t.options.columns||0,h.cols),columnWidth:h.columnWidth,rowHeight:h.rowHeight}})}else this.is(SEL_VIEW)&&o.activeTab&&(l=integer(o.activeTab))},text:function(e){let r=this.is(SEL_DEFINED_NAME);if(r&&!bool(r.function)&&!bool(r.vbProcedure)){let n=r.localSheetId,i=null;null!=n&&(i=a[n].options.name);let o=r.name;"_xlnm._FilterDatabase"!==o&&(i&&(o="'"+i.replace(/\'/g,"\\'")+"'!"+o),withErrorLog(i,null,(function(){t.defineName(o,e,bool(r.hidden))}),"reading user-defined name: "+o))}}});let u=new Deferred;u.progress((function(e){r&&r.notify(e)})).then((function(){let e=t.sheets();recalcSheets(e),t.activeSheet(e[l]),r&&r.resolve()})),loadSheets(a,t,u)}function loadSheets(e,t,r){let n=window.Promise.resolve();for(let i=0;i<e.length;i++)!function(i,o){n=n.then((function(){let n=t.insertSheet(i.options);n.suspendChanges(!0);let s=queueSheet(n,i),a={sheet:n,progress:1===o?1:o/(e.length-1)};return s.then((function(){r.notify(a)})),s}))}(e[i],i);n.then((function(){r.resolve()}))}function queueSheet(e,t){let r=new Deferred;return setTimeout((async function(){await readSheet(t.zip,t.file,e,t.strings,t.styles),r.resolve()}),0),r}function recalcSheets(e){for(let t=0;t<e.length;t++)e[t].suspendChanges(!1).triggerChange({recalc:!0})}function sheetDimensions(e){let t,r={rows:0,cols:0};return parseXML(e,{enter:function(e,n){"dimension"===e?(t=calc.parseReference(n.ref),t.bottomRight&&(r.cols=t.bottomRight.col+1,r.rows=t.bottomRight.row+1)):"sheetFormatPr"===e?(n.defaultColWidth&&(r.columnWidth=toColWidth(parseFloat(n.defaultColWidth))),n.defaultRowHeight&&(r.rowHeight=toRowHeight(parseFloat(n.defaultRowHeight)))):this.is(SEL_ROW)&&n.r?r.rows=Math.max(r.rows,+n.r):this.is(SEL_CELL)&&n.r&&(t=calc.parseReference(n.r),r.rows=Math.max(r.rows,t.row+1),r.cols=Math.max(r.cols,t.col+1))}}),r}function toColWidth(e){return 7*((256*e+Math.floor(128/7))/256)}function toRowHeight(e){return e*(4/3)}async function readSheet(e,t,r,n,i){let o,s,a,l,u,c,h,f,p,d,m,g,C,v,y={},E=r._columns._count,w=null,b=t.replace(/worksheets\//,"worksheets/_rels/"),_=await readRelationships(e,b),A=[],R=[];if(ERROR_LOG=r._workbook.excelImportErrors,t=xl(t),await parse(e,t,{enter:function(e,t,n){let i;if(this.is(SEL_FORMULA))n&&"shared"===t.t&&null!=t.si&&(l=r.range(y[t.si])._get("formula"));else if(this.is(SEL_CELL)){a=null,l=null,o=t.r,u=null,null==o&&(o=calc.parseReference(w),o.col++,o=o.toString()),w=o,s=t.t;let e=t.s;null!=e&&R.push({ref:o,sty:+e})}else if(this.is(SEL_MERGE))r.range(t.ref).merge();else if(this.is(SEL_COL)){let e,n=integer(t.min)-1,i=Math.min(E,integer(t.max))-1;if(t.width&&(e=toColWidth(parseFloat(t.width)),0!==e&&r._columns.values.value(n,i,e)),"1"===t.hidden||0===e)for(let e=n;e<=i;e++)r.hideColumn(e);null!=t.style&&R.unshift({ref:new RangeRef(new CellRef(-1/0,n),new CellRef(1/0,i)),sty:+t.style})}else if(this.is(SEL_ROW)){let e,n=integer(t.r)-1;t.ht&&(e=toRowHeight(parseFloat(t.ht)),0!==e&&r._rows.values.value(n,n,e)),"1"!==t.hidden&&0!==e||r.hideRow(n)}else if(this.is(SEL_SELECTION)){if(t.activeCell){let e=calc.parseReference(t.activeCell);r.select(e,!0)}}else if(this.is(SEL_PANE))t.state&&t.state.indexOf("frozen")>-1&&(t.xSplit&&r.frozenColumns(integer(t.xSplit)),t.ySplit&&r.frozenRows(integer(t.ySplit)));else if(this.is(SEL_SHEET_VIEW))r.showGridLines(bool(t.showGridLines,!0));else if(this.is(SEL_HYPERLINK)){let e=t["r:id"],n=_.byId[e];n&&r.range(t.ref).link(n)}else this.is(SEL_PROTECTION)?t.sheet&&r.range(SHEETREF).enable(!1):this.is(["autoFilter"])?(p=t.ref,n&&x()):p&&(this.is(["filterColumn"])?d=parseInt(t.colId,10):this.is(["customFilters"])?(m=bool(t.and)?"and":"or",g=[]):this.is(["customFilter"])?(i=getCustomFilter(t.operator,t.val),i&&g.push({operator:i.operator,value:i.value})):this.is(["dynamicFilter"])?A.push({column:d,filter:new DynamicFilter({type:dynamicFilterType(t.type)})}):this.is(["top10"])?A.push({column:d,filter:new TopFilter({value:getFilterVal(t.val),type:(c=bool(t.percent),h=bool(t.top),c&&h?"topPercent":h?"topNumber":c?"bottomPercent":"bottomNumber")})}):this.is(["filters"])?(C=bool(t.blank),v=[]):this.is(["filter"])&&v.push(getFilterVal(t.val)));var c,h},leave:function(e,t){if(this.is(SEL_FORMULA))l||"shared"!==t.t||null==t.si||(l=r.range(y[t.si])._get("formula"));else if(this.is(SEL_CELL)){if(null!=l){withErrorLog(r,u||o,(function(){r.range(u||o).formula(l,c)}),"parsing formula")&&r.range(u||o).value(l).background("#ffaaaa")}else if(null!=a){let e=r.range(o);e._get("formula")||(s&&"n"!==s?"s"===s?a=n[integer(a)]:"b"===s?a="1"===a:"d"===s&&(a=intl().parseDate(a)):a=parseFloat(a),null!=a&&e.value(a))}}else this.is(SEL_VALIDATION)||this.is(SEL_VALIDATION_INSANE)?function(){let e=calc.parseSqref(t.sqref),n=t.type.toLowerCase(),i=t.operator;/^(?:whole|decimal)$/.test(n)?n="number":"list"===n&&(i="list"),!i&&/^(?:number|date)$/.test(n)&&(i="between"),e.forEach((function(e){withErrorLog(r,e,(function(){r.range(e).validation({type:bool(t.showErrorMessage,!0)?"reject":"warning",from:h,to:f,dataType:n,comparerType:MAP_EXCEL_OPERATOR[i]||i,allowNulls:bool(t.allowBlank),showButton:bool(t.showDropDown)||"date"===n||"list"===n,messageTemplate:t.error,titleTemplate:t.errorTitle})}),"parsing validation")}))}():"cols"===e?r._columns._refresh():"sheetData"===e?r._rows._refresh():"autoFilter"===e?x():p&&("customFilters"===e?A.push({column:d,filter:new CustomFilter({logic:m,criteria:g})}):"filters"===e&&A.push({column:d,filter:new ValueFilter({values:v,blanks:C})}))},text:function(e){let t;this.is(SEL_VALUE)||this.is(SEL_STRING)?a=e:(t=this.is(SEL_FORMULA))?(l=e,c="array"===t.t,c?u=t.ref:"shared"===t.t&&(y[t.si]=o)):this.is(SEL_VALIDATION_FORMULA1)||this.is(SEL_VALIDATION_FORMULA1_INSANE)?h=e:this.is(SEL_VALIDATION_FORMULA2)||this.is(SEL_VALIDATION_FORMULA2_INSANE)?f=e:this.is(SEL_VALIDATION_SQREF_INSANE)&&(this.stack[this.stack.length-2].sqref=e)}}),R.forEach((({ref:e,sty:t})=>applyStyle(r,e,i,t))),_.byType.comments){let n=relative_file(t,_.byType.comments[0]);await readComments(e,n,r)}if(_.byType.drawing){let n=relative_file(t,_.byType.drawing[0]);await readDrawings(e,n,r)}function x(){r.range(p).filter(A),p=null}}function getContentType(e){let t=/\.([^.]+)$/.exec(e);if(t&&t[1])return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",wmf:"image/wmf"}[t[1].toLowerCase()]}function getFileName(e){let t=/[^/]+$/.exec(e);return t&&t[0]}async function readDrawings(e,t,r){let n,i,o,s,a=["xdr:twoCellAnchor"],l=["xdr:ext"],u=["xdr:oneCellAnchor"],c=["xdr:from"],h=["xdr:to"],f=["xdr:row"],p=["xdr:col"],d=["xdr:rowOff"],m=["xdr:colOff"],g=["xdr:blipFill","a:blip"],C=t.replace(/drawings\//,"drawings/_rels/"),v=await readRelationships(e,C);if(v.byType.image){let n=Object.keys(v.byId);for(let i=0;i<n.length;++i){let o=n[i],s=relative_file(t,v.byId[o]),a=getContentType(s);if(a){let t=await e.file(s).async("arraybuffer"),n=getFileName(s),i=n&&!browser.edge?new window.File([t],n,{type:a}):new window.Blob([t],{type:a});v.byId[o]=r._workbook.addImage(i)}}}await parse(e,t,{enter:function(e,t){if(this.is(a)||this.is(u))n={};else if(this.is(c)||this.is(h))i={};else if(this.is(g)){let e=t["r:embed"];n.image=v.byId[e]}else this.is(l)&&(o=excelToPixels(parseFloat(t.cx)),s=excelToPixels(parseFloat(t.cy)))},leave:function(){if(this.is(c))n.topLeftCell=new CellRef(i.row,i.col),n.offsetX=excelToPixels(i.colOffset),n.offsetY=excelToPixels(i.rowOffset);else if(this.is(h))n.brCell=new CellRef(i.row,i.col),n.brX=excelToPixels(i.colOffset),n.brY=excelToPixels(i.rowOffset);else if(this.is(a)&&n.image){let e=r._columns.sum(0,n.topLeftCell.col-1)+n.offsetX,t=r._rows.sum(0,n.topLeftCell.row-1)+n.offsetY,i=r._columns.sum(0,n.brCell.col-1)+n.brX,a=r._rows.sum(0,n.brCell.row-1)+n.brY;r.addDrawing({topLeftCell:n.topLeftCell,offsetX:n.offsetX,offsetY:n.offsetY,width:null!=o?o:i-e,height:null!=s?s:a-t,image:n.image,opacity:1})}else this.is(u)&&n.image&&r.addDrawing({topLeftCell:n.topLeftCell,offsetX:n.offsetX,offsetY:n.offsetY,width:o,height:s,image:n.image,opacity:1})},text:function(e){this.is(f)?i.row=parseFloat(e):this.is(p)?i.col=parseFloat(e):this.is(d)?i.rowOffset=parseFloat(e):this.is(m)&&(i.colOffset=parseFloat(e))}})}async function readComments(e,t,r){let n,i,o=[];await parse(e,t,{enter:function(e,t){this.is(SEL_COMMENT)?i={author:o[t.authorId],ref:t.ref,text:""}:this.is(SEL_AUTHOR)&&(n="")},leave:function(){this.is(SEL_COMMENT)?r.range(i.ref).comment(i.text):this.is(SEL_AUTHOR)&&o.push(n)},text:function(e){this.is(SEL_COMMENT_TEXT)?i.text+=e:this.is(SEL_AUTHOR)&&(n+=e)}})}function getCustomFilter(e,t){let r={equal:"eq",notEqual:"ne",greaterThan:"gt",greaterThanOrEqual:"gte",lessThan:"lt",lessThanOrEqual:"lte"}[e];return t=getFilterVal(t),r&&"number"==typeof t?{operator:r,value:t}:"notEqual"!==e&&e||"string"!=typeof t?void 0:{operator:e?"doesnotmatch":"matches",value:t}}function dynamicFilterType(e){return{Q1:"quarter1",Q2:"quarter2",Q3:"quarter3",Q4:"quarter4",M1:"january",M2:"february",M3:"march",M4:"april",M5:"may",M6:"june",M7:"july",M8:"august",M9:"september",M10:"october",M11:"november",M12:"december"}[e.toUpperCase()]||e}function getFilterVal(e){let t=parseFloat(e);return isNaN(t)||t!==e?e:t}function withErrorLog(e,t,r,n){try{return r(),!1}catch(r){let i={context:n,error:String(r)};return e&&e.name?i.sheet=e.name():e&&(i.sheet=e),t&&(i.location=String(t)),ERROR_LOG.push(i),!0}}let BORDER_WIDTHS={none:0,thin:1,medium:2,dashed:1,dotted:1,thick:3,double:3,hair:1,mediumDashed:2,dashDot:1,mediumDashDot:2,dashDotDot:1,mediumDashDotDot:2,slantDashDot:1},DEFAULT_FORMATS={0:"General",1:"0",2:"0.00",3:"#,##0",4:"#,##0.00",9:"0%",10:"0.00%",11:"0.00E+00",12:"# ?/?",13:"# ??/??",14:"mm-dd-yy",15:"d-mmm-yy",16:"d-mmm",17:"mmm-yy",18:"h:mm AM/PM",19:"h:mm:ss AM/PM",20:"h:mm",21:"h:mm:ss",22:"m/d/yy h:mm",37:"#,##0 ;(#,##0)",38:"#,##0 ;[Red](#,##0)",39:"#,##0.00;(#,##0.00)",40:"#,##0.00;[Red](#,##0.00)",45:"mm:ss",46:"[h]:mm:ss",47:"mmss.0",48:"##0.0E+0",49:"@"};function applyStyle(e,t,r,n){let i,o,s=e.range(t),a=r.inlineStyles[n];var l;function u(e,t){let r=a[e];if(null!=r&&!r)return!1;if(o=a[t],i&&null==o){if(r=i[e],null!=r&&!r)return!1;o=i[t]}return null!=o}a.xfId&&(i=r.namedStyles[a.xfId]),u("applyBorder","borderId")&&function(e){function t(t,r){let n=e[t];if(!n)return;let i=BORDER_WIDTHS[n.style];if(!i)return;let o=n.color;null==o&&(o="#000");let a={size:i,color:o};"diagonal"===t&&(a.type=n.up<<1|n.down),s._property(r,a)}t("left","borderLeft"),t("top","borderTop"),t("right","borderRight"),t("bottom","borderBottom"),t("diagonal","dBorders")}(r.borders[o]),u("applyFont","fontId")&&function(e){s.fontFamily(e.name),e.size&&s._property("fontSize",4*e.size/3);e.bold&&s.bold(!0);e.italic&&s.italic(!0);e.underline&&s.underline(!0);e.color&&s.color(e.color)}(r.fonts[o]),u("applyAlignment","textAlign")&&s.textAlign(o),u("applyAlignment","verticalAlign")&&s.verticalAlign(o),u("applyAlignment","indent")&&s.indent(o),u("applyAlignment","wrapText")&&s._property("wrap",o),u("applyFill","fillId")&&"solid"===(l=r.fills[o]).type&&s.background(l.color),u("applyNumberFormat","numFmtId")&&function(e){let t="string"==typeof e?e:e.formatCode;null==t||/^general$/i.test(t)||(t=t.replace(/^\[\$-[0-9]+\]/,""),s.format(t))}(r.numFmts[o]||DEFAULT_FORMATS[o]),u("applyProtection","protection")&&s.enable(!a.protection.locked)}function parse(e,t,r){return new window.Promise((n=>{let i=e.file(t);i?i.async("uint8array").then((e=>{parseXML(e,r),n()})):n()}))}async function readStrings(e){let t=[],r=null;return await parse(e,"xl/sharedStrings.xml",{leave:function(){this.is(SEL_SHARED_STRING)&&(t.push(r),r=null)},text:function(e){this.is(SEL_TEXT)&&(null==r&&(r=""),r+=e)}}),t}async function readRelationships(e,t){let r={byId:{},byType:{theme:[]},bytes:{}};await parse(e,xl(t)+".rels",{enter:function(e,t){if("Relationship"===e){r.byId[t.Id]=t.Target;let e=t.Type.match(/\w+$/)[0],n=r.byType[e]||[];n.push(t.Target),r.byType[e]=n}}});let n=[],i=[];Object.keys(r.byId).forEach((t=>{let o=r.byId[t],s=e.file(xl(o));s&&(n.push(o),i.push(s.async("uint8array")))}));let o=await window.Promise.all(i);return n.forEach(((e,t)=>r.bytes[e]=o[t])),r}let SEL_BORDER=["borders","border"],SEL_FILL=["fills","fill"],SEL_FONT=["fonts","font"],SEL_INLINE_STYLE=["cellXfs","xf"],SEL_NAMED_STYLE=["cellStyleXfs","xf"],SEL_NUM_FMT=["numFmts","numFmt"],INDEXED_COLORS=[toCSSColor("FF000000"),toCSSColor("FFFFFFFF"),toCSSColor("FFFF0000"),toCSSColor("FF00FF00"),toCSSColor("FF0000FF"),toCSSColor("FFFFFF00"),toCSSColor("FFFF00FF"),toCSSColor("FF00FFFF"),toCSSColor("FF000000"),toCSSColor("FFFFFFFF"),toCSSColor("FFFF0000"),toCSSColor("FF00FF00"),toCSSColor("FF0000FF"),toCSSColor("FFFFFF00"),toCSSColor("FFFF00FF"),toCSSColor("FF00FFFF"),toCSSColor("FF800000"),toCSSColor("FF008000"),toCSSColor("FF000080"),toCSSColor("FF808000"),toCSSColor("FF800080"),toCSSColor("FF008080"),toCSSColor("FFC0C0C0"),toCSSColor("FF808080"),toCSSColor("FF9999FF"),toCSSColor("FF993366"),toCSSColor("FFFFFFCC"),toCSSColor("FFCCFFFF"),toCSSColor("FF660066"),toCSSColor("FFFF8080"),toCSSColor("FF0066CC"),toCSSColor("FFCCCCFF"),toCSSColor("FF000080"),toCSSColor("FFFF00FF"),toCSSColor("FFFFFF00"),toCSSColor("FF00FFFF"),toCSSColor("FF800080"),toCSSColor("FF800000"),toCSSColor("FF008080"),toCSSColor("FF0000FF"),toCSSColor("FF00CCFF"),toCSSColor("FFCCFFFF"),toCSSColor("FFCCFFCC"),toCSSColor("FFFFFF99"),toCSSColor("FF99CCFF"),toCSSColor("FFFF99CC"),toCSSColor("FFCC99FF"),toCSSColor("FFFFCC99"),toCSSColor("FF3366FF"),toCSSColor("FF33CCCC"),toCSSColor("FF99CC00"),toCSSColor("FFFFCC00"),toCSSColor("FFFF9900"),toCSSColor("FFFF6600"),toCSSColor("FF666699"),toCSSColor("FF969696"),toCSSColor("FF003366"),toCSSColor("FF339966"),toCSSColor("FF003300"),toCSSColor("FF333300"),toCSSColor("FF993300"),toCSSColor("FF993366"),toCSSColor("FF333399"),toCSSColor("FF333333"),toCSSColor("FF000000"),toCSSColor("FFFFFFFF")];async function readStyles(e,t){let r={fonts:[],numFmts:{},fills:[],borders:[],namedStyles:[],inlineStyles:[]},n=null,i=null,o=null,s=null;function a(e){let t={borderId:integer(e.borderId),fillId:integer(e.fillId),fontId:integer(e.fontId),numFmtId:integer(e.numFmtId),pivotButton:bool(e.pivotButton),quotePrefix:bool(e.quotePrefix),xfId:integer(e.xfId)};function r(r){if(null!=e[r])return t[r]=bool(e[r])}return r("applyAlignment"),r("applyBorder"),r("applyFill"),r("applyFont"),r("applyNumberFormat"),r("applyProtection")&&(t.protection={locked:!0}),t}function l(e,r){if(e.rgb)return toCSSColor(e.rgb);if(e.indexed)return INDEXED_COLORS[integer(e.indexed)];if(e.theme){let n=t.colorScheme[integer(e.theme)];if(!n)return r;let i=parseColor(n);if(e.tint){i=i.toHSL();let t=parseFloat(e.tint);i.l=t<0?i.l*(1+t):i.l*(1-t)+(100-100*(1-t))}return i.toCssRgba()}}return await parse(e,"xl/styles.xml",{enter:function(e,t,u){if(this.is(SEL_NUM_FMT))r.numFmts[t.numFmtId]=t;else if(this.is(SEL_FONT))r.fonts.push(n={}),u&&(n=null);else if(n)"sz"===e?n.size=parseFloat(t.val):"name"===e?n.name=t.val:"b"===e?n.bold=bool(t.val,!0):"i"===e?n.italic=bool(t.val,!0):"u"===e?n.underline=null==t.val||"single"===t.val:"color"===e&&(n.color=l(t,null));else if(this.is(SEL_FILL))r.fills.push(i={}),u&&(i=null);else if(i)"patternFill"===e?i.type=t.patternType:("fgColor"===e&&"solid"===i.type||"bgColor"===e&&"solid"!==i.type)&&(i.color=l(t,INDEXED_COLORS[0]));else if(this.is(SEL_BORDER))r.borders.push(o={diagonalUp:+bool(t.diagonalUp,0),diagonalDown:+bool(t.diagonalDown,0)}),u&&(o=null);else if(o){if(/^(?:left|top|right|bottom|diagonal)$/.test(e)&&(o[e]={style:t.style||"none"},"diagonal"===e&&(o.diagonal.up=o.diagonalUp,o.diagonal.down=o.diagonalDown)),"color"===e){let e=this.stack[this.stack.length-2].$tag;o[e].color=l(t,INDEXED_COLORS[0])}}else this.is(SEL_NAMED_STYLE)?(s=a(t),r.namedStyles.push(s),u&&(s=null)):this.is(SEL_INLINE_STYLE)?(s=a(t),r.inlineStyles.push(s),u&&(s=null)):s&&("alignment"===e?(/^(?:left|center|right|justify)$/.test(t.horizontal)&&(s.textAlign=t.horizontal),/^(?:top|center|bottom)$/.test(t.vertical)&&(s.verticalAlign=t.vertical),null!=t.wrapText&&(s.wrapText=bool(t.wrapText)),null!=t.indent&&(s.indent=integer(t.indent))):"protection"==e&&(s.protection={locked:bool(t.locked)}))},leave:function(e){this.is(SEL_FONT)?n=null:this.is(SEL_FILL)?i=null:this.is(SEL_BORDER)?o=null:"xf"===e&&(s=null)}}),r}let SEL_SCHEME_RGBCLR=["a:clrScheme","*","a:srgbClr"],SEL_SCHEME_SYSCLR=["a:clrScheme","*","a:sysClr"];async function readTheme(e,t){let r=[],n={colorScheme:r},i=xl(t);function o(e,t,r){let n=e[t];e[t]=e[r],e[r]=n}return e.file(i)&&(await parse(e,i,{enter:function(e,t){this.is(SEL_SCHEME_SYSCLR)?r.push(toCSSColor("window"===t.val?"FFFFFFFF":"FF000000")):this.is(SEL_SCHEME_RGBCLR)&&r.push(toCSSColor("FF"+t.val))}}),r.length>3&&(o(r,0,1),o(r,2,3))),n}function integer(e){return null==e?null:parseInt(e,10)}function bool(e,t){return null==e?t:"true"===e||!0===e||1===e||"1"===e}function toCSSColor(e){let t=/^([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i.exec(e);return"rgba("+parseInt(t[2],16)+", "+parseInt(t[3],16)+", "+parseInt(t[4],16)+", "+parseInt(t[1],16)/255+")"}function relative_file(e,t){for(e=e.split(/\/+/),t=t.split(/\/+/),e.pop();t.length;){let r=t.shift();if(""===r)e=[];else{if("."===r)continue;".."===r?e.pop():e.push(r)}}return e.join("/")}function excelToPixels(e){return e/9525}const events$1=["cut","copy","paste","changing","change","contextmenu","excelImport","excelExport","insertSheet","removeSheet","selectSheet","renameSheet","insertRow","insertColumn","deleteRow","deleteColumn","hideRow","hideColumn","unhideRow","unhideColumn","select","changeFormat","dataBinding","dataBound","progress"];function loadBinary(e,t){let r=new XMLHttpRequest;r.onload=function(){t(r.response,r.getResponseHeader("Content-Type"))},r.onerror=function(){t(null)},r.open("GET",e),r.responseType="arraybuffer",r.send()}class Workbook extends Observable{constructor(e,t){super(),this.events=events$1,this.options=e,this._view=t,this._sheets=[],this._images={},this._imgID=0,this._sheetsSearchCache={},this._sheet=this.insertSheet({rows:this.options.rows,columns:this.options.columns,rowHeight:this.options.rowHeight,columnWidth:this.options.columnWidth,headerHeight:this.options.headerHeight,headerWidth:this.options.headerWidth,dataSource:this.options.dataSource}),this.undoRedoStack=new UndoRedoStack,this.undoRedoStack.bind(["undo","redo"],this._onUndoRedo.bind(this)),this._context=new FormulaContext(this),this._validationContext=new ValidationFormulaContext(this),this._names=Object.create(null),this.fromJSON(this.options)}clipboard(){return this._clipboard||(this._clipboard=new Clipboard(this)),this._clipboard}destroy(){this.unbind(),this._clipboard&&this._clipboard.destroy()}_sheetChanging(e){this.trigger("changing",e)&&e.preventDefault()}_sheetChange(e){this.trigger("change",e)}_sheetInsertRow(e){this.trigger("insertRow",{sheet:e.sender,index:e.index})&&e.preventDefault()}_sheetInsertColumn(e){this.trigger("insertColumn",{sheet:e.sender,index:e.index})&&e.preventDefault()}_sheetDeleteRow(e){this.trigger("deleteRow",{sheet:e.sender,index:e.index})&&e.preventDefault()}_sheetDeleteColumn(e){this.trigger("deleteColumn",{sheet:e.sender,index:e.index})&&e.preventDefault()}_sheetHideRow(e){this.trigger("hideRow",{sheet:e.sender,index:e.index})&&e.preventDefault()}_sheetHideColumn(e){this.trigger("hideColumn",{sheet:e.sender,index:e.index})&&e.preventDefault()}_sheetUnhideRow(e){this.trigger("unhideRow",{sheet:e.sender,index:e.index})&&e.preventDefault()}_sheetUnhideColumn(e){this.trigger("unhideColumn",{sheet:e.sender,index:e.index})&&e.preventDefault()}_sheetSelect(e){this.trigger("select",e)}_sheetDataBinding(e){this.trigger("dataBinding",{sheet:e.sender})&&e.preventDefault()}_sheetDataBound(e){this.trigger("dataBound",{sheet:e.sender})}_sheetProgress(e){let t=this;setTimeout((function(){t.trigger("progress",{toggle:e.toggle})}))}_sheetCommandRequest(e){this.trigger("commandRequest",e)}_inputForRef(e){let t=this;return t._sheet.withCultureDecimals((function(){return new Range$1(e,t._sheet).input()}))}_onUndoRedo(e){e.command.range().select()}execute(e){let t,r=Object.assign({},{workbook:this},e.options);this.options.getWorkbookCommand&&(t=this.options.getWorkbookCommand(e.command,r)),t=t||new commands[e.command](r);let n=this.activeSheet();r.origin&&t.origin(r.origin),r.operatingRange?t.range(r.operatingRange):t.range(n.selection()),r.editRange&&(t._editRange=r.editRange);let i=t.exec();return i&&"error"===i.reason||t.cannotUndo||this.undoRedoStack.push(t),this.cleanupImages(),i}resetFormulas(){this._sheets.forEach((function(e){e.resetFormulas()}))}resetValidations(){this._sheets.forEach((function(e){e.resetValidations()}))}refresh(e){e.recalc&&(this.resetFormulas(),this.resetValidations(),this._sheet.recalc(this._context),this._sheet.revalidate(this._validationContext))}activeSheet(e){if(void 0===e)return this._sheet;this.sheetByName(e.name())&&(this._sheet=e,e.triggerChange(ALL_REASONS))}moveSheetToIndex(e,t){let r=this.sheetIndex(e),n=this._sheets;-1!==r&&(this._sheetsSearchCache={},n.splice(t,0,n.splice(r,1)[0]),this.trigger("change",{sheetSelection:!0}))}insertSheet(e){let t,r=this,n="number"==typeof(e=e||{}).index?e.index:r._sheets.length,i=r._sheets;const o=this.options.messages;let s=function(e){e=e||1;let t=o.workbook.defaultSheetName+e;return r.sheetByName(t)?s(e+1):t};if(e.name&&r.sheetByName(e.name))return;this._sheetsSearchCache={},t=e.name||s();let a=new Sheet(e.rows||this.options.rows,e.columns||this.options.columns,e.rowHeight||this.options.rowHeight,e.columnWidth||this.options.columnWidth,e.headerHeight||this.options.headerHeight,e.headerWidth||this.options.headerWidth,e.defaultCellStyle||this.options.defaultCellStyle,e.createSheetDataSource||this.options.createSheetDataSource);return a._workbook=this,a._name(t),a._state(e.state),this._bindSheetEvents(a),i.splice(n,0,a),e.data&&a.fromJSON(e.data),e.dataSource&&a.setDataSource(e.dataSource),this.trigger("change",{sheetSelection:!0}),a}_bindSheetEvents(e){e.bind("changing",this._sheetChanging.bind(this)),e.bind("change",this._sheetChange.bind(this)),e.bind("insertRow",this._sheetInsertRow.bind(this)),e.bind("insertColumn",this._sheetInsertColumn.bind(this)),e.bind("deleteRow",this._sheetDeleteRow.bind(this)),e.bind("deleteColumn",this._sheetDeleteColumn.bind(this)),e.bind("hideRow",this._sheetHideRow.bind(this)),e.bind("hideColumn",this._sheetHideColumn.bind(this)),e.bind("unhideRow",this._sheetUnhideRow.bind(this)),e.bind("unhideColumn",this._sheetUnhideColumn.bind(this)),e.bind("select",this._sheetSelect.bind(this)),e.bind("commandRequest",this._sheetCommandRequest.bind(this)),e.bind("dataBinding",this._sheetDataBinding.bind(this)),e.bind("dataBound",this._sheetDataBound.bind(this)),e.bind("progress",this._sheetProgress.bind(this))}sheets(){return this._sheets.slice()}sheetByName(e){return this._sheets[this.sheetIndex(e)]}sheetByIndex(e){return this._sheets[e]}sheetIndex(e){let t=this._sheets,r=("string"==typeof e?e:e.name()).toLowerCase(),n=this._sheetsSearchCache[r];if(n>=0)return n;for(n=0;n<t.length;n++){let e=t[n].name().toLowerCase();if(this._sheetsSearchCache[e]=n,e===r)return n}return-1}renameSheet(e,t){let r=e.name().toLowerCase();if(t&&r!==t.toLowerCase()&&!this.sheetByName(t)&&(e=this.sheetByName(r))&&(this._sheetsSearchCache={},!this.trigger("renameSheet",{sheet:e,newSheetName:t})))return this._sheets.forEach((function(e){e._forFormulas((function(e){e.renameSheet(r,t)}))})),this.forEachName(function(e,n){e.nameref.renameSheet(r,t)&&(this.undefineName(n),e.name=e.nameref.print(),this.nameDefinition(e.name,e)),(e.value instanceof Ref||e.value instanceof calc.runtime.Formula)&&e.value.renameSheet(r,t)}.bind(this)),e._name(t),this.trigger("change",{sheetSelection:!0}),e}removeSheet(e){let t=this,r=t._sheets,n=e.name(),i=t.sheetIndex(e);if(1!==r.length&&!this.trigger("removeSheet",{sheet:e})&&(this._sheetsSearchCache={},i>-1))if(e.unbind(),r.splice(i,1),t.activeSheet().name()===n){let e=r[i===r.length?i-1:i];t.activeSheet(e)}else this.trigger("change",{recalc:!0,sheetSelection:!0})}_clearSheets(){for(let e=0;e<this._sheets.length;e++)this._sheets[e]._activeDrawing=[],this._sheets[e]._drawings=[],this._sheets[e].unbind();this._sheets=[],this._sheetsSearchCache={},this._names={},this._images={},this._imgID=0}_loadImages(){let e=this,t=Object.keys(e._images),r=t.length;function n(){--r<=0&&e.activeSheet().triggerChange({layout:!0})}r?t.forEach((function(t){let r=e._images[t];r.blob||loadBinary(r.url,(function(e,t){null!=e&&(r.blob=new Blob([e],{type:t}),delete r.url),n()}))})):n()}fromJSON(e){if(e.sheets){this._clearSheets(),e.images&&(this._imgID=0,this._images={},Object.keys(e.images).forEach((function(t){if(!isNaN(t)){let e=parseFloat(t);isFinite(e)&&(this._imgID=Math.max(this._imgID,e))}this._images[t]={url:e.images[t]}}),this),this._loadImages());for(let t=0;t<e.sheets.length;t++){let r=e.sheets[t],n=sheetParamsFromJSON(r,this.options),i=this.insertSheet({rows:n.rowCount,columns:n.columnCount,rowHeight:n.rowHeight,columnWidth:n.columnWidth,headerHeight:n.headerHeight,headerWidth:n.headerWidth,data:r});r.dataSource&&i.setDataSource(r.dataSource)}}e.activeSheet?this.activeSheet(this.sheetByName(e.activeSheet)):this.activeSheet(this._sheets[0]),e.names&&e.names.forEach((function(e){this.defineName(e.name,e.value,e.hidden)}),this)}toJSON(){this.resetFormulas(),this.resetValidations();let e=Object.keys(this._names).map((function(e){let t=this._names[e],r=t.value;return r=r instanceof Ref||r instanceof calc.runtime.Formula?r.print(0,0,!0):r instanceof CalcError?String(r):JSON.stringify(r),{value:r,hidden:t.hidden,name:t.name,sheet:t.nameref.sheet,localName:t.nameref.name}}),this);return{activeSheet:this.activeSheet().name(),sheets:this._sheets.map((function(e){return e.recalc(this._context),e.revalidate(this._validationContext),e.toJSON()}),this),names:e,images:{},columnWidth:this.options.columnWidth,rowHeight:this.options.rowHeight}}saveJSON(){let e=this,t=e.toJSON(),r=Object.keys(e._images).filter((function(t){return 1===e.usesImage(t)})),n=r.length;const i=[];return n&&r.forEach((function(r){let n=e._images[r];if(n.blob){const e=new Promise((e=>{let i=new FileReader;i.onload=function(){t.images[r]=i.result,e()},i.readAsDataURL(n.blob)}));i.push(e)}else t.images[r]=n.url})),Promise.all(i).then((()=>t))}fromFile(e){const t=new Deferred;return e&&!this.trigger("excelImport",{file:e,deferred:t})&&(this._clearSheets(),this._readExcel(e,this,t)),t.promise}_readExcel(e,t,r){readExcel(e,t,r)}saveAsExcel(e){let t=this;e=deepExtend({},t.options.excel,e);let r=t.toJSON();if(t.trigger("excelExport",{workbook:r}))return;let n=Object.keys(t._images).filter((function(e){return 1===t.usesImage(e)})),i=n.length,o=i?{}:null;const s=[];return i?(n.forEach((function(e){let r=t._images[e];if(r.blob){const t=new Promise((t=>{let n=new FileReader;n.onload=function(){o[e]={type:r.blob.type,name:r.blob.name,data:n.result},i--,t()},n.readAsArrayBuffer(r.blob)}));s.push(t)}else{const t=new Promise((t=>{loadBinary(r.url,(function(r,n){o[e]={type:n,data:r},i--,t()}))}));s.push(t)}})),Promise.all(s).then((()=>a()))):a();function a(){if(--i<=0){r.images=o;let t=new e.Workbook(r);const n=e.forceProxy?t.toDataURL():t.toBlob();return e.saveAs?n.then((t=>{e.saveAs(t,r.fileName||e.fileName,{proxyURL:e.proxyURL,forceProxy:e.forceProxy})})):n}return Promise.resolve()}}draw(e,t){"function"!=typeof e||t||(t=e,e={});let r=[],n=this._sheets;!function i(o){if(o<n.length)n[o].draw(SHEETREF,e,(function(e){r.push(e),i(o+1)}));else{let e=r[0];for(o=1;o<r.length;++o)e.children=e.children.concat(r[o].children);t(e)}}(0)}nameForRef(e,t){void 0===t&&(t=e.sheet),t=t.toLowerCase();let r=String(e);for(let e in this._names){let n=this._names[e],i=n.value;if(i instanceof Ref&&(!i.sheet||i.sheet&&t===i.sheet.toLowerCase())&&String(i)===r)return n}return{name:r}}defineName(e,t,r){let n=calc.parseNameDefinition(e,t);e=n.name.print(),this._names[e.toLowerCase()]={value:n.value,hidden:r,name:e,nameref:n.name}}undefineName(e){delete this._names[e.toLowerCase()]}nameValue(e){return(e=e.toLowerCase())in this._names?this._names[e].value:null}nameDefinition(e,t){return e=e.toLowerCase(),arguments.length>1&&(void 0===t?delete this._names[e]:this._names[e]=t),this._names[e]}forEachName(e){Object.keys(this._names).forEach((function(t){e(this._names[t],t)}),this)}adjustNames(e,t,r,n){e=e.toLowerCase(),Object.keys(this._names).forEach((function(i){let o=this._names[i],s=o.value;s instanceof Ref&&s.sheet.toLowerCase()===e?o.value=s.adjust(null,null,null,null,t,r,n):s instanceof calc.runtime.Formula&&s.adjust(e,t?"row":"col",r,n)}),this)}addImage(e){let t=String(++this._imgID);return this._images[t]="string"==typeof e?{url:e}:{blob:e},t}imageUrl(e){let t=this._images[e],r=t.url;return r||(r=t.url=window.URL.createObjectURL(t.blob)),r}cleanupImages(){Object.keys(this._images).forEach((function(e){if(!this.usesImage(e)){let t=this._images[e].url;t&&window.URL.revokeObjectURL(t),delete this._images[e]}}),this)}usesImage(e){let t,r=this._sheets;for(t=r.length;--t>=0;)if(r[t].usesImage(e))return 1;let n=this.undoRedoStack.stack;for(t=n.length;--t>=0;)if(n[t].usesImage(e))return 2;return!1}}function sheetParamsFromJSON(e,t){function r(e,t,r){return void 0!==e?e:void 0!==t?t:r}let n=r(e.rowCount,t.rows,200),i=r(e.columnCount,t.columns,50),o=r(e.rowHeight,t.rowHeight,20),s=r(e.columnWidth,t.columnWidth,64),a=r(e.headerHeight,t.headerHeight,20),l=r(e.headerWidth,t.headerWidth,32);if(void 0!==e.rows)for(let t=0;t<e.rows.length;++t){let o=e.rows[t],s=r(o.index,t);if(s>=n&&(n=s+1),o.cells)for(let e=0;e<o.cells.length;++e){let t=r(o.cells[e].index,e);t>=i&&(i=t+1)}}return{rowCount:n,columnCount:i,rowHeight:o,columnWidth:s,headerHeight:a,headerWidth:l}}const events=["cut","copy","paste","pdfExport","excelExport","excelImport","changing","change","render","removeSheet","selectSheet","renameSheet","insertRow","insertColumn","deleteRow","insertSheet","deleteColumn","hideRow","hideColumn","unhideRow","unhideColumn","select","changeFormat","dataBinding","dataBound","update","message","contextmenu"];class SpreadsheetWidget extends Widget{constructor(e,t){super(e,deepExtend({},options,t)),this.events=events,this.bind(this.events,this.options),intl({locale:this.options.locale,...this.options.intl}),initDynamicFilter(),this._view=new View(this.element,{messages:this.options.messages.view,toolbar:this.options.toolbar,sheetsbar:this.options.sheetsbar,formulaBarInputRef:this.options.formulaBarInputRef,formulaCellInputRef:this.options.formulaCellInputRef,nameBoxRef:this.options.nameBoxRef,createTabStrip:this.options.createTabStrip,createFilterMenu:this.options.createFilterMenu,createContextMenus:this.options.createContextMenus,createSheetBar:this.options.createSheetBar,getIconHTMLString:this.options.getIconHTMLString,openDialogCallback:this.openDialog.bind(this)}),this._workbook=new Workbook(this.options,this._view),this._controller=new Controller(this._view,this._workbook),this._autoRefresh=!0,this._bindWorkbookEvents(),this._bindViewEvents(),this._view.workbook(this._workbook),this._view.enableClipboard(!1),this.refresh(),this._view.enableClipboard(!0),this._resizeHandler=this.resize.bind(this),window.addEventListener("resize",this._resizeHandler),this._keyDownHandler=this._keyDown.bind(this),this.element.addEventListener("keydown",this._keyDownHandler)}get view(){return this._view}get workbook(){return this._workbook}_keyDown(e){let t=e.keyCode,r=e.ctrlKey||e.metaKey;if(this.trigger("keydown",e),t===keys.F11&&e.shiftKey)return this._view.sheetsbar.onAddSelect(),void e.preventDefault();if(e.altKey&&t===keys.PAGEDOWN){let e=this.sheetIndex(this.activeSheet()),t=this.sheetByIndex(e+1)?.name();t&&this._view.sheetsbar.onSheetSelect(t)}else if(e.altKey&&t===keys.PAGEUP){let e=this.sheetIndex(this.activeSheet()),t=this.sheetByIndex(e-1)?.name();t&&this._view.sheetsbar.onSheetSelect(t)}else{if(e.altKey&&t===keys.DELETE)return this._view.sheetsbar.onSheetRemove(this.activeSheet()._name()),void e.preventDefault();if(e.altKey&&t===keys.R)return this.options.createSheetEditor?.(),void e.preventDefault();if(r&&t===keys.B)this._handleTypographicalEmphasis("bold");else if(r&&t===keys.I)this._handleTypographicalEmphasis("italic");else if(r&&t===keys.U)this._handleTypographicalEmphasis("underline");else{if(e.altKey&&t===keys.H)return this._view.tabstrip?.select("home"),void e.preventDefault();if(e.altKey&&t===keys.N)return this._view.tabstrip?.select("insert"),void e.preventDefault();if(e.altKey&&t===keys.A)return this._view.tabstrip?.select("data"),void e.preventDefault();t===keys.F10&&(e.preventDefault(),this._view.tabstrip?.focus())}}}_handleTypographicalEmphasis(e){const t=this.activeSheet();t&&this.executeCommand({command:"PropertyChangeCommand",options:{property:e,value:!t.range(t.activeCell())[e]()}})}_resize(){this.refresh({layout:!0})}_workbookChanging(e){this.trigger("changing",e)&&e.preventDefault()}_workbookChange(e){if(this._autoRefresh&&this.refresh(e),e.recalc&&e.ref){let t=e.range||new Range$1(e.ref,this.activeSheet());this.trigger("change",{range:t})}}_workbookCut(e){this.trigger("cut",e)}_workbookCopy(e){this.trigger("copy",e)}_workbookPaste(e){this.trigger("paste",e)}activeSheet(e){return this._workbook.activeSheet(e)}moveSheetToIndex(e,t){return this._workbook.moveSheetToIndex(e,t)}insertSheet(e){return this._workbook.insertSheet(e)}sheets(){return this._workbook.sheets()}removeSheet(e){return this._workbook.removeSheet(e)}sheetByName(e){return this._workbook.sheetByName(e)}sheetIndex(e){return this._workbook.sheetIndex(e)}sheetByIndex(e){return this._workbook.sheetByIndex(e)}renameSheet(e,t){return this._workbook.renameSheet(e,t)}executeCommand(e){return this._controller.executeCommand(e)}refresh(e){return e||(e=ALL_REASONS),e.editorClose||(this._view.sheet(this._workbook.activeSheet()),this._controller.sheet(this._workbook.activeSheet()),this._workbook.refresh(e)),e.editorChange||(this._view.refresh(e),this._controller.refresh(),this._view.render(e),this.trigger("render")),this}openDialog(e,t){return this._view.openDialog(e,t)}autoRefresh(e){return void 0!==e?(this._autoRefresh=e,!0===e&&this.refresh(),this):this._autoRefresh}toJSON(){return this._workbook.toJSON()}fromJSON(e){e.sheets?(this._workbook.destroy(),this._workbook=new Workbook(deepExtend({},this.options,e)),this._bindWorkbookEvents(),this._view.workbook(this._workbook),this._controller.workbook(this._workbook),this.activeSheet(this.activeSheet())):this.refresh()}saveJSON(){return this._workbook.saveJSON()}fromFile(e){return this._workbook.fromFile(e)}saveAsPDF(e){this._workbook.saveAsPDF(deepExtend({},this.options.pdf,e,{workbook:this._workbook}))}saveAsExcel(e){return this._workbook.saveAsExcel(e)}draw(e,t){this._workbook.draw(e,t)}_workbookExcelExport(e){this.trigger("excelExport",e)&&e.preventDefault()}_workbookExcelImport(e){this.trigger("excelImport",e)&&e.preventDefault()}_workbookPdfExport(e){this.trigger("pdfExport",e)&&e.preventDefault()}_workbookInsertSheet(e){this.trigger("insertSheet",e)&&e.preventDefault()}_workbookRemoveSheet(e){this.trigger("removeSheet",e)&&e.preventDefault()}_workbookSelectSheet(e){this.trigger("selectSheet",e)&&e.preventDefault()}_workbookRenameSheet(e){this.trigger("renameSheet",e)&&e.preventDefault()}_workbookInsertRow(e){this.trigger("insertRow",e)&&e.preventDefault()}_workbookInsertColumn(e){this.trigger("insertColumn",e)&&e.preventDefault()}_workbookDeleteRow(e){this.trigger("deleteRow",e)&&e.preventDefault()}_workbookDeleteColumn(e){this.trigger("deleteColumn",e)&&e.preventDefault()}_workbookHideRow(e){this.trigger("hideRow",e)&&e.preventDefault()}_workbookHideColumn(e){this.trigger("hideColumn",e)&&e.preventDefault()}_workbookUnhideRow(e){this.trigger("unhideRow",e)&&e.preventDefault()}_workbookUnhideColumn(e){this.trigger("unhideColumn",e)&&e.preventDefault()}_workbookSelect(e){this.trigger("select",e)}_workbookChangeFormat(e){this.trigger("changeFormat",e)}_workbookDataBinding(e){this.trigger("dataBinding",e)&&e.preventDefault()}_workbookDataBound(e){this.trigger("dataBound",e)}_workbookProgress(){}_viewUpdate(e){this.trigger("update",e)}_viewMessage(e){this.trigger("message",e)}_onContextMenu(e){this.trigger("contextmenu",e)}_bindWorkbookEvents(){this._workbook.bind("cut",this._workbookCut.bind(this)),this._workbook.bind("copy",this._workbookCopy.bind(this)),this._workbook.bind("paste",this._workbookPaste.bind(this)),this._workbook.bind("changing",this._workbookChanging.bind(this)),this._workbook.bind("change",this._workbookChange.bind(this)),this._workbook.bind("excelExport",this._workbookExcelExport.bind(this)),this._workbook.bind("excelImport",this._workbookExcelImport.bind(this)),this._workbook.bind("pdfExport",this._workbookPdfExport.bind(this)),this._workbook.bind("insertSheet",this._workbookInsertSheet.bind(this)),this._workbook.bind("removeSheet",this._workbookRemoveSheet.bind(this)),this._workbook.bind("selectSheet",this._workbookSelectSheet.bind(this)),this._workbook.bind("renameSheet",this._workbookRenameSheet.bind(this)),this._workbook.bind("insertRow",this._workbookInsertRow.bind(this)),this._workbook.bind("insertColumn",this._workbookInsertColumn.bind(this)),this._workbook.bind("deleteRow",this._workbookDeleteRow.bind(this)),this._workbook.bind("deleteColumn",this._workbookDeleteColumn.bind(this)),this._workbook.bind("hideRow",this._workbookHideRow.bind(this)),this._workbook.bind("hideColumn",this._workbookHideColumn.bind(this)),this._workbook.bind("unhideRow",this._workbookUnhideRow.bind(this)),this._workbook.bind("unhideColumn",this._workbookUnhideColumn.bind(this)),this._workbook.bind("select",this._workbookSelect.bind(this)),this._workbook.bind("changeFormat",this._workbookChangeFormat.bind(this)),this._workbook.bind("dataBinding",this._workbookDataBinding.bind(this)),this._workbook.bind("dataBound",this._workbookDataBound.bind(this)),this._workbook.bind("progress",this._workbookProgress.bind(this)),this._workbook.bind("contextmenu",this._onContextMenu.bind(this))}_bindViewEvents(){this._view.bind("update",this._viewUpdate.bind(this)),this._view.bind("message",this._viewMessage.bind(this))}destroy(){window.removeEventListener("resize",this._resizeHandler),this.element.removeEventListener("keydown",this._keyDownHandler),this.unbind(),this._workbook.destroy(),this._controller.destroy(),this._view.destroy()}defineName(e,t,r){return this._workbook.defineName(e,t,r)}undefineName(e){return this._workbook.undefineName(e)}nameValue(e){return this._workbook.nameValue(e)}forEachName(e){return this._workbook.forEachName(e)}cellContextMenu(){return this._view.cellContextMenu}rowHeaderContextMenu(){return this._view.rowHeaderContextMenu}colHeaderContextMenu(){return this._view.colHeaderContextMenu}addImage(e){return this._workbook.addImage(e)}cleanupImages(){return this._workbook.cleanupImages()}}const{FUNCS:FUNCS,defineBuiltinFunction:defineBuiltinFunction,limitPrecision:limitPrecision,packDate:packDate$1,unpackDate:unpackDate$1,daysInMonth:daysInMonth,daysInYear:daysInYear,isLeapYear:isLeapYear}=calc.runtime;function equals(e,t){return e="string"==typeof e?e.toLowerCase():e,t="string"==typeof t?t.toLowerCase():t,!1===e&&null==t||(!1===t&&null==e||(0===e&&null==t||(0===t&&null==e||(""===e&&null==t||(""===t&&null==e||e===t)))))}function binaryCompare(e,t,r){return"string"==typeof e&&"string"!=typeof t&&(t=null==t?"":t+""),"string"!=typeof e&&"string"==typeof t&&(e=null==e?"":e+""),"number"==typeof e&&null==t&&(t=0),"number"==typeof t&&null==e&&(e=0),"string"==typeof e&&"string"==typeof t&&(e=e.toLowerCase(),t=t.toLowerCase()),typeof t==typeof e?r(e=maybeRoundFloatErrors(e,15),t=maybeRoundFloatErrors(t,15)):new CalcError("VALUE")}function _cosh(e){return(Math.exp(e)+Math.exp(-e))/2}function _sinh(e){return(Math.exp(e)-Math.exp(-e))/2}function _tanh(e){return _sinh(e)/_cosh(e)}function _gcd(e,t){for(;t;){var r=e%t;e=t,t=r}return e}function _lcm(e,t){return Math.abs(e*t)/_gcd(e,t)}function forIFS(e,t){for(var r=[],n=0,i=e[0];n<e.length;)r.push({matrix:e[n++],pred:parseCriteria(e[n++])});for(var o=0;o<i.height;++o)e:for(var s=0;s<i.width;++s){for(n=0;n<r.length;++n){var a=r[n].matrix.get(o,s);if(!r[n].pred(null==a||""===a?0:a))continue e}t(o,s)}}function fetchSumRange(e){return function(t,r,n,i){var o=this;if(i instanceof Ref){var s=i.clone().toRangeRef();if(s.width()!=r.width||s.height()!=r.height)return isFinite(s.topLeft.row)||(s.topLeft.row=0),isFinite(s.topLeft.col)||(s.topLeft.col=0),s.bottomRight.row=s.topLeft.row+r.height-1,s.bottomRight.col=s.topLeft.col+r.width-1,o.resolveCells([s],(function(){t(e(r,n,o.asMatrix(s)))}))}t(e(r,n,o.asMatrix(i)))}}function _extreme(e,t,r){var n=[],i=e.each((function(e){if(e instanceof CalcError)return e;"number"==typeof e&&n.push(e)}));return i||(t>n.length?new CalcError("NUM"):n.sort(r)[t-1])}function _avg(e){return e.reduce((function(e,t){return e+t}),0)/e.length}function _var_sp(e,t,r){return null==r&&(r=_avg(e)),e.reduce((function(e,t){return e+Math.pow(t-r,2)}),0)/t}function _stdev_sp(e,t){return Math.sqrt(_var_sp(e,t))}function _percentrank(e,t,r){var n=0,i=0,o=null,s=null,a=!1;return e.forEach((function(e){e<t?(n++,o=null==o?e:Math.max(o,e)):e>t?(i++,s=null==s?e:Math.min(s,e)):a=!0})),n||i?a?r?(n+1)/(e.length+1):n/(n+i):((s-t)*_percentrank(e,o,r)+(t-o)*_percentrank(e,s,r))/(s-o):new CalcError("N/A")}function _covariance(e,t,r){for(var n=0,i=_avg(e),o=_avg(t),s=e.length,a=0;a<s;++a)n+=(e[a]-i)*(t[a]-o);return n/r}defineBuiltinFunction("binary+",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1))||null==o&&(o=0,1)))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];return s instanceof CalcError?s:"number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1))||null==s&&(s=0,1)?(r.push(s),2<e.length?new CalcError("N/A"):r):s instanceof CalcError?s:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);return a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t){return e+t})),defineBuiltinFunction("binary-",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1))||null==o&&(o=0,1)))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];return s instanceof CalcError?s:"number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1))||null==s&&(s=0,1)?(r.push(s),2<e.length?new CalcError("N/A"):r):s instanceof CalcError?s:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);return a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t){return e-t})),defineBuiltinFunction("binary*",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1))||null==o&&(o=0,1)))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];return s instanceof CalcError?s:"number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1))||null==s&&(s=0,1)?(r.push(s),2<e.length?new CalcError("N/A"):r):s instanceof CalcError?s:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);return a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t){return e*t})),defineBuiltinFunction("binary/",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1))||null==o&&(o=0,1)))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];return s instanceof CalcError?s:!("number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||0==s&&(i="DIV/0",1)?s instanceof CalcError?s:new CalcError(i):(r.push(s),2<e.length?new CalcError("N/A"):r)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);return a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t){return e/t})),defineBuiltinFunction("binary^",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1))||null==o&&(o=0,1)))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];return s instanceof CalcError?s:"number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1))||null==s&&(s=0,1)?(r.push(s),2<e.length?new CalcError("N/A"):r):s instanceof CalcError?s:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);return a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t){return Math.pow(e,t)})),defineBuiltinFunction("binary&",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1))||("string"==typeof o||"boolean"==typeof o||"number"==typeof o?(o+="",1):void 0===o&&(o="",1))||"boolean"==typeof o||null==o))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];return s instanceof CalcError?s:"number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1))||("string"==typeof s||"boolean"==typeof s||"number"==typeof s?(s+="",1):void 0===s&&(s="",1))||"boolean"==typeof s||null==s?(r.push(s),2<e.length?new CalcError("N/A"):r):s instanceof CalcError?s:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);return a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t){return null==e&&(e=""),null==t&&(t=""),""+e+t})),defineBuiltinFunction("binary=",!1,{check:function(e){var t=[],r=0,n="VALUE",i=e[r++];if(i instanceof CalcError)return i;if(i=this.force(i),!(r<=e.length))return i instanceof CalcError?i:new CalcError(n);t.push(i);var o=e[r++];return o instanceof CalcError?o:(o=this.force(o),r<=e.length?(t.push(o),r<e.length?new CalcError("N/A"):t):o instanceof CalcError?o:new CalcError(n))},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);return a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t){return equals(e,t)})),defineBuiltinFunction("binary<>",!1,{check:function(e){var t=[],r=0,n="VALUE",i=e[r++];if(i instanceof CalcError)return i;if(i=this.force(i),!(r<=e.length))return i instanceof CalcError?i:new CalcError(n);t.push(i);var o=e[r++];return o instanceof CalcError?o:(o=this.force(o),r<=e.length?(t.push(o),r<e.length?new CalcError("N/A"):t):o instanceof CalcError?o:new CalcError(n))},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);return a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t){return!equals(e,t)})),defineBuiltinFunction("binary<",!1,{check:function(e){var t=[],r=0,n="VALUE",i=e[r++];if(i instanceof CalcError)return i;if(i=this.force(i),!(r<=e.length))return i instanceof CalcError?i:new CalcError(n);t.push(i);var o=e[r++];return o instanceof CalcError?o:(o=this.force(o),r<=e.length?(t.push(o),r<e.length?new CalcError("N/A"):t):o instanceof CalcError?o:new CalcError(n))},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);return a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t){return binaryCompare(e,t,((e,t)=>e<t))})),defineBuiltinFunction("binary<=",!1,{check:function(e){var t=[],r=0,n="VALUE",i=e[r++];if(i instanceof CalcError)return i;if(i=this.force(i),!(r<=e.length))return i instanceof CalcError?i:new CalcError(n);t.push(i);var o=e[r++];return o instanceof CalcError?o:(o=this.force(o),r<=e.length?(t.push(o),r<e.length?new CalcError("N/A"):t):o instanceof CalcError?o:new CalcError(n))},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);return a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t){return binaryCompare(e,t,((e,t)=>e<=t))})),defineBuiltinFunction("binary>",!1,{check:function(e){var t=[],r=0,n="VALUE",i=e[r++];if(i instanceof CalcError)return i;if(i=this.force(i),!(r<=e.length))return i instanceof CalcError?i:new CalcError(n);t.push(i);var o=e[r++];return o instanceof CalcError?o:(o=this.force(o),r<=e.length?(t.push(o),r<e.length?new CalcError("N/A"):t):o instanceof CalcError?o:new CalcError(n))},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);return a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t){return binaryCompare(e,t,((e,t)=>e>t))})),defineBuiltinFunction("binary>=",!1,{check:function(e){var t=[],r=0,n="VALUE",i=e[r++];if(i instanceof CalcError)return i;if(i=this.force(i),!(r<=e.length))return i instanceof CalcError?i:new CalcError(n);t.push(i);var o=e[r++];return o instanceof CalcError?o:(o=this.force(o),r<=e.length?(t.push(o),r<e.length?new CalcError("N/A"):t):o instanceof CalcError?o:new CalcError(n))},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);return a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t){return binaryCompare(e,t,((e,t)=>e>=t))})),defineBuiltinFunction("unary+",!1,{check:function(e){var t,r=[],n=0,i=e[n++];return i instanceof CalcError?i:"number"==typeof(i=this.force(i))&&(i=limitPrecision(i),1)||"boolean"==typeof i&&(i=+i,1)||"string"==typeof i&&!/^(?:=|true|false)/i.test(i)&&(t=calc.parse(0,0,0,i),/^date|number|percent$/.test(t.type)&&(i=+t.value,1))||null==i&&(i=0,1)?(r.push(i),1<e.length?new CalcError("N/A"):r):i instanceof CalcError?i:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return e})),defineBuiltinFunction("unary-",!1,{check:function(e){var t,r=[],n=0,i=e[n++];return i instanceof CalcError?i:"number"==typeof(i=this.force(i))&&(i=limitPrecision(i),1)||"boolean"==typeof i&&(i=+i,1)||"string"==typeof i&&!/^(?:=|true|false)/i.test(i)&&(t=calc.parse(0,0,0,i),/^date|number|percent$/.test(t.type)&&(i=+t.value,1))||null==i&&(i=0,1)?(r.push(i),1<e.length?new CalcError("N/A"):r):i instanceof CalcError?i:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return-e})),defineBuiltinFunction("unary%",!1,{check:function(e){var t,r=[],n=0,i=e[n++];return i instanceof CalcError?i:"number"==typeof(i=this.force(i))&&(i=limitPrecision(i),1)||"boolean"==typeof i&&(i=+i,1)||"string"==typeof i&&!/^(?:=|true|false)/i.test(i)&&(t=calc.parse(0,0,0,i),/^date|number|percent$/.test(t.type)&&(i=+t.value,1))||null==i&&(i=0,1)?(r.push(i),1<e.length?new CalcError("N/A"):r):i instanceof CalcError?i:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return e/100})),defineBuiltinFunction("binary:",!1,{check:function(e){var t=[],r=0,n="VALUE",i=e[r++];if(i instanceof CalcError)return i;if(!(i instanceof CellRef))return new CalcError(n);t.push(i);var o=e[r++];return o instanceof CalcError?o:o instanceof CellRef?(t.push(o),2<e.length?new CalcError("N/A"):t):new CalcError(n)}},(function(e,t){return new RangeRef(e,t).setSheet(e.sheet||this.formula.sheet,e.hasSheet())})),defineBuiltinFunction("binary,",!1,{check:function(e){var t=[],r=0,n="VALUE",i=e[r++];if(i instanceof CalcError)return i;if(!(i instanceof Ref))return new CalcError(n);t.push(i);var o=e[r++];return o instanceof CalcError?o:o instanceof Ref?(t.push(o),2<e.length?new CalcError("N/A"):t):new CalcError(n)}},(function(e,t){return new UnionRef([e,t])})),defineBuiltinFunction("binary ",!1,{check:function(e){var t=[],r=0,n="VALUE",i=e[r++];if(i instanceof CalcError)return i;if(!(i instanceof Ref))return new CalcError(n);t.push(i);var o=e[r++];return o instanceof CalcError?o:o instanceof Ref?(t.push(o),2<e.length?new CalcError("N/A"):t):new CalcError(n)}},(function(e,t){return e.intersect(t)})),defineBuiltinFunction("not",!1,{check:function(e){var t=[],r=0,n=e[r++];return n instanceof CalcError?n:null!=(n=this.force(n))&&1<=e.length||null==n&&(n=0,1)?(t.push(n),1<e.length?new CalcError("N/A"):t):n instanceof CalcError?n:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return!this.bool(e)})),defineBuiltinFunction("isblank",!1,{check:function(e){var t=[],r=0,n=e[r++];return 1<=e.length?(t.push(n),1<e.length?new CalcError("N/A"):t):new CalcError("VALUE")},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return e instanceof CellRef&&null==(e=this.getRefData(e))})),defineBuiltinFunction("iserror",!1,{check:function(e){var t=[],r=0,n=e[r++];return n=this.force(n),1<=e.length?(t.push(n),1<e.length?new CalcError("N/A"):t):new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return e instanceof CalcError})),defineBuiltinFunction("iserr",!1,{check:function(e){var t=[],r=0,n=e[r++];return n=this.force(n),1<=e.length?(t.push(n),1<e.length?new CalcError("N/A"):t):new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return e instanceof CalcError&&"N/A"!=e.code})),defineBuiltinFunction("isna",!1,{check:function(e){var t=[],r=0,n=e[r++];return n=this.force(n),1<=e.length?(t.push(n),1<e.length?new CalcError("N/A"):t):new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return e instanceof CalcError&&"N/A"==e.code})),defineBuiltinFunction("islogical",!1,{check:function(e){var t=[],r=0,n=e[r++];return n=this.force(n),1<=e.length?(t.push(n),1<e.length?new CalcError("N/A"):t):new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return"boolean"==typeof e})),defineBuiltinFunction("isnontext",!1,{check:function(e){var t=[],r=0,n=e[r++];return n=this.force(n),1<=e.length?(t.push(n),1<e.length?new CalcError("N/A"):t):new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return"string"!=typeof e})),defineBuiltinFunction("istext",!1,{check:function(e){var t=[],r=0,n=e[r++];return n=this.force(n),1<=e.length?(t.push(n),1<e.length?new CalcError("N/A"):t):new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return"string"==typeof e})),defineBuiltinFunction("isnumber",!1,{check:function(e){var t=[],r=0,n=e[r++];return n=this.force(n),1<=e.length?(t.push(n),1<e.length?new CalcError("N/A"):t):new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return"number"==typeof e})),defineBuiltinFunction("isref",!1,{check:function(e){var t=[],r=0,n=e[r++];return 1<=e.length?(t.push(n),1<e.length?new CalcError("N/A"):t):new CalcError("VALUE")},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return e instanceof CellRef||e instanceof RangeRef})),defineBuiltinFunction("_matrix",!1,{check:function(e){var t,r=[],n=0,i=e[n++];return i instanceof CalcError?i:(t=this.asMatrix(i))&&(i=t)||("string"==typeof i||"boolean"==typeof i||"number"==typeof i?(i+="",1):void 0===i&&(i="",1))?(r.push(i),1<e.length?new CalcError("N/A"):r):i instanceof CalcError?i:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)}},(function(e){return"string"==typeof e&&(e=this.asMatrix([e.split(/\s*,\s*/)])),e})),FUNCS[",getname"]=function(e,t){this.fetchName(t[0],e)},defineBuiltinFunction("abs",!1,{check:function(e){var t,r=[],n=0,i=e[n++];return i instanceof CalcError?i:"number"==typeof(i=this.force(i))&&(i=limitPrecision(i),1)||"boolean"==typeof i&&(i=+i,1)||"string"==typeof i&&!/^(?:=|true|false)/i.test(i)&&(t=calc.parse(0,0,0,i),/^date|number|percent$/.test(t.type)&&(i=+t.value,1))?(r.push(i),1<e.length?new CalcError("N/A"):r):i instanceof CalcError?i:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},Math.abs),defineBuiltinFunction("cos",!1,{check:function(e){var t,r=[],n=0,i=e[n++];return i instanceof CalcError?i:"number"==typeof(i=this.force(i))&&(i=limitPrecision(i),1)||"boolean"==typeof i&&(i=+i,1)||"string"==typeof i&&!/^(?:=|true|false)/i.test(i)&&(t=calc.parse(0,0,0,i),/^date|number|percent$/.test(t.type)&&(i=+t.value,1))?(r.push(i),1<e.length?new CalcError("N/A"):r):i instanceof CalcError?i:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},Math.cos),defineBuiltinFunction("sin",!1,{check:function(e){var t,r=[],n=0,i=e[n++];return i instanceof CalcError?i:"number"==typeof(i=this.force(i))&&(i=limitPrecision(i),1)||"boolean"==typeof i&&(i=+i,1)||"string"==typeof i&&!/^(?:=|true|false)/i.test(i)&&(t=calc.parse(0,0,0,i),/^date|number|percent$/.test(t.type)&&(i=+t.value,1))?(r.push(i),1<e.length?new CalcError("N/A"):r):i instanceof CalcError?i:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},Math.sin),defineBuiltinFunction("acos",!1,{check:function(e){var t,r=[],n=0,i=e[n++];return i instanceof CalcError?i:"number"==typeof(i=this.force(i))&&(i=limitPrecision(i),1)||"boolean"==typeof i&&(i=+i,1)||"string"==typeof i&&!/^(?:=|true|false)/i.test(i)&&(t=calc.parse(0,0,0,i),/^date|number|percent$/.test(t.type)&&(i=+t.value,1))?(r.push(i),1<e.length?new CalcError("N/A"):r):i instanceof CalcError?i:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},Math.acos),defineBuiltinFunction("asin",!1,{check:function(e){var t,r=[],n=0,i=e[n++];return i instanceof CalcError?i:"number"==typeof(i=this.force(i))&&(i=limitPrecision(i),1)||"boolean"==typeof i&&(i=+i,1)||"string"==typeof i&&!/^(?:=|true|false)/i.test(i)&&(t=calc.parse(0,0,0,i),/^date|number|percent$/.test(t.type)&&(i=+t.value,1))?(r.push(i),1<e.length?new CalcError("N/A"):r):i instanceof CalcError?i:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},Math.asin),defineBuiltinFunction("tan",!1,{check:function(e){var t,r=[],n=0,i=e[n++];return i instanceof CalcError?i:"number"==typeof(i=this.force(i))&&(i=limitPrecision(i),1)||"boolean"==typeof i&&(i=+i,1)||"string"==typeof i&&!/^(?:=|true|false)/i.test(i)&&(t=calc.parse(0,0,0,i),/^date|number|percent$/.test(t.type)&&(i=+t.value,1))?(r.push(i),1<e.length?new CalcError("N/A"):r):i instanceof CalcError?i:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},Math.tan),defineBuiltinFunction("atan",!1,{check:function(e){var t,r=[],n=0,i=e[n++];return i instanceof CalcError?i:"number"==typeof(i=this.force(i))&&(i=limitPrecision(i),1)||"boolean"==typeof i&&(i=+i,1)||"string"==typeof i&&!/^(?:=|true|false)/i.test(i)&&(t=calc.parse(0,0,0,i),/^date|number|percent$/.test(t.type)&&(i=+t.value,1))?(r.push(i),1<e.length?new CalcError("N/A"):r):i instanceof CalcError?i:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},Math.atan),defineBuiltinFunction("exp",!1,{check:function(e){var t,r=[],n=0,i=e[n++];return i instanceof CalcError?i:"number"==typeof(i=this.force(i))&&(i=limitPrecision(i),1)||"boolean"==typeof i&&(i=+i,1)||"string"==typeof i&&!/^(?:=|true|false)/i.test(i)&&(t=calc.parse(0,0,0,i),/^date|number|percent$/.test(t.type)&&(i=+t.value,1))?(r.push(i),1<e.length?new CalcError("N/A"):r):i instanceof CalcError?i:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},Math.exp),defineBuiltinFunction("sqrt",!1,{check:function(e){var t,r=[],n=0,i=e[n++];return i instanceof CalcError?i:"number"==typeof(i=this.force(i))&&(i=limitPrecision(i),1)||"boolean"==typeof i&&(i=+i,1)||"string"==typeof i&&!/^(?:=|true|false)/i.test(i)&&(t=calc.parse(0,0,0,i),/^date|number|percent$/.test(t.type)&&(i=+t.value,1))?(r.push(i),1<e.length?new CalcError("N/A"):r):i instanceof CalcError?i:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},Math.sqrt),defineBuiltinFunction("ln",!1,{check:function(e){var t,r=[],n=0,i=e[n++];return i instanceof CalcError?i:"number"==typeof(i=this.force(i))&&(i=limitPrecision(i),1)||"boolean"==typeof i&&(i=+i,1)||"string"==typeof i&&!/^(?:=|true|false)/i.test(i)&&(t=calc.parse(0,0,0,i),/^date|number|percent$/.test(t.type)&&(i=+t.value,1))?(r.push(i),1<e.length?new CalcError("N/A"):r):i instanceof CalcError?i:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},Math.log),defineBuiltinFunction("log",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||!(o>0||(i="NUM",0)))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];return s instanceof CalcError?s:("number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))&&(s>0||(i="NUM",0))||null==s&&(s=10,1)?(r.push(s),1==s&&(i="DIV/0",1)?new CalcError(i):2<e.length?new CalcError("N/A"):r):s instanceof CalcError?s:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);return a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t){return Math.log(e)/Math.log(t)})),defineBuiltinFunction("log10",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];return o instanceof CalcError?o:("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))&&(o>0||(i="NUM",0))?(r.push(o),1<e.length?new CalcError("N/A"):r):o instanceof CalcError?o:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return Math.log(e)/Math.log(10)})),defineBuiltinFunction("pi",!1,{check:function(e){return 0<e.length?new CalcError("N/A"):[]}},(function(){return Math.PI})),defineBuiltinFunction("sqrtpi",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];return o instanceof CalcError?o:("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))&&(o>=0||(i="NUM",0))?(r.push(o),1<e.length?new CalcError("N/A"):r):o instanceof CalcError?o:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return Math.sqrt(e*Math.PI)})),defineBuiltinFunction("degrees",!1,{check:function(e){var t,r=[],n=0,i=e[n++];return i instanceof CalcError?i:"number"==typeof(i=this.force(i))&&(i=limitPrecision(i),1)||"boolean"==typeof i&&(i=+i,1)||"string"==typeof i&&!/^(?:=|true|false)/i.test(i)&&(t=calc.parse(0,0,0,i),/^date|number|percent$/.test(t.type)&&(i=+t.value,1))?(r.push(i),1<e.length?new CalcError("N/A"):r):i instanceof CalcError?i:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return 180*e/Math.PI%360})),defineBuiltinFunction("radians",!1,{check:function(e){var t,r=[],n=0,i=e[n++];return i instanceof CalcError?i:"number"==typeof(i=this.force(i))&&(i=limitPrecision(i),1)||"boolean"==typeof i&&(i=+i,1)||"string"==typeof i&&!/^(?:=|true|false)/i.test(i)&&(t=calc.parse(0,0,0,i),/^date|number|percent$/.test(t.type)&&(i=+t.value,1))?(r.push(i),1<e.length?new CalcError("N/A"):r):i instanceof CalcError?i:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return Math.PI*e/180})),defineBuiltinFunction("cosh",!1,{check:function(e){var t,r=[],n=0,i=e[n++];return i instanceof CalcError?i:"number"==typeof(i=this.force(i))&&(i=limitPrecision(i),1)||"boolean"==typeof i&&(i=+i,1)||"string"==typeof i&&!/^(?:=|true|false)/i.test(i)&&(t=calc.parse(0,0,0,i),/^date|number|percent$/.test(t.type)&&(i=+t.value,1))?(r.push(i),1<e.length?new CalcError("N/A"):r):i instanceof CalcError?i:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},_cosh),defineBuiltinFunction("acosh",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];return o instanceof CalcError?o:"number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1))?(r.push(o),o>=1||(i="N/A",0)?1<e.length?new CalcError("N/A"):r:new CalcError(i)):o instanceof CalcError?o:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return Math.log(e+Math.sqrt(e-1)*Math.sqrt(e+1))})),defineBuiltinFunction("sinh",!1,{check:function(e){var t,r=[],n=0,i=e[n++];return i instanceof CalcError?i:"number"==typeof(i=this.force(i))&&(i=limitPrecision(i),1)||"boolean"==typeof i&&(i=+i,1)||"string"==typeof i&&!/^(?:=|true|false)/i.test(i)&&(t=calc.parse(0,0,0,i),/^date|number|percent$/.test(t.type)&&(i=+t.value,1))?(r.push(i),1<e.length?new CalcError("N/A"):r):i instanceof CalcError?i:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},_sinh),defineBuiltinFunction("asinh",!1,{check:function(e){var t,r=[],n=0,i=e[n++];return i instanceof CalcError?i:"number"==typeof(i=this.force(i))&&(i=limitPrecision(i),1)||"boolean"==typeof i&&(i=+i,1)||"string"==typeof i&&!/^(?:=|true|false)/i.test(i)&&(t=calc.parse(0,0,0,i),/^date|number|percent$/.test(t.type)&&(i=+t.value,1))?(r.push(i),1<e.length?new CalcError("N/A"):r):i instanceof CalcError?i:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return Math.log(e+Math.sqrt(e*e+1))})),defineBuiltinFunction("sec",!1,{check:function(e){var t,r=[],n=0,i=e[n++];return i instanceof CalcError?i:"number"==typeof(i=this.force(i))&&(i=limitPrecision(i),1)||"boolean"==typeof i&&(i=+i,1)||"string"==typeof i&&!/^(?:=|true|false)/i.test(i)&&(t=calc.parse(0,0,0,i),/^date|number|percent$/.test(t.type)&&(i=+t.value,1))?(r.push(i),1<e.length?new CalcError("N/A"):r):i instanceof CalcError?i:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return 1/Math.cos(e)})),defineBuiltinFunction("sech",!1,{check:function(e){var t,r=[],n=0,i=e[n++];return i instanceof CalcError?i:"number"==typeof(i=this.force(i))&&(i=limitPrecision(i),1)||"boolean"==typeof i&&(i=+i,1)||"string"==typeof i&&!/^(?:=|true|false)/i.test(i)&&(t=calc.parse(0,0,0,i),/^date|number|percent$/.test(t.type)&&(i=+t.value,1))?(r.push(i),1<e.length?new CalcError("N/A"):r):i instanceof CalcError?i:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return 1/_cosh(e)})),defineBuiltinFunction("csc",!1,{check:function(e){var t,r=[],n=0,i=e[n++];return i instanceof CalcError?i:"number"==typeof(i=this.force(i))&&(i=limitPrecision(i),1)||"boolean"==typeof i&&(i=+i,1)||"string"==typeof i&&!/^(?:=|true|false)/i.test(i)&&(t=calc.parse(0,0,0,i),/^date|number|percent$/.test(t.type)&&(i=+t.value,1))?(r.push(i),1<e.length?new CalcError("N/A"):r):i instanceof CalcError?i:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return 1/Math.sin(e)})),defineBuiltinFunction("csch",!1,{check:function(e){var t,r=[],n=0,i=e[n++];return i instanceof CalcError?i:"number"==typeof(i=this.force(i))&&(i=limitPrecision(i),1)||"boolean"==typeof i&&(i=+i,1)||"string"==typeof i&&!/^(?:=|true|false)/i.test(i)&&(t=calc.parse(0,0,0,i),/^date|number|percent$/.test(t.type)&&(i=+t.value,1))?(r.push(i),1<e.length?new CalcError("N/A"):r):i instanceof CalcError?i:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return 1/_sinh(e)})),defineBuiltinFunction("atan2",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||0==o&&(i="DIV/0",1))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];return s instanceof CalcError?s:"number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1))?(r.push(s),2<e.length?new CalcError("N/A"):r):s instanceof CalcError?s:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);return a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t){return Math.atan(t/e)})),defineBuiltinFunction("tanh",!1,{check:function(e){var t,r=[],n=0,i=e[n++];return i instanceof CalcError?i:"number"==typeof(i=this.force(i))&&(i=limitPrecision(i),1)||"boolean"==typeof i&&(i=+i,1)||"string"==typeof i&&!/^(?:=|true|false)/i.test(i)&&(t=calc.parse(0,0,0,i),/^date|number|percent$/.test(t.type)&&(i=+t.value,1))?(r.push(i),1<e.length?new CalcError("N/A"):r):i instanceof CalcError?i:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},_tanh),defineBuiltinFunction("atanh",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];return o instanceof CalcError?o:("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))&&(o>-1&&o<1||(i="NUM",0))?(r.push(o),1<e.length?new CalcError("N/A"):r):o instanceof CalcError?o:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return Math.log(Math.sqrt(1-e*e)/(1-e))})),defineBuiltinFunction("cot",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];return o instanceof CalcError?o:!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||0==o&&(i="DIV/0",1)?o instanceof CalcError?o:new CalcError(i):(r.push(o),1<e.length?new CalcError("N/A"):r)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return 1/Math.tan(e)})),defineBuiltinFunction("coth",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];return o instanceof CalcError?o:!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||0==o&&(i="DIV/0",1)?o instanceof CalcError?o:new CalcError(i):(r.push(o),1<e.length?new CalcError("N/A"):r)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return 1/_tanh(e)})),defineBuiltinFunction("acot",!1,{check:function(e){var t,r=[],n=0,i=e[n++];return i instanceof CalcError?i:"number"==typeof(i=this.force(i))&&(i=limitPrecision(i),1)||"boolean"==typeof i&&(i=+i,1)||"string"==typeof i&&!/^(?:=|true|false)/i.test(i)&&(t=calc.parse(0,0,0,i),/^date|number|percent$/.test(t.type)&&(i=+t.value,1))?(r.push(i),1<e.length?new CalcError("N/A"):r):i instanceof CalcError?i:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return Math.PI/2-Math.atan(e)})),defineBuiltinFunction("acoth",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];return o instanceof CalcError?o:"number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1))?(r.push(o),o<-1||(i="N/A",0)||o>1||(i="N/A",0)?1<e.length?new CalcError("N/A"):r:new CalcError(i)):o instanceof CalcError?o:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return Math.log((e+1)/(e-1))/2})),defineBuiltinFunction("power",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1))))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];return s instanceof CalcError?s:"number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1))?(r.push(s),2<e.length?new CalcError("N/A"):r):s instanceof CalcError?s:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);return a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t){return Math.pow(e,t)})),defineBuiltinFunction("mod",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1))))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];return s instanceof CalcError?s:!("number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||0==s&&(i="DIV/0",1)?s instanceof CalcError?s:new CalcError(i):(r.push(s),2<e.length?new CalcError("N/A"):r)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);return a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t){return e%t})),defineBuiltinFunction("quotient",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1))))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];return s instanceof CalcError?s:!("number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||0==s&&(i="DIV/0",1)?s instanceof CalcError?s:new CalcError(i):(r.push(s),2<e.length?new CalcError("N/A"):r)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);return a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t){return Math.floor(e/t)})),defineBuiltinFunction("ceiling",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1))))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];return s instanceof CalcError?s:"number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1))?(r.push(s),s>=0||o<0||(i="N/A",0)?2<e.length?new CalcError("N/A"):r:new CalcError(i)):s instanceof CalcError?s:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);return a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t){return t?t*Math.ceil(e/t):0})),defineBuiltinFunction("ceiling.precise",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1))))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];return s instanceof CalcError?s:"number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1))||null==s&&(s=1,1)?(r.push(s),2<e.length?new CalcError("N/A"):r):s instanceof CalcError?s:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);return a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t){return(t=Math.abs(t))?t*Math.ceil(e/t):0})),calc.runtime.defineAlias("iso.ceiling","ceiling.precise"),defineBuiltinFunction("ceiling.math",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1))))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1))||null==s&&(s=o<0?-1:1,1)))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];return a instanceof CalcError?a:"boolean"==typeof(a=this.force(a))||"number"==typeof a&&(a=!!a,1)||null==a&&(a=0,1)?(r.push(a),3<e.length?new CalcError("N/A"):r):a instanceof CalcError?a:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var l=this._arrayArg(e[o]);return l?(t.push(l),r=Math.max(r,l.width),n=Math.max(n,l.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t,r){return t&&e?(e<0&&(!r&&t<0||r&&t>0)&&(t=-t),t?t*Math.ceil(e/t):0):0})),defineBuiltinFunction("floor",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1))))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];return s instanceof CalcError?s:"number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1))?(r.push(s),s>=0||o<0||(i="N/A",0)?2<e.length?new CalcError("N/A"):r:new CalcError(i)):s instanceof CalcError?s:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);return a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t){return t?t*Math.floor(e/t):0})),defineBuiltinFunction("floor.precise",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1))))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];return s instanceof CalcError?s:"number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1))||null==s&&(s=1,1)?(r.push(s),2<e.length?new CalcError("N/A"):r):s instanceof CalcError?s:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);return a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t){return(t=Math.abs(t))?t*Math.floor(e/t):0})),defineBuiltinFunction("floor.math",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1))))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1))||null==s&&(s=o<0?-1:1,1)))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];return a instanceof CalcError?a:"boolean"==typeof(a=this.force(a))||"number"==typeof a&&(a=!!a,1)||null==a&&(a=0,1)?(r.push(a),3<e.length?new CalcError("N/A"):r):a instanceof CalcError?a:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var l=this._arrayArg(e[o]);return l?(t.push(l),r=Math.max(r,l.width),n=Math.max(n,l.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t,r){return t&&e?(e<0&&(!r&&t<0||r&&t>0)&&(t=-t),t?t*Math.floor(e/t):0):0})),defineBuiltinFunction("int",!1,{check:function(e){var t,r=[],n=0,i=e[n++];return i instanceof CalcError?i:"number"==typeof(i=this.force(i))&&(i=limitPrecision(i),1)||"boolean"==typeof i&&(i=+i,1)||"string"==typeof i&&!/^(?:=|true|false)/i.test(i)&&(t=calc.parse(0,0,0,i),/^date|number|percent$/.test(t.type)&&(i=+t.value,1))?(r.push(i),1<e.length?new CalcError("N/A"):r):i instanceof CalcError?i:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},Math.floor),defineBuiltinFunction("mround",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1))))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];return s instanceof CalcError?s:"number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1))?(r.push(s),2<e.length?new CalcError("N/A"):r):s instanceof CalcError?s:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);return a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t){return t?t*Math.round(e/t):0})),defineBuiltinFunction("round",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1))))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];return s instanceof CalcError?s:"number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1))?(r.push(s),2<e.length?new CalcError("N/A"):r):s instanceof CalcError?s:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);return a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t){var r=e<0?-1:1;return r<0&&(e=-e),t=Math.pow(10,t),e=limitPrecision(e*t),r*(e=Math.round(e))/t})),defineBuiltinFunction("roundup",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1))))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];return s instanceof CalcError?s:"number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1))?(r.push(s),2<e.length?new CalcError("N/A"):r):s instanceof CalcError?s:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);return a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t){return t=Math.pow(10,t),(e=(e=limitPrecision(e*t))<0?Math.floor(e):Math.ceil(e))/t})),defineBuiltinFunction("rounddown",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1))))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];return s instanceof CalcError?s:"number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1))?(r.push(s),2<e.length?new CalcError("N/A"):r):s instanceof CalcError?s:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);return a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t){return t=Math.pow(10,t),(e=(e=limitPrecision(e*t))<0?Math.ceil(e):Math.floor(e))/t})),defineBuiltinFunction("even",!1,{check:function(e){var t,r=[],n=0,i=e[n++];return i instanceof CalcError?i:"number"==typeof(i=this.force(i))&&(i=limitPrecision(i),1)||"boolean"==typeof i&&(i=+i,1)||"string"==typeof i&&!/^(?:=|true|false)/i.test(i)&&(t=calc.parse(0,0,0,i),/^date|number|percent$/.test(t.type)&&(i=+t.value,1))?(r.push(i),1<e.length?new CalcError("N/A"):r):i instanceof CalcError?i:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){var t=e<0?Math.floor(e):Math.ceil(e);return t%2?t+(t<0?-1:1):t})),defineBuiltinFunction("odd",!1,{check:function(e){var t,r=[],n=0,i=e[n++];return i instanceof CalcError?i:"number"==typeof(i=this.force(i))&&(i=limitPrecision(i),1)||"boolean"==typeof i&&(i=+i,1)||"string"==typeof i&&!/^(?:=|true|false)/i.test(i)&&(t=calc.parse(0,0,0,i),/^date|number|percent$/.test(t.type)&&(i=+t.value,1))?(r.push(i),1<e.length?new CalcError("N/A"):r):i instanceof CalcError?i:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){var t=e<0?Math.floor(e):Math.ceil(e);return t%2?t:t+(t<0?-1:1)})),defineBuiltinFunction("sign",!1,{check:function(e){var t,r=[],n=0,i=e[n++];return i instanceof CalcError?i:"number"==typeof(i=this.force(i))&&(i=limitPrecision(i),1)||"boolean"==typeof i&&(i=+i,1)||"string"==typeof i&&!/^(?:=|true|false)/i.test(i)&&(t=calc.parse(0,0,0,i),/^date|number|percent$/.test(t.type)&&(i=+t.value,1))?(r.push(i),1<e.length?new CalcError("N/A"):r):i instanceof CalcError?i:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return e<0?-1:e>0?1:0})),defineBuiltinFunction("gcd",!1,{check:function(e){var t,r=[],n=0;try{var i=this.cellValues(e.slice(n)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n=e.length,r.push(i)}catch(e){if(e instanceof CalcError)return e;throw e}return n<e.length?new CalcError("N/A"):r},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e.slice(1)),this.resolveCells(r,t)}},(function(e){for(var t=e[0],r=1;r<e.length;++r)t=_gcd(t,e[r]);return t})),defineBuiltinFunction("lcm",!1,{check:function(e){var t,r=[],n=0;try{var i=this.cellValues(e.slice(n)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n=e.length,r.push(i)}catch(e){if(e instanceof CalcError)return e;throw e}return n<e.length?new CalcError("N/A"):r},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e.slice(1)),this.resolveCells(r,t)}},(function(e){for(var t=e[0],r=1;r<e.length;++r)t=_lcm(t,e[r]);return t})),defineBuiltinFunction("sum",!1,{check:function(e){var t,r=[],n=0;try{var i=this.cellValues(e.slice(n)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n=e.length,r.push(i)}catch(e){if(e instanceof CalcError)return e;throw e}return n<e.length?new CalcError("N/A"):r},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e.slice(1)),this.resolveCells(r,t)}},(function(e){return e.reduce((function(e,t){return e+t}),0)})),defineBuiltinFunction("product",!1,{check:function(e){var t,r=[],n=0;try{var i=this.cellValues(e.slice(n)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n=e.length,r.push(i)}catch(e){if(e instanceof CalcError)return e;throw e}return n<e.length?new CalcError("N/A"):r},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e.slice(1)),this.resolveCells(r,t)}},(function(e){return e.reduce((function(e,t){return e*t}),1)})),defineBuiltinFunction("sumproduct",!1,{check:function(e){var t,r,n=[],i=[],o=0,s="VALUE",a=e[o++];if(a instanceof CalcError)return a;if(!(r=this.asMatrix(a))||!(a=r))return a instanceof CalcError?a:new CalcError(s);if(i.push(a),o>=e.length)return new CalcError("N/A");i.push(t=[]),n.push(i),i=t;do{var l=e[o++];if(l instanceof CalcError)return l;if(!(r=this.asMatrix(l))||!(l=r)||l.width!=a.width&&(s="N/A",1)||l.height!=a.height&&(s="N/A",1))return l instanceof CalcError?l:new CalcError(s);i.push(l)}while(o<e.length);return i=n.pop(),o<e.length?new CalcError("N/A"):i},resolve:function(e,t){var r=[],n=0;for(r.push(e[n++]);n<e.length;)r.push(e[n++]);this.resolveCells(r,t)}},(function(e,t){var r=0;return e.each((function(e,n,i){if("number"==typeof e){for(var o=0;o<t.length;++o){var s=t[o].get(n,i);if("number"!=typeof s)return;e*=s}r+=e}})),r})),defineBuiltinFunction("sumsq",!1,{check:function(e){var t,r=[],n=0;try{var i=this.cellValues(e.slice(n)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n=e.length,r.push(i)}catch(e){if(e instanceof CalcError)return e;throw e}return n<e.length?new CalcError("N/A"):r},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e.slice(1)),this.resolveCells(r,t)}},(function(e){return e.reduce((function(e,t){return e+t*t}),0)})),defineBuiltinFunction("sumx2my2",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!(t=this.asMatrix(o))||!(o=t))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];return s instanceof CalcError?s:!(t=this.asMatrix(s))||!(s=t)||s.width!=o.width&&(i="N/A",1)||s.height!=o.height&&(i="N/A",1)?s instanceof CalcError?s:new CalcError(i):(r.push(s),2<e.length?new CalcError("N/A"):r)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},(function(e,t){var r=0;return e.each((function(e,n,i){var o=t.get(n,i);"number"==typeof e&&"number"==typeof o&&(r+=e*e-o*o)})),r})),defineBuiltinFunction("sumx2py2",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!(t=this.asMatrix(o))||!(o=t))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];return s instanceof CalcError?s:!(t=this.asMatrix(s))||!(s=t)||s.width!=o.width&&(i="N/A",1)||s.height!=o.height&&(i="N/A",1)?s instanceof CalcError?s:new CalcError(i):(r.push(s),2<e.length?new CalcError("N/A"):r)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},(function(e,t){var r=0;return e.each((function(e,n,i){var o=t.get(n,i);"number"==typeof e&&"number"==typeof o&&(r+=e*e+o*o)})),r})),defineBuiltinFunction("sumxmy2",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!(t=this.asMatrix(o))||!(o=t))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];return s instanceof CalcError?s:!(t=this.asMatrix(s))||!(s=t)||s.width!=o.width&&(i="N/A",1)||s.height!=o.height&&(i="N/A",1)?s instanceof CalcError?s:new CalcError(i):(r.push(s),2<e.length?new CalcError("N/A"):r)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},(function(e,t){var r=0;return e.each((function(e,n,i){var o=t.get(n,i);"number"==typeof e&&"number"==typeof o&&(r+=(e-o)*(e-o))})),r})),defineBuiltinFunction("seriessum",!1,{check:function(e){var t,r,n=[],i=0,o="VALUE",s=e[i++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1))))return s instanceof CalcError?s:new CalcError(o);n.push(s);var a=e[i++];if(a instanceof CalcError)return a;if(!("number"==typeof(a=this.force(a))&&(a=limitPrecision(a),1)||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1))))return a instanceof CalcError?a:new CalcError(o);n.push(a);var l=e[i++];if(l instanceof CalcError)return l;if(!("number"==typeof(l=this.force(l))&&(l=limitPrecision(l),1)||"boolean"==typeof l&&(l=+l,1)||"string"==typeof l&&!/^(?:=|true|false)/i.test(l)&&(t=calc.parse(0,0,0,l),/^date|number|percent$/.test(t.type)&&(l=+t.value,1))))return l instanceof CalcError?l:new CalcError(o);n.push(l);var u=e[i++];return u instanceof CalcError?u:(r=this.asMatrix(u))&&(u=r)?(n.push(u),4<e.length?new CalcError("N/A"):n):u instanceof CalcError?u:new CalcError(o)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},(function(e,t,r,n){var i=0;return n.each((function(n){if("number"!=typeof n)throw new CalcError("VALUE");i+=n*Math.pow(e,t),t+=r})),i})),defineBuiltinFunction("min",!1,{check:function(e){var t=[],r=0;try{var n=this.cellValues(e.slice(r)).reduce(function(e,t){if(t instanceof CalcError)throw t;return"number"==typeof t&&(t=limitPrecision(t),1)&&e.push(t),e}.bind(this),[]);r=e.length,t.push(n)}catch(e){if(e instanceof CalcError)return e;throw e}return r<e.length?new CalcError("N/A"):t},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e.slice(1)),this.resolveCells(r,t)}},(function(e){return e.length?Math.min.apply(Math,e):0})),defineBuiltinFunction("max",!1,{check:function(e){var t=[],r=0;try{var n=this.cellValues(e.slice(r)).reduce(function(e,t){if(t instanceof CalcError)throw t;return"number"==typeof t&&(t=limitPrecision(t),1)&&e.push(t),e}.bind(this),[]);r=e.length,t.push(n)}catch(e){if(e instanceof CalcError)return e;throw e}return r<e.length?new CalcError("N/A"):t},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e.slice(1)),this.resolveCells(r,t)}},(function(e){return e.length?Math.max.apply(Math,e):0})),defineBuiltinFunction("counta",!1,{check:function(e){var t=[],r=0;try{var n=this.cellValues(e.slice(r)).reduce(function(t,n){return null!=n&&r<=e.length&&t.push(n),t}.bind(this),[]);r=e.length,t.push(n)}catch(e){if(e instanceof CalcError)return e;throw e}return r<e.length?new CalcError("N/A"):t},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e.slice(1)),this.resolveCells(r,t)}},(function(e){return e.length})),defineBuiltinFunction("count",!1,{check:function(e){var t,r=[],n=0;try{var i=this.cellValues(e.slice(n)).reduce(function(e,r){return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n=e.length,r.push(i)}catch(e){if(e instanceof CalcError)return e;throw e}return n<e.length?new CalcError("N/A"):r},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e.slice(1)),this.resolveCells(r,t)}},(function(e){return e.length})),defineBuiltinFunction("countunique",!1,{check:function(e){var t=[],r=0;try{var n=this.cellValues(e.slice(r)).reduce(function(t,n){return null!=n&&r<=e.length&&t.push(n),t}.bind(this),[]);r=e.length,t.push(n)}catch(e){if(e instanceof CalcError)return e;throw e}return r<e.length?new CalcError("N/A"):t},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e.slice(1)),this.resolveCells(r,t)}},(function(e){var t=0,r=[];return e.forEach((function(e){r.indexOf(e)<0&&(t++,r.push(e))})),t})),defineBuiltinFunction("countblank",!1,{check:function(e){var t,r,n=[],i=[],o=0;if(o>=e.length)return new CalcError("N/A");i.push(t=[]),n.push(i),i=t;do{var s=e[o++];if(s instanceof CalcError)return s;if(!((r=this.asMatrix(s))&&(s=r)||null!=s&&o<=e.length))return s instanceof CalcError?s:new CalcError("VALUE");i.push(s)}while(o<e.length);return i=n.pop(),o<e.length?new CalcError("N/A"):i},resolve:function(e,t){for(var r=[],n=0;n<e.length;)r.push(e[n++]);this.resolveCells(r,t)}},(function(e){var t=0;function r(e){null!=e&&""!==e||t++}return function(e){for(var t=0;t<e.length;++t){var n=e[t];n instanceof Matrix?n.each(r,!0):r(n)}}(e),t})),defineBuiltinFunction("iseven",!1,{check:function(e){var t,r=[],n=0,i=e[n++];return i instanceof CalcError?i:"number"==typeof(i=this.force(i))&&(i=limitPrecision(i),1)||"boolean"==typeof i&&(i=+i,1)||"string"==typeof i&&!/^(?:=|true|false)/i.test(i)&&(t=calc.parse(0,0,0,i),/^date|number|percent$/.test(t.type)&&(i=+t.value,1))?(r.push(i),1<e.length?new CalcError("N/A"):r):i instanceof CalcError?i:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return e%2==0})),defineBuiltinFunction("isodd",!1,{check:function(e){var t,r=[],n=0,i=e[n++];return i instanceof CalcError?i:"number"==typeof(i=this.force(i))&&(i=limitPrecision(i),1)||"boolean"==typeof i&&(i=+i,1)||"string"==typeof i&&!/^(?:=|true|false)/i.test(i)&&(t=calc.parse(0,0,0,i),/^date|number|percent$/.test(t.type)&&(i=+t.value,1))?(r.push(i),1<e.length?new CalcError("N/A"):r):i instanceof CalcError?i:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return e%2!=0})),defineBuiltinFunction("n",!1,{check:function(e){var t=[],r=0,n=e[r++];return n instanceof CalcError?n:null!=(n=this.force(n))&&1<=e.length?(t.push(n),1<e.length?new CalcError("N/A"):t):n instanceof CalcError?n:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return"boolean"==typeof e?e?1:0:"number"==typeof e?e:0})),defineBuiltinFunction("na",!1,{check:function(e){return 0<e.length?new CalcError("N/A"):[]}},(function(){return new CalcError("N/A")})),defineBuiltinFunction("countifs",!1,{check:function(e){var t,r,n=[],i=[],o=0,s="VALUE",a=e[o++];if(a instanceof CalcError)return a;if(!(r=this.asMatrix(a))||!(a=r))return a instanceof CalcError?a:new CalcError(s);i.push(a);var l=e[o++];if(l instanceof CalcError)return l;if(!(null!=(l=this.force(l))&&o<=e.length))return l instanceof CalcError?l:new CalcError(s);for(i.push(l),i.push(t=[]),n.push(i),i=t;o<e.length;){var u=e[o++];if(u instanceof CalcError)return u;if(!(r=this.asMatrix(u))||!(u=r))return u instanceof CalcError?u:new CalcError(s);i.push(u);var c=e[o++];if(c instanceof CalcError)return c;if(!(null!=(c=this.force(c))&&o<=e.length))return c instanceof CalcError?c:new CalcError(s);i.push(c)}return i=n.pop(),o<e.length?new CalcError("N/A"):i},resolve:function(e,t){var r=[],n=0;for(r.push(e[n++]),r.push(e[n++]);n<e.length;)r.push(e[n++]),r.push(e[n++]);this.resolveCells(r,t)}},(function(e,t,r){var n=0;return r.unshift(e,t),forIFS(r,(function(){n++})),n})),defineBuiltinFunction("sumifs",!1,{check:function(e){var t,r,n=[],i=[],o=0,s="VALUE",a=e[o++];if(a instanceof CalcError)return a;if(!(r=this.asMatrix(a))||!(a=r))return a instanceof CalcError?a:new CalcError(s);i.push(a);var l=e[o++];if(l instanceof CalcError)return l;if(!(r=this.asMatrix(l))||!(l=r))return l instanceof CalcError?l:new CalcError(s);i.push(l);var u=e[o++];if(u instanceof CalcError)return u;if(!(null!=(u=this.force(u))&&o<=e.length))return u instanceof CalcError?u:new CalcError(s);for(i.push(u),i.push(t=[]),n.push(i),i=t;o<e.length;){var c=e[o++];if(c instanceof CalcError)return c;if(!(r=this.asMatrix(c))||!(c=r))return c instanceof CalcError?c:new CalcError(s);i.push(c);var h=e[o++];if(h instanceof CalcError)return h;if(!(null!=(h=this.force(h))&&o<=e.length))return h instanceof CalcError?h:new CalcError(s);i.push(h)}return i=n.pop(),o<e.length?new CalcError("N/A"):i},resolve:function(e,t){var r=[],n=0;for(r.push(e[n++]),r.push(e[n++]),r.push(e[n++]);n<e.length;)r.push(e[n++]),r.push(e[n++]);this.resolveCells(r,t)}},(function(e,t,r,n){n.unshift(e,numericPredicate,t,r);var i=0;return forIFS(n,(function(t,r){var n=e.get(t,r);n&&(i+=n)})),i})),defineBuiltinFunction("averageifs",!1,{check:function(e){var t,r,n=[],i=[],o=0,s="VALUE",a=e[o++];if(a instanceof CalcError)return a;if(!(r=this.asMatrix(a))||!(a=r))return a instanceof CalcError?a:new CalcError(s);i.push(a);var l=e[o++];if(l instanceof CalcError)return l;if(!(r=this.asMatrix(l))||!(l=r))return l instanceof CalcError?l:new CalcError(s);i.push(l);var u=e[o++];if(u instanceof CalcError)return u;if(!(null!=(u=this.force(u))&&o<=e.length))return u instanceof CalcError?u:new CalcError(s);for(i.push(u),i.push(t=[]),n.push(i),i=t;o<e.length;){var c=e[o++];if(c instanceof CalcError)return c;if(!(r=this.asMatrix(c))||!(c=r))return c instanceof CalcError?c:new CalcError(s);i.push(c);var h=e[o++];if(h instanceof CalcError)return h;if(!(null!=(h=this.force(h))&&o<=e.length))return h instanceof CalcError?h:new CalcError(s);i.push(h)}return i=n.pop(),o<e.length?new CalcError("N/A"):i},resolve:function(e,t){var r=[],n=0;for(r.push(e[n++]),r.push(e[n++]),r.push(e[n++]);n<e.length;)r.push(e[n++]),r.push(e[n++]);this.resolveCells(r,t)}},(function(e,t,r,n){n.unshift(e,numericPredicate,t,r);var i=0,o=0;return forIFS(n,(function(t,r){var n=e.get(t,r);null!=n&&""!==n||(n=0),i+=n,o++})),o?i/o:new CalcError("DIV/0")})),defineBuiltinFunction("countif",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!(t=this.asMatrix(o))||!(o=t))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];return s instanceof CalcError?s:null!=(s=this.force(s))&&2<=e.length?(r.push(s),2<e.length?new CalcError("N/A"):r):s instanceof CalcError?s:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0;t.push(e[o++]),i.push(!1);var s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t){t=parseCriteria(t);var r=0;return e.each((function(e){t(e)&&r++})),r})),defineBuiltinFunction("sumif",!0,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!(t=this.asMatrix(o))||!(o=t))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!(null!=(s=this.force(s))&&n<=e.length))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];return a instanceof CalcError?a:a instanceof CellRef||a instanceof RangeRef||(t=this.asMatrix(a))&&(a=t)||null==(a=this.force(a))&&(a=o,1)?(r.push(a),n<e.length?new CalcError("N/A"):r):a instanceof CalcError?a:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0;t.push(e[o++]),i.push(!1);var s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,t.push(e[o++]),i.push(!1),{args:t,width:r,height:n,arrays:i}}},fetchSumRange((function(e,t,r){var n=0;return t=parseCriteria(t),e.each((function(e,i,o){if(t(e)){var s=r.get(i,o);numericPredicate(s)&&(n+=s||0)}})),n}))),defineBuiltinFunction("averageif",!0,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!(t=this.asMatrix(o))||!(o=t))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!(null!=(s=this.force(s))&&n<=e.length))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];return a instanceof CalcError?a:a instanceof CellRef||a instanceof RangeRef||(t=this.asMatrix(a))&&(a=t)||null==(a=this.force(a))&&(a=o,1)?(r.push(a),n<e.length?new CalcError("N/A"):r):a instanceof CalcError?a:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0;t.push(e[o++]),i.push(!1);var s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,t.push(e[o++]),i.push(!1),{args:t,width:r,height:n,arrays:i}}},fetchSumRange((function(e,t,r){var n=0,i=0;return t=parseCriteria(t),e.each((function(e,o,s){if(t(e)){var a=r.get(o,s);numericPredicate(a)&&(n+=a||0,i++)}})),i?n/i:new CalcError("DIV/0")}))),defineBuiltinFunction("large",!1,{check:function(e){var t,r,n=[],i=0,o="VALUE",s=e[i++];if(s instanceof CalcError)return s;if(!(r=this.asMatrix(s))||!(s=r))return s instanceof CalcError?s:new CalcError(o);n.push(s);var a=e[i++];return a instanceof CalcError?a:("number"==typeof(a=this.force(a))&&(a=limitPrecision(a),1)||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))&&(a>0||(o="NUM",0))?(n.push(a),2<e.length?new CalcError("N/A"):n):a instanceof CalcError?a:new CalcError(o)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0;t.push(e[o++]),i.push(!1);var s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t){return _extreme(e,t,descending)})),defineBuiltinFunction("small",!1,{check:function(e){var t,r,n=[],i=0,o="VALUE",s=e[i++];if(s instanceof CalcError)return s;if(!(r=this.asMatrix(s))||!(s=r))return s instanceof CalcError?s:new CalcError(o);n.push(s);var a=e[i++];return a instanceof CalcError?a:("number"==typeof(a=this.force(a))&&(a=limitPrecision(a),1)||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))&&(a>0||(o="NUM",0))?(n.push(a),2<e.length?new CalcError("N/A"):n):a instanceof CalcError?a:new CalcError(o)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0;t.push(e[o++]),i.push(!1);var s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t){return _extreme(e,t,ascending)})),defineBuiltinFunction("stdev.s",!1,{check:function(e){var t,r=[],n=0,i="VALUE";try{var o=this.cellValues(e.slice(n)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n=e.length,r.push(o)}catch(e){if(e instanceof CalcError)return e;throw e}return o.length>=2||(i="NUM",0)?n<e.length?new CalcError("N/A"):r:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e.slice(1)),this.resolveCells(r,t)}},(function(e){return _stdev_sp(e,e.length-1)})),defineBuiltinFunction("stdev.p",!1,{check:function(e){var t=[],r=0,n="VALUE";try{var i=this.cellValues(e.slice(r)).reduce(function(e,t){if(t instanceof CalcError)throw t;return"number"==typeof t&&(t=limitPrecision(t),1)&&e.push(t),e}.bind(this),[]);r=e.length,t.push(i)}catch(e){if(e instanceof CalcError)return e;throw e}return i.length>=1||(n="NUM",0)?r<e.length?new CalcError("N/A"):t:new CalcError(n)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e.slice(1)),this.resolveCells(r,t)}},(function(e){return _stdev_sp(e,e.length)})),defineBuiltinFunction("var.s",!1,{check:function(e){var t,r=[],n=0,i="VALUE";try{var o=this.cellValues(e.slice(n)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n=e.length,r.push(o)}catch(e){if(e instanceof CalcError)return e;throw e}return o.length>=2||(i="NUM",0)?n<e.length?new CalcError("N/A"):r:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e.slice(1)),this.resolveCells(r,t)}},(function(e){return _var_sp(e,e.length-1)})),defineBuiltinFunction("var.p",!1,{check:function(e){var t,r=[],n=0,i="VALUE";try{var o=this.cellValues(e.slice(n)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n=e.length,r.push(o)}catch(e){if(e instanceof CalcError)return e;throw e}return o.length>=2||(i="NUM",0)?n<e.length?new CalcError("N/A"):r:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e.slice(1)),this.resolveCells(r,t)}},(function(e){return _var_sp(e,e.length)})),defineBuiltinFunction("median",!1,{check:function(e){var t,r=[],n=0,i="VALUE";try{var o=this.cellValues(e.slice(n)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n=e.length,r.push(o)}catch(e){if(e instanceof CalcError)return e;throw e}return o.length>0||(i="N/A",0)?n<e.length?new CalcError("N/A"):r:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e.slice(1)),this.resolveCells(r,t)}},(function(e){var t=e.length;return e.sort(ascending),t%2?e[t>>1]:(e[t>>=1]+e[t-1])/2})),defineBuiltinFunction("mode.sngl",!1,{check:function(e){var t,r=[],n=0;try{var i=this.cellValues(e.slice(n)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n=e.length,r.push(i)}catch(e){if(e instanceof CalcError)return e;throw e}return n<e.length?new CalcError("N/A"):r},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e.slice(1)),this.resolveCells(r,t)}},(function(e){e.sort(ascending);for(var t=null,r=0,n=1,i=null,o=0;o<e.length;++o){var s=e[o];s!=t?(r=1,t=s):r++,r>n&&(n=r,i=s)}return null==i?new CalcError("N/A"):i})),defineBuiltinFunction("mode.mult",!1,{check:function(e){var t,r=[],n=0;try{var i=this.cellValues(e.slice(n)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n=e.length,r.push(i)}catch(e){if(e instanceof CalcError)return e;throw e}return n<e.length?new CalcError("N/A"):r},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e.slice(1)),this.resolveCells(r,t)}},(function(e){var t=Object.create(null),r=2,n=[];e.forEach((function(e){var i=t[e]||0;t[e]=++i,i==r?n.push(e):i>r&&(r=i,n=[e])}));var i=new Matrix(this);return n.forEach((function(e,t){i.set(t,0,e)})),i})),defineBuiltinFunction("geomean",!1,{check:function(e){var t,r=[],n=0,i="VALUE";try{var o=this.cellValues(e.slice(n)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n=e.length,r.push(o)}catch(e){if(e instanceof CalcError)return e;throw e}return o.length>0||(i="NUM",0)?n<e.length?new CalcError("N/A"):r:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e.slice(1)),this.resolveCells(r,t)}},(function(e){var t=e.length,r=e.reduce((function(e,t){if(t<0)throw new CalcError("NUM");return e*t}),1);return Math.pow(r,1/t)})),defineBuiltinFunction("harmean",!1,{check:function(e){var t,r=[],n=0,i="VALUE";try{var o=this.cellValues(e.slice(n)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n=e.length,r.push(o)}catch(e){if(e instanceof CalcError)return e;throw e}return o.length>0||(i="NUM",0)?n<e.length?new CalcError("N/A"):r:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e.slice(1)),this.resolveCells(r,t)}},(function(e){return e.length/e.reduce((function(e,t){if(!t)throw new CalcError("DIV/0");return e+1/t}),0)})),defineBuiltinFunction("trimmean",!1,{check:function(e){var t,r=[],n=0,i="VALUE";try{var o=this.cellValues(e.slice(n,n+1)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n+=1,r.push(o)}catch(e){if(e instanceof CalcError)return e;throw e}var s=e[n++];return s instanceof CalcError?s:("number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))&&(s>=0&&s<1||(i="NUM",0))?(r.push(s),o.length>0||(i="NUM",0)?n<e.length?new CalcError("N/A"):r:new CalcError(i)):s instanceof CalcError?s:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e.slice(n)),r.push(e[n++]),this.resolveCells(r,t)}},(function(e,t){var r=e.length;e.sort(ascending);var n=Math.floor(r*t);n%2&&--n;for(var i=0,o=n/=2;o<r-n;++o)i+=e[o];return i/(r-2*n)})),defineBuiltinFunction("frequency",!1,{check:function(e){var t,r=[],n=0;try{var i=this.cellValues(e.slice(n,n+1)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n+=1,r.push(i)}catch(e){if(e instanceof CalcError)return e;throw e}try{var o=this.cellValues(e.slice(n,n+1)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n+=1,r.push(o)}catch(e){if(e instanceof CalcError)return e;throw e}return n<e.length?new CalcError("N/A"):r},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e.slice(1)),r.push(e.slice(1)),this.resolveCells(r,t)}},(function(e,t){e.sort(ascending),t.sort(ascending);var r=-1/0,n=0;function i(t){for(var i=0;n<e.length&&e[n]>r&&e[n]<=t;)++i,++n;return i}var o=new Matrix(this);return t.forEach((function(e,t){var n=i(e);r=e,o.set(t,0,n)})),o.set(o.height,0,e.length-n),o})),defineBuiltinFunction("rank.eq",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1))))return o instanceof CalcError?o:new CalcError(i);r.push(o);try{var s=this.cellValues(e.slice(n,n+1)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n+=1,r.push(s)}catch(e){if(e instanceof CalcError)return e;throw e}var a=e[n++];return a instanceof CalcError?a:"boolean"==typeof(a=this.force(a))||"number"==typeof a&&(a=!!a,1)||null==a&&(a=!1,1)?(r.push(a),n<e.length?new CalcError("N/A"):r):a instanceof CalcError?a:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e.slice(n)),r.push(e[n++]),this.resolveCells(r,t)}},(function(e,t,r){t.sort(r?ascending:descending);var n=t.indexOf(e);return n<0?new CalcError("N/A"):n+1})),calc.runtime.defineAlias("rank","rank.eq"),defineBuiltinFunction("rank.avg",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1))))return o instanceof CalcError?o:new CalcError(i);r.push(o);try{var s=this.cellValues(e.slice(n)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n=e.length,r.push(s)}catch(e){if(e instanceof CalcError)return e;throw e}var a=e[n++];return a instanceof CalcError?a:"boolean"==typeof(a=this.force(a))||"number"==typeof a&&(a=!!a,1)||null==a&&(a=!1,1)?(r.push(a),n<e.length?new CalcError("N/A"):r):a instanceof CalcError?a:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e.slice(n)),r.push(e[n++]),this.resolveCells(r,t)}},(function(e,t,r){t.sort(r?ascending:descending);var n=t.indexOf(e);if(n<0)return new CalcError("N/A");for(var i=n;t[i]==e;++i);return(n+i+1)/2})),defineBuiltinFunction("kurt",!1,{check:function(e){var t,r=[],n=0,i="VALUE";try{var o=this.cellValues(e.slice(n)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n=e.length,r.push(o)}catch(e){if(e instanceof CalcError)return e;throw e}return o.length>=4||(i="NUM",0)?n<e.length?new CalcError("N/A"):r:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e.slice(1)),this.resolveCells(r,t)}},(function(e){var t=e.length,r=_avg(e),n=_var_sp(e,t-1,r),i=Math.sqrt(n);return t*(t+1)/((t-1)*(t-2)*(t-3))*e.reduce((function(e,t){return e+Math.pow((t-r)/i,4)}),0)-3*Math.pow(t-1,2)/((t-2)*(t-3))})),defineBuiltinFunction("percentrank.inc",!1,{check:function(e){var t,r=[],n=0,i="VALUE";try{var o=this.cellValues(e.slice(n,n+1)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n+=1,r.push(o)}catch(e){if(e instanceof CalcError)return e;throw e}var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1))))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];return a instanceof CalcError?a:null==(a=this.force(a))&&(a=3,1)||("number"==typeof a||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))&&((a|=0)>0||(i="NUM",0))?(r.push(a),o.length>0||(i="NUM",0)?n<e.length?new CalcError("N/A"):r:new CalcError(i)):a instanceof CalcError?a:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e.slice(n)),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},(function(e,t,r){var n=_percentrank(e,t,0);return n=n.toFixed(r+1),parseFloat(n.substr(0,n.length-1))})),defineBuiltinFunction("percentrank.exc",!1,{check:function(e){var t,r=[],n=0,i="VALUE";try{var o=this.cellValues(e.slice(n,n+1)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n+=1,r.push(o)}catch(e){if(e instanceof CalcError)return e;throw e}var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1))))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];return a instanceof CalcError?a:null==(a=this.force(a))&&(a=3,1)||("number"==typeof a||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))&&((a|=0)>0||(i="NUM",0))?(r.push(a),o.length>0||(i="NUM",0)?n<e.length?new CalcError("N/A"):r:new CalcError(i)):a instanceof CalcError?a:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e.slice(n)),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},(function(e,t,r){var n=_percentrank(e,t,1);return n=n.toFixed(r+1),parseFloat(n.substr(0,n.length-1))})),calc.runtime.defineAlias("percentrank","percentrank.inc"),defineBuiltinFunction("covariance.p",!1,{check:function(e){var t,r=[],n=0,i="VALUE";try{var o=this.cellValues(e.slice(n,n+1)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n+=1,r.push(o)}catch(e){if(e instanceof CalcError)return e;throw e}try{var s=this.cellValues(e.slice(n,n+1)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n+=1,r.push(s)}catch(e){if(e instanceof CalcError)return e;throw e}return o.length!=s.length&&(i="N/A",1)?new CalcError(i):o.length>0||(i="DIV/0",0)?n<e.length?new CalcError("N/A"):r:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e.slice(1)),r.push(e.slice(1)),this.resolveCells(r,t)}},(function(e,t){return _covariance(e,t,e.length)})),defineBuiltinFunction("covariance.s",!1,{check:function(e){var t,r=[],n=0,i="VALUE";try{var o=this.cellValues(e.slice(n,n+1)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n+=1,r.push(o)}catch(e){if(e instanceof CalcError)return e;throw e}try{var s=this.cellValues(e.slice(n,n+1)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n+=1,r.push(s)}catch(e){if(e instanceof CalcError)return e;throw e}return o.length!=s.length&&(i="N/A",1)?new CalcError(i):o.length>1||(i="DIV/0",0)?n<e.length?new CalcError("N/A"):r:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e.slice(1)),r.push(e.slice(1)),this.resolveCells(r,t)}},(function(e,t){return _covariance(e,t,e.length-1)})),calc.runtime.defineAlias("covar","covariance.p");var _fact=memoize((function(e){for(var t=2,r=1;t<=e;++t)r*=t;return r}));defineBuiltinFunction("fact",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];return o instanceof CalcError?o:("number"==typeof(o=this.force(o))||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))&&((o|=0)>=0||(i="NUM",0))?(r.push(o),1<e.length?new CalcError("N/A"):r):o instanceof CalcError?o:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},_fact),defineBuiltinFunction("factdouble",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];return o instanceof CalcError?o:("number"==typeof(o=this.force(o))||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))&&((o|=0)>=0||(i="NUM",0))?(r.push(o),1<e.length?new CalcError("N/A"):r):o instanceof CalcError?o:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){for(var t=2+(1&e),r=1;t<=e;t+=2)r*=t;return r})),defineBuiltinFunction("multinomial",!1,{check:function(e){var t,r=[],n=0;try{var i=this.cellValues(e.slice(n)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n=e.length,r.push(i)}catch(e){if(e instanceof CalcError)return e;throw e}return n<e.length?new CalcError("N/A"):r},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e.slice(1)),this.resolveCells(r,t)}},(function(e){var t=1,r=0;return e.forEach((function(e){if(e<0)throw new CalcError("NUM");r+=e,t*=_fact(e)})),_fact(r)/t}));var _combinations=memoize((function(e,t){for(var r=t+1,n=1,i=1,o=1;n<=e-t;++r,++n)i*=r,o*=n;return i/o}));function _percentile(e,t){e.sort(ascending);var r=e.length,n=0|t,i=t-n;return 0===n?e[0]:n>=r?e[r-1]:e[--n]+i*(e[n+1]-e[n])}function _percentile_inc(e,t){return _percentile(e,t*(e.length-1)+1)}function _percentile_exc(e,t){return _percentile(e,t*(e.length+1))}defineBuiltinFunction("combin",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||!((o|=0)>0||(i="NUM",0)))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];return s instanceof CalcError?s:("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))&&(s|=0,1)&&(s>=0&&s<=o||(i="NUM",0))?(r.push(s),2<e.length?new CalcError("N/A"):r):s instanceof CalcError?s:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);return a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},_combinations),defineBuiltinFunction("combina",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||!((o|=0)>0||(i="NUM",0)))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];return s instanceof CalcError?s:("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))&&(s|=0,1)&&(s>=1&&s<=o||(i="NUM",0))?(r.push(s),2<e.length?new CalcError("N/A"):r):s instanceof CalcError?s:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);return a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t){return _combinations(e+t-1,e-1)})),defineBuiltinFunction("average",!1,{check:function(e){var t=[],r=0,n="VALUE";try{var i=this.cellValues(e.slice(r)).reduce(function(e,t){if(t instanceof CalcError)throw t;return"number"==typeof t&&(t=limitPrecision(t),1)&&e.push(t),e}.bind(this),[]);r=e.length,t.push(i)}catch(e){if(e instanceof CalcError)return e;throw e}return i.length>0||(n="DIV/0",0)?r<e.length?new CalcError("N/A"):t:new CalcError(n)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e.slice(1)),this.resolveCells(r,t)}},(function(e){return e.reduce((function(e,t){return e+t}),0)/e.length})),defineBuiltinFunction("averagea",!1,{check:function(e){var t=[],r=0;try{var n=this.cellValues(e.slice(r)).reduce(function(t,n){if(n instanceof CalcError)throw n;return null!=n&&r<=e.length&&t.push(n),t}.bind(this),[]);r=e.length,t.push(n)}catch(e){if(e instanceof CalcError)return e;throw e}return r<e.length?new CalcError("N/A"):t},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e.slice(1)),this.resolveCells(r,t)}},(function(e){var t=0,r=0;return e.forEach((function(e){"string"!=typeof e&&(t+=e),++r})),r?t/r:new CalcError("DIV/0")})),defineBuiltinFunction("percentile.inc",!1,{check:function(e){var t,r=[],n=0,i="VALUE";try{var o=this.cellValues(e.slice(n,n+1)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n+=1,r.push(o)}catch(e){if(e instanceof CalcError)return e;throw e}var s=e[n++];return s instanceof CalcError?s:("number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))&&(s>=0&&s<=1||(i="NUM",0))?(r.push(s),n<e.length?new CalcError("N/A"):r):s instanceof CalcError?s:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e.slice(n)),r.push(e[n++]),this.resolveCells(r,t)}},_percentile_inc),defineBuiltinFunction("percentile.exc",!1,{check:function(e){var t,r=[],n=0,i="VALUE";try{var o=this.cellValues(e.slice(n,n+1)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n+=1,r.push(o)}catch(e){if(e instanceof CalcError)return e;throw e}var s=e[n++];return s instanceof CalcError?s:("number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))&&(s>0&&s<1||(i="NUM",0))?(r.push(s),n<e.length?new CalcError("N/A"):r):s instanceof CalcError?s:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e.slice(n)),r.push(e[n++]),this.resolveCells(r,t)}},_percentile_exc),defineBuiltinFunction("quartile.inc",!1,{check:function(e){var t,r=[],n=0;try{var i=this.cellValues(e.slice(n,n+1)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n+=1,r.push(i)}catch(e){if(e instanceof CalcError)return e;throw e}var o=e[n++];return o instanceof CalcError?o:0!==(o=this.force(o))&&1!==o&&2!==o&&3!==o&&4!==o?o instanceof CalcError?o:new CalcError("VALUE"):(r.push(o),n<e.length?new CalcError("N/A"):r)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e.slice(n)),r.push(e[n++]),this.resolveCells(r,t)}},(function(e,t){return _percentile_inc(e,t/4)})),defineBuiltinFunction("quartile.exc",!1,{check:function(e){var t,r=[],n=0;try{var i=this.cellValues(e.slice(n,n+1)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n+=1,r.push(i)}catch(e){if(e instanceof CalcError)return e;throw e}var o=e[n++];return o instanceof CalcError?o:0!==(o=this.force(o))&&1!==o&&2!==o&&3!==o&&4!==o?o instanceof CalcError?o:new CalcError("VALUE"):(r.push(o),n<e.length?new CalcError("N/A"):r)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e.slice(n)),r.push(e[n++]),this.resolveCells(r,t)}},(function(e,t){return _percentile_exc(e,t/4)})),calc.runtime.defineAlias("quartile","quartile.inc"),calc.runtime.defineAlias("percentile","percentile.inc");var AGGREGATE_FUNCS=["AVERAGE","COUNT","COUNTA","MAX","MIN","PRODUCT","STDEV.S","STDEV.P","SUM","VAR.S","VAR.P","MEDIAN","MODE.SNGL","LARGE","SMALL","PERCENTILE.INC","QUARTILE.INC","PERCENTILE.EXC","QUARTILE.EXC"];function fetchValuesForAggregate(e,t,r){var n=[];return function t(i){if(i instanceof Ref)e.getRefCells(i,!0).forEach((function(e){var t=e.value;if(!(1&r&&e.hidden)){if(e.formula){var i=e.formula.print(e.row,e.col);if(/^\s*(?:aggregate|subtotal)\s*\(/i.test(i)&&!(4&r))return}2&r&&t instanceof CalcError||("number"==typeof t||t instanceof CalcError)&&n.push(t)}}));else if(Array.isArray(i))for(var o=0;o<i.length;++o)t(i[o]);else i instanceof Matrix?i.each(t):("number"==typeof i||i instanceof CalcError&&!(2&r))&&n.push(i)}(t),n}function _binom_dist(e,t,r,n){if(n){for(var i=0,o=0;o<=e;++o)i+=_combinations(t,o)*Math.pow(r,o)*Math.pow(1-r,t-o);return i}return _combinations(t,e)*Math.pow(r,e)*Math.pow(1-r,t-e)}function weeksInYear(e){var t=unpackDate$1(packDate$1(e,0,1));return 4==t.day||3==t.day&&calc.runtime.isLeapYear(e)?53:52}function _days_360(e,t,r){var n=unpackDate$1(e),i=unpackDate$1(t);return r?(31==n.date&&(n.date=30),31==i.date&&(i.date=30)):(1==n.month&&1==i.month&&n.date==daysInMonth(n.year,1)&&i.date==daysInMonth(i.year,1)&&(i.date=30),n.date==daysInMonth(n.year,n.month)?(n.date=30,31==i.date&&(i.date=30)):30==n.date&&31==i.date&&(i.date=30)),360*(i.year-n.year)+30*(i.month-n.month)+(i.date-n.date)}defineBuiltinFunction("aggregate",!0,{check:function(e){var t=[],r=0,n="VALUE",i=e[r++];if(i instanceof CalcError)return i;if(1!==(i=this.force(i))&&2!==i&&3!==i&&4!==i&&5!==i&&6!==i&&7!==i&&8!==i&&9!==i&&10!==i&&11!==i&&12!==i&&13!==i&&14!==i&&15!==i&&16!==i&&17!==i&&18!==i&&19!==i)return i instanceof CalcError?i:new CalcError(n);t.push(i);var o=e[r++];return o instanceof CalcError?o:null==(o=this.force(o))&&(o=0,1)||0===o||1===o||2===o||3===o||4===o||5===o||6===o||7===o?(t.push(o),t.push(e.slice(r)),(r=e.length)<e.length?new CalcError("N/A"):t):o instanceof CalcError?o:new CalcError(n)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},(function(e,t,r,n){var i=this;i.resolveCells(n,(function(){var o;if(t>12){o=fetchValuesForAggregate(i,n[0],r);var s=n[1];if(s instanceof CellRef&&(s=i.getRefData(s)),"number"!=typeof s)return e(new CalcError("VALUE"))}else o=fetchValuesForAggregate(i,n,r);i.func(AGGREGATE_FUNCS[t-1],e,o)}))})),defineBuiltinFunction("subtotal",!0,{check:function(e){var t,r,n=[],i=[],o=0,s="VALUE",a=e[o++];if(a instanceof CalcError)return a;if(1!==(a=this.force(a))&&2!==a&&3!==a&&4!==a&&5!==a&&6!==a&&7!==a&&8!==a&&9!==a&&10!==a&&11!==a&&101!==a&&102!==a&&103!==a&&104!==a&&105!==a&&106!==a&&107!==a&&108!==a&&109!==a&&110!==a&&111!==a)return a instanceof CalcError?a:new CalcError(s);if(i.push(a),o>=e.length)return new CalcError("N/A");i.push(t=[]),n.push(i),i=t;do{var l=e[o++];if(l instanceof CalcError)return l;if(!(l instanceof Ref||(r=this.asMatrix(l))&&(l=r)))return new CalcError(s);i.push(l)}while(o<e.length);return i=n.pop(),o<e.length?new CalcError("N/A"):i},resolve:function(e,t){var r=[],n=0;for(r.push(e[n++]);n<e.length;)n++;this.resolveCells(r,t)}},(function(e,t){var r=this,n=t>100;n&&(t-=100);for(var i=[],o=2;o<arguments.length;++o)i.push(arguments[o]);r.resolveCells(i,(function(){var o=fetchValuesForAggregate(r,i,n?1:0);r.func(AGGREGATE_FUNCS[t-1],e,o)}))})),defineBuiltinFunction("avedev",!1,{check:function(e){var t,r=[],n=0,i="VALUE";try{var o=this.cellValues(e.slice(n)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n=e.length,r.push(o)}catch(e){if(e instanceof CalcError)return e;throw e}return o.length>=2||(i="NUM",0)?n<e.length?new CalcError("N/A"):r:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e.slice(1)),this.resolveCells(r,t)}},(function(e){var t=e.reduce((function(e,t){return e+t}),0)/e.length;return e.reduce((function(e,r){return e+Math.abs(r-t)}),0)/e.length})),defineBuiltinFunction("binom.dist",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||!((o|=0)>=0||(i="NUM",0)))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!(("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))&&(s|=0,1)&&(s>=o||(i="N/A",0))))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];if(a instanceof CalcError)return a;if(!("number"==typeof(a=this.force(a))&&(a=limitPrecision(a),1)||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))||!(a>=0&&a<=1||(i="NUM",0)))return a instanceof CalcError?a:new CalcError(i);r.push(a);var l=e[n++];return l instanceof CalcError?l:"boolean"==typeof(l=this.force(l))||"number"==typeof l&&(l=!!l,1)?(r.push(l),4<e.length?new CalcError("N/A"):r):l instanceof CalcError?l:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},_binom_dist),calc.runtime.defineAlias("binomdist","binom.dist"),defineBuiltinFunction("binom.inv",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||!((o|=0)>=0||(i="NUM",0)))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||!(s>=0&&s<=1||(i="NUM",0)))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];return a instanceof CalcError?a:("number"==typeof(a=this.force(a))&&(a=limitPrecision(a),1)||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))&&(a>=0&&a<=1||(i="NUM",0))?(r.push(a),3<e.length?new CalcError("N/A"):r):a instanceof CalcError?a:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},(function(e,t,r){for(var n=0;n<=e;++n)if(_binom_dist(n,e,t,!0)>=r)return n;return new CalcError("N/A")})),calc.runtime.defineAlias("critbinom","binom.inv"),defineBuiltinFunction("binom.dist.range",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||!((o|=0)>=0||(i="NUM",0)))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||!(s>=0&&s<=1||(i="NUM",0)))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];if(a instanceof CalcError)return a;if(!(("number"==typeof(a=this.force(a))||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))&&(a|=0,1)&&(a>=0&&a<=o||(i="NUM",0))))return a instanceof CalcError?a:new CalcError(i);r.push(a);var l=e[n++];return l instanceof CalcError?l:("number"==typeof(l=this.force(l))||"boolean"==typeof l&&(l=+l,1)||"string"==typeof l&&!/^(?:=|true|false)/i.test(l)&&(t=calc.parse(0,0,0,l),/^date|number|percent$/.test(t.type)&&(l=+t.value,1)))&&(l|=0,1)&&(l>=a&&l<=o||(i="NUM",0))||null==l&&(l=a,1)?(r.push(l),4<e.length?new CalcError("N/A"):r):l instanceof CalcError?l:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},(function(e,t,r,n){for(var i=0,o=r;o<=n;++o)i+=_combinations(e,o)*Math.pow(t,o)*Math.pow(1-t,e-o);return i})),defineBuiltinFunction("negbinom.dist",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||!((o|=0)>=0||(i="NUM",0)))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||!((s|=0)>=0||(i="NUM",0)))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];if(a instanceof CalcError)return a;if(!("number"==typeof(a=this.force(a))&&(a=limitPrecision(a),1)||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))||!(a>=0&&a<=1||(i="NUM",0)))return a instanceof CalcError?a:new CalcError(i);r.push(a);var l=e[n++];return l instanceof CalcError?l:"boolean"==typeof(l=this.force(l))||"number"==typeof l&&(l=!!l,1)?(r.push(l),4<e.length?new CalcError("N/A"):r):l instanceof CalcError?l:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},(function(e,t,r,n){if(n){for(var i=0;e>=0;)i+=_combinations(e+t-1,e)*Math.pow(r,t)*Math.pow(1-r,e),e--;return i}return _combinations(e+t-1,e)*Math.pow(r,t)*Math.pow(1-r,e)})),calc.runtime.defineAlias("negbinomdist","negbinom.dist"),defineBuiltinFunction("address",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||!((o|=0)>0||(i="NUM",0)))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||!((s|=0)>0||(i="NUM",0)))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];if(a instanceof CalcError)return a;if(!(null==(a=this.force(a))&&(a=1,1)||1===a||2===a||3===a||4===a))return a instanceof CalcError?a:new CalcError(i);r.push(a);var l=e[n++];if(l instanceof CalcError)return l;if(!(null==(l=this.force(l))&&(l=!0,1)||"boolean"==typeof l||"number"==typeof l&&(l=!!l,1)))return l instanceof CalcError?l:new CalcError(i);r.push(l);var u=e[n++];return u instanceof CalcError?u:null==(u=this.force(u))||("string"==typeof u||"boolean"==typeof u||"number"==typeof u?(u+="",1):void 0===u&&(u="",1))?(r.push(u),5<e.length?new CalcError("N/A"):r):u instanceof CalcError?u:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},(function(e,t,r,n,i){var o=new CellRef(e-1,t-1,r-1);return i&&o.setSheet(i,!0),n?o.print(0,0):o.print()})),defineBuiltinFunction("areas",!1,{check:function(e){var t=[],r=0,n=e[r++];return n instanceof CalcError?n:n instanceof Ref?(t.push(n),1<e.length?new CalcError("N/A"):t):new CalcError("VALUE")}},(function(e){var t=0;return function e(r){r instanceof CellRef||r instanceof RangeRef?t++:r instanceof UnionRef&&r.refs.forEach(e)}(e),t})),defineBuiltinFunction("choose",!1,{check:function(e){var t,r=[],n=[],i=0,o="VALUE",s=e[i++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||(s|=0,0))return s instanceof CalcError?s:new CalcError(o);if(n.push(s),i>=e.length)return new CalcError("N/A");n.push(t=[]),r.push(n),n=t;do{var a=e[i++];if(a instanceof CalcError)return a;if(!(i<=e.length))return new CalcError(o);n.push(a)}while(i<e.length);return n=r.pop(),i<e.length?new CalcError("N/A"):n},resolve:function(e,t){var r=[],n=0;for(r.push(e[n++]);n<e.length;)n++;this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);for(s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;o<e.length;)t.push(e[o++]),i.push(!1);return{args:t,width:r,height:n,arrays:i}}},(function(e,t){return e>t.length?new CalcError("N/A"):t[e-1]})),defineBuiltinFunction("column",!1,{check:function(e){var t=[],r=0,n=e[r++];return n instanceof CalcError?n:n instanceof CellRef||n instanceof RangeRef||null==(n=this.force(n))?(t.push(n),1<e.length?new CalcError("N/A"):t):n instanceof CalcError?n:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)}},(function(e){return e?e instanceof CellRef?e.col+1:this.asMatrix(e).mapCol((function(t){return t+e.topLeft.col+1})):this.formula.col+1})),defineBuiltinFunction("columns",!1,{check:function(e){var t,r=[],n=0,i=e[n++];return i instanceof CalcError?i:i instanceof CellRef||i instanceof RangeRef||(t=this.asMatrix(i))&&(i=t)?(r.push(i),1<e.length?new CalcError("N/A"):r):new CalcError("VALUE")}},(function(e){return e instanceof Ref?e.width():e.width})),defineBuiltinFunction("formulatext",!1,{check:function(e){var t=[],r=0,n=e[r++];return n instanceof CalcError?n:n instanceof Ref?(t.push(n),1<e.length?new CalcError("N/A"):t):new CalcError("VALUE")}},(function(e){var t=this.getRefCells(e)[0];return t.formula?t.formula.print(t.row,t.col):new CalcError("N/A")})),defineBuiltinFunction("hlookup",!1,{check:function(e){var t,r,n=[],i=0,o="VALUE",s=e[i++];if(s instanceof CalcError)return s;if(!(null!=(s=this.force(s))&&i<=e.length))return s instanceof CalcError?s:new CalcError(o);n.push(s);var a=e[i++];if(a instanceof CalcError)return a;if(!(r=this.asMatrix(a))||!(a=r))return a instanceof CalcError?a:new CalcError(o);n.push(a);var l=e[i++];if(l instanceof CalcError)return l;if(!("number"==typeof(l=this.force(l))||"boolean"==typeof l&&(l=+l,1)||"string"==typeof l&&!/^(?:=|true|false)/i.test(l)&&(t=calc.parse(0,0,0,l),/^date|number|percent$/.test(t.type)&&(l=+t.value,1)))||!((l|=0)>0||(o="NUM",0)))return l instanceof CalcError?l:new CalcError(o);n.push(l);var u=e[i++];return u instanceof CalcError?u:"boolean"==typeof(u=this.force(u))||"number"==typeof u&&(u=!!u,1)||null==u&&(u=!0,1)?(n.push(u),i<e.length?new CalcError("N/A"):n):u instanceof CalcError?u:new CalcError(o)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},(function(e,t,r,n){var i=null;return t.eachCol((function(r){var o=t.get(0,r);if(n){if(o>e)return!0;i=r}else if(o===e)return i=r,!0})),null==i?new CalcError("N/A"):t.get(r-1,i)})),defineBuiltinFunction("index",!0,{check:function(e){var t,r,n=[],i=0,o="VALUE",s=e[i++];if(s instanceof CalcError)return s;if(!(s instanceof Ref||(r=this.asMatrix(s))&&(s=r)))return s instanceof CalcError?s:new CalcError(o);n.push(s);var a=e[i++];if(a instanceof CalcError)return a;if(!(("number"==typeof(a=this.force(a))||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))&&((a|=0)>=0||(o="NUM",0))||null==a))return a instanceof CalcError?a:new CalcError(o);n.push(a);var l=e[i++];if(l instanceof CalcError)return l;if(!(("number"==typeof(l=this.force(l))||"boolean"==typeof l&&(l=+l,1)||"string"==typeof l&&!/^(?:=|true|false)/i.test(l)&&(t=calc.parse(0,0,0,l),/^date|number|percent$/.test(t.type)&&(l=+t.value,1)))&&((l|=0)>=0||(o="NUM",0))||null==l))return l instanceof CalcError?l:new CalcError(o);n.push(l);var u=e[i++];return u instanceof CalcError?u:("number"==typeof(u=this.force(u))||"boolean"==typeof u&&(u=+u,1)||"string"==typeof u&&!/^(?:=|true|false)/i.test(u)&&(t=calc.parse(0,0,0,u),/^date|number|percent$/.test(t.type)&&(u=+t.value,1)))&&((u|=0)>0||(o="NUM",0))||null==u&&(u=1,1)?(n.push(u),4<e.length?new CalcError("N/A"):n):u instanceof CalcError?u:new CalcError(o)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},(function(e,t,r,n,i){var o=this;if(t instanceof UnionRef&&(t=t.refs[i-1]),!r&&!n||!t)return e(new CalcError("N/A"));if(t instanceof CellRef&&(t=t.toRangeRef()),t instanceof RangeRef){if(r&&n){if(n>t.width()||r>t.height())return e(new CalcError("REF"));var s=t.toCell(r-1,n-1);return void o.resolveCells([s],(function(){e(o.getRefData(s))}))}if(!r){var a=t.toColumn(n-1);return void o.resolveCells([a],(function(){e(o.asMatrix(a))}))}if(!n){var l=t.toRow(r-1);return void o.resolveCells([l],(function(){e(o.asMatrix(l))}))}}else if(t instanceof Matrix){if(t.width>1&&t.height>1){if(r&&n)return e(t.get(r-1,n-1));if(!r)return e(t.mapRow((function(e){return t.get(e,n-1)})));if(!n)return e(t.mapCol((function(e){return t.get(r-1,e)})))}if(1==t.width)return e(t.get((r||1)-1,0));if(1==t.height)return e(t.get(0,(n||1)-1))}else e(new CalcError("REF"))})),defineBuiltinFunction("indirect",!1,{check:function(e){var t=[],r=0,n=e[r++];return n instanceof CalcError?n:("string"==typeof(n=this.force(n))||"boolean"==typeof n||"number"==typeof n?(n+="",1):void 0===n&&(n="",1))?(t.push(n),1<e.length?new CalcError("N/A"):t):n instanceof CalcError?n:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)}},(function(e){try{var t=this.formula,r=calc.parseFormula(t.sheet,t.row,t.col,e).ast;if(r instanceof NameRef&&(r=this.ss.nameValue(r,t.sheet,t.row,t.col)),!(r instanceof Ref))throw 1;return r.absolute(t.row,t.col)}catch(e){return new CalcError("REF")}})),defineBuiltinFunction("match",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!(null!=(o=this.force(o))&&n<=e.length))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!(t=this.asMatrix(s))||!(s=t))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];return a instanceof CalcError?a:-1===(a=this.force(a))||0===a||1===a||null==a&&(a=1,1)?(r.push(a),n<e.length?new CalcError("N/A"):r):a instanceof CalcError?a:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},(function(e,t,r){var n,i=1;return 0===r?n=parseCriteria(e):-1===r?n=parseCriteria("<="+e):1===r&&(n=parseCriteria(">="+e)),t.each((function(t){if(null!=t&&n(t))return 0!==r&&e!=t&&--i,!0;i++}),!0)&&i>0?i:new CalcError("N/A")})),defineBuiltinFunction("offset",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!(o instanceof CellRef||o instanceof RangeRef))return new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||(s|=0,0))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];if(a instanceof CalcError)return a;if(!("number"==typeof(a=this.force(a))||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))||(a|=0,0))return a instanceof CalcError?a:new CalcError(i);r.push(a);var l=e[n++];if(l instanceof CalcError)return l;if(!(("number"==typeof(l=this.force(l))||"boolean"==typeof l&&(l=+l,1)||"string"==typeof l&&!/^(?:=|true|false)/i.test(l)&&(t=calc.parse(0,0,0,l),/^date|number|percent$/.test(t.type)&&(l=+t.value,1)))&&((l|=0)>0||(i="NUM",0))||null==l&&(l=o.height(),1)))return l instanceof CalcError?l:new CalcError(i);r.push(l);var u=e[n++];return u instanceof CalcError?u:("number"==typeof(u=this.force(u))||"boolean"==typeof u&&(u=+u,1)||"string"==typeof u&&!/^(?:=|true|false)/i.test(u)&&(t=calc.parse(0,0,0,u),/^date|number|percent$/.test(t.type)&&(u=+t.value,1)))&&((u|=0)>0||(i="NUM",0))||null==u&&(u=o.width(),1)?(r.push(u),5<e.length?new CalcError("N/A"):r):u instanceof CalcError?u:new CalcError(i)},resolve:function(e,t){var r=[],n=0;n++,r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0;t.push(e[o++]),i.push(!1);var s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var l=this._arrayArg(e[o]);l?(t.push(l),r=Math.max(r,l.width),n=Math.max(n,l.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var u=this._arrayArg(e[o]);return u?(t.push(u),r=Math.max(r,u.width),n=Math.max(n,u.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t,r,n,i){var o=(e instanceof CellRef?e:e.topLeft).clone();return o.row+=t,o.col+=r,o.row<0||o.col<0?new CalcError("VALUE"):n>1||i>1?new RangeRef(o,new CellRef(o.row+n-1,o.col+i-1)).setSheet(e.sheet,e.hasSheet()):o})),defineBuiltinFunction("row",!1,{check:function(e){var t=[],r=0,n=e[r++];return n instanceof CalcError?n:n instanceof CellRef||n instanceof RangeRef||null==(n=this.force(n))?(t.push(n),1<e.length?new CalcError("N/A"):t):n instanceof CalcError?n:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)}},(function(e){return e?e instanceof CellRef?e.row+1:this.asMatrix(e).mapRow((function(t){return t+e.topLeft.row+1})):this.formula.row+1})),defineBuiltinFunction("rows",!1,{check:function(e){var t,r=[],n=0,i=e[n++];return i instanceof CalcError?i:i instanceof CellRef||i instanceof RangeRef||(t=this.asMatrix(i))&&(i=t)?(r.push(i),1<e.length?new CalcError("N/A"):r):new CalcError("VALUE")}},(function(e){return e instanceof Ref?e.height():e.height})),defineBuiltinFunction("vlookup",!1,{check:function(e){var t,r,n=[],i=0,o="VALUE",s=e[i++];if(s instanceof CalcError)return s;if(!(null!=(s=this.force(s))&&i<=e.length))return s instanceof CalcError?s:new CalcError(o);n.push(s);var a=e[i++];if(a instanceof CalcError)return a;if(!(r=this.asMatrix(a))||!(a=r))return a instanceof CalcError?a:new CalcError(o);n.push(a);var l=e[i++];if(l instanceof CalcError)return l;if(!("number"==typeof(l=this.force(l))||"boolean"==typeof l&&(l=+l,1)||"string"==typeof l&&!/^(?:=|true|false)/i.test(l)&&(t=calc.parse(0,0,0,l),/^date|number|percent$/.test(t.type)&&(l=+t.value,1)))||!((l|=0)>0||(o="NUM",0)))return l instanceof CalcError?l:new CalcError(o);n.push(l);var u=e[i++];return u instanceof CalcError?u:"boolean"==typeof(u=this.force(u))||"number"==typeof u&&(u=!!u,1)||null==u&&(u=!0,1)?(n.push(u),i<e.length?new CalcError("N/A"):n):u instanceof CalcError?u:new CalcError(o)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},(function(e,t,r,n){var i=null;return"number"!=typeof e&&(n=!1),"string"==typeof e&&(e=e.toLowerCase()),t.eachRow((function(r){var o=t.get(r,0);if(n){if(o>e)return!0;i=r}else if("string"==typeof o&&(o=o.toLowerCase()),o===e)return i=r,!0})),null==i?new CalcError("N/A"):t.get(i,r-1)})),defineBuiltinFunction("date",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||(o|=0,0))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||(s|=0,0))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];return a instanceof CalcError?a:!("number"==typeof(a=this.force(a))||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))||(a|=0,0)?a instanceof CalcError?a:new CalcError(i):(r.push(a),3<e.length?new CalcError("N/A"):r)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var l=this._arrayArg(e[o]);return l?(t.push(l),r=Math.max(r,l.width),n=Math.max(n,l.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t,r){return packDate$1(e,t-1,r)})),defineBuiltinFunction("day",!1,{check:function(e){var t,r=[],n=0,i=e[n++];return i instanceof CalcError?i:!("number"==typeof(i=this.force(i))||"boolean"==typeof i&&(i=+i,1)||"string"==typeof i&&!/^(?:=|true|false)/i.test(i)&&(t=calc.parse(0,0,0,i),/^date|number|percent$/.test(t.type)&&(i=+t.value,1)))||(i|=0,0)?i instanceof CalcError?i:new CalcError("VALUE"):(r.push(i),1<e.length?new CalcError("N/A"):r)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return unpackDate$1(e).date})),defineBuiltinFunction("month",!1,{check:function(e){var t,r=[],n=0,i=e[n++];return i instanceof CalcError?i:!("number"==typeof(i=this.force(i))||"boolean"==typeof i&&(i=+i,1)||"string"==typeof i&&!/^(?:=|true|false)/i.test(i)&&(t=calc.parse(0,0,0,i),/^date|number|percent$/.test(t.type)&&(i=+t.value,1)))||(i|=0,0)?i instanceof CalcError?i:new CalcError("VALUE"):(r.push(i),1<e.length?new CalcError("N/A"):r)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return unpackDate$1(e).month+1})),defineBuiltinFunction("year",!1,{check:function(e){var t,r=[],n=0,i=e[n++];return i instanceof CalcError?i:!("number"==typeof(i=this.force(i))||"boolean"==typeof i&&(i=+i,1)||"string"==typeof i&&!/^(?:=|true|false)/i.test(i)&&(t=calc.parse(0,0,0,i),/^date|number|percent$/.test(t.type)&&(i=+t.value,1)))||(i|=0,0)?i instanceof CalcError?i:new CalcError("VALUE"):(r.push(i),1<e.length?new CalcError("N/A"):r)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return unpackDate$1(e).year})),defineBuiltinFunction("weekday",!1,{check:function(e){var t,r=[],n=0,i=e[n++];return i instanceof CalcError?i:!("number"==typeof(i=this.force(i))||"boolean"==typeof i&&(i=+i,1)||"string"==typeof i&&!/^(?:=|true|false)/i.test(i)&&(t=calc.parse(0,0,0,i),/^date|number|percent$/.test(t.type)&&(i=+t.value,1)))||(i|=0,0)?i instanceof CalcError?i:new CalcError("VALUE"):(r.push(i),1<e.length?new CalcError("N/A"):r)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return unpackDate$1(e).day+1})),defineBuiltinFunction("weeknum",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||(o|=0,0))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];return s instanceof CalcError?s:null==(s=this.force(s))&&(s=1,1)||1===s||2===s||11===s||12===s||13===s||14===s||15===s||16===s||17===s||21===s?(r.push(s),2<e.length?new CalcError("N/A"):r):s instanceof CalcError?s:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);return a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t){var r,n=packDate$1(unpackDate$1(e).year,0,1),i=unpackDate$1(n);return 21==t?((r=3-(i.day+6)%7)<0&&(r+=7),n+=r,i.date+=r,i.day=4,t=1):t=1==t?0:2==t?1:(t-10)%7,(r=i.day-t)<0&&(r+=7),n-=r,Math.ceil((e+1-n)/7)})),defineBuiltinFunction("isoweeknum",!1,{check:function(e){var t,r=[],n=0,i=e[n++];return i instanceof CalcError?i:!("number"==typeof(i=this.force(i))||"boolean"==typeof i&&(i=+i,1)||"string"==typeof i&&!/^(?:=|true|false)/i.test(i)&&(t=calc.parse(0,0,0,i),/^date|number|percent$/.test(t.type)&&(i=+t.value,1)))||(i|=0,0)?i instanceof CalcError?i:new CalcError("VALUE"):(r.push(i),1<e.length?new CalcError("N/A"):r)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){var t=unpackDate$1(e),r=t.day||7,n=Math.floor((t.ord-r+10)/7);return n<1?weeksInYear(t.year-1):53==n&&n>weeksInYear(t.year)?1:n})),defineBuiltinFunction("now",!1,{check:function(e){return 0<e.length?new CalcError("N/A"):[]}},(function(){return calc.runtime.dateToSerial(new Date)})),defineBuiltinFunction("today",!1,{check:function(e){return 0<e.length?new CalcError("N/A"):[]}},(function(){return 0|calc.runtime.dateToSerial(new Date)})),defineBuiltinFunction("time",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||(o|=0,0))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||(s|=0,0))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];return a instanceof CalcError?a:!("number"==typeof(a=this.force(a))||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))||(a|=0,0)?a instanceof CalcError?a:new CalcError(i):(r.push(a),3<e.length?new CalcError("N/A"):r)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var l=this._arrayArg(e[o]);return l?(t.push(l),r=Math.max(r,l.width),n=Math.max(n,l.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t,r){return calc.runtime.packTime(e,t,r,0)})),defineBuiltinFunction("hour",!1,{check:function(e){var t,r=[],n=0,i=e[n++];return i instanceof CalcError?i:"number"==typeof(i=this.force(i))&&(i=limitPrecision(i),1)||"boolean"==typeof i&&(i=+i,1)||"string"==typeof i&&!/^(?:=|true|false)/i.test(i)&&(t=calc.parse(0,0,0,i),/^date|number|percent$/.test(t.type)&&(i=+t.value,1))?(r.push(i),1<e.length?new CalcError("N/A"):r):i instanceof CalcError?i:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return calc.runtime.unpackTime(e).hours})),defineBuiltinFunction("minute",!1,{check:function(e){var t,r=[],n=0,i=e[n++];return i instanceof CalcError?i:"number"==typeof(i=this.force(i))&&(i=limitPrecision(i),1)||"boolean"==typeof i&&(i=+i,1)||"string"==typeof i&&!/^(?:=|true|false)/i.test(i)&&(t=calc.parse(0,0,0,i),/^date|number|percent$/.test(t.type)&&(i=+t.value,1))?(r.push(i),1<e.length?new CalcError("N/A"):r):i instanceof CalcError?i:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return calc.runtime.unpackTime(e).minutes})),defineBuiltinFunction("second",!1,{check:function(e){var t,r=[],n=0,i=e[n++];return i instanceof CalcError?i:"number"==typeof(i=this.force(i))&&(i=limitPrecision(i),1)||"boolean"==typeof i&&(i=+i,1)||"string"==typeof i&&!/^(?:=|true|false)/i.test(i)&&(t=calc.parse(0,0,0,i),/^date|number|percent$/.test(t.type)&&(i=+t.value,1))?(r.push(i),1<e.length?new CalcError("N/A"):r):i instanceof CalcError?i:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return calc.runtime.unpackTime(e).seconds})),defineBuiltinFunction("edate",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||(o|=0,0))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];return s instanceof CalcError?s:!("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||(s|=0,0)?s instanceof CalcError?s:new CalcError(i):(r.push(s),2<e.length?new CalcError("N/A"):r)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);return a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t){var r=unpackDate$1(e),n=r.month+t,i=r.year+Math.floor(n/12);return(n%=12)<0&&(n+=12),r=Math.min(r.date,daysInMonth(i,n)),packDate$1(i,n,r)})),defineBuiltinFunction("eomonth",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||(o|=0,0))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];return s instanceof CalcError?s:!("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||(s|=0,0)?s instanceof CalcError?s:new CalcError(i):(r.push(s),2<e.length?new CalcError("N/A"):r)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);return a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t){var r=unpackDate$1(e),n=r.month+t,i=r.year+Math.floor(n/12);return(n%=12)<0&&(n+=12),r=daysInMonth(i,n),packDate$1(i,n,r)})),defineBuiltinFunction("workday",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||(o|=0,0))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||(s|=0,0))return s instanceof CalcError?s:new CalcError(i);r.push(s);try{var a=this.cellValues(e.slice(n)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&(r|=0,1)&&e.push(r),e}.bind(this),[]);n=e.length,r.push(a)}catch(e){if(e instanceof CalcError)return e;throw e}return n<e.length?new CalcError("N/A"):r},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e.slice(2)),this.resolveCells(r,t)}},(function(e,t,r){var n=t>0?1:-1;t=Math.abs(t);for(var i=unpackDate$1(e).day;t>0;)e+=n,(i=(i+n)%7)>0&&i<6&&r.indexOf(e)<0&&--t;return e})),defineBuiltinFunction("networkdays",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||(o|=0,0))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||(s|=0,0))return s instanceof CalcError?s:new CalcError(i);r.push(s);try{var a=this.cellValues(e.slice(n)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&(r|=0,1)&&e.push(r),e}.bind(this),[]);n=e.length,r.push(a)}catch(e){if(e instanceof CalcError)return e;throw e}return n<e.length?new CalcError("N/A"):r},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e.slice(2)),this.resolveCells(r,t)}},(function(e,t,r){if(e>t){var n=e;e=t,t=n}for(var i=0,o=unpackDate$1(e).day;e<=t;)o>0&&o<6&&r.indexOf(e)<0&&i++,e++,o=(o+1)%7;return i})),defineBuiltinFunction("days",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||(o|=0,0))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];return s instanceof CalcError?s:!("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||(s|=0,0)?s instanceof CalcError?s:new CalcError(i):(r.push(s),2<e.length?new CalcError("N/A"):r)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);return a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t){return e-t})),calc.runtime._days_360=_days_360,defineBuiltinFunction("days360",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||(o|=0,0))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||(s|=0,0))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];return a instanceof CalcError?a:"boolean"==typeof(a=this.force(a))||"number"==typeof a&&(a=!!a,1)||null==a&&(a=!1,1)?(r.push(a),3<e.length?new CalcError("N/A"):r):a instanceof CalcError?a:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var l=this._arrayArg(e[o]);return l?(t.push(l),r=Math.max(r,l.width),n=Math.max(n,l.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},_days_360),defineBuiltinFunction("yearfrac",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||(o|=0,0))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||(s|=0,0))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];return a instanceof CalcError?a:null==(a=this.force(a))&&(a=0,1)||0===a||1===a||2===a||3===a||4===a?(r.push(a),3<e.length?new CalcError("N/A"):r):a instanceof CalcError?a:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var l=this._arrayArg(e[o]);return l?(t.push(l),r=Math.max(r,l.width),n=Math.max(n,l.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t,r){switch(r){case 0:return _days_360(e,t,!1)/360;case 1:return(t-e)/daysInYear(unpackDate$1(e).year);case 2:return(t-e)/360;case 3:return(t-e)/365;case 4:return _days_360(e,t,!0)/360}})),defineBuiltinFunction("datevalue",!1,{check:function(e){var t=[],r=0,n=e[r++];return n instanceof CalcError?n:("string"==typeof(n=this.force(n))||"boolean"==typeof n||"number"==typeof n?(n+="",1):void 0===n&&(n="",1))?(t.push(n),1<e.length?new CalcError("N/A"):t):n instanceof CalcError?n:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){var t=calc.runtime.parseDate(e);return t?calc.runtime.dateToSerial(t):new CalcError("VALUE")})),defineBuiltinFunction("timevalue",!1,{check:function(e){var t=[],r=0,n=e[r++];return n instanceof CalcError?n:("string"==typeof(n=this.force(n))||"boolean"==typeof n||"number"==typeof n?(n+="",1):void 0===n&&(n="",1))?(t.push(n),1<e.length?new CalcError("N/A"):t):n instanceof CalcError?n:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){var t=e.toLowerCase().match(/(\d+):(\d+)(:(\d+)(\.(\d+))?)?\s*(am?|pm?)?/);if(t){var r=parseFloat(t[1]),n=parseFloat(t[2]),i=t[3]?parseFloat(t[4]):0,o=t[7];return o&&(r>12||r<1)?new CalcError("VALUE"):(/^p/.test(o)&&(r+=12),calc.runtime.packTime(r,n,i,0))}return new CalcError("VALUE")})),defineBuiltinFunction("mdeterm",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];return o instanceof CalcError?o:!(t=this.asMatrix(o))||!(o=t)||o.width!=o.height&&(i="N/A",1)?o instanceof CalcError?o:new CalcError(i):(r.push(o),1<e.length?new CalcError("N/A"):r)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)}},(function(e){return e.each((function(e){if("number"!=typeof e)return new CalcError("VALUE")}),!0)||e.determinant()})),defineBuiltinFunction("transpose",!1,{check:function(e){var t,r=[],n=0,i=e[n++];return i instanceof CalcError?i:(t=this.asMatrix(i))&&(i=t)?(r.push(i),1<e.length?new CalcError("N/A"):r):i instanceof CalcError?i:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)}},(function(e){return e.transpose()})),defineBuiltinFunction("mmult",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!(t=this.asMatrix(o))||!(o=t))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];return s instanceof CalcError?s:!(t=this.asMatrix(s))||!(s=t)||s.height!=o.width&&(i="N/A",1)?s instanceof CalcError?s:new CalcError(i):(r.push(s),2<e.length?new CalcError("N/A"):r)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},(function(e,t){return e.multiply(t)})),defineBuiltinFunction("munit",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];return o instanceof CalcError?o:("number"==typeof(o=this.force(o))||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))&&((o|=0)>=0||(i="NUM",0))?(r.push(o),1<e.length?new CalcError("N/A"):r):o instanceof CalcError?o:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)}},(function(e){return new Matrix(this).unit(e)})),defineBuiltinFunction("minverse",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];return o instanceof CalcError?o:!(t=this.asMatrix(o))||!(o=t)||o.width!=o.height&&(i="N/A",1)?o instanceof CalcError?o:new CalcError(i):(r.push(o),1<e.length?new CalcError("N/A"):r)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)}},(function(e){return e.each((function(e){if("number"!=typeof e)return new CalcError("VALUE")}),!0)||e.inverse()||new CalcError("VALUE")})),defineBuiltinFunction("rand",!1,{check:function(e){return 0<e.length?new CalcError("N/A"):[]}},(function(){return Math.random()})),defineBuiltinFunction("randbetween",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||(o|=0,0))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];return s instanceof CalcError?s:("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))&&(s|=0,1)&&(s>=o||(i="N/A",0))?(r.push(s),2<e.length?new CalcError("N/A"):r):s instanceof CalcError?s:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},(function(e,t){return e+Math.floor((t-e+1)*Math.random())})),defineBuiltinFunction("true",!1,{check:function(e){return 0<e.length?new CalcError("N/A"):[]}},(function(){return!0})),defineBuiltinFunction("false",!1,{check:function(e){return 0<e.length?new CalcError("N/A"):[]}},(function(){return!0})),defineBuiltinFunction("roman",!1,{check:function(e){var t,r=[],n=0,i=e[n++];return i instanceof CalcError?i:!("number"==typeof(i=this.force(i))||"boolean"==typeof i&&(i=+i,1)||"string"==typeof i&&!/^(?:=|true|false)/i.test(i)&&(t=calc.parse(0,0,0,i),/^date|number|percent$/.test(t.type)&&(i=+t.value,1)))||(i|=0,0)?i instanceof CalcError?i:new CalcError("VALUE"):(r.push(i),1<e.length?new CalcError("N/A"):r)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return arabicToRoman(e).toUpperCase()})),defineBuiltinFunction("arabic",!1,{check:function(e){var t=[],r=0,n=e[r++];return n instanceof CalcError?n:("string"==typeof(n=this.force(n))||"boolean"==typeof n||"number"==typeof n?(n+="",1):void 0===n&&(n="",1))?(t.push(n),1<e.length?new CalcError("N/A"):t):n instanceof CalcError?n:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){var t=romanToArabic(e);return null==t?new CalcError("VALUE"):t})),defineBuiltinFunction("base",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||(o|=0,0))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!(("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))&&(s|=0,1)&&(s>=2&&s<=36||(i="NUM",0))))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];return a instanceof CalcError?a:("number"==typeof(a=this.force(a))||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))&&((a|=0)>=0||(i="NUM",0))||null==a&&(a=0,1)?(r.push(a),3<e.length?new CalcError("N/A"):r):a instanceof CalcError?a:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var l=this._arrayArg(e[o]);return l?(t.push(l),r=Math.max(r,l.width),n=Math.max(n,l.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t,r){for(var n=e.toString(t).toUpperCase();n.length<r;)n="0"+n;return n})),defineBuiltinFunction("decimal",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("string"==typeof(o=this.force(o))||"boolean"==typeof o||"number"==typeof o?(o+="",1):void 0===o&&(o="",1)))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];return s instanceof CalcError?s:("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))&&(s|=0,1)&&(s>=2&&s<=36||(i="NUM",0))?(r.push(s),2<e.length?new CalcError("N/A"):r):s instanceof CalcError?s:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);return a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t){e=e.toUpperCase();for(var r=0,n=0;n<e.length;++n){var i=e.charCodeAt(n);if(i>=48&&i<=57)i-=48;else{if(!(i>=65&&i<55+t))return new CalcError("VALUE");i-=55}r=r*t+i}return r})),defineBuiltinFunction("char",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];return o instanceof CalcError?o:("number"==typeof(o=this.force(o))||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))&&((o|=0)>=0||(i="NUM",0))?(r.push(o),1<e.length?new CalcError("N/A"):r):o instanceof CalcError?o:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return String.fromCharCode(e)}));var RX_NON_PRINTABLE=/[\0-\x1F\x7F-\x9F\xAD\u0378\u0379\u037F-\u0383\u038B\u038D\u03A2\u0528-\u0530\u0557\u0558\u0560\u0588\u058B-\u058E\u0590\u05C8-\u05CF\u05EB-\u05EF\u05F5-\u0605\u061C\u061D\u06DD\u070E\u070F\u074B\u074C\u07B2-\u07BF\u07FB-\u07FF\u082E\u082F\u083F\u085C\u085D\u085F-\u089F\u08A1\u08AD-\u08E3\u08FF\u0978\u0980\u0984\u098D\u098E\u0991\u0992\u09A9\u09B1\u09B3-\u09B5\u09BA\u09BB\u09C5\u09C6\u09C9\u09CA\u09CF-\u09D6\u09D8-\u09DB\u09DE\u09E4\u09E5\u09FC-\u0A00\u0A04\u0A0B-\u0A0E\u0A11\u0A12\u0A29\u0A31\u0A34\u0A37\u0A3A\u0A3B\u0A3D\u0A43-\u0A46\u0A49\u0A4A\u0A4E-\u0A50\u0A52-\u0A58\u0A5D\u0A5F-\u0A65\u0A76-\u0A80\u0A84\u0A8E\u0A92\u0AA9\u0AB1\u0AB4\u0ABA\u0ABB\u0AC6\u0ACA\u0ACE\u0ACF\u0AD1-\u0ADF\u0AE4\u0AE5\u0AF2-\u0B00\u0B04\u0B0D\u0B0E\u0B11\u0B12\u0B29\u0B31\u0B34\u0B3A\u0B3B\u0B45\u0B46\u0B49\u0B4A\u0B4E-\u0B55\u0B58-\u0B5B\u0B5E\u0B64\u0B65\u0B78-\u0B81\u0B84\u0B8B-\u0B8D\u0B91\u0B96-\u0B98\u0B9B\u0B9D\u0BA0-\u0BA2\u0BA5-\u0BA7\u0BAB-\u0BAD\u0BBA-\u0BBD\u0BC3-\u0BC5\u0BC9\u0BCE\u0BCF\u0BD1-\u0BD6\u0BD8-\u0BE5\u0BFB-\u0C00\u0C04\u0C0D\u0C11\u0C29\u0C34\u0C3A-\u0C3C\u0C45\u0C49\u0C4E-\u0C54\u0C57\u0C5A-\u0C5F\u0C64\u0C65\u0C70-\u0C77\u0C80\u0C81\u0C84\u0C8D\u0C91\u0CA9\u0CB4\u0CBA\u0CBB\u0CC5\u0CC9\u0CCE-\u0CD4\u0CD7-\u0CDD\u0CDF\u0CE4\u0CE5\u0CF0\u0CF3-\u0D01\u0D04\u0D0D\u0D11\u0D3B\u0D3C\u0D45\u0D49\u0D4F-\u0D56\u0D58-\u0D5F\u0D64\u0D65\u0D76-\u0D78\u0D80\u0D81\u0D84\u0D97-\u0D99\u0DB2\u0DBC\u0DBE\u0DBF\u0DC7-\u0DC9\u0DCB-\u0DCE\u0DD5\u0DD7\u0DE0-\u0DF1\u0DF5-\u0E00\u0E3B-\u0E3E\u0E5C-\u0E80\u0E83\u0E85\u0E86\u0E89\u0E8B\u0E8C\u0E8E-\u0E93\u0E98\u0EA0\u0EA4\u0EA6\u0EA8\u0EA9\u0EAC\u0EBA\u0EBE\u0EBF\u0EC5\u0EC7\u0ECE\u0ECF\u0EDA\u0EDB\u0EE0-\u0EFF\u0F48\u0F6D-\u0F70\u0F98\u0FBD\u0FCD\u0FDB-\u0FFF\u10C6\u10C8-\u10CC\u10CE\u10CF\u1249\u124E\u124F\u1257\u1259\u125E\u125F\u1289\u128E\u128F\u12B1\u12B6\u12B7\u12BF\u12C1\u12C6\u12C7\u12D7\u1311\u1316\u1317\u135B\u135C\u137D-\u137F\u139A-\u139F\u13F5-\u13FF\u169D-\u169F\u16F1-\u16FF\u170D\u1715-\u171F\u1737-\u173F\u1754-\u175F\u176D\u1771\u1774-\u177F\u17DE\u17DF\u17EA-\u17EF\u17FA-\u17FF\u180F\u181A-\u181F\u1878-\u187F\u18AB-\u18AF\u18F6-\u18FF\u191D-\u191F\u192C-\u192F\u193C-\u193F\u1941-\u1943\u196E\u196F\u1975-\u197F\u19AC-\u19AF\u19CA-\u19CF\u19DB-\u19DD\u1A1C\u1A1D\u1A5F\u1A7D\u1A7E\u1A8A-\u1A8F\u1A9A-\u1A9F\u1AAE-\u1AFF\u1B4C-\u1B4F\u1B7D-\u1B7F\u1BF4-\u1BFB\u1C38-\u1C3A\u1C4A-\u1C4C\u1C80-\u1CBF\u1CC8-\u1CCF\u1CF7-\u1CFF\u1DE7-\u1DFB\u1F16\u1F17\u1F1E\u1F1F\u1F46\u1F47\u1F4E\u1F4F\u1F58\u1F5A\u1F5C\u1F5E\u1F7E\u1F7F\u1FB5\u1FC5\u1FD4\u1FD5\u1FDC\u1FF0\u1FF1\u1FF5\u1FFF\u200B-\u200F\u202A-\u202E\u2060-\u206F\u2072\u2073\u208F\u209D-\u209F\u20BB-\u20CF\u20F1-\u20FF\u218A-\u218F\u23F4-\u23FF\u2427-\u243F\u244B-\u245F\u2700\u2B4D-\u2B4F\u2B5A-\u2BFF\u2C2F\u2C5F\u2CF4-\u2CF8\u2D26\u2D28-\u2D2C\u2D2E\u2D2F\u2D68-\u2D6E\u2D71-\u2D7E\u2D97-\u2D9F\u2DA7\u2DAF\u2DB7\u2DBF\u2DC7\u2DCF\u2DD7\u2DDF\u2E3C-\u2E7F\u2E9A\u2EF4-\u2EFF\u2FD6-\u2FEF\u2FFC-\u2FFF\u3040\u3097\u3098\u3100-\u3104\u312E-\u3130\u318F\u31BB-\u31BF\u31E4-\u31EF\u321F\u32FF\u4DB6-\u4DBF\u9FCD-\u9FFF\uA48D-\uA48F\uA4C7-\uA4CF\uA62C-\uA63F\uA698-\uA69E\uA6F8-\uA6FF\uA78F\uA794-\uA79F\uA7AB-\uA7F7\uA82C-\uA82F\uA83A-\uA83F\uA878-\uA87F\uA8C5-\uA8CD\uA8DA-\uA8DF\uA8FC-\uA8FF\uA954-\uA95E\uA97D-\uA97F\uA9CE\uA9DA-\uA9DD\uA9E0-\uA9FF\uAA37-\uAA3F\uAA4E\uAA4F\uAA5A\uAA5B\uAA7C-\uAA7F\uAAC3-\uAADA\uAAF7-\uAB00\uAB07\uAB08\uAB0F\uAB10\uAB17-\uAB1F\uAB27\uAB2F-\uABBF\uABEE\uABEF\uABFA-\uABFF\uD7A4-\uD7AF\uD7C7-\uD7CA\uD7FC-\uF8FF\uFA6E\uFA6F\uFADA-\uFAFF\uFB07-\uFB12\uFB18-\uFB1C\uFB37\uFB3D\uFB3F\uFB42\uFB45\uFBC2-\uFBD2\uFD40-\uFD4F\uFD90\uFD91\uFDC8-\uFDEF\uFDFE\uFDFF\uFE1A-\uFE1F\uFE27-\uFE2F\uFE53\uFE67\uFE6C-\uFE6F\uFE75\uFEFD-\uFF00\uFFBF-\uFFC1\uFFC8\uFFC9\uFFD0\uFFD1\uFFD8\uFFD9\uFFDD-\uFFDF\uFFE7\uFFEF-\uFFFB\uFFFE\uFFFF]/g;function Hyperlink(e,t){this.link=e,this.text=t}defineBuiltinFunction("clean",!1,{check:function(e){var t=[],r=0,n=e[r++];return n instanceof CalcError?n:("string"==typeof(n=this.force(n))||"boolean"==typeof n||"number"==typeof n?(n+="",1):void 0===n&&(n="",1))?(t.push(n),1<e.length?new CalcError("N/A"):t):n instanceof CalcError?n:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return e.replace(RX_NON_PRINTABLE,"")})),defineBuiltinFunction("code",!1,{check:function(e){var t=[],r=0,n=e[r++];return n instanceof CalcError?n:("string"==typeof(n=this.force(n))||"boolean"==typeof n||"number"==typeof n?(n+="",1):void 0===n&&(n="",1))?(t.push(n),1<e.length?new CalcError("N/A"):t):n instanceof CalcError?n:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return e.charAt(0)})),calc.runtime.defineAlias("unichar","char"),calc.runtime.defineAlias("unicode","code"),defineBuiltinFunction("concatenate",!1,{check:function(e){var t,r=[],n=[],i=0;if(i>=e.length)return new CalcError("N/A");n.push(t=[]),r.push(n),n=t;do{var o=e[i++];if(o instanceof CalcError)return o;if(!("string"==typeof(o=this.force(o))||"boolean"==typeof o||"number"==typeof o?(o+="",1):void 0===o&&(o="",1)))return o instanceof CalcError?o:new CalcError("VALUE");n.push(o)}while(i<e.length);return n=r.pop(),i<e.length?new CalcError("N/A"):n},resolve:function(e,t){for(var r=[],n=0;n<e.length;)r.push(e[n++]);this.resolveCells(r,t)},arrayArgs:function(e){for(var t=[],r=0,n=0,i=[],o=0;o<e.length;){var s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++}return{args:t,width:r,height:n,arrays:i}}},(function(e){for(var t="",r=0;r<e.length;++r)t+=e[r];return t})),defineBuiltinFunction("dollar",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1))))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];return s instanceof CalcError?s:("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))&&(s|=0,1)||null==s&&(s=2,1)?(r.push(s),2<e.length?new CalcError("N/A"):r):s instanceof CalcError?s:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);return a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t){for(var r="$#,##0DECIMALS;($#,##0DECIMALS)",n="",i=1;t-- >0;)n+="0";for(;++t<0;)i*=10;return""!==n?n="."+n:1!==i&&(e=Math.round(e/i)*i),r=r.replace(/DECIMALS/g,n),formatting.text(e,r)})),defineBuiltinFunction("exact",!1,{check:function(e){var t=[],r=0,n="VALUE",i=e[r++];if(i instanceof CalcError)return i;if(!("string"==typeof(i=this.force(i))||"boolean"==typeof i||"number"==typeof i?(i+="",1):void 0===i&&(i="",1)))return i instanceof CalcError?i:new CalcError(n);t.push(i);var o=e[r++];return o instanceof CalcError?o:("string"==typeof(o=this.force(o))||"boolean"==typeof o||"number"==typeof o?(o+="",1):void 0===o&&(o="",1))?(t.push(o),2<e.length?new CalcError("N/A"):t):o instanceof CalcError?o:new CalcError(n)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);return a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t){return e===t})),defineBuiltinFunction("find",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("string"==typeof(o=this.force(o))||"boolean"==typeof o||"number"==typeof o?(o+="",1):void 0===o&&(o="",1)))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("string"==typeof(s=this.force(s))||"boolean"==typeof s||"number"==typeof s?(s+="",1):void 0===s&&(s="",1)))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];return a instanceof CalcError?a:("number"==typeof(a=this.force(a))||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))&&((a|=0)>0||(i="NUM",0))||null==a&&(a=1,1)?(r.push(a),3<e.length?new CalcError("N/A"):r):a instanceof CalcError?a:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var l=this._arrayArg(e[o]);return l?(t.push(l),r=Math.max(r,l.width),n=Math.max(n,l.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t,r){var n=t.indexOf(e,r-1);return n<0?new CalcError("VALUE"):n+1})),defineBuiltinFunction("fixed",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1))))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!(("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))&&(s|=0,1)||null==s&&(s=2,1)))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];return a instanceof CalcError?a:"boolean"==typeof(a=this.force(a))||null==a&&(a=!1,1)?(r.push(a),3<e.length?new CalcError("N/A"):r):a instanceof CalcError?a:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var l=this._arrayArg(e[o]);return l?(t.push(l),r=Math.max(r,l.width),n=Math.max(n,l.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t,r){var n=Math.pow(10,t);e=Math.round(e*n)/n;var i=r?"0":"#,##0";if(t>0)for(i+=".";t-- >0;)i+="0";return formatting.text(e,i)})),defineBuiltinFunction("left",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("string"==typeof(o=this.force(o))||"boolean"==typeof o||"number"==typeof o?(o+="",1):void 0===o&&(o="",1)))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];return s instanceof CalcError?s:("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))&&((s|=0)>=0||(i="NUM",0))||null==s&&(s=1,1)?(r.push(s),2<e.length?new CalcError("N/A"):r):s instanceof CalcError?s:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);return a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t){return e.substr(0,t)})),defineBuiltinFunction("right",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("string"==typeof(o=this.force(o))||"boolean"==typeof o||"number"==typeof o?(o+="",1):void 0===o&&(o="",1)))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];return s instanceof CalcError?s:("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))&&((s|=0)>=0||(i="NUM",0))||null==s&&(s=1,1)?(r.push(s),2<e.length?new CalcError("N/A"):r):s instanceof CalcError?s:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);return a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t){return e.substr(-t)})),defineBuiltinFunction("len",!1,{check:function(e){var t=[],r=0,n=e[r++];return n instanceof CalcError?n:("string"==typeof(n=this.force(n))||"boolean"==typeof n||"number"==typeof n?(n+="",1):void 0===n&&(n="",1))?(t.push(n),1<e.length?new CalcError("N/A"):t):n instanceof CalcError?n:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return e.length})),defineBuiltinFunction("lower",!1,{check:function(e){var t=[],r=0,n=e[r++];return n instanceof CalcError?n:("string"==typeof(n=this.force(n))||"boolean"==typeof n||"number"==typeof n?(n+="",1):void 0===n&&(n="",1))?(t.push(n),1<e.length?new CalcError("N/A"):t):n instanceof CalcError?n:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return e.toLowerCase()})),defineBuiltinFunction("upper",!1,{check:function(e){var t=[],r=0,n=e[r++];return n instanceof CalcError?n:("string"==typeof(n=this.force(n))||"boolean"==typeof n||"number"==typeof n?(n+="",1):void 0===n&&(n="",1))?(t.push(n),1<e.length?new CalcError("N/A"):t):n instanceof CalcError?n:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return e.toUpperCase()})),defineBuiltinFunction("ltrim",!1,{check:function(e){var t=[],r=0,n=e[r++];return n instanceof CalcError?n:("string"==typeof(n=this.force(n))||"boolean"==typeof n||"number"==typeof n?(n+="",1):void 0===n&&(n="",1))?(t.push(n),1<e.length?new CalcError("N/A"):t):n instanceof CalcError?n:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return e.replace(/^\s+/,"")})),defineBuiltinFunction("rtrim",!1,{check:function(e){var t=[],r=0,n=e[r++];return n instanceof CalcError?n:("string"==typeof(n=this.force(n))||"boolean"==typeof n||"number"==typeof n?(n+="",1):void 0===n&&(n="",1))?(t.push(n),1<e.length?new CalcError("N/A"):t):n instanceof CalcError?n:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return e.replace(/\s+$/,"")})),defineBuiltinFunction("trim",!1,{check:function(e){var t=[],r=0,n=e[r++];return n instanceof CalcError?n:("string"==typeof(n=this.force(n))||"boolean"==typeof n||"number"==typeof n?(n+="",1):void 0===n&&(n="",1))?(t.push(n),1<e.length?new CalcError("N/A"):t):n instanceof CalcError?n:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return e.replace(/^\s+|\s+$/,"")})),defineBuiltinFunction("mid",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("string"==typeof(o=this.force(o))||"boolean"==typeof o||"number"==typeof o?(o+="",1):void 0===o&&(o="",1)))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||!((s|=0)>0||(i="NUM",0)))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];return a instanceof CalcError?a:("number"==typeof(a=this.force(a))||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))&&((a|=0)>=0||(i="NUM",0))?(r.push(a),3<e.length?new CalcError("N/A"):r):a instanceof CalcError?a:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var l=this._arrayArg(e[o]);return l?(t.push(l),r=Math.max(r,l.width),n=Math.max(n,l.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t,r){return e.substr(t-1,r)})),defineBuiltinFunction("proper",!1,{check:function(e){var t=[],r=0,n=e[r++];return n instanceof CalcError?n:("string"==typeof(n=this.force(n))||"boolean"==typeof n||"number"==typeof n?(n+="",1):void 0===n&&(n="",1))?(t.push(n),1<e.length?new CalcError("N/A"):t):n instanceof CalcError?n:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return e.toLowerCase().replace(/\b./g,(function(e){return e.toUpperCase()}))})),defineBuiltinFunction("replace",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("string"==typeof(o=this.force(o))||"boolean"==typeof o||"number"==typeof o?(o+="",1):void 0===o&&(o="",1)))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||!((s|=0)>0||(i="NUM",0)))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];if(a instanceof CalcError)return a;if(!("number"==typeof(a=this.force(a))||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))||!((a|=0)>=0||(i="NUM",0)))return a instanceof CalcError?a:new CalcError(i);r.push(a);var l=e[n++];return l instanceof CalcError?l:("string"==typeof(l=this.force(l))||"boolean"==typeof l||"number"==typeof l?(l+="",1):void 0===l&&(l="",1))?(r.push(l),4<e.length?new CalcError("N/A"):r):l instanceof CalcError?l:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var l=this._arrayArg(e[o]);l?(t.push(l),r=Math.max(r,l.width),n=Math.max(n,l.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var u=this._arrayArg(e[o]);return u?(t.push(u),r=Math.max(r,u.width),n=Math.max(n,u.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t,r,n){return e.substr(0,--t)+n+e.substr(t+r)})),defineBuiltinFunction("rept",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("string"==typeof(o=this.force(o))||"boolean"==typeof o||"number"==typeof o?(o+="",1):void 0===o&&(o="",1)))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];return s instanceof CalcError?s:("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))&&((s|=0)>=0||(i="NUM",0))?(r.push(s),2<e.length?new CalcError("N/A"):r):s instanceof CalcError?s:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);return a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t){for(var r="";t-- >0;)r+=e;return r})),defineBuiltinFunction("search",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("string"==typeof(o=this.force(o))||"boolean"==typeof o||"number"==typeof o?(o+="",1):void 0===o&&(o="",1)))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("string"==typeof(s=this.force(s))||"boolean"==typeof s||"number"==typeof s?(s+="",1):void 0===s&&(s="",1)))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];return a instanceof CalcError?a:("number"==typeof(a=this.force(a))||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))&&((a|=0)>0||(i="NUM",0))||null==a&&(a=1,1)?(r.push(a),3<e.length?new CalcError("N/A"):r):a instanceof CalcError?a:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var l=this._arrayArg(e[o]);return l?(t.push(l),r=Math.max(r,l.width),n=Math.max(n,l.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t,r){var n=t.toLowerCase().indexOf(e.toLowerCase(),r-1);return n<0?new CalcError("VALUE"):n+1})),defineBuiltinFunction("substitute",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("string"==typeof(o=this.force(o))||"boolean"==typeof o||"number"==typeof o?(o+="",1):void 0===o&&(o="",1)))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("string"==typeof(s=this.force(s))||"boolean"==typeof s||"number"==typeof s?(s+="",1):void 0===s&&(s="",1)))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];if(a instanceof CalcError)return a;if(!("string"==typeof(a=this.force(a))||"boolean"==typeof a||"number"==typeof a?(a+="",1):void 0===a&&(a="",1)))return a instanceof CalcError?a:new CalcError(i);r.push(a);var l=e[n++];return l instanceof CalcError?l:("number"==typeof(l=this.force(l))||"boolean"==typeof l&&(l=+l,1)||"string"==typeof l&&!/^(?:=|true|false)/i.test(l)&&(t=calc.parse(0,0,0,l),/^date|number|percent$/.test(t.type)&&(l=+t.value,1)))&&((l|=0)>0||(i="NUM",0))||null==l?(r.push(l),4<e.length?new CalcError("N/A"):r):l instanceof CalcError?l:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var l=this._arrayArg(e[o]);l?(t.push(l),r=Math.max(r,l.width),n=Math.max(n,l.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var u=this._arrayArg(e[o]);return u?(t.push(u),r=Math.max(r,u.width),n=Math.max(n,u.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t,r,n){if(t===r)return e;var i=e.split(t);if(null==n)return i.join(r);e="",n--;for(var o=0;o<i.length;++o)e+=i[o],o<i.length-1&&(e+=o===n?r:t);return e})),defineBuiltinFunction("t",!1,{check:function(e){var t=[],r=0,n=e[r++];return n instanceof CalcError?n:null!=(n=this.force(n))&&1<=e.length?(t.push(n),1<e.length?new CalcError("N/A"):t):n instanceof CalcError?n:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return"string"==typeof e?e:""})),defineBuiltinFunction("text",!1,{check:function(e){var t=[],r=0,n="VALUE",i=e[r++];if(i instanceof CalcError)return i;if(!(null!=(i=this.force(i))&&r<=e.length))return i instanceof CalcError?i:new CalcError(n);t.push(i);var o=e[r++];return o instanceof CalcError?o:("string"==typeof(o=this.force(o))||"boolean"==typeof o||"number"==typeof o?(o+="",1):void 0===o&&(o="",1))?(t.push(o),r<e.length?new CalcError("N/A"):t):o instanceof CalcError?o:new CalcError(n)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);return a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t){return formatting.text(e,t)})),defineBuiltinFunction("value",!1,{check:function(e){var t=[],r=0,n=e[r++];return n instanceof CalcError?n:null!=(n=this.force(n))&&1<=e.length?(t.push(n),1<e.length?new CalcError("N/A"):t):n instanceof CalcError?n:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);return s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e){return"number"==typeof e?e:"boolean"==typeof e?+e:(e=(e+"").replace(/[$€,]/g,""),e=parseFloat(e),isNaN(e)?new CalcError("VALUE"):e)})),Hyperlink.prototype.toString=function(){return this.text},defineBuiltinFunction("hyperlink",!1,{check:function(e){var t=[],r=0,n="VALUE",i=e[r++];if(i instanceof CalcError)return i;if(!("string"==typeof(i=this.force(i))||"boolean"==typeof i||"number"==typeof i?(i+="",1):void 0===i&&(i="",1)))return i instanceof CalcError?i:new CalcError(n);t.push(i);var o=e[r++];return o instanceof CalcError?o:("string"==typeof(o=this.force(o))||"boolean"==typeof o||"number"==typeof o?(o+="",1):void 0===o&&(o="",1))||null==o&&(o=i,1)?(t.push(o),2<e.length?new CalcError("N/A"):t):o instanceof CalcError?o:new CalcError(n)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);return a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t){return new Hyperlink(e,t)})),defineBuiltinFunction("iferror",!1,{check:function(e){var t=[],r=0,n="VALUE",i=e[r++];if(i=this.force(i),!(r<=e.length))return new CalcError(n);t.push(i);var o=e[r++];return null!=(o=this.force(o))&&r<=e.length?(t.push(o),r<e.length?new CalcError("N/A"):t):new CalcError(n)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)},arrayArgs:function(e){var t=[],r=0,n=0,i=[],o=0,s=this._arrayArg(e[o]);s?(t.push(s),r=Math.max(r,s.width),n=Math.max(n,s.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++;var a=this._arrayArg(e[o]);return a?(t.push(a),r=Math.max(r,a.width),n=Math.max(n,a.height),i.push(!0)):(t.push(e[o]),i.push(!1)),o++,{args:t,width:r,height:n,arrays:i}}},(function(e,t){return e instanceof CalcError?t:e}));var parseCriteria=function(){var e=Object.create(null);function t(e,t){if("string"==typeof t){var r=parseFloat(t);isNaN(r)||r!=t||(t=r)}return function(r){var n=t;return"string"==typeof r&&"string"==typeof n&&(r=r.toLowerCase(),n=n.toLowerCase()),e(r,n)}}function r(e){var t,r;return"string"==typeof e&&(e=e.toLowerCase()),/^[0-9.]+%$/.test(e)?(r=e.substr(0,e.length-1),t=parseFloat(r),isNaN(t)||t!=r||(e=t/100)):/^[0-9.]+$/.test(e)&&(t=parseFloat(e),isNaN(t)||t!=e||(e=t)),e}function n(e,t){return r(e)<r(t)}function i(e,t){return r(e)<=r(t)}function o(e,t){return r(e)>r(t)}function s(e,t){return r(e)>=r(t)}function a(e,t){return!l(e,t)}function l(e,t){return t instanceof RegExp?t.test(e):("string"!=typeof e&&"string"!=typeof t||(e=String(e),t=String(t)),r(e)==r(t))}return function(r){if("function"==typeof r)return r;var u;if(u=/^=(.*)$/.exec(r))return t(l,u[1]);if(u=/^<>(.*)$/.exec(r))return t(a,u[1]);if(u=/^<=(.*)$/.exec(r))return t(i,u[1]);if(u=/^<(.*)$/.exec(r))return t(n,u[1]);if(u=/^>=(.*)$/.exec(r))return t(s,u[1]);if(u=/^>(.*)$/.exec(r))return t(o,u[1]);if(/[?*]/.exec(r)){var c=e[r];return c||(c=r.replace(/(~\?|~\*|[\]({\+\.\|\^\$\\})\[]|[?*])/g,(function(e){switch(e){case"~?":return"\\?";case"~*":return"\\*";case"?":return".";case"*":return".*";default:return"\\"+e}})),c=e[r]=new RegExp("^"+c+"$","i")),t(l,c)}return t(l,r)}}();function numericPredicate(e){return"number"==typeof e||"boolean"==typeof e||null==e||""===e}function ascending(e,t){return e===t?0:e<t?-1:1}function descending(e,t){return e===t?0:e<t?1:-1}defineBuiltinFunction("ERF",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1))))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];return s instanceof CalcError?s:"number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1))||null==s?(r.push(s),2<e.length?new CalcError("N/A"):r):s instanceof CalcError?s:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},(function(e,t){return null==t?ERF(e):ERF(t)-ERF(e)})),defineBuiltinFunction("ERFC",!1,{check:function(e){var t,r=[],n=0,i=e[n++];return i instanceof CalcError?i:"number"==typeof(i=this.force(i))&&(i=limitPrecision(i),1)||"boolean"==typeof i&&(i=+i,1)||"string"==typeof i&&!/^(?:=|true|false)/i.test(i)&&(t=calc.parse(0,0,0,i),/^date|number|percent$/.test(t.type)&&(i=+t.value,1))?(r.push(i),1<e.length?new CalcError("N/A"):r):i instanceof CalcError?i:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)}},ERFC),defineBuiltinFunction("GAMMALN",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];return o instanceof CalcError?o:("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))&&(o>0||(i="NUM",0))?(r.push(o),1<e.length?new CalcError("N/A"):r):o instanceof CalcError?o:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)}},GAMMALN),defineBuiltinFunction("GAMMA",!1,{check:function(e){var t,r=[],n=0,i=e[n++];return i instanceof CalcError?i:"number"==typeof(i=this.force(i))&&(i=limitPrecision(i),1)||"boolean"==typeof i&&(i=+i,1)||"string"==typeof i&&!/^(?:=|true|false)/i.test(i)&&(t=calc.parse(0,0,0,i),/^date|number|percent$/.test(t.type)&&(i=+t.value,1))?(r.push(i),1<e.length?new CalcError("N/A"):r):i instanceof CalcError?i:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)}},GAMMA),defineBuiltinFunction("GAMMA.DIST",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||!(o>=0||(i="NUM",0)))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||!(s>0||(i="NUM",0)))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];if(a instanceof CalcError)return a;if(!("number"==typeof(a=this.force(a))&&(a=limitPrecision(a),1)||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))||!(a>0||(i="NUM",0)))return a instanceof CalcError?a:new CalcError(i);r.push(a);var l=e[n++];return l instanceof CalcError?l:"boolean"==typeof(l=this.force(l))||"number"==typeof l&&(l=!!l,1)?(r.push(l),4<e.length?new CalcError("N/A"):r):l instanceof CalcError?l:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},GAMMA_DIST),defineBuiltinFunction("GAMMA.INV",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||!(o>=0&&o<=1||(i="NUM",0)))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||!(s>0||(i="NUM",0)))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];return a instanceof CalcError?a:("number"==typeof(a=this.force(a))&&(a=limitPrecision(a),1)||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))&&(a>0||(i="NUM",0))?(r.push(a),3<e.length?new CalcError("N/A"):r):a instanceof CalcError?a:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},GAMMA_INV),defineBuiltinFunction("NORM.S.DIST",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1))))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];return s instanceof CalcError?s:"boolean"==typeof(s=this.force(s))||"number"==typeof s&&(s=!!s,1)?(r.push(s),2<e.length?new CalcError("N/A"):r):s instanceof CalcError?s:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},NORM_S_DIST),defineBuiltinFunction("NORM.S.INV",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];return o instanceof CalcError?o:("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))&&(o>=0&&o<=1||(i="NUM",0))?(r.push(o),1<e.length?new CalcError("N/A"):r):o instanceof CalcError?o:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)}},NORM_S_INV),defineBuiltinFunction("NORM.DIST",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1))))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1))))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];if(a instanceof CalcError)return a;if(!("number"==typeof(a=this.force(a))&&(a=limitPrecision(a),1)||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))||!(a>0||(i="NUM",0)))return a instanceof CalcError?a:new CalcError(i);r.push(a);var l=e[n++];return l instanceof CalcError?l:"boolean"==typeof(l=this.force(l))||"number"==typeof l&&(l=!!l,1)?(r.push(l),4<e.length?new CalcError("N/A"):r):l instanceof CalcError?l:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},NORM_DIST),defineBuiltinFunction("NORM.INV",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||!(o>=0&&o<=1||(i="NUM",0)))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1))))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];return a instanceof CalcError?a:("number"==typeof(a=this.force(a))&&(a=limitPrecision(a),1)||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))&&(a>0||(i="NUM",0))?(r.push(a),3<e.length?new CalcError("N/A"):r):a instanceof CalcError?a:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},NORM_INV),defineBuiltinFunction("BETADIST",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1))))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||!(s>0||(i="NUM",0)))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];if(a instanceof CalcError)return a;if(!("number"==typeof(a=this.force(a))&&(a=limitPrecision(a),1)||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))||!(a>0||(i="NUM",0)))return a instanceof CalcError?a:new CalcError(i);r.push(a);var l=e[n++];if(l instanceof CalcError)return l;if(!("number"==typeof(l=this.force(l))&&(l=limitPrecision(l),1)||"boolean"==typeof l&&(l=+l,1)||"string"==typeof l&&!/^(?:=|true|false)/i.test(l)&&(t=calc.parse(0,0,0,l),/^date|number|percent$/.test(t.type)&&(l=+t.value,1))||null==l&&(l=0,1)))return l instanceof CalcError?l:new CalcError(i);r.push(l);var u=e[n++];return u instanceof CalcError?u:"number"==typeof(u=this.force(u))&&(u=limitPrecision(u),1)||"boolean"==typeof u&&(u=+u,1)||"string"==typeof u&&!/^(?:=|true|false)/i.test(u)&&(t=calc.parse(0,0,0,u),/^date|number|percent$/.test(t.type)&&(u=+t.value,1))||null==u&&(u=1,1)?(r.push(u),(o>=l||(i="NUM",0))&&(o<=u||(i="NUM",0))&&(l<u||(i="NUM",0))?5<e.length?new CalcError("N/A"):r:new CalcError(i)):u instanceof CalcError?u:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},BETADIST),defineBuiltinFunction("BETA.DIST",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1))))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||!(s>0||(i="NUM",0)))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];if(a instanceof CalcError)return a;if(!("number"==typeof(a=this.force(a))&&(a=limitPrecision(a),1)||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))||!(a>0||(i="NUM",0)))return a instanceof CalcError?a:new CalcError(i);r.push(a);var l=e[n++];if(l instanceof CalcError)return l;if(!("boolean"==typeof(l=this.force(l))||"number"==typeof l&&(l=!!l,1)))return l instanceof CalcError?l:new CalcError(i);r.push(l);var u=e[n++];if(u instanceof CalcError)return u;if(!("number"==typeof(u=this.force(u))&&(u=limitPrecision(u),1)||"boolean"==typeof u&&(u=+u,1)||"string"==typeof u&&!/^(?:=|true|false)/i.test(u)&&(t=calc.parse(0,0,0,u),/^date|number|percent$/.test(t.type)&&(u=+t.value,1))||null==u&&(u=0,1)))return u instanceof CalcError?u:new CalcError(i);r.push(u);var c=e[n++];return c instanceof CalcError?c:"number"==typeof(c=this.force(c))&&(c=limitPrecision(c),1)||"boolean"==typeof c&&(c=+c,1)||"string"==typeof c&&!/^(?:=|true|false)/i.test(c)&&(t=calc.parse(0,0,0,c),/^date|number|percent$/.test(t.type)&&(c=+t.value,1))||null==c&&(c=1,1)?(r.push(c),(o>=u||(i="NUM",0))&&(o<=c||(i="NUM",0))&&(u<c||(i="NUM",0))?6<e.length?new CalcError("N/A"):r:new CalcError(i)):c instanceof CalcError?c:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},BETA_DIST),defineBuiltinFunction("BETA.INV",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||!(o>=0&&o<=1||(i="NUM",0)))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||!(s>0||(i="NUM",0)))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];if(a instanceof CalcError)return a;if(!("number"==typeof(a=this.force(a))&&(a=limitPrecision(a),1)||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))||!(a>0||(i="NUM",0)))return a instanceof CalcError?a:new CalcError(i);r.push(a);var l=e[n++];if(l instanceof CalcError)return l;if(!("number"==typeof(l=this.force(l))&&(l=limitPrecision(l),1)||"boolean"==typeof l&&(l=+l,1)||"string"==typeof l&&!/^(?:=|true|false)/i.test(l)&&(t=calc.parse(0,0,0,l),/^date|number|percent$/.test(t.type)&&(l=+t.value,1))||null==l&&(l=0,1)))return l instanceof CalcError?l:new CalcError(i);r.push(l);var u=e[n++];return u instanceof CalcError?u:"number"==typeof(u=this.force(u))&&(u=limitPrecision(u),1)||"boolean"==typeof u&&(u=+u,1)||"string"==typeof u&&!/^(?:=|true|false)/i.test(u)&&(t=calc.parse(0,0,0,u),/^date|number|percent$/.test(t.type)&&(u=+t.value,1))||null==u&&(u=1,1)?(r.push(u),5<e.length?new CalcError("N/A"):r):u instanceof CalcError?u:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},BETA_INV),defineBuiltinFunction("CHISQ.DIST",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||!(o>=0||(i="NUM",0)))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||!((s|=0)>0||(i="NUM",0)))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];return a instanceof CalcError?a:"boolean"==typeof(a=this.force(a))||"number"==typeof a&&(a=!!a,1)?(r.push(a),3<e.length?new CalcError("N/A"):r):a instanceof CalcError?a:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},chisq_left),defineBuiltinFunction("CHISQ.DIST.RT",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||!(o>=0||(i="NUM",0)))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];return s instanceof CalcError?s:("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))&&((s|=0)>0||(i="NUM",0))?(r.push(s),2<e.length?new CalcError("N/A"):r):s instanceof CalcError?s:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},chisq_right),defineBuiltinFunction("CHISQ.INV",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||!(o>=0&&o<=1||(i="NUM",0)))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];return s instanceof CalcError?s:("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))&&((s|=0)>0||(i="NUM",0))?(r.push(s),2<e.length?new CalcError("N/A"):r):s instanceof CalcError?s:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},chisq_left_inv),defineBuiltinFunction("CHISQ.INV.RT",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||!(o>=0&&o<=1||(i="NUM",0)))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];return s instanceof CalcError?s:("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))&&((s|=0)>0||(i="NUM",0))?(r.push(s),2<e.length?new CalcError("N/A"):r):s instanceof CalcError?s:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},chisq_right_inv),defineBuiltinFunction("CHISQ.TEST",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!(t=this.asMatrix(o))||!(o=t))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];return s instanceof CalcError?s:(t=this.asMatrix(s))&&(s=t)?(r.push(s),o.width!=s.width&&(i="N/A",1)||o.height!=s.height&&(i="N/A",1)?new CalcError(i):2<e.length?new CalcError("N/A"):r):s instanceof CalcError?s:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},(function(e,t){return chisq_test(e.data,t.data)})),defineBuiltinFunction("EXPON.DIST",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||!(o>=0||(i="NUM",0)))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||!(s>0||(i="NUM",0)))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];return a instanceof CalcError?a:"boolean"==typeof(a=this.force(a))||"number"==typeof a&&(a=!!a,1)?(r.push(a),3<e.length?new CalcError("N/A"):r):a instanceof CalcError?a:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},expon),defineBuiltinFunction("POISSON.DIST",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||!((o|=0)>=0||(i="NUM",0)))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||!(s>=0||(i="NUM",0)))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];return a instanceof CalcError?a:"boolean"==typeof(a=this.force(a))||"number"==typeof a&&(a=!!a,1)?(r.push(a),3<e.length?new CalcError("N/A"):r):a instanceof CalcError?a:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},poisson),defineBuiltinFunction("F.DIST",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||!(o>=0||(i="NUM",0)))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||!((s|=0)>0||(i="NUM",0)))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];if(a instanceof CalcError)return a;if(!("number"==typeof(a=this.force(a))||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))||!((a|=0)>0||(i="NUM",0)))return a instanceof CalcError?a:new CalcError(i);r.push(a);var l=e[n++];return l instanceof CalcError?l:"boolean"==typeof(l=this.force(l))||"number"==typeof l&&(l=!!l,1)?(r.push(l),4<e.length?new CalcError("N/A"):r):l instanceof CalcError?l:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},Fdist),defineBuiltinFunction("F.DIST.RT",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||!(o>=0||(i="NUM",0)))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||!((s|=0)>0||(i="NUM",0)))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];return a instanceof CalcError?a:("number"==typeof(a=this.force(a))||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))&&((a|=0)>0||(i="NUM",0))?(r.push(a),3<e.length?new CalcError("N/A"):r):a instanceof CalcError?a:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},Fdist_right),defineBuiltinFunction("F.INV",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||!(o>=0&&o<=1||(i="NUM",0)))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||!((s|=0)>0||(i="NUM",0)))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];return a instanceof CalcError?a:("number"==typeof(a=this.force(a))||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))&&((a|=0)>0||(i="NUM",0))?(r.push(a),3<e.length?new CalcError("N/A"):r):a instanceof CalcError?a:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},Finv),defineBuiltinFunction("F.INV.RT",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||!(o>=0&&o<=1||(i="NUM",0)))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||!((s|=0)>0||(i="NUM",0)))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];return a instanceof CalcError?a:("number"==typeof(a=this.force(a))||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))&&((a|=0)>0||(i="NUM",0))?(r.push(a),3<e.length?new CalcError("N/A"):r):a instanceof CalcError?a:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},Finv_right),defineBuiltinFunction("F.TEST",!1,{check:function(e){var t,r=[],n=0,i="VALUE";try{var o=this.cellValues(e.slice(n,n+1)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n+=1,r.push(o)}catch(e){if(e instanceof CalcError)return e;throw e}try{var s=this.cellValues(e.slice(n,n+1)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n+=1,r.push(s)}catch(e){if(e instanceof CalcError)return e;throw e}return(o.length>=2||(i="DIV/0",0))&&(s.length>=2||(i="DIV/0",0))?n<e.length?new CalcError("N/A"):r:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e.slice(1)),r.push(e.slice(1)),this.resolveCells(r,t)}},Ftest),defineBuiltinFunction("FISHER",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];return o instanceof CalcError?o:("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))&&(o>-1&&o<1||(i="NUM",0))?(r.push(o),1<e.length?new CalcError("N/A"):r):o instanceof CalcError?o:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)}},fisher),defineBuiltinFunction("FISHERINV",!1,{check:function(e){var t,r=[],n=0,i=e[n++];return i instanceof CalcError?i:"number"==typeof(i=this.force(i))&&(i=limitPrecision(i),1)||"boolean"==typeof i&&(i=+i,1)||"string"==typeof i&&!/^(?:=|true|false)/i.test(i)&&(t=calc.parse(0,0,0,i),/^date|number|percent$/.test(t.type)&&(i=+t.value,1))?(r.push(i),1<e.length?new CalcError("N/A"):r):i instanceof CalcError?i:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)}},fisherinv),defineBuiltinFunction("T.DIST",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1))))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||!((s|=0)>0||(i="NUM",0)))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];return a instanceof CalcError?a:"boolean"==typeof(a=this.force(a))||"number"==typeof a&&(a=!!a,1)?(r.push(a),3<e.length?new CalcError("N/A"):r):a instanceof CalcError?a:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},Tdist),defineBuiltinFunction("T.DIST.RT",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1))))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];return s instanceof CalcError?s:("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))&&((s|=0)>0||(i="NUM",0))?(r.push(s),2<e.length?new CalcError("N/A"):r):s instanceof CalcError?s:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},Tdist_right),defineBuiltinFunction("T.DIST.2T",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||!(o>=0||(i="NUM",0)))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];return s instanceof CalcError?s:("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))&&((s|=0)>0||(i="NUM",0))?(r.push(s),2<e.length?new CalcError("N/A"):r):s instanceof CalcError?s:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},Tdist_2tail),defineBuiltinFunction("T.INV",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||!(o>0&&o<=1||(i="NUM",0)))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];return s instanceof CalcError?s:("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))&&((s|=0)>0||(i="NUM",0))?(r.push(s),2<e.length?new CalcError("N/A"):r):s instanceof CalcError?s:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},Tdist_inv),defineBuiltinFunction("T.INV.2T",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||!(o>0&&o<=1||(i="NUM",0)))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];return s instanceof CalcError?s:("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))&&((s|=0)>0||(i="NUM",0))?(r.push(s),2<e.length?new CalcError("N/A"):r):s instanceof CalcError?s:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},Tdist_2tail_inv),defineBuiltinFunction("T.TEST",!1,{check:function(e){var t,r=[],n=0,i="VALUE";try{var o=this.cellValues(e.slice(n,n+1)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n+=1,r.push(o)}catch(e){if(e instanceof CalcError)return e;throw e}try{var s=this.cellValues(e.slice(n,n+1)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n+=1,r.push(s)}catch(e){if(e instanceof CalcError)return e;throw e}var a=e[n++];if(a instanceof CalcError)return a;if(!("number"==typeof(a=this.force(a))||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))||(a|=0,0)||1!==a&&2!==a)return a instanceof CalcError?a:new CalcError(i);r.push(a);var l=e[n++];return l instanceof CalcError?l:!("number"==typeof(l=this.force(l))||"boolean"==typeof l&&(l=+l,1)||"string"==typeof l&&!/^(?:=|true|false)/i.test(l)&&(t=calc.parse(0,0,0,l),/^date|number|percent$/.test(t.type)&&(l=+t.value,1)))||(l|=0,0)||1!==l&&2!==l&&3!==l?l instanceof CalcError?l:new CalcError(i):(r.push(l),1==l&&o.length!=s.length&&(i="N/A",1)?new CalcError(i):(o.length>=2||(i="DIV/0",0))&&(s.length>=2||(i="DIV/0",0))?n<e.length?new CalcError("N/A"):r:new CalcError(i))},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e.slice(n)),r.push(e.slice(n)),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},Tdist_test),defineBuiltinFunction("CONFIDENCE.T",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||!(o>0&&o<1||(i="NUM",0)))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||!(s>0||(i="NUM",0)))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];return a instanceof CalcError?a:!("number"==typeof(a=this.force(a))||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))||!((a|=0)>0||(i="NUM",0))||1==a&&(i="DIV/0",1)?a instanceof CalcError?a:new CalcError(i):(r.push(a),3<e.length?new CalcError("N/A"):r)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},confidence_t),defineBuiltinFunction("CONFIDENCE.NORM",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||!(o>0&&o<1||(i="NUM",0)))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||!(s>0||(i="NUM",0)))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];return a instanceof CalcError?a:("number"==typeof(a=this.force(a))||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))&&((a|=0)>0||(i="NUM",0))?(r.push(a),3<e.length?new CalcError("N/A"):r):a instanceof CalcError?a:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},confidence_norm),defineBuiltinFunction("GAUSS",!1,{check:function(e){var t,r=[],n=0,i=e[n++];return i instanceof CalcError?i:"number"==typeof(i=this.force(i))&&(i=limitPrecision(i),1)||"boolean"==typeof i&&(i=+i,1)||"string"==typeof i&&!/^(?:=|true|false)/i.test(i)&&(t=calc.parse(0,0,0,i),/^date|number|percent$/.test(t.type)&&(i=+t.value,1))?(r.push(i),1<e.length?new CalcError("N/A"):r):i instanceof CalcError?i:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)}},gauss),defineBuiltinFunction("PHI",!1,{check:function(e){var t,r=[],n=0,i=e[n++];return i instanceof CalcError?i:"number"==typeof(i=this.force(i))&&(i=limitPrecision(i),1)||"boolean"==typeof i&&(i=+i,1)||"string"==typeof i&&!/^(?:=|true|false)/i.test(i)&&(t=calc.parse(0,0,0,i),/^date|number|percent$/.test(t.type)&&(i=+t.value,1))?(r.push(i),1<e.length?new CalcError("N/A"):r):i instanceof CalcError?i:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),this.resolveCells(r,t)}},phi),defineBuiltinFunction("LOGNORM.DIST",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||!(o>0||(i="NUM",0)))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1))))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];if(a instanceof CalcError)return a;if(!("number"==typeof(a=this.force(a))&&(a=limitPrecision(a),1)||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))||!(a>0||(i="NUM",0)))return a instanceof CalcError?a:new CalcError(i);r.push(a);var l=e[n++];return l instanceof CalcError?l:"boolean"==typeof(l=this.force(l))||"number"==typeof l&&(l=!!l,1)?(r.push(l),4<e.length?new CalcError("N/A"):r):l instanceof CalcError?l:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},lognorm_dist),defineBuiltinFunction("LOGNORM.INV",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||!(o>0&&o<1||(i="NUM",0)))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1))))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];return a instanceof CalcError?a:("number"==typeof(a=this.force(a))&&(a=limitPrecision(a),1)||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))&&(a>0||(i="NUM",0))?(r.push(a),3<e.length?new CalcError("N/A"):r):a instanceof CalcError?a:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},lognorm_inv),defineBuiltinFunction("PROB",!1,{check:function(e){var t,r=[],n=0,i="VALUE";try{var o=this.cellValues(e.slice(n,n+1)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n+=1,r.push(o)}catch(e){if(e instanceof CalcError)return e;throw e}try{var s=this.cellValues(e.slice(n,n+1)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n+=1,r.push(s)}catch(e){if(e instanceof CalcError)return e;throw e}var a=e[n++];if(a instanceof CalcError)return a;if(!("number"==typeof(a=this.force(a))&&(a=limitPrecision(a),1)||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1))))return a instanceof CalcError?a:new CalcError(i);r.push(a);var l=e[n++];return l instanceof CalcError?l:"number"==typeof(l=this.force(l))&&(l=limitPrecision(l),1)||"boolean"==typeof l&&(l=+l,1)||"string"==typeof l&&!/^(?:=|true|false)/i.test(l)&&(t=calc.parse(0,0,0,l),/^date|number|percent$/.test(t.type)&&(l=+t.value,1))||null==l&&(l=a,1)?(r.push(l),s.length!=o.length&&(i="N/A",1)?new CalcError(i):n<e.length?new CalcError("N/A"):r):l instanceof CalcError?l:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e.slice(n)),r.push(e.slice(n)),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},prob),defineBuiltinFunction("SLOPE",!1,{check:function(e){var t,r=[],n=0,i="VALUE";try{var o=this.cellValues(e.slice(n,n+1)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n+=1,r.push(o)}catch(e){if(e instanceof CalcError)return e;throw e}try{var s=this.cellValues(e.slice(n,n+1)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n+=1,r.push(s)}catch(e){if(e instanceof CalcError)return e;throw e}return s.length!=o.length&&(i="N/A",1)?new CalcError(i):s.length>0&&o.length>0||(i="N/A",0)?n<e.length?new CalcError("N/A"):r:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e.slice(1)),r.push(e.slice(1)),this.resolveCells(r,t)}},slope),defineBuiltinFunction("INTERCEPT",!1,{check:function(e){var t,r=[],n=0,i="VALUE";try{var o=this.cellValues(e.slice(n,n+1)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n+=1,r.push(o)}catch(e){if(e instanceof CalcError)return e;throw e}try{var s=this.cellValues(e.slice(n,n+1)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n+=1,r.push(s)}catch(e){if(e instanceof CalcError)return e;throw e}return s.length!=o.length&&(i="N/A",1)?new CalcError(i):s.length>0&&o.length>0||(i="N/A",0)?n<e.length?new CalcError("N/A"):r:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e.slice(1)),r.push(e.slice(1)),this.resolveCells(r,t)}},intercept),defineBuiltinFunction("PEARSON",!1,{check:function(e){var t=[],r=0,n="VALUE";try{var i=this.cellValues(e.slice(r,r+1),!0).reduce(function(t,n){if(n instanceof CalcError)throw n;return r<=e.length&&t.push(n),t}.bind(this),[]);r+=1,t.push(i)}catch(e){if(e instanceof CalcError)return e;throw e}try{var o=this.cellValues(e.slice(r,r+1),!0).reduce(function(t,n){if(n instanceof CalcError)throw n;return r<=e.length&&t.push(n),t}.bind(this),[]);r+=1,t.push(o)}catch(e){if(e instanceof CalcError)return e;throw e}return o.length!=i.length&&(n="N/A",1)?new CalcError(n):o.length>0&&i.length>0||(n="N/A",0)?r<e.length?new CalcError("N/A"):t:new CalcError(n)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e.slice(1)),r.push(e.slice(1)),this.resolveCells(r,t)}},pearson),defineBuiltinFunction("RSQ",!1,{check:function(e){var t,r=[],n=0,i="VALUE";try{var o=this.cellValues(e.slice(n,n+1)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n+=1,r.push(o)}catch(e){if(e instanceof CalcError)return e;throw e}try{var s=this.cellValues(e.slice(n,n+1)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n+=1,r.push(s)}catch(e){if(e instanceof CalcError)return e;throw e}return s.length!=o.length&&(i="N/A",1)?new CalcError(i):(s.length>0&&o.length>0||(i="N/A",0))&&(1!=s.length&&1!=o.length||(i="N/A",0))?n<e.length?new CalcError("N/A"):r:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e.slice(1)),r.push(e.slice(1)),this.resolveCells(r,t)}},rsq),defineBuiltinFunction("STEYX",!1,{check:function(e){var t,r=[],n=0,i="VALUE";try{var o=this.cellValues(e.slice(n,n+1)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n+=1,r.push(o)}catch(e){if(e instanceof CalcError)return e;throw e}try{var s=this.cellValues(e.slice(n,n+1)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n+=1,r.push(s)}catch(e){if(e instanceof CalcError)return e;throw e}return s.length!=o.length&&(i="N/A",1)?new CalcError(i):s.length>=3&&o.length>=3||(i="DIV/0",0)?n<e.length?new CalcError("N/A"):r:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e.slice(1)),r.push(e.slice(1)),this.resolveCells(r,t)}},steyx),defineBuiltinFunction("FORECAST",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1))))return o instanceof CalcError?o:new CalcError(i);r.push(o);try{var s=this.cellValues(e.slice(n,n+1)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n+=1,r.push(s)}catch(e){if(e instanceof CalcError)return e;throw e}try{var a=this.cellValues(e.slice(n,n+1)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n+=1,r.push(a)}catch(e){if(e instanceof CalcError)return e;throw e}return a.length!=s.length&&(i="N/A",1)?new CalcError(i):a.length>0&&s.length>0||(i="N/A",0)?n<e.length?new CalcError("N/A"):r:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e.slice(1)),r.push(e.slice(1)),this.resolveCells(r,t)}},forecast),defineBuiltinFunction("LINEST",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!(t=this.asMatrix(o))||!(o=t))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!((t=this.asMatrix(s))&&(s=t)||null==s))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];if(a instanceof CalcError)return a;if(!("boolean"==typeof(a=this.force(a))||"number"==typeof a&&(a=!!a,1)||null==a&&(a=!0,1)))return a instanceof CalcError?a:new CalcError(i);r.push(a);var l=e[n++];return l instanceof CalcError?l:"boolean"==typeof(l=this.force(l))||"number"==typeof l&&(l=!!l,1)||null==l&&(l=!1,1)?(r.push(l),4<e.length?new CalcError("N/A"):r):l instanceof CalcError?l:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},linest),defineBuiltinFunction("LOGEST",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!(t=this.asMatrix(o))||!(o=t))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!((t=this.asMatrix(s))&&(s=t)||null==s))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];if(a instanceof CalcError)return a;if(!("boolean"==typeof(a=this.force(a))||"number"==typeof a&&(a=!!a,1)||null==a&&(a=!0,1)))return a instanceof CalcError?a:new CalcError(i);r.push(a);var l=e[n++];return l instanceof CalcError?l:"boolean"==typeof(l=this.force(l))||"number"==typeof l&&(l=!!l,1)||null==l&&(l=!1,1)?(r.push(l),4<e.length?new CalcError("N/A"):r):l instanceof CalcError?l:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},logest),defineBuiltinFunction("TREND",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!(t=this.asMatrix(o))||!(o=t))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!((t=this.asMatrix(s))&&(s=t)||null==s))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];if(a instanceof CalcError)return a;if(!((t=this.asMatrix(a))&&(a=t)||null==a))return a instanceof CalcError?a:new CalcError(i);r.push(a);var l=e[n++];return l instanceof CalcError?l:"boolean"==typeof(l=this.force(l))||"number"==typeof l&&(l=!!l,1)||null==l&&(l=!0,1)?(r.push(l),4<e.length?new CalcError("N/A"):r):l instanceof CalcError?l:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},trend),defineBuiltinFunction("GROWTH",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!(t=this.asMatrix(o))||!(o=t))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!((t=this.asMatrix(s))&&(s=t)||null==s))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];if(a instanceof CalcError)return a;if(!((t=this.asMatrix(a))&&(a=t)||null==a))return a instanceof CalcError?a:new CalcError(i);r.push(a);var l=e[n++];return l instanceof CalcError?l:"boolean"==typeof(l=this.force(l))||"number"==typeof l&&(l=!!l,1)||null==l&&(l=!0,1)?(r.push(l),4<e.length?new CalcError("N/A"):r):l instanceof CalcError?l:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},growth),defineBuiltinFunction("FV",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1))))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1))))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];if(a instanceof CalcError)return a;if(!("number"==typeof(a=this.force(a))&&(a=limitPrecision(a),1)||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1))||null==a&&(a=0,1)))return a instanceof CalcError?a:new CalcError(i);r.push(a);var l=e[n++];if(l instanceof CalcError)return l;if(!("number"==typeof(l=this.force(l))&&(l=limitPrecision(l),1)||"boolean"==typeof l&&(l=+l,1)||"string"==typeof l&&!/^(?:=|true|false)/i.test(l)&&(t=calc.parse(0,0,0,l),/^date|number|percent$/.test(t.type)&&(l=+t.value,1))||null==l&&(l=0,1)))return l instanceof CalcError?l:new CalcError(i);r.push(l);var u=e[n++];return u instanceof CalcError?u:0===(u=this.force(u))||1===u||null==u&&(u=0,1)?(r.push(u),a||l||(i="N/A",0)?5<e.length?new CalcError("N/A"):r:new CalcError(i)):u instanceof CalcError?u:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},FV),defineBuiltinFunction("PV",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1))))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1))))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];if(a instanceof CalcError)return a;if(!("number"==typeof(a=this.force(a))&&(a=limitPrecision(a),1)||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1))||null==a&&(a=0,1)))return a instanceof CalcError?a:new CalcError(i);r.push(a);var l=e[n++];if(l instanceof CalcError)return l;if(!("number"==typeof(l=this.force(l))&&(l=limitPrecision(l),1)||"boolean"==typeof l&&(l=+l,1)||"string"==typeof l&&!/^(?:=|true|false)/i.test(l)&&(t=calc.parse(0,0,0,l),/^date|number|percent$/.test(t.type)&&(l=+t.value,1))||null==l&&(l=0,1)))return l instanceof CalcError?l:new CalcError(i);r.push(l);var u=e[n++];return u instanceof CalcError?u:0===(u=this.force(u))||1===u||null==u&&(u=0,1)?(r.push(u),5<e.length?new CalcError("N/A"):r):u instanceof CalcError?u:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},PV),defineBuiltinFunction("PMT",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1))))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1))))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];if(a instanceof CalcError)return a;if(!("number"==typeof(a=this.force(a))&&(a=limitPrecision(a),1)||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1))))return a instanceof CalcError?a:new CalcError(i);r.push(a);var l=e[n++];if(l instanceof CalcError)return l;if(!("number"==typeof(l=this.force(l))&&(l=limitPrecision(l),1)||"boolean"==typeof l&&(l=+l,1)||"string"==typeof l&&!/^(?:=|true|false)/i.test(l)&&(t=calc.parse(0,0,0,l),/^date|number|percent$/.test(t.type)&&(l=+t.value,1))||null==l&&(l=0,1)))return l instanceof CalcError?l:new CalcError(i);r.push(l);var u=e[n++];return u instanceof CalcError?u:0===(u=this.force(u))||1===u||null==u&&(u=0,1)?(r.push(u),5<e.length?new CalcError("N/A"):r):u instanceof CalcError?u:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},PMT),defineBuiltinFunction("NPER",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1))))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1))))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];if(a instanceof CalcError)return a;if(!("number"==typeof(a=this.force(a))&&(a=limitPrecision(a),1)||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1))))return a instanceof CalcError?a:new CalcError(i);r.push(a);var l=e[n++];if(l instanceof CalcError)return l;if(!("number"==typeof(l=this.force(l))&&(l=limitPrecision(l),1)||"boolean"==typeof l&&(l=+l,1)||"string"==typeof l&&!/^(?:=|true|false)/i.test(l)&&(t=calc.parse(0,0,0,l),/^date|number|percent$/.test(t.type)&&(l=+t.value,1))||null==l&&(l=0,1)))return l instanceof CalcError?l:new CalcError(i);r.push(l);var u=e[n++];return u instanceof CalcError?u:0===(u=this.force(u))||1===u||null==u&&(u=0,1)?(r.push(u),5<e.length?new CalcError("N/A"):r):u instanceof CalcError?u:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},NPER),defineBuiltinFunction("RATE",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1))))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1))||null==s&&(s=0,1)))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];if(a instanceof CalcError)return a;if(!("number"==typeof(a=this.force(a))&&(a=limitPrecision(a),1)||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1))))return a instanceof CalcError?a:new CalcError(i);r.push(a);var l=e[n++];if(l instanceof CalcError)return l;if(!("number"==typeof(l=this.force(l))&&(l=limitPrecision(l),1)||"boolean"==typeof l&&(l=+l,1)||"string"==typeof l&&!/^(?:=|true|false)/i.test(l)&&(t=calc.parse(0,0,0,l),/^date|number|percent$/.test(t.type)&&(l=+t.value,1))||null==l&&(l=0,1)))return l instanceof CalcError?l:new CalcError(i);r.push(l);var u=e[n++];if(u instanceof CalcError)return u;if(!(0===(u=this.force(u))||1===u||null==u&&(u=0,1)))return u instanceof CalcError?u:new CalcError(i);r.push(u);var c=e[n++];return c instanceof CalcError?c:("number"==typeof(c=this.force(c))&&(c=limitPrecision(c),1)||"boolean"==typeof c&&(c=+c,1)||"string"==typeof c&&!/^(?:=|true|false)/i.test(c)&&(t=calc.parse(0,0,0,c),/^date|number|percent$/.test(t.type)&&(c=+t.value,1)))&&(c>0||(i="NUM",0))||null==c&&(c=.01,1)?(r.push(c),s||l||(i="N/A",0)?6<e.length?new CalcError("N/A"):r:new CalcError(i)):c instanceof CalcError?c:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},RATE),defineBuiltinFunction("IPMT",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1))))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||!(s>0||(i="NUM",0)))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];if(a instanceof CalcError)return a;if(!("number"==typeof(a=this.force(a))&&(a=limitPrecision(a),1)||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))||!(a>0||(i="NUM",0)))return a instanceof CalcError?a:new CalcError(i);r.push(a);var l=e[n++];if(l instanceof CalcError)return l;if(!("number"==typeof(l=this.force(l))&&(l=limitPrecision(l),1)||"boolean"==typeof l&&(l=+l,1)||"string"==typeof l&&!/^(?:=|true|false)/i.test(l)&&(t=calc.parse(0,0,0,l),/^date|number|percent$/.test(t.type)&&(l=+t.value,1))))return l instanceof CalcError?l:new CalcError(i);r.push(l);var u=e[n++];if(u instanceof CalcError)return u;if(!("number"==typeof(u=this.force(u))&&(u=limitPrecision(u),1)||"boolean"==typeof u&&(u=+u,1)||"string"==typeof u&&!/^(?:=|true|false)/i.test(u)&&(t=calc.parse(0,0,0,u),/^date|number|percent$/.test(t.type)&&(u=+t.value,1))||null==u&&(u=0,1)))return u instanceof CalcError?u:new CalcError(i);r.push(u);var c=e[n++];return c instanceof CalcError?c:0===(c=this.force(c))||1===c||null==c&&(c=0,1)?(r.push(c),s>=1&&s<=a||(i="N/A",0)?6<e.length?new CalcError("N/A"):r:new CalcError(i)):c instanceof CalcError?c:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},IPMT),defineBuiltinFunction("PPMT",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1))))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||!(s>0||(i="NUM",0)))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];if(a instanceof CalcError)return a;if(!("number"==typeof(a=this.force(a))&&(a=limitPrecision(a),1)||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))||!(a>0||(i="NUM",0)))return a instanceof CalcError?a:new CalcError(i);r.push(a);var l=e[n++];if(l instanceof CalcError)return l;if(!("number"==typeof(l=this.force(l))&&(l=limitPrecision(l),1)||"boolean"==typeof l&&(l=+l,1)||"string"==typeof l&&!/^(?:=|true|false)/i.test(l)&&(t=calc.parse(0,0,0,l),/^date|number|percent$/.test(t.type)&&(l=+t.value,1))))return l instanceof CalcError?l:new CalcError(i);r.push(l);var u=e[n++];if(u instanceof CalcError)return u;if(!("number"==typeof(u=this.force(u))&&(u=limitPrecision(u),1)||"boolean"==typeof u&&(u=+u,1)||"string"==typeof u&&!/^(?:=|true|false)/i.test(u)&&(t=calc.parse(0,0,0,u),/^date|number|percent$/.test(t.type)&&(u=+t.value,1))||null==u&&(u=0,1)))return u instanceof CalcError?u:new CalcError(i);r.push(u);var c=e[n++];return c instanceof CalcError?c:0===(c=this.force(c))||1===c||null==c&&(c=0,1)?(r.push(c),s>=1&&s<=a||(i="N/A",0)?6<e.length?new CalcError("N/A"):r:new CalcError(i)):c instanceof CalcError?c:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},PPMT),defineBuiltinFunction("CUMPRINC",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||!(o>0||(i="NUM",0)))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||!(s>0||(i="NUM",0)))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];if(a instanceof CalcError)return a;if(!("number"==typeof(a=this.force(a))&&(a=limitPrecision(a),1)||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))||!(a>0||(i="NUM",0)))return a instanceof CalcError?a:new CalcError(i);r.push(a);var l=e[n++];if(l instanceof CalcError)return l;if(!("number"==typeof(l=this.force(l))&&(l=limitPrecision(l),1)||"boolean"==typeof l&&(l=+l,1)||"string"==typeof l&&!/^(?:=|true|false)/i.test(l)&&(t=calc.parse(0,0,0,l),/^date|number|percent$/.test(t.type)&&(l=+t.value,1)))||!(l>0||(i="NUM",0)))return l instanceof CalcError?l:new CalcError(i);r.push(l);var u=e[n++];if(u instanceof CalcError)return u;if(!("number"==typeof(u=this.force(u))&&(u=limitPrecision(u),1)||"boolean"==typeof u&&(u=+u,1)||"string"==typeof u&&!/^(?:=|true|false)/i.test(u)&&(t=calc.parse(0,0,0,u),/^date|number|percent$/.test(t.type)&&(u=+t.value,1)))||!(u>0||(i="NUM",0)))return u instanceof CalcError?u:new CalcError(i);r.push(u);var c=e[n++];return c instanceof CalcError?c:0===(c=this.force(c))||1===c||null==c&&(c=0,1)?(r.push(c),u>=l||(i="NUM",0)?6<e.length?new CalcError("N/A"):r:new CalcError(i)):c instanceof CalcError?c:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},CUMPRINC),defineBuiltinFunction("CUMIPMT",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||!(o>0||(i="NUM",0)))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||!(s>0||(i="NUM",0)))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];if(a instanceof CalcError)return a;if(!("number"==typeof(a=this.force(a))&&(a=limitPrecision(a),1)||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))||!(a>0||(i="NUM",0)))return a instanceof CalcError?a:new CalcError(i);r.push(a);var l=e[n++];if(l instanceof CalcError)return l;if(!("number"==typeof(l=this.force(l))&&(l=limitPrecision(l),1)||"boolean"==typeof l&&(l=+l,1)||"string"==typeof l&&!/^(?:=|true|false)/i.test(l)&&(t=calc.parse(0,0,0,l),/^date|number|percent$/.test(t.type)&&(l=+t.value,1)))||!(l>0||(i="NUM",0)))return l instanceof CalcError?l:new CalcError(i);r.push(l);var u=e[n++];if(u instanceof CalcError)return u;if(!("number"==typeof(u=this.force(u))&&(u=limitPrecision(u),1)||"boolean"==typeof u&&(u=+u,1)||"string"==typeof u&&!/^(?:=|true|false)/i.test(u)&&(t=calc.parse(0,0,0,u),/^date|number|percent$/.test(t.type)&&(u=+t.value,1)))||!(u>0||(i="NUM",0)))return u instanceof CalcError?u:new CalcError(i);r.push(u);var c=e[n++];return c instanceof CalcError?c:0===(c=this.force(c))||1===c||null==c&&(c=0,1)?(r.push(c),u>=l||(i="NUM",0)?6<e.length?new CalcError("N/A"):r:new CalcError(i)):c instanceof CalcError?c:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},CUMIPMT),defineBuiltinFunction("NPV",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1))))return o instanceof CalcError?o:new CalcError(i);r.push(o);try{var s=this.cellValues(e.slice(n)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n=e.length,r.push(s)}catch(e){if(e instanceof CalcError)return e;throw e}return s.length>0||(i="N/A",0)?n<e.length?new CalcError("N/A"):r:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e.slice(1)),this.resolveCells(r,t)}},NPV),defineBuiltinFunction("IRR",!1,{check:function(e){var t,r=[],n=0;try{var i=this.cellValues(e.slice(n,n+1)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n+=1,r.push(i)}catch(e){if(e instanceof CalcError)return e;throw e}var o=e[n++];return o instanceof CalcError?o:"number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1))||null==o&&(o=.1,1)?(r.push(o),n<e.length?new CalcError("N/A"):r):o instanceof CalcError?o:new CalcError("VALUE")},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e.slice(n)),r.push(e[n++]),this.resolveCells(r,t)}},IRR),defineBuiltinFunction("EFFECT",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||!(o>0||(i="NUM",0)))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];return s instanceof CalcError?s:("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))&&((s|=0)>0||(i="NUM",0))?(r.push(s),2<e.length?new CalcError("N/A"):r):s instanceof CalcError?s:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},EFFECT),defineBuiltinFunction("NOMINAL",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||!(o>0||(i="NUM",0)))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];return s instanceof CalcError?s:("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))&&((s|=0)>0||(i="NUM",0))?(r.push(s),2<e.length?new CalcError("N/A"):r):s instanceof CalcError?s:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},NOMINAL),defineBuiltinFunction("XNPV",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1))))return o instanceof CalcError?o:new CalcError(i);r.push(o);try{var s=this.cellValues(e.slice(n,n+1)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n+=1,r.push(s)}catch(e){if(e instanceof CalcError)return e;throw e}try{var a=this.cellValues(e.slice(n,n+1)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&(r|=0,1)&&e.push(r),e}.bind(this),[]);n+=1,r.push(a)}catch(e){if(e instanceof CalcError)return e;throw e}return s.length!=a.length&&(i="NUM",1)?new CalcError(i):n<e.length?new CalcError("N/A"):r},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e.slice(1)),r.push(e.slice(1)),this.resolveCells(r,t)}},XNPV),defineBuiltinFunction("XIRR",!1,{check:function(e){var t,r=[],n=0,i="VALUE";try{var o=this.cellValues(e.slice(n,n+1)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r&&(r=limitPrecision(r),1)||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&e.push(r),e}.bind(this),[]);n+=1,r.push(o)}catch(e){if(e instanceof CalcError)return e;throw e}try{var s=this.cellValues(e.slice(n,n+1)).reduce(function(e,r){if(r instanceof CalcError)throw r;return("number"==typeof r||"boolean"==typeof r&&(r=+r,1)||"string"==typeof r&&!/^(?:=|true|false)/i.test(r)&&(t=calc.parse(0,0,0,r),/^date|number|percent$/.test(t.type)&&(r=+t.value,1)))&&(r|=0,1)&&e.push(r),e}.bind(this),[]);n+=1,r.push(s)}catch(e){if(e instanceof CalcError)return e;throw e}var a=e[n++];return a instanceof CalcError?a:"number"==typeof(a=this.force(a))&&(a=limitPrecision(a),1)||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1))||null==a&&(a=.1,1)?(r.push(a),o.length!=s.length&&(i="NUM",1)?new CalcError(i):n<e.length?new CalcError("N/A"):r):a instanceof CalcError?a:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e.slice(n)),r.push(e.slice(n)),r.push(e[n++]),this.resolveCells(r,t)}},XIRR),defineBuiltinFunction("ISPMT",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1))))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||!(s>0||(i="NUM",0)))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];if(a instanceof CalcError)return a;if(!("number"==typeof(a=this.force(a))&&(a=limitPrecision(a),1)||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))||!(a>0||(i="NUM",0)))return a instanceof CalcError?a:new CalcError(i);r.push(a);var l=e[n++];return l instanceof CalcError?l:"number"==typeof(l=this.force(l))&&(l=limitPrecision(l),1)||"boolean"==typeof l&&(l=+l,1)||"string"==typeof l&&!/^(?:=|true|false)/i.test(l)&&(t=calc.parse(0,0,0,l),/^date|number|percent$/.test(t.type)&&(l=+t.value,1))?(r.push(l),s>=1&&s<=a||(i="N/A",0)?4<e.length?new CalcError("N/A"):r:new CalcError(i)):l instanceof CalcError?l:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},ISPMT),defineBuiltinFunction("DB",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1))))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1))))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];if(a instanceof CalcError)return a;if(!("number"==typeof(a=this.force(a))&&(a=limitPrecision(a),1)||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))||!(a>0||(i="NUM",0)))return a instanceof CalcError?a:new CalcError(i);r.push(a);var l=e[n++];if(l instanceof CalcError)return l;if(!("number"==typeof(l=this.force(l))&&(l=limitPrecision(l),1)||"boolean"==typeof l&&(l=+l,1)||"string"==typeof l&&!/^(?:=|true|false)/i.test(l)&&(t=calc.parse(0,0,0,l),/^date|number|percent$/.test(t.type)&&(l=+t.value,1)))||!(l>0||(i="NUM",0)))return l instanceof CalcError?l:new CalcError(i);r.push(l);var u=e[n++];return u instanceof CalcError?u:"number"==typeof(u=this.force(u))&&(u=limitPrecision(u),1)||"boolean"==typeof u&&(u=+u,1)||"string"==typeof u&&!/^(?:=|true|false)/i.test(u)&&(t=calc.parse(0,0,0,u),/^date|number|percent$/.test(t.type)&&(u=+t.value,1))||null==u&&(u=12,1)?(r.push(u),5<e.length?new CalcError("N/A"):r):u instanceof CalcError?u:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},DB),defineBuiltinFunction("DDB",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1))))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1))))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];if(a instanceof CalcError)return a;if(!("number"==typeof(a=this.force(a))&&(a=limitPrecision(a),1)||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))||!(a>0||(i="NUM",0)))return a instanceof CalcError?a:new CalcError(i);r.push(a);var l=e[n++];if(l instanceof CalcError)return l;if(!("number"==typeof(l=this.force(l))&&(l=limitPrecision(l),1)||"boolean"==typeof l&&(l=+l,1)||"string"==typeof l&&!/^(?:=|true|false)/i.test(l)&&(t=calc.parse(0,0,0,l),/^date|number|percent$/.test(t.type)&&(l=+t.value,1)))||!(l>0||(i="NUM",0)))return l instanceof CalcError?l:new CalcError(i);r.push(l);var u=e[n++];return u instanceof CalcError?u:"number"==typeof(u=this.force(u))&&(u=limitPrecision(u),1)||"boolean"==typeof u&&(u=+u,1)||"string"==typeof u&&!/^(?:=|true|false)/i.test(u)&&(t=calc.parse(0,0,0,u),/^date|number|percent$/.test(t.type)&&(u=+t.value,1))||null==u&&(u=2,1)?(r.push(u),5<e.length?new CalcError("N/A"):r):u instanceof CalcError?u:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},DDB),defineBuiltinFunction("SLN",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1))))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1))))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];return a instanceof CalcError?a:("number"==typeof(a=this.force(a))&&(a=limitPrecision(a),1)||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))&&(a>0||(i="NUM",0))?(r.push(a),3<e.length?new CalcError("N/A"):r):a instanceof CalcError?a:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},SLN),defineBuiltinFunction("SYD",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1))))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1))))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];if(a instanceof CalcError)return a;if(!("number"==typeof(a=this.force(a))&&(a=limitPrecision(a),1)||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))||!(a>0||(i="NUM",0)))return a instanceof CalcError?a:new CalcError(i);r.push(a);var l=e[n++];return l instanceof CalcError?l:("number"==typeof(l=this.force(l))&&(l=limitPrecision(l),1)||"boolean"==typeof l&&(l=+l,1)||"string"==typeof l&&!/^(?:=|true|false)/i.test(l)&&(t=calc.parse(0,0,0,l),/^date|number|percent$/.test(t.type)&&(l=+t.value,1)))&&(l>0||(i="NUM",0))?(r.push(l),4<e.length?new CalcError("N/A"):r):l instanceof CalcError?l:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},SYD),defineBuiltinFunction("VDB",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))&&(o=limitPrecision(o),1)||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||!(o>=0||(i="NUM",0)))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))&&(s=limitPrecision(s),1)||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||!(s>=0||(i="NUM",0)))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];if(a instanceof CalcError)return a;if(!("number"==typeof(a=this.force(a))&&(a=limitPrecision(a),1)||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))||!(a>0||(i="NUM",0)))return a instanceof CalcError?a:new CalcError(i);r.push(a);var l=e[n++];if(l instanceof CalcError)return l;if(!("number"==typeof(l=this.force(l))&&(l=limitPrecision(l),1)||"boolean"==typeof l&&(l=+l,1)||"string"==typeof l&&!/^(?:=|true|false)/i.test(l)&&(t=calc.parse(0,0,0,l),/^date|number|percent$/.test(t.type)&&(l=+t.value,1)))||!(l>=0||(i="NUM",0)))return l instanceof CalcError?l:new CalcError(i);r.push(l);var u=e[n++];if(u instanceof CalcError)return u;if(!("number"==typeof(u=this.force(u))&&(u=limitPrecision(u),1)||"boolean"==typeof u&&(u=+u,1)||"string"==typeof u&&!/^(?:=|true|false)/i.test(u)&&(t=calc.parse(0,0,0,u),/^date|number|percent$/.test(t.type)&&(u=+t.value,1)))||!(u>=0||(i="NUM",0)))return u instanceof CalcError?u:new CalcError(i);r.push(u);var c=e[n++];if(c instanceof CalcError)return c;if(!(("number"==typeof(c=this.force(c))&&(c=limitPrecision(c),1)||"boolean"==typeof c&&(c=+c,1)||"string"==typeof c&&!/^(?:=|true|false)/i.test(c)&&(t=calc.parse(0,0,0,c),/^date|number|percent$/.test(t.type)&&(c=+t.value,1)))&&(c>=0||(i="NUM",0))||null==c&&(c=2,1)))return c instanceof CalcError?c:new CalcError(i);r.push(c);var h=e[n++];return h instanceof CalcError?h:"boolean"==typeof(h=this.force(h))||"number"==typeof h&&(h=!!h,1)||null==h&&(h=!1,1)?(r.push(h),u>=l||(i="NUM",0)?7<e.length?new CalcError("N/A"):r:new CalcError(i)):h instanceof CalcError?h:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},VDB),defineBuiltinFunction("COUPDAYBS",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||(o|=0,0))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||(s|=0,0))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];if(a instanceof CalcError)return a;if(!("number"==typeof(a=this.force(a))||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))||(a|=0,0)||1!==a&&2!==a&&4!==a)return a instanceof CalcError?a:new CalcError(i);r.push(a);var l=e[n++];return l instanceof CalcError?l:null==(l=this.force(l))&&(l=0,1)||("number"==typeof l||"boolean"==typeof l&&(l=+l,1)||"string"==typeof l&&!/^(?:=|true|false)/i.test(l)&&(t=calc.parse(0,0,0,l),/^date|number|percent$/.test(t.type)&&(l=+t.value,1)))&&(l|=0,1)&&(0===l||1===l||2===l||3===l||4===l)?(r.push(l),o<s||(i="NUM",0)?4<e.length?new CalcError("N/A"):r:new CalcError(i)):l instanceof CalcError?l:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},COUPDAYBS),defineBuiltinFunction("COUPDAYS",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||(o|=0,0))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||(s|=0,0))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];if(a instanceof CalcError)return a;if(!("number"==typeof(a=this.force(a))||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))||(a|=0,0)||1!==a&&2!==a&&4!==a)return a instanceof CalcError?a:new CalcError(i);r.push(a);var l=e[n++];return l instanceof CalcError?l:null==(l=this.force(l))&&(l=0,1)||("number"==typeof l||"boolean"==typeof l&&(l=+l,1)||"string"==typeof l&&!/^(?:=|true|false)/i.test(l)&&(t=calc.parse(0,0,0,l),/^date|number|percent$/.test(t.type)&&(l=+t.value,1)))&&(l|=0,1)&&(0===l||1===l||2===l||3===l||4===l)?(r.push(l),o<s||(i="NUM",0)?4<e.length?new CalcError("N/A"):r:new CalcError(i)):l instanceof CalcError?l:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},COUPDAYS),defineBuiltinFunction("COUPDAYSNC",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||(o|=0,0))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||(s|=0,0))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];if(a instanceof CalcError)return a;if(!("number"==typeof(a=this.force(a))||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))||(a|=0,0)||1!==a&&2!==a&&4!==a)return a instanceof CalcError?a:new CalcError(i);r.push(a);var l=e[n++];return l instanceof CalcError?l:null==(l=this.force(l))&&(l=0,1)||("number"==typeof l||"boolean"==typeof l&&(l=+l,1)||"string"==typeof l&&!/^(?:=|true|false)/i.test(l)&&(t=calc.parse(0,0,0,l),/^date|number|percent$/.test(t.type)&&(l=+t.value,1)))&&(l|=0,1)&&(0===l||1===l||2===l||3===l||4===l)?(r.push(l),o<s||(i="NUM",0)?4<e.length?new CalcError("N/A"):r:new CalcError(i)):l instanceof CalcError?l:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},COUPDAYSNC),defineBuiltinFunction("COUPPCD",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||(o|=0,0))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||(s|=0,0))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];if(a instanceof CalcError)return a;if(!("number"==typeof(a=this.force(a))||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))||(a|=0,0)||1!==a&&2!==a&&4!==a)return a instanceof CalcError?a:new CalcError(i);r.push(a);var l=e[n++];return l instanceof CalcError?l:null==(l=this.force(l))&&(l=0,1)||("number"==typeof l||"boolean"==typeof l&&(l=+l,1)||"string"==typeof l&&!/^(?:=|true|false)/i.test(l)&&(t=calc.parse(0,0,0,l),/^date|number|percent$/.test(t.type)&&(l=+t.value,1)))&&(l|=0,1)&&(0===l||1===l||2===l||3===l||4===l)?(r.push(l),o<s||(i="NUM",0)?4<e.length?new CalcError("N/A"):r:new CalcError(i)):l instanceof CalcError?l:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},COUPPCD),defineBuiltinFunction("COUPNCD",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||(o|=0,0))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||(s|=0,0))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];if(a instanceof CalcError)return a;if(!("number"==typeof(a=this.force(a))||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))||(a|=0,0)||1!==a&&2!==a&&4!==a)return a instanceof CalcError?a:new CalcError(i);r.push(a);var l=e[n++];return l instanceof CalcError?l:null==(l=this.force(l))&&(l=0,1)||("number"==typeof l||"boolean"==typeof l&&(l=+l,1)||"string"==typeof l&&!/^(?:=|true|false)/i.test(l)&&(t=calc.parse(0,0,0,l),/^date|number|percent$/.test(t.type)&&(l=+t.value,1)))&&(l|=0,1)&&(0===l||1===l||2===l||3===l||4===l)?(r.push(l),o<s||(i="NUM",0)?4<e.length?new CalcError("N/A"):r:new CalcError(i)):l instanceof CalcError?l:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},COUPNCD),defineBuiltinFunction("COUPNUM",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||(o|=0,0))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||(s|=0,0))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];if(a instanceof CalcError)return a;if(!("number"==typeof(a=this.force(a))||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))||(a|=0,0)||1!==a&&2!==a&&4!==a)return a instanceof CalcError?a:new CalcError(i);r.push(a);var l=e[n++];return l instanceof CalcError?l:null==(l=this.force(l))&&(l=0,1)||("number"==typeof l||"boolean"==typeof l&&(l=+l,1)||"string"==typeof l&&!/^(?:=|true|false)/i.test(l)&&(t=calc.parse(0,0,0,l),/^date|number|percent$/.test(t.type)&&(l=+t.value,1)))&&(l|=0,1)&&(0===l||1===l||2===l||3===l||4===l)?(r.push(l),o<s||(i="NUM",0)?4<e.length?new CalcError("N/A"):r:new CalcError(i)):l instanceof CalcError?l:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},COUPNUM),defineBuiltinFunction("ACCRINTM",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||(o|=0,0))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||(s|=0,0))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];if(a instanceof CalcError)return a;if(!("number"==typeof(a=this.force(a))&&(a=limitPrecision(a),1)||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))||!(a>0||(i="NUM",0)))return a instanceof CalcError?a:new CalcError(i);r.push(a);var l=e[n++];if(l instanceof CalcError)return l;if(!(null==(l=this.force(l))&&(l=1e3,1)||("number"==typeof l&&(l=limitPrecision(l),1)||"boolean"==typeof l&&(l=+l,1)||"string"==typeof l&&!/^(?:=|true|false)/i.test(l)&&(t=calc.parse(0,0,0,l),/^date|number|percent$/.test(t.type)&&(l=+t.value,1)))&&(l>0||(i="NUM",0))))return l instanceof CalcError?l:new CalcError(i);r.push(l);var u=e[n++];return u instanceof CalcError?u:null==(u=this.force(u))&&(u=0,1)||("number"==typeof u||"boolean"==typeof u&&(u=+u,1)||"string"==typeof u&&!/^(?:=|true|false)/i.test(u)&&(t=calc.parse(0,0,0,u),/^date|number|percent$/.test(t.type)&&(u=+t.value,1)))&&(u|=0,1)&&(0===u||1===u||2===u||3===u||4===u)?(r.push(u),o<s||(i="NUM",0)?5<e.length?new CalcError("N/A"):r:new CalcError(i)):u instanceof CalcError?u:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},ACCRINTM),defineBuiltinFunction("ACCRINT",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||(o|=0,0))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||(s|=0,0))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];if(a instanceof CalcError)return a;if(!("number"==typeof(a=this.force(a))||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))||(a|=0,0))return a instanceof CalcError?a:new CalcError(i);r.push(a);var l=e[n++];if(l instanceof CalcError)return l;if(!("number"==typeof(l=this.force(l))&&(l=limitPrecision(l),1)||"boolean"==typeof l&&(l=+l,1)||"string"==typeof l&&!/^(?:=|true|false)/i.test(l)&&(t=calc.parse(0,0,0,l),/^date|number|percent$/.test(t.type)&&(l=+t.value,1)))||!(l>0||(i="NUM",0)))return l instanceof CalcError?l:new CalcError(i);r.push(l);var u=e[n++];if(u instanceof CalcError)return u;if(!(null==(u=this.force(u))&&(u=1e3,1)||("number"==typeof u&&(u=limitPrecision(u),1)||"boolean"==typeof u&&(u=+u,1)||"string"==typeof u&&!/^(?:=|true|false)/i.test(u)&&(t=calc.parse(0,0,0,u),/^date|number|percent$/.test(t.type)&&(u=+t.value,1)))&&(u>0||(i="NUM",0))))return u instanceof CalcError?u:new CalcError(i);r.push(u);var c=e[n++];if(c instanceof CalcError)return c;if(!("number"==typeof(c=this.force(c))||"boolean"==typeof c&&(c=+c,1)||"string"==typeof c&&!/^(?:=|true|false)/i.test(c)&&(t=calc.parse(0,0,0,c),/^date|number|percent$/.test(t.type)&&(c=+t.value,1)))||(c|=0,0)||1!==c&&2!==c&&4!==c)return c instanceof CalcError?c:new CalcError(i);r.push(c);var h=e[n++];if(h instanceof CalcError)return h;if(!(null==(h=this.force(h))&&(h=0,1)||("number"==typeof h||"boolean"==typeof h&&(h=+h,1)||"string"==typeof h&&!/^(?:=|true|false)/i.test(h)&&(t=calc.parse(0,0,0,h),/^date|number|percent$/.test(t.type)&&(h=+t.value,1)))&&(h|=0,1)&&(0===h||1===h||2===h||3===h||4===h)))return h instanceof CalcError?h:new CalcError(i);r.push(h);var f=e[n++];return f instanceof CalcError?f:"boolean"==typeof(f=this.force(f))||"number"==typeof f&&(f=!!f,1)||null==f&&(f=!0,1)?(r.push(f),o<a||(i="NUM",0)?8<e.length?new CalcError("N/A"):r:new CalcError(i)):f instanceof CalcError?f:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},ACCRINT),defineBuiltinFunction("DISC",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||(o|=0,0))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||(s|=0,0))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];if(a instanceof CalcError)return a;if(!("number"==typeof(a=this.force(a))&&(a=limitPrecision(a),1)||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))||!(a>0||(i="NUM",0)))return a instanceof CalcError?a:new CalcError(i);r.push(a);var l=e[n++];if(l instanceof CalcError)return l;if(!("number"==typeof(l=this.force(l))&&(l=limitPrecision(l),1)||"boolean"==typeof l&&(l=+l,1)||"string"==typeof l&&!/^(?:=|true|false)/i.test(l)&&(t=calc.parse(0,0,0,l),/^date|number|percent$/.test(t.type)&&(l=+t.value,1)))||!(l>0||(i="NUM",0)))return l instanceof CalcError?l:new CalcError(i);r.push(l);var u=e[n++];return u instanceof CalcError?u:null==(u=this.force(u))&&(u=0,1)||("number"==typeof u||"boolean"==typeof u&&(u=+u,1)||"string"==typeof u&&!/^(?:=|true|false)/i.test(u)&&(t=calc.parse(0,0,0,u),/^date|number|percent$/.test(t.type)&&(u=+t.value,1)))&&(u|=0,1)&&(0===u||1===u||2===u||3===u||4===u)?(r.push(u),o<s||(i="NUM",0)?5<e.length?new CalcError("N/A"):r:new CalcError(i)):u instanceof CalcError?u:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},DISC),defineBuiltinFunction("INTRATE",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||(o|=0,0))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||(s|=0,0))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];if(a instanceof CalcError)return a;if(!("number"==typeof(a=this.force(a))&&(a=limitPrecision(a),1)||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))||!(a>0||(i="NUM",0)))return a instanceof CalcError?a:new CalcError(i);r.push(a);var l=e[n++];if(l instanceof CalcError)return l;if(!("number"==typeof(l=this.force(l))&&(l=limitPrecision(l),1)||"boolean"==typeof l&&(l=+l,1)||"string"==typeof l&&!/^(?:=|true|false)/i.test(l)&&(t=calc.parse(0,0,0,l),/^date|number|percent$/.test(t.type)&&(l=+t.value,1)))||!(l>0||(i="NUM",0)))return l instanceof CalcError?l:new CalcError(i);r.push(l);var u=e[n++];return u instanceof CalcError?u:null==(u=this.force(u))&&(u=0,1)||("number"==typeof u||"boolean"==typeof u&&(u=+u,1)||"string"==typeof u&&!/^(?:=|true|false)/i.test(u)&&(t=calc.parse(0,0,0,u),/^date|number|percent$/.test(t.type)&&(u=+t.value,1)))&&(u|=0,1)&&(0===u||1===u||2===u||3===u||4===u)?(r.push(u),o<s||(i="NUM",0)?5<e.length?new CalcError("N/A"):r:new CalcError(i)):u instanceof CalcError?u:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},INTRATE),defineBuiltinFunction("RECEIVED",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||(o|=0,0))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||(s|=0,0))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];if(a instanceof CalcError)return a;if(!("number"==typeof(a=this.force(a))&&(a=limitPrecision(a),1)||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))||!(a>0||(i="NUM",0)))return a instanceof CalcError?a:new CalcError(i);r.push(a);var l=e[n++];if(l instanceof CalcError)return l;if(!("number"==typeof(l=this.force(l))&&(l=limitPrecision(l),1)||"boolean"==typeof l&&(l=+l,1)||"string"==typeof l&&!/^(?:=|true|false)/i.test(l)&&(t=calc.parse(0,0,0,l),/^date|number|percent$/.test(t.type)&&(l=+t.value,1)))||!(l>0||(i="NUM",0)))return l instanceof CalcError?l:new CalcError(i);r.push(l);var u=e[n++];return u instanceof CalcError?u:null==(u=this.force(u))&&(u=0,1)||("number"==typeof u||"boolean"==typeof u&&(u=+u,1)||"string"==typeof u&&!/^(?:=|true|false)/i.test(u)&&(t=calc.parse(0,0,0,u),/^date|number|percent$/.test(t.type)&&(u=+t.value,1)))&&(u|=0,1)&&(0===u||1===u||2===u||3===u||4===u)?(r.push(u),o<s||(i="NUM",0)?5<e.length?new CalcError("N/A"):r:new CalcError(i)):u instanceof CalcError?u:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},RECEIVED),defineBuiltinFunction("PRICE",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||(o|=0,0))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||(s|=0,0))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];if(a instanceof CalcError)return a;if(!("number"==typeof(a=this.force(a))&&(a=limitPrecision(a),1)||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))||!(a>0||(i="NUM",0)))return a instanceof CalcError?a:new CalcError(i);r.push(a);var l=e[n++];if(l instanceof CalcError)return l;if(!("number"==typeof(l=this.force(l))&&(l=limitPrecision(l),1)||"boolean"==typeof l&&(l=+l,1)||"string"==typeof l&&!/^(?:=|true|false)/i.test(l)&&(t=calc.parse(0,0,0,l),/^date|number|percent$/.test(t.type)&&(l=+t.value,1)))||!(l>0||(i="NUM",0)))return l instanceof CalcError?l:new CalcError(i);r.push(l);var u=e[n++];if(u instanceof CalcError)return u;if(!("number"==typeof(u=this.force(u))&&(u=limitPrecision(u),1)||"boolean"==typeof u&&(u=+u,1)||"string"==typeof u&&!/^(?:=|true|false)/i.test(u)&&(t=calc.parse(0,0,0,u),/^date|number|percent$/.test(t.type)&&(u=+t.value,1)))||!(u>0||(i="NUM",0)))return u instanceof CalcError?u:new CalcError(i);r.push(u);var c=e[n++];if(c instanceof CalcError)return c;if(!("number"==typeof(c=this.force(c))||"boolean"==typeof c&&(c=+c,1)||"string"==typeof c&&!/^(?:=|true|false)/i.test(c)&&(t=calc.parse(0,0,0,c),/^date|number|percent$/.test(t.type)&&(c=+t.value,1)))||(c|=0,0)||1!==c&&2!==c&&4!==c)return c instanceof CalcError?c:new CalcError(i);r.push(c);var h=e[n++];return h instanceof CalcError?h:null==(h=this.force(h))&&(h=0,1)||("number"==typeof h||"boolean"==typeof h&&(h=+h,1)||"string"==typeof h&&!/^(?:=|true|false)/i.test(h)&&(t=calc.parse(0,0,0,h),/^date|number|percent$/.test(t.type)&&(h=+t.value,1)))&&(h|=0,1)&&(0===h||1===h||2===h||3===h||4===h)?(r.push(h),o<s||(i="NUM",0)?7<e.length?new CalcError("N/A"):r:new CalcError(i)):h instanceof CalcError?h:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},PRICE),defineBuiltinFunction("PRICEDISC",!1,{check:function(e){var t,r=[],n=0,i="VALUE",o=e[n++];if(o instanceof CalcError)return o;if(!("number"==typeof(o=this.force(o))||"boolean"==typeof o&&(o=+o,1)||"string"==typeof o&&!/^(?:=|true|false)/i.test(o)&&(t=calc.parse(0,0,0,o),/^date|number|percent$/.test(t.type)&&(o=+t.value,1)))||(o|=0,0))return o instanceof CalcError?o:new CalcError(i);r.push(o);var s=e[n++];if(s instanceof CalcError)return s;if(!("number"==typeof(s=this.force(s))||"boolean"==typeof s&&(s=+s,1)||"string"==typeof s&&!/^(?:=|true|false)/i.test(s)&&(t=calc.parse(0,0,0,s),/^date|number|percent$/.test(t.type)&&(s=+t.value,1)))||(s|=0,0))return s instanceof CalcError?s:new CalcError(i);r.push(s);var a=e[n++];if(a instanceof CalcError)return a;if(!("number"==typeof(a=this.force(a))&&(a=limitPrecision(a),1)||"boolean"==typeof a&&(a=+a,1)||"string"==typeof a&&!/^(?:=|true|false)/i.test(a)&&(t=calc.parse(0,0,0,a),/^date|number|percent$/.test(t.type)&&(a=+t.value,1)))||!(a>0||(i="NUM",0)))return a instanceof CalcError?a:new CalcError(i);r.push(a);var l=e[n++];if(l instanceof CalcError)return l;if(!("number"==typeof(l=this.force(l))&&(l=limitPrecision(l),1)||"boolean"==typeof l&&(l=+l,1)||"string"==typeof l&&!/^(?:=|true|false)/i.test(l)&&(t=calc.parse(0,0,0,l),/^date|number|percent$/.test(t.type)&&(l=+t.value,1)))||!(l>0||(i="NUM",0)))return l instanceof CalcError?l:new CalcError(i);r.push(l);var u=e[n++];return u instanceof CalcError?u:null==(u=this.force(u))&&(u=0,1)||("number"==typeof u||"boolean"==typeof u&&(u=+u,1)||"string"==typeof u&&!/^(?:=|true|false)/i.test(u)&&(t=calc.parse(0,0,0,u),/^date|number|percent$/.test(t.type)&&(u=+t.value,1)))&&(u|=0,1)&&(0===u||1===u||2===u||3===u||4===u)?(r.push(u),o<s||(i="NUM",0)?5<e.length?new CalcError("N/A"):r:new CalcError(i)):u instanceof CalcError?u:new CalcError(i)},resolve:function(e,t){var r=[],n=0;r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),r.push(e[n++]),this.resolveCells(r,t)}},PRICEDISC);var MAX_IT=300,EPS=22204e-20,FP_MIN=1e-30,f_abs=Math.abs;function ERF(e){if(f_abs(e)>=3.3)return 1-ERFC(e);var t=e>0?1:-1;-1==t&&(e=-e);for(var r=0,n=1,i=1;i<100;i++)r+=n,n*=2*e*e/(2*i+1);return 2*t/Math.sqrt(Math.PI)*e*Math.exp(-e*e)*r}function ERFC(e){if(f_abs(e)<3.3)return 1-ERF(e);var t=1;e<0&&(t=-1,e=-e);for(var r=e,n=8;n>=1;n-=.5)r=e+n/r;return r=1/(e+r),1==t?Math.exp(-e*e)/Math.sqrt(Math.PI)*r:2-Math.exp(-e*e)/Math.sqrt(Math.PI)*r}function GAMMALN(e){var t=[1.000000000190015,76.18009172947146,-86.50532032941678,24.01409824083091,-1.231739572450155,.001208650973866179,-5395239384953e-18],r=e,n=e+5.5,i=t[0];n-=(e+.5)*Math.log(n);for(var o=1;o<=6;o++)i+=t[o]/(r+=1);return-n+Math.log(Math.sqrt(2*Math.PI)*i/e)}function GAMMA(e){if(e>0)return Math.exp(GAMMALN(e));var t=Math.PI,r=-e;return-t/(r*GAMMA(r)*Math.sin(t*r))}function BETALN(e,t){return GAMMALN(e)+GAMMALN(t)-GAMMALN(e+t)}function BETA(e,t){return Math.exp(BETALN(e,t))}function gamma_inc(e,t){return t<e+1?g_series(e,t):1-g_contfrac(e,t)}function g_series(e,t){var r,n=1/e,i=n,o=e,s=GAMMALN(e);for(r=1;r<=MAX_IT&&(n+=i*=t/++o,!(f_abs(i)<f_abs(n)*EPS));r++);return n*Math.exp(-t+e*Math.log(t)-s)}function g_contfrac(e,t){for(var r=FP_MIN,n=r,i=0,o=1,s=t+1-e,a=GAMMALN(e),l=1;l<=MAX_IT;l++){f_abs(i=s+o*i)<FP_MIN&&(i=FP_MIN),f_abs(n=s+o/n)<FP_MIN&&(n=FP_MIN);var u=n*(i=1/i);if(r*=u,f_abs(u-1)<EPS)break;s+=2,o=-l*(l-e)}return r*Math.exp(-t-a+e*Math.log(t))}function GAMMA_DIST(e,t,r,n){return n?gamma_inc(t,e/r):Math.pow(e/r,t-1)*Math.exp(-e/r)/(r*GAMMA(t))}function GAMMA_INV(e,t,r){if(0===e)return 0;if(1==e)return 1/0;var n=0,i=10,o=0,s=t*r;s>1&&(i*=s);for(var a=0;a<MAX_IT;a++){var l=GAMMA_DIST(o=.5*(n+i),t,r,!0);if(f_abs(e-l)<1e-16)break;l>e?i=o:n=o}return o}function NORM_S_DIST(e,t){return t?.5+.5*ERF(e/Math.sqrt(2)):Math.exp(-e*e/2)/Math.sqrt(2*Math.PI)}function NORM_S_INV(e){var t,r,n=[-39.69683028665376,220.9460984245205,-275.9285104469687,138.357751867269,-30.66479806614716,2.506628277459239],i=[-54.47609879822406,161.5858368580409,-155.6989798598866,66.80131188771972,-13.28068155288572],o=[-.007784894002430293,-.3223964580411365,-2.400758277161838,-2.549732539343734,4.374664141464968,2.938163982698783],s=[.007784695709041462,.3224671290700398,2.445134137142996,3.754408661907416],a=.02425;return e<a?(t=Math.sqrt(-2*Math.log(e)),(((((o[0]*t+o[1])*t+o[2])*t+o[3])*t+o[4])*t+o[5])/((((s[0]*t+s[1])*t+s[2])*t+s[3])*t+1)):.97575<e?(t=Math.sqrt(-2*Math.log(1-e)),-(((((o[0]*t+o[1])*t+o[2])*t+o[3])*t+o[4])*t+o[5])/((((s[0]*t+s[1])*t+s[2])*t+s[3])*t+1)):(((((n[0]*(r=(t=e-.5)*t)+n[1])*r+n[2])*r+n[3])*r+n[4])*r+n[5])*t/(((((i[0]*r+i[1])*r+i[2])*r+i[3])*r+i[4])*r+1)}function NORM_DIST(e,t,r,n){return n?NORM_S_DIST((e-t)/r,!0):Math.exp(-(e-t)*(e-t)/(2*r*r))/(r*Math.sqrt(2*Math.PI))}function NORM_INV(e,t,r){return t+r*NORM_S_INV(e)}function betastd_pdf(e,t,r){return Math.exp((t-1)*Math.log(e)+(r-1)*Math.log(1-e)-BETALN(t,r))}function betastd_cdf(e,t,r){var n=Math.exp(t*Math.log(e)+r*Math.log(1-e)-BETALN(t,r));return e<(t+1)/(t+r+2)?n*beta_lentz(t,r,e)/t:1-n*beta_lentz(r,t,1-e)/r}function beta_lentz(e,t,r){var n,i,o,s,a,l,u,c,h,f;for(h=e-1,s=1,f_abs(a=1-(c=e+t)*r/(f=e+1))<FP_MIN&&(a=FP_MIN),u=a=1/a,n=1;n<=MAX_IT&&(f_abs(a=1+(o=n*(t-n)*r/((h+(i=2*n))*(e+i)))*a)<FP_MIN&&(a=FP_MIN),f_abs(s=1+o/s)<FP_MIN&&(s=FP_MIN),u*=(a=1/a)*s,f_abs(a=1+(o=-(e+n)*(c+n)*r/((e+i)*(f+i)))*a)<FP_MIN&&(a=FP_MIN),f_abs(s=1+o/s)<FP_MIN&&(s=FP_MIN),u*=l=(a=1/a)*s,!(f_abs(l-1)<EPS));n++);return u}function betastd_inv(e,t,r){for(var n=0,i=1,o=0,s=0;s<MAX_IT;s++){var a=betastd_cdf(o=.5*(n+i),t,r);if(f_abs(e-a)<EPS)break;a>e?i=o:n=o}return o}function BETADIST(e,t,r,n,i){return betastd_cdf((e-n)/(i-n),t,r)}function BETA_DIST(e,t,r,n,i,o){return n?betastd_cdf((e-i)/(o-i),t,r):betastd_pdf((e-i)/(o-i),t,r)/(o-i)}function BETA_INV(e,t,r,n,i){return n+(i-n)*betastd_inv(e,t,r)}function chisq_left(e,t,r){return GAMMA_DIST(e,t/2,2,r)}function chisq_right(e,t){return 1-chisq_left(e,t,!0)}function chisq_left_inv(e,t){return GAMMA_INV(e,t/2,2)}function chisq_right_inv(e,t){return chisq_left_inv(1-e,t)}function chisq_test(e,t){var r,n,i=e.length,o=e[0].length,s=0;for(r=0;r<i;r++)for(n=0;n<o;n++){var a=t[r][n],l=e[r][n]-a;s+=(l*=l)/a}return chisq_right(s,(i-1)*(o-1))}function expon(e,t,r){return r?1-Math.exp(-t*e):t*Math.exp(-t*e)}function poisson(e,t,r){if(r)return 1-chisq_left(2*t,2*(e+1),!0);for(var n=0,i=2;i<=e;i++)n+=Math.log(i);return Math.exp(e*Math.log(t)-t-n)}function Fdist(e,t,r,n){if(n)return betastd_cdf(t*e/(r+t*e),t/2,r/2);var i=t/r;return i/BETA(t/=2,r/=2)*Math.pow(i*e,t-1)/Math.pow(1+i*e,t+r)}function Fdist_right(e,t,r){return 1-Fdist(e,t,r,!0)}function Finv_right(e,t,r){return r/t*(1/BETA_INV(e,r/2,t/2,0,1)-1)}function Finv(e,t,r){return r/t*(1/BETA_INV(1-e,r/2,t/2,0,1)-1)}function _mean(e){for(var t=0,r=e.length,n=0;n<r;n++)t+=e[n];return t/r}function _var_sq(e,t){for(var r=0,n=e.length,i=0;i<n;i++){var o=e[i]-t;r+=o*o}return r/(n-1)}function Ftest(e,t){var r=e.length-1,n=t.length-1,i=_var_sq(e,_mean(e)),o=_var_sq(t,_mean(t));if(!i||!o)throw new CalcError("DIV/0");return 2*Fdist(i/o,r,n,!0)}function fisher(e){return.5*Math.log((1+e)/(1-e))}function fisherinv(e){var t=Math.exp(2*e);return(t-1)/(t+1)}function Tdist(e,t,r){return r?1-.5*betastd_cdf(t/(e*e+t),t/2,.5):1/(Math.sqrt(t)*BETA(.5,t/2))*Math.pow(1+e*e/t,-(t+1)/2)}function Tdist_right(e,t){return 1-Tdist(e,t,!0)}function Tdist_2tail(e,t){return e<0&&(e=-e),2*Tdist_right(e,t)}function Tdist_inv(e,t){var r=betastd_inv(2*Math.min(e,1-e),t/2,.5);return r=Math.sqrt(t*(1-r)/r),e>.5?r:-r}function Tdist_2tail_inv(e,t){return Tdist_inv(1-e/2,t)}function Tdist_test(e,t,r,n){var i,o,s=e.length,a=t.length;if(1==n){for(var l=0,u=0,c=0;c<s;c++){var h=e[c]-t[c];l+=h,u+=h*h}var f=l/s;return i=f/Math.sqrt((u-l*f)/(s*(s-1))),1==r?Tdist_right(i,s-1):Tdist_2tail(i,s-1)}var p=_mean(e),d=_mean(t),m=_var_sq(e,p),g=_var_sq(t,d);if(3==n){var C=m/s,v=g/a,y=C+v,E=C/y,w=v/y;return o=1/(E*E/(s-1)+w*w/(a-1)),i=f_abs(p-d)/Math.sqrt(y),1==r?Tdist_right(i,o):Tdist_2tail(i,o)}return o=s+a-2,i=f_abs(p-d)*Math.sqrt(o*s*a/((s+a)*((s-1)*m+(a-1)*g))),1==r?Tdist_right(i,o):Tdist_2tail(i,o)}function confidence_t(e,t,r){return-Tdist_inv(e/2,r-1)*t/Math.sqrt(r)}function confidence_norm(e,t,r){return-NORM_S_INV(e/2)*t/Math.sqrt(r)}function gauss(e){return NORM_S_DIST(e,!0)-.5}function phi(e){return NORM_S_DIST(e)}function lognorm_dist(e,t,r,n){if(n)return.5+.5*ERF((Math.log(e)-t)/(r*Math.sqrt(2)));var i=Math.log(e)-t;return Math.exp(-i*i/(2*r*r))/(e*r*Math.sqrt(2*Math.PI))}function lognorm_inv(e,t,r){return Math.exp(NORM_INV(e,t,r))}function prob(e,t,r,n){var i,o=e.length,s=0;for(i=0;i<o;i++){if(t[i]<=0||t[i]>1)throw new CalcError("NUM");s+=t[i]}if(1!=s)throw new CalcError("NUM");var a=0;for(i=0;i<o;i++){var l=e[i];l>=r&&l<=n&&(a+=t[i])}return a}function slope(e,t){for(var r=_mean(t),n=_mean(e),i=0,o=0,s=0,a=e.length;s<a;s++){var l=t[s]-r;i+=l*(e[s]-n),o+=l*l}return i/o}function intercept(e,t){for(var r=_mean(t),n=_mean(e),i=0,o=0,s=0,a=e.length;s<a;s++){var l=t[s]-r;i+=l*(e[s]-n),o+=l*l}return n-i*r/o}function pearson(e,t){whipNumberArrays(e,t);for(var r=_mean(e),n=_mean(t),i=0,o=0,s=0,a=0,l=e.length;a<l;a++){var u=e[a]-r,c=t[a]-n;i+=u*c,o+=u*u,s+=c*c}return i/Math.sqrt(o*s)}function rsq(e,t){var r=pearson(e,t);return r*r}function steyx(e,t){for(var r=t.length,n=_mean(t),i=_mean(e),o=0,s=0,a=0,l=0;l<r;l++){var u=t[l]-n,c=e[l]-i;o+=c*c,s+=u*c,a+=u*u}return Math.sqrt((o-s*s/a)/(r-2))}function forecast(e,t,r){for(var n=_mean(r),i=_mean(t),o=0,s=0,a=0,l=r.length;a<l;a++){var u=r[a]-n;o+=u*(t[a]-i),s+=u*u}if(0===s)throw new CalcError("N/A");var c=o/s;return i-c*n+c*e}function _mat_mean(e){for(var t=e.height,r=0,n=0;n<t;n++)r+=e.data[n][0];return r/t}function _mat_devsq(e,t){for(var r=e.height,n=0,i=0;i<r;i++){var o=e.data[i][0]-t;n+=o*o}return n}function linest(e,t,r,n){var i=0;t||(t=e.map((function(){return++i}))),r&&((t=t.clone()).eachRow((function(e){t.data[e].unshift(1)})),++t.width);var o=t.transpose(),s=o.multiply(t).inverse().multiply(o).multiply(e),a=[];for(i=s.height-1;i>=0;i--)a.push(s.data[i][0]);if(r||a.push(0),!n)return this.asMatrix([a]);var l=t.multiply(s),u=e.adds(l,!0),c=_mat_devsq(l,r?_mat_mean(l):0),h=_mat_devsq(u,r?_mat_mean(u):0),f=[];f.push(c,h);var p=c/(c+h),d=e.height-t.width,m=Math.sqrt(h/d),g=[];g.push(p,m);var C=r?c/(t.width-1)/(h/d):p/t.width/((1-p)/d),v=[];v.push(C,d);var y=o.multiply(t).inverse(),E=[];for(i=y.height-1;i>=0;i--)E.push(Math.sqrt(y.data[i][i]*h/d));return this.asMatrix([a,E,g,v,f])}function logest(e,t,r,n){return linest.call(this,e.map(Math.log),t,r,n).map(Math.exp)}function trend(e,t,r,n){var i=0;t||(t=e.map((function(){return++i}))),n&&((t=t.clone()).eachRow((function(e){t.data[e].unshift(1)})),++t.width);var o=t.transpose(),s=o.multiply(t).inverse().multiply(o).multiply(e);return r?n&&((r=r.clone()).eachRow((function(e){r.data[e].unshift(1)})),++r.width):r=t,r.multiply(s)}function growth(e,t,r,n){return trend.call(this,e.map(Math.log),t,r,n).map(Math.exp)}function root_newton(e,t,r,n){for(var i=r||20,o=n||1e-7,s=t,a=1;a<=i;a++){var l=e(s),u=l[0]/l[1];if(s-=u,Math.abs(u)<o)return s}return new CalcError("NUM")}function FV(e,t,r,n,i){var o=Math.pow(1+e,t);return-(n*o+r*(e?(o-1)/e:t)*(1+e*i))}function PV(e,t,r,n,i){if(!e)return-n-r*t;var o=Math.pow(1+e,t);return-(n+r*(o-1)/e*(1+e*i))/o}function PMT(e,t,r,n,i){if(!e)return-(n+r)/t;var o=Math.pow(1+e,t);return-e*(n+r*o)/((1+e*i)*(o-1))}function NPER(e,t,r,n,i){if(!e)return-(n+r)/t;var o=t*(1+e*i);return Math.log((o-n*e)/(o+r*e))/Math.log(1+e)}function RATE(e,t,r,n,i,o){return root_newton((function(o){var s=Math.pow(1+o,e-1),a=s*(1+o);return[r*a+t*(1/o+i)*(a-1)+n,e*r*s+t*(-(a-1)/(o*o)+(1/o+i)*e*s)]}),o)}function IPMT(e,t,r,n,i,o){if(1==o&&1==t)return 0;var s=FV(e,t-1,PMT(e,r,n,i,o),n,o)*e;return o?s/(1+e):s}function PPMT(e,t,r,n,i,o){return PMT(e,r,n,i,o)-IPMT(e,t,r,n,i,o)}function CUMPRINC(e,t,r,n,i,o){1==o&&(n--,i--);var s=Math.pow(1+e,t),a=Math.pow(1+e,n-1),l=Math.pow(1+e,i),u=e*r*s/(s-1);return l*r-(l-1)/e*u-(a*r-(a-1)/e*u)}function CUMIPMT(e,t,r,n,i,o){for(var s=0,a=n;a<=i;a++)s+=IPMT(e,a,t,r,0,o);return s}function NPV(e,t){for(var r=0,n=0,i=t.length;n<i;n++)r+=t[n]*Math.pow(1+e,-n-1);return r}function IRR(e,t){return root_newton((function(t){for(var r=0,n=0,i=0,o=e.length;i<o;i++)r+=e[i]*Math.pow(1+t,-i-1),n+=-i*e[i]*Math.pow(1+t,-i-2);return[r,n]}),t)}function EFFECT(e,t){return Math.pow(1+e/t,t)-1}function NOMINAL(e,t){return t*(Math.pow(e+1,1/t)-1)}function XNPV(e,t,r){for(var n=0,i=0,o=t.length;i<o;i++)n+=t[i]*Math.pow(1+e,(r[0]-r[i])/365);return n}function XIRR(e,t,r){return root_newton((function(r){for(var n=e[0],i=0,o=1,s=e.length;o<s;o++){var a=(t[0]-t[o])/365;n+=e[o]*Math.pow(1+r,a),i+=a*e[o]*Math.pow(1+r,a-1)}return[n,i]}),r)}function ISPMT(e,t,r,n){return-n*e*(1-t/r)}function DB(e,t,r,n,i){var o=1-Math.pow(t/e,1/r),s=e*(o=Math.floor(1e3*o+.5)/1e3)*i/12;if(1==n)return s;for(var a=1;a<r;a++){if(a==n-1)return(e-s)*o;s+=(e-s)*o}return(e-s)*o*(12-i)/12}function DDB(e,t,r,n,i){var o=i/r,s=-e*(Math.pow(1-o,n-1)-1),a=(e-s)*o;return a=Math.min(a,Math.max(0,e-s-t))}function SLN(e,t,r){return(e-t)/r}function SYD(e,t,r,n){return(e-t)*(r-n+1)*2/(r*(r+1))}function VDB(e,t,r,n,i,o,s){var a=o>=r?1:o/r;function l(e,r){var n,i,o;return i=1==a?1==r?e:0:e*Math.pow(1-a,r-1),(n=(o=e*Math.pow(1-a,r))<t?i-t:i-o)<0?0:n}function u(e,r,n){for(var i,o=e-t,s=Math.ceil(n),a=0,u=0,c=!1,h=1;h<=s;h++){if(c)i=a;else{var f=l(e,h);(a=o/(r-h+1))>f?(i=a,c=!0):(i=f,o-=f)}h==s&&(i*=n+1-s),u+=i}return u}var c=Math.floor(n),h=Math.ceil(i),f=0;if(s)for(var p=c+1;p<=h;p++){var d=l(e,p);p==c+1?d*=Math.min(i,c+1)-n:p==h&&(d*=i+1-h),f+=d}else{var m=r;if(n!=Math.floor(n)&&o>1&&n>=r/2){var g=n-r/2;n=r/2,i-=g,m+=1}e-=u(e,m,n),f=u(e,r-n,i-n)}return f}function _edate(e,t){var r=unpackDate$1(e),n=r.month+t,i=r.year+Math.floor(n/12);return(n%=12)<0&&(n+=12),r=Math.min(r.date,daysInMonth(i,n)),packDate$1(i,n,r)}function _daysBetween(e,t,r){return 1==r||2==r||3==r?t-e:_days_360(e,t,r)}function _borderCoupons(e,t,r){var n=unpackDate$1(e),i=unpackDate$1(t).year-n.year;i>0&&(i=(i-1)*r);var o,s=12/r;do{o=_edate(t,-++i*s)}while(e<o);return[o,_edate(t,- --i*s)]}function _borderCoupons_fw(e,t,r){var n=unpackDate$1(t),i=unpackDate$1(e),o=n.year-i.year;o>0&&(o=(o-1)*r);for(var s,a=e,l=12/r;t>a;)s=a,a=_edate(e,++o*l);return[s,a]}function COUPDAYBS(e,t,r,n){return _daysBetween(_borderCoupons(e,t,r)[0],e,n)}function COUPDAYS(e,t,r,n){if(1==n){var i=_borderCoupons(e,t,r);return _daysBetween(i[0],i[1],1)}return 3==n?365/r:360/r}function COUPDAYSNC(e,t,r,n){return _daysBetween(e,_borderCoupons(e,t,r)[1],n)}function COUPPCD(e,t,r){return _borderCoupons(e,t,r)[0]}function COUPNCD(e,t,r){return _borderCoupons(e,t,r)[1]}function COUPNUM(e,t,r){var n=unpackDate$1(e),i=unpackDate$1(t);return 1+((12*(i.year-n.year)+i.month-n.month)*r/12|0)}function daysInYear2(e,t){return 3==t?365:1==t?isLeapYear(e)?366:365:360}function ACCRINTM(e,t,r,n,i){var o=daysInYear2(unpackDate$1(t).year,i);return r*n*_daysBetween(e,t,i)/o}function ACCRINT(e,t,r,n,i,o,s,a){var l,u,c,h,f,p,d=0,m=i*n/o,g=s%2==0?360:365;function C(e,t){return(t-e)*o/g|0}return r<=t?(u=(l=_borderCoupons(r,t,o))[0],c=l[1],u<=e?m*_daysBetween(e,r,s)/_daysBetween(u,c,s):(h=(l=_borderCoupons(e,u,o))[0],m*((p=C(f=l[1],r))+_daysBetween(e,f,s)/_daysBetween(h,f,s)+(r<c?_daysBetween(u,r,s)/_daysBetween(u,c,s):0)))):(u=(l=_borderCoupons_fw(t,r,o))[0],c=l[1],p=C(t,r),d=c==r?m*p:m*(p+_daysBetween(u,r,s)/_daysBetween(u,c,s)),a?(u=(l=_borderCoupons(e,t,o))[0],c=l[1],d+=m*((p=C(e,t))+_daysBetween(e,c,s)/_daysBetween(u,c,s))):d)}function DISC(e,t,r,n,i){return(n-r)/n*(i%2==0?360:isLeapYear(unpackDate$1(e).year)?366:365)/_daysBetween(e,t,i)}function INTRATE(e,t,r,n,i){return(n-r)/r*(i%2==0?360:isLeapYear(unpackDate$1(e).year)?366:365)/_daysBetween(e,t,i)}function RECEIVED(e,t,r,n,i){var o=i%2==0?360:isLeapYear(unpackDate$1(e).year)?366:365;return r/(1-n*_daysBetween(e,t,i)/o)}function PRICE(e,t,r,n,i,o,s){var a=1+((t-e)*o/(s%2==0?360:365)|0),l=_borderCoupons(e,t,o),u=l[0],c=l[1],h=_daysBetween(u,e,s),f=_daysBetween(e,c,s),p=_daysBetween(u,c,s),d=100*r/o,m=n/o,g=f/p;return 1==a?(i+d)/(1+g*m)-h/p*d:i/Math.pow(1+m,a-1+g)+d*Math.pow(1+m,1-a-g)*(Math.pow(1+m,a)-1)/m-h/p*d}function PRICEDISC(e,t,r,n,i){return n-r*n*_daysBetween(e,t,i)/daysInYear2(unpackDate$1(t).year,i)}function whipNumberArrays(e,t){for(var r=e.length;--r>=0;)"number"==typeof e[r]&&"number"==typeof t[r]||(e.splice(r,1),t.splice(r,1))}const{packDate:packDate,unpackDate:unpackDate,packTime:packTime,unpackTime:unpackTime,serialToDate:serialToDate,dateToSerial:dateToSerial,defineAlias:defineAlias}=calc.runtime;var commonEngine=Object.freeze({__proto__:null,ALL_PROPERTIES:ALL_PROPERTIES,ALL_REASONS:ALL_REASONS,AddColumnCommand:AddColumnCommand,AddCommand:AddCommand,AddRowCommand:AddRowCommand,AdjustDecimalsCommand:AdjustDecimalsCommand,AdjustRowHeightCommand:AdjustRowHeightCommand,ApplyFilterCommand:ApplyFilterCommand,AutoFillCalculator:AutoFillCalculator,AutoFillCommand:AutoFillCommand,Axis:Axis,AxisManager:AxisManager,BorderChangeCommand:BorderChangeCommand,BringToFrontCommand:BringToFrontCommand,CalcError:CalcError,CellRef:CellRef,ClearContentCommand:ClearContentCommand,ClearFilterCommand:ClearFilterCommand,Clipboard:Clipboard,ColumnWidthCommand:ColumnWidthCommand,Command:Command,Context:Context,Controller:Controller,CopyCommand:CopyCommand,CustomFilter:CustomFilter,CutCommand:CutCommand,Deferred:Deferred,DefineNameCommand:DefineNameCommand,DeleteColumnCommand:DeleteColumnCommand,DeleteCommand:DeleteCommand,DeleteDrawingCommand:DeleteDrawingCommand,DeleteNameCommand:DeleteNameCommand,DeleteRowCommand:DeleteRowCommand,Drawing:Drawing,DrawingCommand:DrawingCommand,DrawingUpdateCommand:DrawingUpdateCommand,DynamicFilter:DynamicFilter,EditCommand:EditCommand,EditValidationCommand:EditValidationCommand,EventListener:EventListener,FIRSTREF:FIRSTREF,Filter:Filter,FilterCommand:FilterCommand,FormulaBar:FormulaBar,FormulaContext:FormulaContext,FormulaInput:FormulaInput,FreezePanesCommand:FreezePanesCommand,Grid:Grid,GridLinesChangeCommand:GridLinesChangeCommand,HideLineCommand:HideLineCommand,HyperlinkCommand:HyperlinkCommand,InsertCommentCommand:InsertCommentCommand,InsertImageCommand:InsertImageCommand,Matrix:Matrix,MergeCellCommand:MergeCellCommand,NULLREF:NULLREF,NameCommand:NameCommand,NameEditor:NameEditor,NameRef:NameRef,OpenCommand:OpenCommand,Pane:Pane,PaneAxis:PaneAxis,PaneGrid:PaneGrid,PasteCommand:PasteCommand,PropertyBag:PropertyBag,PropertyChangeCommand:PropertyChangeCommand,PropertyCleanCommand:PropertyCleanCommand,Range:Range$1,RangeList:RangeList,RangeRef:RangeRef,RangeTree:RangeTree,Ref:Ref,ReorderDrawingsCommand:ReorderDrawingsCommand,RowHeightCommand:RowHeightCommand,SHEETREF:SHEETREF,SaveAsCommand:SaveAsCommand,SendToBackCommand:SendToBackCommand,Sheet:Sheet,SheetDataSourceBinder:SheetDataSourceBinder,SheetEditor:SheetEditor,SheetNavigator:SheetNavigator,SortCommand:SortCommand,Sorter:Sorter,SpreadsheetWidget:SpreadsheetWidget,TargetValueCommand:TargetValueCommand,TextWrapCommand:TextWrapCommand,ToolbarCopyCommand:ToolbarCopyCommand,ToolbarCutCommand:ToolbarCutCommand,ToolbarPasteCommand:ToolbarPasteCommand,TopFilter:TopFilter,UnHideLineCommand:UnHideLineCommand,UnionRef:UnionRef,ValidationFormulaContext:ValidationFormulaContext,ValueFilter:ValueFilter,View:View,Workbook:Workbook,calc:calc,dateToNumber:dateToNumber,dateToSerial:dateToSerial,defineAlias:defineAlias,defineFunction:defineFunction,draw:draw,drawCell:drawCell,formatting:formatting,initDynamicFilter:initDynamicFilter,intl:intl,numberToDate:numberToDate,packDate:packDate,packTime:packTime,registerEditor:registerEditor,serialToDate:serialToDate,unpackDate:unpackDate,unpackTime:unpackTime,validation:validationExport});export{commonEngine as c};export{__meta__};
//# sourceMappingURL=kendo.spreadsheet-common.cmn.chunk.js.map
