/**
 * Kendo UI v2024.4.1112 (http://www.telerik.com/kendo-ui)
 * Copyright 2024 Progress Software Corporation and/or one of its subsidiaries or affiliates. All rights reserved.
 *
 * Kendo UI commercial licenses may be obtained at
 * http://www.telerik.com/purchase/license-agreement/kendo-ui-complete
 * If you do not own a commercial license, this file shall be governed by the trial license terms.
 */
import{c as compileFilter}from"./kendo.data-query.cmn.chunk.js";const __meta__={id:"pivotgrid-common.cmn.chunk",name:"PivotgridCommonCmnChunk",category:"web",description:"A reusable outputed chunk of code",depends:["data-query.cmn.chunk"],hidden:!0,chunk:!0};var filterFunctionFormats={contains:', InStr({0}.CurrentMember.MEMBER_CAPTION,"{1}") > 0',doesnotcontain:', InStr({0}.CurrentMember.MEMBER_CAPTION,"{1}")',endswith:', Right({0}.CurrentMember.MEMBER_CAPTION,Len("{1}"))="{1}"',eq:', {0}.CurrentMember.MEMBER_CAPTION = "{1}"',neq:', {0}.CurrentMember.MEMBER_CAPTION = "{1}"',startswith:', Left({0}.CurrentMember.MEMBER_CAPTION,Len("{1}"))="{1}"'},operators={doesnotcontain:"doesnotcontain",in:"in",neq:"neq"};function serializeFilters(e,r){for(var t="",n="",a=e.length-1;a>=0;a--)n="SELECT (",n+=serializeExpression(e[a]),n+=") ON 0",t=a===e.length-1?n+=" FROM ["+r+"]":n+" FROM ( "+t+" )";return t}function serializeExpression(e){var r="",t=String(e.value),n=e.field,a=e.operator;return a===operators.in?(r+="{",r+=t,r+="}"):(r+=a===operators.neq||a===operators.doesnotcontain?"-":"",r+="Filter(",r+=n+".MEMBERS",r+=formatString(filterFunctionFormats[a],n,t),r+=")"),r}function formatString(e){for(var r=[],t=1;t<arguments.length;t++)r[t-1]=arguments[t];return r.forEach((function(r,t){e=e.replace(new RegExp("\\{"+t+"\\}","g"),r)})),e}function serializeMembers(e,r,t){var n,a="",o=parseDescriptors(e=e||[]),i=o.expanded,l=getRootNames(o.root),u=[],s=i.length,c=0,f=[];if(l.length>1||r.length>1){for(u.push(crossJoinCommand(l,r));c<s;c++)f=mapNames(n=expandMemberDescriptor(i[c].name,t),l),u.push(crossJoinCommand(f,r));a+=u.join(",")}else{for(;c<s;c++)n=expandMemberDescriptor(i[c].name,t),f.push(n[0]);a+=l.concat(f).join(",")}return a}function measureNames(e){for(var r,t=e.length,n=[],a=0;a<t;a++)r=e[a],n.push(void 0!==r.name?r.name:r);return n}function getRootNames(e){var r=[];return e.forEach((function(e){var t=e.name[0],n=baseHierarchyPath(t);r.some((function(e){return 0===e.indexOf(n)}))||r.push(t)})),r}function parseDescriptors(e){for(var r,t=[],n=[],a=[],o=0;o<e.length;o++){var i=e[o],l=i.name;if(r=!1,l.length>1)n.push(i);else{for(var u=baseHierarchyPath(l[0]),s=0,c=a.length;s<c;s++)if(0===a[s].name[0].indexOf(u)){r=!0;break}r||a.push(i),i.expand&&t.push(i)}}return{expanded:t=t.concat(n),root:a}}function mapNames(e,r){var t=r.length;r=r.slice(0);for(var n=0;n<e.length;n++)for(var a=e[n],o=0;o<t;o++){var i=baseHierarchyPath(r[o]);if(-1!==a.indexOf(i)){r[o]=a;break}}return r}function crossJoinCommand(e,r){var t=e.slice(0);return r.length>1&&t.push("{"+measureNames(r).join(",")+"}"),crossJoin(t)}function expandMemberDescriptor(e,r){var t=e.length-1,n=e[t],a=sortDescriptorForMember(r,n);return a&&a.dir?n="ORDER("+n+".Children,"+a.field+".CurrentMember.MEMBER_CAPTION,"+a.dir+")":n+=".Children",e[t]=n,e}function sortDescriptorForMember(e,r){for(var t=0,n=e.length;t<n;t++)if(0===r.indexOf(e[t].field))return e[t];return null}function baseHierarchyPath(e){var r=e.split(".");return r.length>2?r[0]+"."+r[1]:e}function crossJoin(e){var r,t="CROSSJOIN({";return e.length>2?(r=e.pop(),t+=crossJoin(e)):(t+=e.shift(),r=e.pop()),t+="},{",t+=r,t+="})"}function createRequestBody(e){var r='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"><Header/><Body><Execute xmlns="urn:schemas-microsoft-com:xml-analysis"><Command><Statement>',t=e.columnAxes,n=void 0===t?[]:t,a=e.rowAxes,o=void 0===a?[]:a,i=e.measureAxes,l=void 0===i?[]:i,u=e.sort,s=void 0===u?[]:u,c=e.filter,f=void 0===c?[]:c,p="rows"===e.measuresAxis;return r+="SELECT NON EMPTY {",!n.length&&o.length&&(!l.length||l.length&&p)&&(n=o,o=[],p=!1),n.length||o.length||(p=!1),n.length?r+=serializeMembers(n,p?[]:l,s):l.length&&!p&&(r+=measureNames(l).join(",")),r+="} DIMENSION PROPERTIES CHILDREN_CARDINALITY, PARENT_UNIQUE_NAME ON COLUMNS",(o.length||p&&l.length>1)&&(r+=", NON EMPTY {",o.length?r+=serializeMembers(o,p?l:[],s):r+=measureNames(l).join(","),r+="} DIMENSION PROPERTIES CHILDREN_CARDINALITY, PARENT_UNIQUE_NAME ON ROWS"),f.length?(r+=" FROM ",r+="(",r+=serializeFilters(f,e.connection.cube),r+=")"):r+=" FROM ["+e.connection.cube+"]",1===l.length&&n.length&&(r+=" WHERE ("+measureNames(l).join(",")+")"),(r+="</Statement></Command><Properties><PropertyList><Catalog>"+e.connection.catalog+"</Catalog><Format>Multidimensional</Format></PropertyList></Properties></Execute></Body></Envelope>").replace(/&/g,"&amp;")}var extendStatics=function(e,r){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])},extendStatics(e,r)};function __extends(e,r){function t(){this.constructor=e}extendStatics(e,r),e.prototype=null===r?Object.create(r):(t.prototype=r.prototype,new t)}var __assign=function(){return __assign=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++)for(var a in r=arguments[t])Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a]);return e},__assign.apply(this,arguments)};function __rest(e,r){var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&r.indexOf(n)<0&&(t[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)r.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(t[n[a]]=e[n[a]])}return t}function __decorate(e,r,t,n){var a,o=arguments.length,i=o<3?r:null===n?n=Object.getOwnPropertyDescriptor(r,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,r,t,n);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(i=(o<3?a(i):o>3?a(r,t,i):a(r,t))||i);return o>3&&i&&Object.defineProperty(r,t,i),i}function __param(e,r){return function(t,n){r(t,n,e)}}function __metadata(e,r){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,r)}function __awaiter(e,r,t,n){return new(t||(t=Promise))((function(a,o){function i(e){try{u(n.next(e))}catch(e){o(e)}}function l(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){var r;e.done?a(e.value):(r=e.value,r instanceof t?r:new t((function(e){e(r)}))).then(i,l)}u((n=n.apply(e,r||[])).next())}))}function __generator(e,r){var t,n,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(o){return function(l){return function(o){if(t)throw new TypeError("Generator is already executing.");for(;i;)try{if(t=1,n&&(a=2&o[0]?n.return:o[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,o[1])).done)return a;switch(n=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,n=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=r.call(e,i)}catch(e){o=[6,e],n=0}finally{t=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}}function __createBinding(e,r,t,n){void 0===n&&(n=t),e[n]=r[t]}function __exportStar(e,r){for(var t in e)"default"===t||r.hasOwnProperty(t)||(r[t]=e[t])}function __values(e){var r="function"==typeof Symbol&&Symbol.iterator,t=r&&e[r],n=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")}function __read(e,r){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var n,a,o=t.call(e),i=[];try{for(;(void 0===r||r-- >0)&&!(n=o.next()).done;)i.push(n.value)}catch(e){a={error:e}}finally{try{n&&!n.done&&(t=o.return)&&t.call(o)}finally{if(a)throw a.error}}return i}function __spread(){for(var e=[],r=0;r<arguments.length;r++)e=e.concat(__read(arguments[r]));return e}function __spreadArrays(){for(var e=0,r=0,t=arguments.length;r<t;r++)e+=arguments[r].length;var n=Array(e),a=0;for(r=0;r<t;r++)for(var o=arguments[r],i=0,l=o.length;i<l;i++,a++)n[a]=o[i];return n}function __await(e){return this instanceof __await?(this.v=e,this):new __await(e)}function __asyncGenerator(e,r,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,a=t.apply(e,r||[]),o=[];return n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n;function i(e){a[e]&&(n[e]=function(r){return new Promise((function(t,n){o.push([e,r,t,n])>1||l(e,r)}))})}function l(e,r){try{(t=a[e](r)).value instanceof __await?Promise.resolve(t.value.v).then(u,s):c(o[0][2],t)}catch(e){c(o[0][3],e)}var t}function u(e){l("next",e)}function s(e){l("throw",e)}function c(e,r){e(r),o.shift(),o.length&&l(o[0][0],o[0][1])}}function __asyncDelegator(e){var r,t;return r={},n("next"),n("throw",(function(e){throw e})),n("return"),r[Symbol.iterator]=function(){return this},r;function n(n,a){r[n]=e[n]?function(r){return(t=!t)?{value:__await(e[n](r)),done:"return"===n}:a?a(r):r}:a}}function __asyncValues(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,t=e[Symbol.asyncIterator];return t?t.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(t){r[t]=e[t]&&function(r){return new Promise((function(n,a){(function(e,r,t,n){Promise.resolve(n).then((function(r){e({value:r,done:t})}),r)})(n,a,(r=e[t](r)).done,r.value)}))}}}function __makeTemplateObject(e,r){return Object.defineProperty?Object.defineProperty(e,"raw",{value:r}):e.raw=r,e}function __importStar(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)Object.hasOwnProperty.call(e,t)&&(r[t]=e[t]);return r.default=e,r}function __importDefault(e){return e&&e.__esModule?e:{default:e}}function __classPrivateFieldGet(e,r){if(!r.has(e))throw new TypeError("attempted to get private field on non-instance");return r.get(e)}function __classPrivateFieldSet(e,r,t){if(!r.has(e))throw new TypeError("attempted to set private field on non-instance");return r.set(e,t),t}function parseResponse(e){var r=(new DOMParser).parseFromString(e,"text/xml"),t=Array.from(r.querySelectorAll("Axis")),n=Array.from(r.querySelectorAll("CellData > Cell")).map((function(e){return{fmtValue:getPropertyValue(e,"FmtValue"),ordinal:parseInt(e.getAttribute("CellOrdinal"),10),value:getPropertyValue(e,"Value")}})),a={tuples:[]},o={tuples:[]},i=[];t.forEach((function(e){if("SlicerAxis"!==e.getAttribute("name")){var r=0===a.tuples.length?a.tuples:o.tuples;Array.prototype.push.apply(r,translateAxis(e))}}));var l=new Array(o.tuples.length*a.tuples.length).fill(null);n.forEach((function(e){l[e.ordinal]=e}));var u=0;return o.tuples.forEach((function(e){a.tuples.forEach((function(r){i.push({columnTuple:r,data:l[u],rowTuple:e}),u++}))})),{columns:a,data:i,rows:o}}function getPropertyValue(e,r){var t=e.querySelector(r);return t?t.textContent:""}function translateAxis(e){return Array.from(e.querySelectorAll("Tuple")).map((function(e){return{members:Array.from(e.querySelectorAll("Member")).map((function(e){var r=parseInt(getPropertyValue(e,"LNum")||"0",10),t=parseInt(getPropertyValue(e,"CHILDREN_CARDINALITY")||"0",10)>0;return{caption:getPropertyValue(e,"Caption"),children:[],hasChildren:t,hierarchy:e.getAttribute("Hierarchy"),levelName:getPropertyValue(e,"LName"),levelNum:r,name:getPropertyValue(e,"UName"),parentName:getPropertyValue(e,"PARENT_UNIQUE_NAME")}}))}}))}var discoverCommands={schemaCatalogs:"DBSCHEMA_CATALOGS",schemaCubes:"MDSCHEMA_CUBES",schemaDimensions:"MDSCHEMA_DIMENSIONS",schemaHierarchies:"MDSCHEMA_HIERARCHIES",schemaKPIs:"MDSCHEMA_KPIS",schemaLevels:"MDSCHEMA_LEVELS",schemaMeasures:"MDSCHEMA_MEASURES",schemaMembers:"MDSCHEMA_MEMBERS"};function createDiscoverBody(e){var r={},t='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"><Header/><Body><Discover xmlns="urn:schemas-microsoft-com:xml-analysis">';return t+="<RequestType>"+(discoverCommands[e.command]||e.command)+"</RequestType>",t+="<Restrictions>"+serializeOptions("RestrictionList",e.restrictions,!0)+"</Restrictions>",e.connection&&e.connection.catalog&&(r.Catalog=e.connection.catalog),t+="<Properties>"+serializeOptions("PropertyList",r,!1)+"</Properties>",t+="</Discover></Body></Envelope>"}function serializeOptions(e,r,t){var n="";if(r){n+="<"+e+">";var a=void 0;for(var o in r)r[o]&&(a=r[o],t&&(o=o.replace(/([A-Z]+(?=$|[A-Z][a-z])|[A-Z]?[a-z]+)/g,"$1_").toUpperCase().replace(/_$/,"")),n+="<"+o+">"+a+"</"+o+">");n+="</"+e+">"}else n+="<"+e+"/>";return n}function parseCubes(e){var r=(new DOMParser).parseFromString(e,"text/xml");return Array.from(r.querySelectorAll("DiscoverResponse > return > root > row")).map((function(e){return{name:getPropertyValue(e,"CUBE_NAME"),caption:getPropertyValue(e,"CUBE_CAPTION"),description:getPropertyValue(e,"DESCRIPTION"),type:getPropertyValue(e,"CUBE_TYPE")}}))}function parseCatalogs(e){var r=(new DOMParser).parseFromString(e,"text/xml");return Array.from(r.querySelectorAll("DiscoverResponse > return > root > row")).map((function(e){return{name:getPropertyValue(e,"CATALOG_NAME"),description:getPropertyValue(e,"DESCRIPTION")}}))}function parseMeasures(e){var r=(new DOMParser).parseFromString(e,"text/xml");return Array.from(r.querySelectorAll("DiscoverResponse > return > root > row")).map((function(e){return{name:getPropertyValue(e,"MEASURE_NAME"),caption:getPropertyValue(e,"MEASURE_CAPTION"),uniqueName:getPropertyValue(e,"MEASURE_UNIQUE_NAME"),description:getPropertyValue(e,"DESCRIPTION"),aggregator:getPropertyValue(e,"MEASURE_AGGREGATOR"),groupName:getPropertyValue(e,"MEASUREGROUP_NAME"),displayFolder:getPropertyValue(e,"MEASURE_DISPLAY_FOLDER"),defaultFormat:getPropertyValue(e,"DEFAULT_FORMAT_STRING")}}))}function parseKPIs(e){var r=(new DOMParser).parseFromString(e,"text/xml");return Array.from(r.querySelectorAll("DiscoverResponse > return > root > row")).map((function(e){return{name:getPropertyValue(e,"KPI_NAME"),uniqueName:getPropertyValue(e,"KPI_NAME"),caption:getPropertyValue(e,"KPI_CAPTION"),value:getPropertyValue(e,"KPI_VALUE"),goal:getPropertyValue(e,"KPI_GOAL"),status:getPropertyValue(e,"KPI_STATUS"),trend:getPropertyValue(e,"KPI_TREND"),statusGraphic:getPropertyValue(e,"KPI_STATUS_GRAPHIC"),trendGraphic:getPropertyValue(e,"KPI_TREND_GRAPHIC"),description:getPropertyValue(e,"KPI_DESCRIPTION"),groupName:getPropertyValue(e,"MEASUREGROUP_NAME"),type:"kpi"}}))}function parseDimensions(e){var r=(new DOMParser).parseFromString(e,"text/xml");return Array.from(r.querySelectorAll("DiscoverResponse > return > root > row")).map((function(e){return{caption:getPropertyValue(e,"DIMENSION_CAPTION"),defaultHierarchy:getPropertyValue(e,"DEFAULT_HIERARCHY"),description:getPropertyValue(e,"DESCRIPTION"),name:getPropertyValue(e,"DIMENSION_NAME"),type:parseInt(getPropertyValue(e,"DIMENSION_TYPE"),10),uniqueName:getPropertyValue(e,"DIMENSION_UNIQUE_NAME")}}))}function parseHierarchies(e){var r=(new DOMParser).parseFromString(e,"text/xml");return Array.from(r.querySelectorAll("DiscoverResponse > return > root > row")).map((function(e){return{name:getPropertyValue(e,"HIERARCHY_NAME"),caption:getPropertyValue(e,"HIERARCHY_CAPTION"),description:getPropertyValue(e,"DESCRIPTION"),uniqueName:getPropertyValue(e,"HIERARCHY_UNIQUE_NAME"),dimensionUniqueName:getPropertyValue(e,"DIMENSION_UNIQUE_NAME"),displayFolder:getPropertyValue(e,"HIERARCHY_DISPLAY_FOLDER"),origin:getPropertyValue(e,"HIERARCHY_ORIGIN"),defaultMember:getPropertyValue(e,"DEFAULT_MEMBER")}}))}function parseLevels(e){var r=(new DOMParser).parseFromString(e,"text/xml");return Array.from(r.querySelectorAll("DiscoverResponse > return > root > row")).map((function(e){return{name:getPropertyValue(e,"LEVEL_NAME"),caption:getPropertyValue(e,"LEVEL_CAPTION"),description:getPropertyValue(e,"DESCRIPTION"),uniqueName:getPropertyValue(e,"LEVEL_UNIQUE_NAME"),dimensionUniqueName:getPropertyValue(e,"DIMENSION_UNIQUE_NAME"),displayFolder:getPropertyValue(e,"LEVEL_DISPLAY_FOLDER"),orderingProperty:getPropertyValue(e,"LEVEL_ORDERING_PROPERTY"),origin:getPropertyValue(e,"LEVEL_ORIGIN"),hierarchyUniqueName:getPropertyValue(e,"HIERARCHY_UNIQUE_NAME")}}))}function parseMembers(e){var r=(new DOMParser).parseFromString(e,"text/xml");return Array.from(r.querySelectorAll("DiscoverResponse > return > root > row")).map((function(e){return{name:getPropertyValue(e,"MEMBER_NAME"),caption:getPropertyValue(e,"MEMBER_CAPTION"),uniqueName:getPropertyValue(e,"MEMBER_UNIQUE_NAME"),dimensionUniqueName:getPropertyValue(e,"DIMENSION_UNIQUE_NAME"),hierarchyUniqueName:getPropertyValue(e,"HIERARCHY_UNIQUE_NAME"),levelUniqueName:getPropertyValue(e,"LEVEL_UNIQUE_NAME"),childrenCardinality:getPropertyValue(e,"CHILDREN_CARDINALITY")}}))}var _this=void 0,discoverParser={schemaCatalogs:parseCatalogs,schemaCubes:parseCubes,schemaDimensions:parseDimensions,schemaHierarchies:parseHierarchies,schemaKPIs:parseKPIs,schemaLevels:parseLevels,schemaMeasures:parseMeasures,schemaMembers:parseMembers},fetchData=function(e,r){return __awaiter(_this,void 0,void 0,(function(){var t;return __generator(this,(function(n){switch(n.label){case 0:return t=__assign({body:createRequestBody(r),headers:{"Content-Type":"text/xml"},method:"POST"},e.init),[4,fetch(e.url,t)];case 1:return[4,n.sent().text()];case 2:return[2,parseResponse(n.sent())]}}))}))},fetchDiscover=function(e,r){return __awaiter(_this,void 0,void 0,(function(){var t,n;return __generator(this,(function(a){switch(a.label){case 0:return t=__assign({body:createDiscoverBody(r),headers:{"Content-Type":"text/xml"},method:"POST"},e.init),[4,fetch(e.url,t)];case 1:return[4,a.sent().text()];case 2:return n=a.sent(),[2,discoverParser[r.command](n)]}}))}))},isMeasure=function(e){return"[Measures]"===e.hierarchy},getMaxNesting=function(e,r){return void 0===r&&(r=new Set),(e.children||[]).forEach((function(e){r.add(e.levelName),getMaxNesting(e,r)})),r.size},getMaxExpansion=function(e){var r=0;return(e.children||[]).forEach((function(e){r+=getMaxExpansion(e)||1})),r},generateNormalizedPath=function(e,r){return(r&&r.hierarchy===e.hierarchy?(r.normalizedPath||[]).slice(0,-1).concat([e.name||null]):(r&&r.normalizedPath?r.normalizedPath:[]).concat([e.name])).filter(Boolean)},generatePath=function(e,r){return(r&&r.hierarchy===e.hierarchy?(r.path||[]).slice(0,-1).concat([(0===e.levelNum?e.hierarchy:e.name)||null]):(r&&r.path?r.path:[]).concat([0===e.levelNum?e.hierarchy:e.name])).filter(Boolean)},toMatrix=function(e,r,t,n,a,o,i,l){void 0===r&&(r=-1),void 0===t&&(t=0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===o&&(o=void 0),void 0===i&&(i=void 0),void 0===l&&(l=void 0);var u=getMaxNesting(e),s=getMaxExpansion(e),c=n||u,f=a||s,p=o?o.slice():[],m=i?i.slice():new Array(f),d=p.findIndex((function(r){return r&&r.name===e.levelName&&r.level===e.levelNum})),h=p[d],g={name:e.levelName,level:e.levelNum,index:r,cells:new Array(f).fill(null)},y=-1!==r&&-1!==t,A={caption:e.caption,name:e.name,levelName:e.levelName,levelNum:e.levelNum,hasChildren:e.hasChildren,parentName:e.parentName,hierarchy:e.hierarchy,total:void 0!==e.total&&e.total||l&&l.children.length<=1&&l.total,parent:l,rowIndex:r,colIndex:t,depth:1,breadth:1,path:e.path||[],normalizedPath:e.normalizedPath||[],children:e.children.filter((function(r){return r.hierarchy===e.hierarchy}))};if(y)if(h)h.cells[t]=A,h.index>=r&&(r=h.index);else if(p[r]&&p[r].cells.length){for(var v=r;v<p.length;v++){p[v].index++}p.splice(r,0,g),p[r].cells[t]=A}else p[r]=g,p[r].cells[t]=A;var _=0;return e.children&&e.children.length?e.children.forEach((function(e){var n=toMatrix(e,r+1,t+_,c,f,p,m,A),a=n[0],o=n[1],i=n[3];_+=i||1,p=a.slice(),m=o.slice()})):e.normalizedPath&&(m[t]={total:A.total,path:e.normalizedPath}),A.depth=u,A.breadth=s,[p,m,u,s]},withTotal=function(e,r,t){var n;void 0===r&&(r=null),void 0===t&&(t=0);for(var a=__assign({},e,{total:!0,hasChildren:!1,children:[]}),o=0;o<e.children.length;o++){var i=withTotal(e.children[o],e,o);n=n||i.hierarchy,i.hierarchy===n||!r||r.children.some((function(e){return e.total&&e.name===a.name}))||e.total||(a.children.push(i),e.children.splice(o,1),o--)}if(e.children.filter((function(e){return!e.total})).length>=1&&r&&!r.children.some((function(e){return e.total&&e.name===a.name}))&&!e.total){var l=e.children[0].hierarchy;e.hierarchy===l&&r.children.splice(t+1,0,a)}return e},toTree=function(e){var r={children:[]},t={};if(e.every((function(e){return 1===e.members.length&&isMeasure(e.members[0])})))return{children:e.map((function(e){var r=e.members[0];return __assign({},r,{normalizedPath:[r.name],parentName:r.name,path:[r.hierarchy]})}))};for(var n=0;n<e.length;n++)for(var a=copy(e[n]),o="",i=function(e){var n,i=a.members[e];if(r.children&&0===r.children.length)n=r;else if(t[o]&&!t[o+i.name]&&0===i.levelNum)n=t[o];else if(t[o+i.parentName]&&i.levelNum>0&&!t[o+i.parentName+i.name])n=t[o+i.parentName];else if(!t[o+i.parentName]&&i.levelNum>0&&!t[o+i.parentName+i.name]){var l=Object.keys(t).find((function(e){return i.parentName===t[e].name}));l&&(n=t[l])}if(n){i.path=generatePath(i,n),i.normalizedPath=generateNormalizedPath(i,n);var u=n.children.findIndex((function(e){return e.hierarchy!==n.hierarchy}));-1!==u?n.children.splice(u,0,i):n.children.push(i)}i.parentName+=i.name,o+=i.parentName,t[o]||(t[o]=i)},l=0;l<a.members.length;l++)i(l);return copy(withTotal(r))},toData=function(e,r,t,n,a){var o=Array.from(new Array(a),(function(){return{cells:Array.from(new Array(n),(function(){return null}))}})),i=function(e){return e.join("|")},l=function(e){return e.members.map((function(e){return e.name}))},u=new Map,s=new Map;return r.forEach((function(e,r){u.set(i(e.path),r)})),t.forEach((function(e,r){s.set(i(e.path),r)})),e.forEach((function(e){var r=u.get(i(l(e.columnTuple))),n=s.get(i(l(e.rowTuple)));void 0!==r&&void 0!==n&&(o[n].cells[r]||(o[n].row=t[n].path,o[n].cells[r]=e))})),o},rotateMatrix=function(e,r,t,n){for(var a=new Array(n),o=0;o<n;o++)for(var i=0;i<t;i++)if(e[i]&&e[i].cells[o]){var l=e[i].cells[o];a[o]||(a[o]={cells:new Array(t).fill(null)}),a[o].cells[i]=__assign({},l,{rowSpan:l.colSpan,colSpan:l.rowSpan})}return[a,r,n,t]},toColumns=function(e){for(var r=toMatrix(e),t=r[0],n=r[1],a=r[2],o=r[3],i=0;i<o;i++)for(var l=null,u=0;u<a;u++)if(t[u]){var s=t[u].cells[i];!s&&l&&(l.rowSpan=(l.rowSpan||1)+1),l&&(l.colSpan=l.breadth||1),s&&(l=s)}return[t,n,a,o]},toRows=function(e){for(var r=toMatrix(e),t=r[0],n=r[1],a=r[2],o=r[3],i=0;i<o;i++)for(var l=null,u=0;u<a;u++)if(t[u]){var s=t[u].cells[i];!s&&l&&(l.rowSpan=(l.rowSpan||1)+1),l&&(l.colSpan=l.breadth),s&&(l=s)}return rotateMatrix(t,n,a,o)},cloneDate=function(e){return e?new Date(e.getTime()):null};function clone(e){var r={};return cloneObject(e,r),r}function cloneObject(e,r){for(var t in e)if(e.hasOwnProperty(t)){var n=e[t];r[t]=cloneValue(n,r[t])}}function cloneValue(e,r){if(Array.isArray(e))return cloneArray(e);if(e instanceof Date)return cloneDate(e);if(e&&"object"==typeof e){var t=r||{};return cloneObject(e,t),t}return e}function copy(e){return JSON.parse(JSON.stringify(e))}function cloneArray(e){return e.map((function(e){return cloneValue(e,void 0)}))}var kpiMeasure=function(e,r,t){return{hierarchyUniqueName:e,uniqueName:r,caption:r,measure:r,name:r,type:t,kpi:!0}};function buildKPIMeasures(e){var r=e.name;return[kpiMeasure(r,e.value,"value"),kpiMeasure(r,e.goal,"goal"),kpiMeasure(r,e.status,"status"),kpiMeasure(r,e.trend,"trend")]}var addKPI=function(e){for(var r,t=0;t<e.length;t++)if(2===e[t].type){r=!0;break}r&&e.splice(t+1,0,{caption:"KPIs",defaultHierarchy:"[KPIs]",name:"KPIs",uniqueName:"[KPIs]"})},compareAxisWithField=function(e,r){return String(e.name)===String([r.defaultHierarchy?r.defaultHierarchy:r.uniqueName])},compareAxes=function(e,r){return String(e.name)===String(r.name)},filterField=function(e,r){for(var t=function(t){var n=e[t],a=n.name.findIndex((function(e){return compareAxisWithField({name:[e]},r)||String(e).startsWith(r.uniqueName)}));if(-1!==a)if(a===n.name.length-1||1===n.name.length)e.splice(t,1);else{n.name.splice(a,1);var o=e.findIndex((function(e){return e!==n&&String(e.name)===String(n.name)}));-1!==o&&(e[o]=__assign({},e[o],n,e[o].expand||n.expand?{expand:!0}:{}),e.splice(t,1))}},n=e.length-1;n>=0;n--)t(n)},insertAxis=function(e,r,t){var n=-1;if(t.dropTarget&&t.dropDirection){var a=t.dropDirection?"before"===t.dropDirection?0:1:0;n=e.findIndex((function(e){return compareAxes(e,t.dropTarget)}))+a}-1!==n?(e.forEach((function(e){var t;e.expand&&e.name.length>1&&e.name.length>n&&(t=e.name).splice.apply(t,[n,0].concat(r.name))})),e.splice(n,0,r)):e.push(r)},reverseColumnsByMeasures=function(e){var r=e.length&&e[0],t=r&&r.members[r.members.length-1];if(t&&isMeasure(t)){for(var n=[],a=new Set(e.map((function(e){return e.members[e.members.length-1].caption}))).size,o=0;o<e.length;o+=a)n.push(e.slice(o,o+a));var i=[];return n.forEach((function(e){i.push.apply(i,e.reverse())})),i}return e},createDataState=function(e){return{columns:reverseColumnsByMeasures(e.columns.tuples),data:e.data,rows:e.rows.tuples}};function createAxisDescriptors(e){for(var r=[],t=0,n=Object.keys(e);t<n.length;t++){var a=n[t];r.push({name:JSON.parse(a),expand:e[a]})}return r}var HEADERS_ACTION,setSort=function(e,r){void 0===r&&(r=[]),e.sort=r},setFilter=function(e,r){void 0===r&&(r=[]),e.filter=r};!function(e){e.toggle="HEADERS_ACTION_TOGGLE",e.expand="HEADERS_ACTION_EXPAND",e.collapse="HEADERS_ACTION_COLLAPSE"}(HEADERS_ACTION||(HEADERS_ACTION={}));var PIVOT_CONFIGURATOR_ACTION,findPath=function(e,r,t){var n=new Set;return e.children.forEach((function(e){var a=r(e);t&&n.add(String(e.path)),findPath(e,r,t||a).map((function(e){n.add(e)}))})),Array.from(n.values())},headersReducer=function(e,r){switch(r.type){case HEADERS_ACTION.toggle:var t=e.find((function(e){return String(e.name)===String(r.payload)}));return headersReducer(e,__assign({},r,{type:t&&t.expand?HEADERS_ACTION.collapse:HEADERS_ACTION.expand}));case HEADERS_ACTION.expand:var n=e.find((function(e){return String(e.name)===String(r.payload)}));if(n&&!0===n.expand)return e;if(!n||!1!==n.expand&&void 0!==n.expand){var a=e.slice();return a.push({name:r.payload,expand:!0}),a}return e.map((function(e){return e===n?__assign({},n,{expand:!0}):e}));case HEADERS_ACTION.collapse:var o=findPath(r.tree,(function(e){return!e.total&&String(e.path)===String(r.payload)}));return e.slice().filter((function(e){return!o.some((function(r){return r===String(e.name)}))})).map((function(e){return __assign({},e,{expand:Boolean(e.expand)})})).map((function(e){return String(e.name)===String(r.payload)?r.payload.length>1?void 0:{name:r.payload,expand:!1}:e})).filter(Boolean);default:return e}};!function(e){e.toggleSelection="PIVOT_CONFIGURATOR_ACTION_TOGGLE_SELECTION",e.addColumnAxis="PIVOT_CONFIGURATOR_ACTION_ADD_COLUMN_AXIS",e.addColumnAxes="PIVOT_CONFIGURATOR_ACTION_ADD_COLUMN_AXES",e.removeColumnAxis="PIVOT_CONFIGURATOR_ACTION_REMOVE_COLUMN_AXIS",e.removeColumnAxes="PIVOT_CONFIGURATOR_ACTION_REMOVE_COLUMN_AXES",e.addRowAxis="PIVOT_CONFIGURATOR_ACTION_ADD_ROW_AXIS",e.addRowAxes="PIVOT_CONFIGURATOR_ACTION_ADD_ROW_AXES",e.removeRowAxis="PIVOT_CONFIGURATOR_ACTION_REMOVE_ROW_AXIS",e.removeRowAxes="PIVOT_CONFIGURATOR_ACTION_REMOVE_ROW_AXES",e.addMeasureAxis="PIVOT_CONFIGURATOR_ACTION_ADD_MEASURE_AXIS",e.addMeasureAxes="PIVOT_CONFIGURATOR_ACTION_ADD_MEASURE_AXES",e.removeMeasureAxis="PIVOT_CONFIGURATOR_ACTION_REMOVE_MEASURE_AXIS",e.removeMeasureAxes="PIVOT_CONFIGURATOR_ACTION_REMOVE_MEASURE_AXES",e.remove="PIVOT_CONFIGURATOR_ACTION_REMOVE",e.setSort="PIVOT_CONFIGURATOR_ACTION_SET_SORT",e.setFilter="PIVOT_CONFIGURATOR_ACTION_SET_FILTER",e.addFilter="PIVOT_CONFIGURATOR_ACTION_ADD_FILTER",e.changeFilter="PIVOT_CONFIGURATOR_ACTION_CHANGE_FILTER",e.removeFilter="PIVOT_CONFIGURATOR_ACTION_REMOVE_FILTER",e.setDragItem="PIVOT_CONFIGURATOR_ACTION_SET_DRAGITEM",e.drop="PIVOT_CONFIGURATOR_ACTION_DROP",e.setDropZone="PIVOT_CONFIGURATOR_ACTION_SET_DROP_ZONE",e.setDropTarget="PIVOT_CONFIGURATOR_ACTION_SET_DROP_TARGET",e.setDropDirection="PIVOT_CONFIGURATOR_ACTION_SET_DROP_DIRECTION"}(PIVOT_CONFIGURATOR_ACTION||(PIVOT_CONFIGURATOR_ACTION={}));var configuratorReducer=function(e,r){var t,n,a,o,i,l,u,s,c;switch(r.type){case PIVOT_CONFIGURATOR_ACTION.toggleSelection:if(!Array.isArray(r.payload)){var f=r.payload;if(2===f.type||"aggregator"in f)return e.measureAxes.some((function(e){return compareAxisWithField(e,f)}))?configuratorReducer(e,__assign({},r,{type:PIVOT_CONFIGURATOR_ACTION.removeMeasureAxis})):configuratorReducer(e,__assign({},r,{type:PIVOT_CONFIGURATOR_ACTION.addMeasureAxis}));if("kpi"===f.type){var p=buildKPIMeasures(f);return p.every((function(r){return e.measureAxes.some((function(e){return compareAxisWithField(e,r)}))}))?configuratorReducer(e,__assign({},r,{type:PIVOT_CONFIGURATOR_ACTION.removeMeasureAxes,payload:p})):configuratorReducer(e,__assign({},r,{type:PIVOT_CONFIGURATOR_ACTION.addMeasureAxes,payload:p.filter((function(r){return!e.measureAxes.some((function(e){return compareAxisWithField(e,r)}))}))}))}return r.payload.kpi?e.measureAxes.some((function(e){return compareAxisWithField(e,f)}))?configuratorReducer(e,__assign({},r,{type:PIVOT_CONFIGURATOR_ACTION.removeMeasureAxis})):configuratorReducer(e,__assign({},r,{type:PIVOT_CONFIGURATOR_ACTION.addMeasureAxis})):e.columnAxes.some((function(e){return compareAxisWithField(e,f)}))?configuratorReducer(e,__assign({},r,{type:PIVOT_CONFIGURATOR_ACTION.removeColumnAxis})):e.rowAxes.some((function(e){return compareAxisWithField(e,f)}))?configuratorReducer(e,__assign({},r,{type:PIVOT_CONFIGURATOR_ACTION.removeRowAxis})):!e.columnAxes||!e.columnAxes.length||e.rowAxes&&e.rowAxes.length?configuratorReducer(e,__assign({},r,{type:PIVOT_CONFIGURATOR_ACTION.addColumnAxis})):configuratorReducer(e,__assign({},r,{type:PIVOT_CONFIGURATOR_ACTION.addRowAxis}))}break;case PIVOT_CONFIGURATOR_ACTION.addColumnAxis:n=(e.columnAxes||[]).concat([{name:[r.payload.defaultHierarchy||r.payload.uniqueName]}]);break;case PIVOT_CONFIGURATOR_ACTION.addColumnAxes:break;case PIVOT_CONFIGURATOR_ACTION.removeColumnAxis:n=(e.columnAxes||[]).filter((function(e){return!compareAxisWithField(e,r.payload)})).slice(),filterField(n,r.payload);break;case PIVOT_CONFIGURATOR_ACTION.removeColumnAxes:break;case PIVOT_CONFIGURATOR_ACTION.addRowAxis:t=(e.rowAxes||[]).concat([{name:[r.payload.defaultHierarchy||r.payload.uniqueName]}]);break;case PIVOT_CONFIGURATOR_ACTION.addRowAxes:break;case PIVOT_CONFIGURATOR_ACTION.removeRowAxis:t=(e.rowAxes||[]).filter((function(e){return!compareAxisWithField(e,r.payload)})).slice(),filterField(t,r.payload);break;case PIVOT_CONFIGURATOR_ACTION.removeRowAxes:break;case PIVOT_CONFIGURATOR_ACTION.addMeasureAxis:a=(e.measureAxes||[]).concat([{name:[r.payload.defaultHierarchy||r.payload.uniqueName]}]);break;case PIVOT_CONFIGURATOR_ACTION.removeMeasureAxis:a=(e.measureAxes||[]).filter((function(e){return!compareAxisWithField(e,r.payload)})).slice();break;case PIVOT_CONFIGURATOR_ACTION.addMeasureAxes:a=(e.measureAxes||[]).concat((r.payload||[]).map((function(e){return{name:[e.defaultHierarchy||e.uniqueName]}})));break;case PIVOT_CONFIGURATOR_ACTION.removeMeasureAxes:a=(e.measureAxes||[]).filter((function(e){return!r.payload.some((function(r){return compareAxisWithField(e,r)}))})).slice();break;case PIVOT_CONFIGURATOR_ACTION.remove:e.columnAxes.some((function(e){return compareAxes(e,r.payload)}))&&(n=e.columnAxes.filter((function(e){return!compareAxes(e,r.payload)})).slice(),filterField(n,{uniqueName:r.payload.name})),e.rowAxes.some((function(e){return compareAxes(e,r.payload)}))&&(t=e.rowAxes.filter((function(e){return!compareAxes(e,r.payload)})).slice(),filterField(t,{uniqueName:r.payload.name})),e.measureAxes.some((function(e){return compareAxes(e,r.payload)}))&&(a=e.measureAxes.filter((function(e){return!compareAxes(e,r.payload)})).slice());break;case PIVOT_CONFIGURATOR_ACTION.setDragItem:l=r.payload;break;case PIVOT_CONFIGURATOR_ACTION.setDropZone:u=r.payload;break;case PIVOT_CONFIGURATOR_ACTION.setDropTarget:c=r.payload;break;case PIVOT_CONFIGURATOR_ACTION.setDropDirection:s=r.payload;break;case PIVOT_CONFIGURATOR_ACTION.drop:if(e.dragItem&&e.dropZone){var m=e.columnAxes.find((function(e){return compareAxes(e,r.payload)})),d=e.rowAxes.find((function(e){return compareAxes(e,r.payload)})),h=e.measureAxes.find((function(e){return compareAxes(e,r.payload)})),g=void 0;switch(m&&(g=m,n=e.columnAxes.filter((function(e){return!compareAxes(e,r.payload)})).slice(),filterField(n,{uniqueName:r.payload.name})),d&&(g=d,t=e.rowAxes.filter((function(e){return!compareAxes(e,r.payload)})).slice(),filterField(t,{uniqueName:r.payload.name})),h&&(g=h,a=e.measureAxes.filter((function(e){return!compareAxes(e,r.payload)})).slice()),e.dropZone){case"columnAxes":n=n||e.columnAxes.slice(),insertAxis(n,g,e);break;case"rowAxes":t=t||e.rowAxes.slice(),insertAxis(t,g,e);break;case"measureAxes":a=a||e.measureAxes.slice(),insertAxis(a,g,e)}}l=null,u=null,c=null;break;case PIVOT_CONFIGURATOR_ACTION.setSort:o=r.payload;break;case PIVOT_CONFIGURATOR_ACTION.setFilter:i=Array.isArray(r.payload)?r.payload:[r.payload];break;case PIVOT_CONFIGURATOR_ACTION.addFilter:i=(e.filter||[]).slice(),Array.isArray(r.payload)?i.push.apply(i,r.payload):i.push(r.payload);break;case PIVOT_CONFIGURATOR_ACTION.changeFilter:i=Array.isArray(r.payload)?(e.filter||[]).map((function(e){return r.payload.some((function(r){return r.field===e.field}))?r.payload.find((function(r){return r.field===e.field})):e})):(e.filter||[]).map((function(e){return e.field===r.payload.field?r.payload:e}));break;case PIVOT_CONFIGURATOR_ACTION.removeFilter:i=(e.filter||[]).slice(),i=Array.isArray(r.payload)?i.filter((function(e){return!r.payload.some((function(r){return r.field===e.field&&r.operator===e.operator}))})):i.filter((function(e){return!(e.field===r.payload.field&&e.operator===r.payload.operator)}))}return{dragItem:l,dropTarget:c,dropDirection:s,dropZone:u,columnAxes:n,rowAxes:t,measureAxes:a,filter:i,sort:o}},sumAggregate={init:function(e){"sum"in e==!1&&(e.sum=0)},merge:function(e,r){r.sum+=e.sum},accumulate:function(e,r){e.sum+=r},result:function(e){return e.sum},format:function(e){return e.toFixed(2)}},countAggregate={init:function(e){"countA"in e==!1&&(e.countA=0)},merge:function(e,r){r.countA+=e.countA},accumulate:function(e,r){e.countA+=1},result:function(e){return e.countA},format:function(e){return e.toFixed()}},minAggregate={init:function(e){"min"in e==!1&&(e.min=Number.POSITIVE_INFINITY)},merge:function(e,r){r.min=Math.min(e.min,r.min)},accumulate:function(e,r){e.min=Math.min(r,e.min)},result:function(e){return Number.isFinite(e.min)?e.min:NaN},format:function(e){return e.toFixed(2)}},maxAggregate={init:function(e){"max"in e==!1&&(e.max=Number.NEGATIVE_INFINITY)},merge:function(e,r){r.max=Math.max(e.max,r.max)},accumulate:function(e,r){e.max=Math.max(r,e.max)},result:function(e){return Number.isFinite(e.max)?e.max:NaN},format:function(e){return e.toFixed(2)}},averageAggregate={init:function(e){"count"in e==!1&&(e.sumA=0,e.count=0)},merge:function(e,r){r.sumA+=e.sumA,r.count+=e.count},accumulate:function(e,r){e.sumA+=r,e.count+=1},result:function(e){return e.sumA/e.count},format:function(e){return e.toFixed(2)}};function forEachDesc(e,r){"filters"in e?e.filters.map((function(e){return forEachDesc(e,r)})):r(e)}var filterFields=function(e,r){(Array.isArray(e)?e:e.filters).forEach((function(e){return forEachDesc(e,r)}))},initializeFiltering=function(e,r,t){var n=t?Array.isArray(t)?{logic:"and",filters:t}:t:void 0,a=n?compileFilter(n):function(){return!0},o=e.concat(r),i=[];filterFields(t||[],(function(e){"field"in e&&e.field&&i.push(e.field)}));var l={hasFilter:!1,predicate:a,filteringAxes:[]};if(i.some((function(e){return"function"==typeof e})))l.filteringAxes=o.slice();else if(i.length>0){var u=Array.from(new Set(i).values()),s=o.filter((function(e){return u.indexOf(e.key)>=0}));l.filteringAxes=s}return l.hasFilter=l.filteringAxes.length>0,l},subNode=function(e,r,t){var n=e.get(r);return n||(n=t||new Map,e.set(r,n)),n},separator="&",createKey=function(e,r){return e+separator+r},splitKeyValue=function(e){var r=e.indexOf(separator);return-1!==r?[e.substring(0,r),e.substring(r+1)]:[e,void 0]},calculateColumnData=function(e,r,t){e.forEach((function(n,a){if(a!==t){n.size>0&&calculateColumnData(n,r,t);var o=n.get(t),i=subNode(e,t,{});r.forEach((function(e){e.aggregate.init(i),e.aggregate.merge(o,i)}))}}))},mergeTrees=function(e,r,t,n){e.forEach((function(e,a){var o;a!==n?(o=subNode(r,a),mergeTrees(e,o,t,n)):(o=subNode(r,a,{}),t.forEach((function(r){r.aggregate.init(o),r.aggregate.merge(e,o)})))}))},calculateColumns=function(e,r,t,n){e.forEach((function(a,o){if(o!==t){a.size>0&&calculateColumns(a,r,t,n);var i=subNode(a,t),l=subNode(e,t);mergeTrees(i,l,r,n)}}))},createDataTree=function(e,r,t,n,a,o){var i=new Map,l=new Map,u=r.concat(t),s=new Set,c=a.dataField,f=a.columnsData,p=initializeFiltering(r,t,o),m=p.hasFilter,d=p.predicate,h=p.filteringAxes;return e.forEach((function(e){if(m){var a={};if(h.forEach((function(r){a[r.key]=r.displayValue(e)})),!d(a))return}var o=u.map((function(r){return r.displayValue(e)})),p="".concat.apply("",o),g=l.get(p);if(!g){var y=i,A=function(r){y=subNode(y,createKey(r.key,r.displayValue(e)))};r.forEach(A),y=subNode(y,f),s.add(y),t.forEach(A),g={},y.set(c,g),l.set(p,g),n.forEach((function(e){e.aggregate.init(g)}))}n.forEach((function(r){r.aggregate.accumulate(g,r.value(e))}))})),s.forEach((function(e){return calculateColumnData(e,n,c)})),calculateColumns(i,n,f,c),i},cloneDataTree=function(e,r,t){var n=new Map;return mergeTrees(e,n,t,r),n},createPath=function(e,r,t){var n=splitKeyValue(e),a=n[0],o=n[1],i=t.slice();if(a&&o){var l=r.find((function(e){return e.key===a})),u=l?l.caption:"";return i.map((function(r){return r===u?e:r}))}return i},membersNode=function(e,r,t,n,a,o,i){for(var l=i||new Map,u=n.map((function(e){return e.caption}));r.length>1&&n.some((function(e){return e.caption===r[r.length-1].caption}));)r.pop(),u.pop();var s=e;return r.forEach((function(e,r){if(u=createPath(e.name,n,u),s&&!n.some((function(r){return r.caption===e.name}))){if(!s.has(e.name)&&!l.has(u.slice(0,u.indexOf(e.name)+1).join("-")))for(var i=Array.from(s).find((function(e){return e[0]!==t})),c=i&&i[0],f=c&&splitKeyValue(c)[0],p=f?r-n.findIndex((function(e){return e.key===f})):0,m=function(r){var i=[];s.forEach((function(e,r){r!==t&&i.push.apply(i,Array.from(e).filter((function(e){return e[0]!==t})))}));var c=new Map;i.forEach((function(e){if(c.has(e[0])){var r=c.get(e[0]),t=e[1],n=new Map;mergeTrees(r,n,a,o),mergeTrees(t,n,a,o),c.set(e[0],n)}else c.set(e[0],new Map(e[1]))}));var f=u.slice(0,u.indexOf(e.name));c.forEach((function(e,r){l.set(createPath(r,n,f.concat([r])).join("-"),e)})),c.set(t,s.get(t)),s=c},d=0;d<p;d++)m();s=s.get(e.name)||l.get(u.slice(0,u.indexOf(e.name)+1).join("-"))}})),s},readData=function(e,r,t,n,a,o,i){var l=[],u=n.dataField,s=n.columnsData,c=new Map;return r.forEach((function(r){var n=membersNode(e,r.members.slice(),s,o,i,u,c),f=n&&n.get(s);t.forEach((function(e){var t=e.members.slice(),n=i[0];if("[Measures].[MeasuresLevel]"===t[t.length-1].levelName){var o=t.pop();n=i.find((function(e){return String(e.name)===o.caption}))||n}var s=f&&membersNode(f,t,u,a,i,u),c="",p="";if(s&&n){var m=n.aggregate.result(s.get(u));c=String(m),p=n.aggregate.format(m)}l.push({columnTuple:e,data:{fmtValue:p,ordinal:0,value:c},rowTuple:r})}))})),l},getTopMembersTuple=function(e,r){var t={members:[]};return e.forEach((function(e){var n=r.find((function(r){return r.key===e})),a=n?n.caption:"",o={caption:a,children:[],hasChildren:!0,parentName:"",levelNum:0,levelName:a,hierarchy:e,name:a};t.members.push(o)})),t},sortFunc=function(e,r){return function(t,n){var a=e.dir,o=r.sortValue(splitKeyValue(t[0])[1]),i=r.sortValue(splitKeyValue(n[0])[1]);return o<i?"asc"===a?-1:1:o>i?"asc"===a?1:-1:0}},mergeData=function(e,r,t){e.forEach((function(e,n){if(!t[n]){var a=subNode(r,n);mergeData(e,a,t)}}))},childrenByKeys=function(e,r,t){for(var n,a=[],o=function(e){return Array.from(e).filter((function(e){return!t[e[0]]}))},i=new Map(e),l=function(e){if(n=i.get(r[e]))i=new Map(n);else if(e<r.length-1&&Array.from(i).some((function(t){return splitKeyValue(t[0])[0]===r[e]}))){var l=[];i.forEach((function(e,r){t[r]||l.push.apply(l,o(new Map(e)))})),i=new Map,l.forEach((function(e){if(i.has(e[0])){var r=i.get(e[0]),n=e[1],a=new Map;mergeData(r,a,t),mergeData(n,a,t),i.set(e[0],a)}else i.set(e[0],new Map(e[1]))}))}else 0!==e&&e!==r.length-1||Array.from(i).some((function(t){return splitKeyValue(t[0])[0]===r[e]}))&&a.push.apply(a,o(i))},u=0;u<r.length;u++)l(u);return a},rootFields=function(e){var r=new Set;return e.forEach((function(e){1!==e.name.length||splitKeyValue(e.name[0])[1]||r.add(e.name[0])})),r},createTuples=function(e,r,t,n,a){var o=rootFields(r),i=[],l=getTopMembersTuple(o,e);i.push(l);for(var u=function(l){var u=r[l];if(1===u.name.length&&!u.expand&&o.has(u.name[0]))return"continue";var s,c=new Set(o.keys()),f=[],p=[],m=[];u.name.forEach((function(r,o){var l,d=splitKeyValue(r),h=d[0],g=d[1];if(s=e.find((function(e){return e.key===h})),g){c.delete(h),p.push(r);var y={children:[],caption:g,hierarchy:h,levelNum:1,levelName:h+" "+h,name:r,parentName:s?s.caption:""};f.push(y)}else if(u.expand&&u.name.length-1===o){c.delete(r),p.push(r);var A=childrenByKeys(t,p,a),v=n.find((function(e){return e.field===h}));v&&v.dir&&A.sort(sortFunc(v,s));for(var _=0;_<A.length;_++){var O=A[_][0],N={members:[]};m.push(N);var I=splitKeyValue(O)[1];s=e.find((function(e){return e.key===r}));y={caption:I,children:[],levelName:r+" "+r,levelNum:1,parentName:s?s.caption:"",hierarchy:r,name:O};(l=N.members).push.apply(l,f),N.members.push(y)}}else if(u.expand){var E=(s=e.find((function(e){return e.key===r})))?s.caption:"";c.delete(r),p.push(r);y={children:[],caption:E,hierarchy:r,levelName:E,levelNum:0,name:E,parentName:""};f.push(y)}c.forEach((function(r){m.forEach((function(t){var n=(s=e.find((function(e){return e.key===r})))?s.caption:"",a={children:[],hasChildren:!0,caption:n,hierarchy:r,levelName:n,levelNum:0,name:n,parentName:""};t.members.push(a)}))})),i.push.apply(i,m)}))},s=0;s<r.length;s++)u(s);return i},measureToMember=function(e){return{caption:String(e.name),children:[],hasChildren:!1,hierarchy:"[Measures]",levelName:"[Measures].[MeasuresLevel]",levelNum:0,name:"[Measures].["+e.name+"]",parentName:""}},addMeasure=function(e,r){var t=measureToMember(r),n=copy(e);return n.members.push(t),n},addMultipleMeasures=function(e,r){if(r.length<2)return e;for(var t=e.slice(),n=t.length-1;n>=0;n--){var a=t[n];t[n]=addMeasure(t[n],r[0]);for(var o=1;o<r.length;o++){var i=addMeasure(a,r[o]);t.splice(n+o,0,i)}}return reverseColumnsByMeasures(t)},createLocalDataState=function(e){var r,t=e.dataTree,n=e.rowSettings,a=e.columnSettings,o=e.rowAxes,i=e.columnAxes,l=e.measures,u=e.sort,s=e.fields,c=((r={})[s.columnsData]=s.columnsData,r[s.dataField]=s.dataField,r),f=i.length?createTuples(a,i,t.get(s.columnsData),u,c):l.map((function(e){return{members:[measureToMember(e)]}})),p=i.length>0?addMultipleMeasures(f,l):f,m=o.length?createTuples(n,o,t,u,c):[{members:[]}];return{columns:p,data:readData(t,m,p,s,a,n,l),rows:m}},createFlatSchemaDimensions=function(e,r){var t=Object.keys(e).map((function(e){return{caption:e,defaultHierarchy:e,description:"",name:e,uniqueName:e,hierarchyUniqueName:e,measure:!0,type:1}}));return r.length&&t.push({caption:"Measures",children:r.map((function(e){return{aggregator:"1",caption:String(e.name),defaultFormat:"",description:"",displayFolder:"",groupName:String(e.name),name:String(e.name),uniqueName:String(e.name)}})),type:2,description:"",name:"Measures",uniqueName:"[Measures]"}),t},Navigation=function(){function e(e){this.tabIndex=0,this.root=null,this.eventHandlers={},this.update=function(){},this.tabIndex=e.tabIndex}return Object.defineProperty(e.prototype,"elements",{get:function(){return this.root?Array.from(this.root.querySelectorAll(this.selectors.join(","))):[]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"first",{get:function(){return this.root&&this.root.querySelector(this.selectors.join(","))||null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"last",{get:function(){var e=this.elements;return e[e.length-1]||null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"current",{get:function(){return this.elements.find((function(e){return e.matches(":focus")}))},enumerable:!0,configurable:!0}),e.prototype.start=function(e){var r=this;this.root=e;var t=function(t){n.mouseEvents[t]&&(n.eventHandlers[t]=function(e){var n=e.target instanceof Element&&e.target.closest(r.selectors.join(","));n&&r.mouseEvents[t].call(void 0,n,r,e)},e.addEventListener(t,n.eventHandlers[t]))},n=this;for(var a in this.mouseEvents)t(a);var o=function(t){i.keyboardEvents[t]&&(i.eventHandlers[t]=function(e){var n=e.target instanceof Element&&e.target.closest(r.selectors.join(",")),a=" "===e.key?"Space":e.key;n&&r.keyboardEvents[t][a]&&r.keyboardEvents[t][a].call(void 0,n,r,e)},e.addEventListener(t,i.eventHandlers[t]))},i=this;for(var a in this.keyboardEvents)o(a)},e.prototype.stop=function(){if(this.root)for(var e in this.eventHandlers)this.eventHandlers[e]&&this.root.removeEventListener(e,this.eventHandlers[e]);this.root=null},e.prototype.focusElement=function(e,r){e&&(r&&(r.removeAttribute("tabindex"),r.classList.remove("k-focus")),e.setAttribute("tabindex",String(this.tabIndex)),e.focus({preventScroll:!0}))},e}(),scrollableValuesSel=".k-pivotgrid .k-pivotgrid-values",scrollableColumnHeaderSel=".k-pivotgrid .k-pivotgrid-column-headers",scrollableRowHeaderSel=".k-pivotgrid .k-pivotgrid-row-headers",emptyCellSel=".k-pivotgrid > .k-pivotgrid-empty-cell",tableSel="table.k-pivotgrid-table",cellSel=".k-pivotgrid-cell",scrollables=[scrollableValuesSel,scrollableColumnHeaderSel,scrollableRowHeaderSel].join(","),selectors$1=[emptyCellSel,[scrollableColumnHeaderSel,tableSel,cellSel].join(" "),[scrollableRowHeaderSel,tableSel,cellSel].join(" "),[scrollableValuesSel,tableSel,cellSel].join(" ")],onEnter=function(e,r,t){var n=e.querySelector(".k-icon, .k-svg-icon");if(n){var a=r.elements.indexOf(e);r.update=function(){r.focusElement(r.elements[a],null),r.update=function(){}},n.click(),t.preventDefault()}},tryScrollLeft=function(e,r,t){e.offsetLeft<r.scrollLeft&&(t.scrollLeft=e.offsetLeft)},tryScrollRight=function(e,r,t){e.offsetLeft+e.offsetWidth>r.scrollLeft+r.offsetWidth&&e.offsetWidth<r.offsetWidth&&(t.scrollLeft=e.offsetLeft+e.offsetWidth-r.offsetWidth)},tryScrollUp=function(e,r,t){r.scrollTop&&e.offsetTop<r.scrollTop&&(t.scrollTop=e.offsetTop)},tryScrollDown=function(e,r,t){e.offsetTop+e.offsetHeight>r.scrollTop+r.offsetHeight&&e.offsetHeight<r.offsetHeight&&(t.scrollTop=e.offsetTop+e.offsetHeight-r.offsetHeight)},scrollTo=function(e,r,t){var n=r.querySelector(scrollableValuesSel),a=e&&e.closest(scrollables);n&&a&&e&&t.forEach((function(r){return r(e,a,n)}))},tableMap=function(e){var r=Array.from(e.rows),t=Array.from(r&&r[0]&&r[0].cells||[]).map((function(e){return e.colSpan})).reduce((function(e,r){return e+r}),0),n=r.map((function(){return new Array(t)}));return r.forEach((function(e,r){var t=0;Array.from(e.cells).forEach((function(e){for(var a=0;a<e.colSpan;a++){for(var o=0;o<e.rowSpan;o++){var i=n[r+o].findIndex((function(e,r){return r>=t&&!e}));n[r+o][i]=e}t++}}))})),n},navigationMap=function(e){for(var r=tableMap(e.querySelector([scrollableColumnHeaderSel,tableSel].join(" "))),t=tableMap(e.querySelector([scrollableRowHeaderSel,tableSel].join(" "))),n=tableMap(e.querySelector([scrollableValuesSel,tableSel].join(" "))),a=e.querySelector(emptyCellSel),o=new Array(t[0].length).fill(a),i=[],l=0;l<r.length;l++)i.push(o.concat(r[l]));for(l=0;l<t.length;l++)i.push(t[l].concat(n[l]));return i},getTargetPos=function(e,r){for(var t=0;t<e.length;t++)for(var n=0;n<e[t].length;n++)if(e[t][n]===r)return[t,n];return[-1,-1]},ctrlKey=function(e){return e.ctrlKey||e.metaKey},cellAt=function(e,r,t){for(var n=navigationMap(e),a=getTargetPos(n,r),o=[a[0]+t[0],a[1]+t[1]],i=n[o[0]]&&n[o[0]][o[1]];i&&i===r;)i=n[(o=[o[0]+t[0],o[1]+t[1]])[0]]&&n[o[0]][o[1]];return i},keyboardEvents$1={keydown:{ArrowLeft:function(e,r,t){t.preventDefault();var n=cellAt(r.root,e,[0,-1]);r.focusElement(n,e),scrollTo(n,r.root,[tryScrollRight,tryScrollLeft,tryScrollDown,tryScrollUp])},ArrowRight:function(e,r,t){t.preventDefault();var n=cellAt(r.root,e,[0,1]);r.focusElement(n,e),scrollTo(n,r.root,[tryScrollLeft,tryScrollRight,tryScrollDown,tryScrollUp])},ArrowUp:function(e,r,t){t.preventDefault();var n=cellAt(r.root,e,[-1,0]);r.focusElement(n,e),scrollTo(n,r.root,[tryScrollRight,tryScrollLeft,tryScrollDown,tryScrollUp])},ArrowDown:function(e,r,t){t.preventDefault();var n=cellAt(r.root,e,[1,0]);r.focusElement(n,e),scrollTo(n,r.root,[tryScrollRight,tryScrollLeft,tryScrollUp,tryScrollDown])},o:function(e,r,t){if(r.root){var n=r.root.nextElementSibling;n&&n instanceof HTMLElement&&n.matches("div.k-pivotgrid-configurator-button")&&(n.click(),setTimeout((function(){if(r.root.parentNode){var e=r.root.parentNode.querySelector(".k-pivotgrid-configurator-content .k-form-field .k-fields-list-wrapper .k-treeview");e instanceof HTMLElement&&(e.setAttribute("tabindex",String(r.tabIndex)),e.focus())}}),0))}},Enter:onEnter,Space:onEnter,Home:function(e,r,t){var n=navigationMap(r.root),a=(ctrlKey(t)?n[0]:n.find((function(r){return Boolean(r.find((function(r){return r===e})))}))||[])[0];a&&(r.focusElement(a,e),scrollTo(a,r.root,[tryScrollRight,tryScrollLeft,tryScrollDown,tryScrollUp]),t.preventDefault())},End:function(e,r,t){var n=navigationMap(r.root),a=ctrlKey(t)?n[n.length-1]:n.find((function(r){return Boolean(r.find((function(r){return r===e})))}))||[],o=a&&a[a.length-1]||null;o&&(r.focusElement(o,e),scrollTo(o,r.root,[tryScrollLeft,tryScrollRight,tryScrollUp,tryScrollDown]),t.preventDefault())}}},mouseEvents$1={click:function(e,r){if(e&&e instanceof HTMLElement){var t=r.elements.find((function(e){return e.hasAttribute("tabindex")}))||null;r.focusElement(e,t)}}},PivotGridNavigation=function(e){function r(){var r=null!==e&&e.apply(this,arguments)||this;return r.selectors=selectors$1,r.mouseEvents=mouseEvents$1,r.keyboardEvents=keyboardEvents$1,r}return __extends(r,e),r}(Navigation),selectors=[".k-pivotgrid-configurator-content .k-form-field .k-fields-list-wrapper .k-treeview",".k-pivotgrid-configurator-content .k-chip",".k-pivotgrid-configurator-actions button"],onEscape=function(e,r,t){if(t.target instanceof HTMLElement&&r.root){var n=r.root.previousElementSibling,a=r.root.nextElementSibling,o=Array.from(n instanceof HTMLElement?n.querySelectorAll("[tabindex]"):[]).find((function(e){return e.tabIndex>=0}));o instanceof HTMLElement&&(o.focus(),a instanceof HTMLElement&&a.click())}},navigate=function(e,r,t,n){t.preventDefault();var a=r.elements,o=a.indexOf(e)+n;o<0&&(o=a.length-1),r.focusElement(a[o%a.length],e)},onDelete=function(e,r,t){t.target instanceof HTMLElement&&(t.target.querySelector(".k-icon.k-i-x-circle, .k-svg-icon.k-svg-i-x-circle")instanceof HTMLElement&&(t.preventDefault(),navigate(e,r,t,-1)))},keyboardEvents={keydown:{Tab:function(e,r,t){navigate(e,r,t,t.shiftKey?-1:1)},Escape:onEscape,Delete:onDelete,Backspace:onDelete}},mouseEvents={click:function(e,r){if(e&&e instanceof HTMLElement){var t=r.elements.find((function(e){return e.hasAttribute("tabindex")}))||null;r.focusElement(e,t)}}},ConfiguratorNavigation=function(e){function r(){var r=null!==e&&e.apply(this,arguments)||this;return r.selectors=selectors,r.mouseEvents=mouseEvents,r.keyboardEvents=keyboardEvents,r}return __extends(r,e),r}(Navigation);export{discoverCommands as A,mergeTrees as B,parseResponse as C,readData as D,rootFields as E,setFilter as F,setSort as G,ConfiguratorNavigation as H,PIVOT_CONFIGURATOR_ACTION as I,PivotGridNavigation as P,createLocalDataState as a,averageAggregate as b,createDataTree as c,maxAggregate as d,countAggregate as e,fetchData as f,createDataState as g,fetchDiscover as h,headersReducer as i,toTree as j,toColumns as k,toRows as l,minAggregate as m,addKPI as n,addMultipleMeasures as o,buildKPIMeasures as p,cloneDataTree as q,compareAxes as r,sumAggregate as s,toData as t,configuratorReducer as u,createAxisDescriptors as v,createDiscoverBody as w,createFlatSchemaDimensions as x,createRequestBody as y,createTuples as z};export{__meta__};
//# sourceMappingURL=kendo.pivotgrid-common.cmn.chunk.js.map
