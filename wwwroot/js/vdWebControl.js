vdrawTM='VectorDraw WebControl by www.vdraw.com';vdversion='1002.2022.0808.1531';var X=0;var Y=1;var Z=2;var B=3;var W=3;var INDEX=3;var A00=0;var A01=1;var A02=2;var A03=3;var A10=4;var A11=5;var A12=6;var A13=7;var A20=8;var A21=9;var A22=10;var A23=11;var A30=12;var A31=13;var A32=14;var A33=15;var vdgeo={};vdgeo.vd_yr=function(number,precision){var ret='';if(precision)ret=number.toFixed(precision);else ret=number.toString();var i=ret.length-1;while(i>0&&ret[i]=='0')i--;if(i>0&&ret[i]=='.')i--;ret=ret.substr(0,i+1);return ret;};vdgeo.vd_yp=function(point,precision){var ret="";for(var i=0;i<point.length;i++){ret+=vdgeo.vd_yr(point[i],precision);if(i!=point.length-1)ret+=",";}return ret;};vdgeo.vd_xv=function(point){var pt=[0,0,0];var vd_CJ=point.split(",");for(var i=0;i<vd_CJ.length;i++){pt[i]=Number(vd_CJ[i]);}return pt;};vdgeo.newpoint=function(x,y,z){return[x,y,z];};vdgeo.vd_ES=function(x,y,z,i){return[x,y,z,i];};vdgeo.newvertex=function(x,y,z,vd_gz){return[x,y,z,vd_gz];};vdgeo.pointPolar=function(pt,ang,dst){ang=vdgeo.FixAngle(ang);return vdgeo.newpoint(Math.cos(ang)*dst+pt[X],Math.sin(ang)*dst+pt[Y],pt[Z]);};vdgeo.vd_MM=function(pt,x,y,z){pt[X]+=x;pt[Y]+=y;pt[Z]+=z;};vdgeo.vd_jU=function(pt,x,y,z,w){pt[X]=x;pt[Y]=y;pt[Z]=z;pt[W]=w;};vdgeo.MidPoint=function(p1,p2){return vdgeo.newpoint((p1[X]+p2[X])/2.0,(p1[Y]+p2[Y])/2.0,(p1[Z]+p2[Z])/2.0);};vdgeo.Distance2D=function(p1,p2){return Math.sqrt((p1[X]-p2[X])*(p1[X]-p2[X])+(p1[Y]-p2[Y])*(p1[Y]-p2[Y]));};vdgeo.Distance3D=function(p1,p2){return Math.sqrt((p1[X]-p2[X])*(p1[X]-p2[X])+(p1[Y]-p2[Y])*(p1[Y]-p2[Y])+(p1[Z]-p2[Z])*(p1[Z]-p2[Z]));};vdgeo.vd_bn=function(dest,source){dest[X]=source[X];dest[Y]=source[Y];dest[Z]=source[Z];dest[W]=source[W];};vdgeo.vd_rc=function(pt,vd_wS,dir,dist){pt[X]=vd_wS[X]+dir[X]*dist;pt[Y]=vd_wS[Y]+dir[Y]*dist;pt[Z]=vd_wS[Z]+dir[Z]*dist;};vdgeo.vd_Gn=function(pt,val){return vdgeo.newpoint(pt[X]*val,pt[Y]*val,pt[Z]*val);};vdgeo.GetAngle=function(p1,p2){if(vdgeo.AreEqual(vdgeo.Distance2D(p1,p2),0.0,vdgeo.DefaultLinearEquality))return 0.0;return vdgeo.FixAngle(Math.atan2(p2[Y]-p1[Y],p2[X]-p1[X]));};vdgeo.VectorDirection=function(p1,p2){var v=vdgeo.newpoint(p2[X]-p1[X],p2[Y]-p1[Y],p2[Z]-p1[Z]);vdgeo.vd_dR(v);return v;};vdgeo.vd_ht=function(v,other){return(v[X]*other[X]+v[Y]*other[Y]+v[Z]*other[Z]);};vdgeo.vd_im=function(v){return Math.sqrt(vdgeo.vd_ht(v,v));};vdgeo.vd_Ah=function(vec){var v=vdgeo.newpoint(vec[X],vec[Y],vec[Z]);vdgeo.vd_dR(v);var sa=0.0;if(vdgeo.AreEqual(v[X],0,vdgeo.DefaultLinearEquality)){if(v[Y]>0.0){sa=vdgeo.HALF_PI;}else{sa=3.0*vdgeo.HALF_PI;}}else if(vdgeo.AreEqual(v[Y],0,vdgeo.DefaultLinearEquality)){if(v[X]>0.0){sa=0.0;}else{sa=vdgeo.PI;}}else{sa=Math.atan(Math.abs(v[Y])/Math.abs(v[X]));if(v[Y]>0.0&&v[X]<0.0){sa=vdgeo.PI-sa;}else if(v[Y]<0.0&&v[X]<0.0){sa=vdgeo.PI+sa;}else if(v[Y]<0.0&&v[X]>0.0){sa=vdgeo.VD_TWOPI-sa;}}return vdgeo.FixAngle(sa);};vdgeo.vd_dR=function(v){var l=vdgeo.vd_im(v);if(vdgeo.AreEqual(l,0.0,vdgeo.DefaultVectorEquality)){v[X]=0.0;v[Y]=0.0;v[Z]=1.0;return false;}v[X]/=l;v[Y]/=l;v[Z]/=l;return true;};vdgeo.vd_FL=function(v1,v2,v){v[X]=v1[Y]*v2[Z]-v2[Y]*v1[Z];v[Y]=v1[Z]*v2[X]-v2[Z]*v1[X];v[Z]=v1[X]*v2[Y]-v2[X]*v1[Y];};vdgeo.vd_od=function(v1,v2){var v=vdgeo.newpoint(0,0,0);vdgeo.vd_FL(v1,v2,v);return v;};vdgeo.vd_nz=function(p1,p2,p3,v){var A=vdgeo.newpoint(p2[X]-p1[X],p2[Y]-p1[Y],p2[Z]-p1[Z]);var B=vdgeo.newpoint(p3[X]-p1[X],p3[Y]-p1[Y],p3[Z]-p1[Z]);vdgeo.vd_FL(A,B,v);if(!vdgeo.vd_dR(v))return false;return true;};vdgeo.vd_QI=function(p1,p2,p3){var v=vdgeo.newpoint(0,0,0);if(!vdgeo.vd_nz(p1,p2,p3,v))return null;return v;};vdgeo.vd_Rr=function(p1,p2,p3,p4){if(vdgeo.vd_fH(p1,p2,vdgeo.vd_qd))return 1;if(vdgeo.vd_fH(p2,p3,vdgeo.vd_qd))return 2;if(vdgeo.vd_fH(p3,p4,vdgeo.vd_qd))return 3;if(vdgeo.vd_fH(p4,p1,vdgeo.vd_qd))return 4;return 0;};vdgeo.vd_KL=function(p1,p2,p3,p4,v){var olap=vdgeo.vd_Rr(p1,p2,p3,p4);switch(olap){case 0:return vdgeo.vd_nz(p1,p2,p3,v);case 1:return vdgeo.vd_nz(p2,p3,p4,v);case 2:return vdgeo.vd_nz(p1,p3,p4,v);case 3:return vdgeo.vd_nz(p1,p2,p4,v);case 4:return vdgeo.vd_nz(p1,p2,p3,v);}return false;};vdgeo.vd_qF=function(mat){return[mat[A00],mat[A10],mat[A20],mat[A30],mat[A01],mat[A11],mat[A21],mat[A31],mat[A02],mat[A12],mat[A22],mat[A32],mat[A03],mat[A13],mat[A23],mat[A33]];};vdgeo.vd_RL=function(vd_yT,pvTo){var vA=vdgeo.newpoint(vd_yT[X],vd_yT[Y],vd_yT[Z]);var vB=vdgeo.newpoint(pvTo[X],pvTo[Y],pvTo[Z]);vdgeo.vd_dR(vA);vdgeo.vd_dR(vB);var vd_yu=vdgeo.newpoint(vA[X]+vB[X],vA[Y]+vB[Y],vA[Z]+vB[Z]);vdgeo.vd_dR(vd_yu);var vOut=vdgeo.vd_od(vA,vd_yu);var x=vOut[X];var y=vOut[Y];var z=vOut[Z];var w=vdgeo.vd_ht(vA,vd_yu);return[x,y,z,w];};vdgeo.vd_QZ=function(q){var x=q[X];var y=q[Y];var z=q[Z];var w=q[W];var vd_mx=0.0;var vd_ox=0.0;var bank=0.0;var test=x*y+z*w;if(test>0.499){vd_mx=2*Math.atan2(x,w);vd_ox=vdgeo.PI/2;bank=0;return[vdgeo.FixAngle(bank),vdgeo.FixAngle(vd_mx),vdgeo.FixAngle(vd_ox)];}if(test< -0.499){vd_mx= -2*Math.atan2(x,w);vd_ox= -vdgeo.PI/2;bank=0;return[vdgeo.FixAngle(bank),vdgeo.FixAngle(vd_mx),vdgeo.FixAngle(vd_ox)];}var sqx=x*x;var sqy=y*y;var sqz=z*z;vd_mx=Math.atan2(2*y*w-2*x*z,1-2*sqy-2*sqz);vd_ox=Math.asin(2*test);bank=Math.atan2(2*x*w-2*y*z,1-2*sqx-2*sqz);return[vdgeo.FixAngle(bank),vdgeo.FixAngle(vd_mx),vdgeo.FixAngle(vd_ox)];};vdgeo.vd_e=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];};vdgeo.vd_dD=function(m){var ret=vdgeo.vd_e();vdgeo.vd_mB(ret,m);return ret;};vdgeo.vd_RW=function(m,precision){if(precision==undefined)precision=10;return "["+m[A00].toFixed(precision)+","+m[A01].toFixed(precision)+","+m[A02].toFixed(precision)+","+m[A03].toFixed(precision)+","+m[A10].toFixed(precision)+","+m[A11].toFixed(precision)+","+m[A12].toFixed(precision)+","+m[A13].toFixed(precision)+","+m[A20].toFixed(precision)+","+m[A21].toFixed(precision)+","+m[A22].toFixed(precision)+","+m[A23].toFixed(precision)+","+m[A30].toFixed(precision)+","+m[A31].toFixed(precision)+","+m[A32].toFixed(precision)+","+m[A33].toFixed(precision)+"]";};vdgeo.vd_Se=function(m,precision){if(precision==undefined)precision=10;m[A00]=Number(m[A00].toFixed(precision));m[A01]=Number(m[A01].toFixed(precision));m[A02]=Number(m[A02].toFixed(precision));m[A03]=Number(m[A03].toFixed(precision));m[A10]=Number(m[A10].toFixed(precision));m[A11]=Number(m[A11].toFixed(precision));m[A12]=Number(m[A12].toFixed(precision));m[A13]=Number(m[A13].toFixed(precision));m[A20]=Number(m[A20].toFixed(precision));m[A21]=Number(m[A21].toFixed(precision));m[A22]=Number(m[A22].toFixed(precision));m[A23]=Number(m[A23].toFixed(precision));m[A30]=Number(m[A30].toFixed(precision));m[A31]=Number(m[A31].toFixed(precision));m[A32]=Number(m[A32].toFixed(precision));m[A33]=Number(m[A33].toFixed(precision));};vdgeo.vd_gM=function(m){m[A00]=1.0;m[A01]=0.0;m[A02]=0.0;m[A03]=0.0;m[A10]=0.0;m[A11]=1.0;m[A12]=0.0;m[A13]=0.0;m[A20]=0.0;m[A21]=0.0;m[A22]=1.0;m[A23]=0.0;m[A30]=0.0;m[A31]=0.0;m[A32]=0.0;m[A33]=1.0;};vdgeo.vd_mB=function(m,from){m[A00]=from[A00];m[A01]=from[A01];m[A02]=from[A02];m[A03]=from[A03];m[A10]=from[A10];m[A11]=from[A11];m[A12]=from[A12];m[A13]=from[A13];m[A20]=from[A20];m[A21]=from[A21];m[A22]=from[A22];m[A23]=from[A23];m[A30]=from[A30];m[A31]=from[A31];m[A32]=from[A32];m[A33]=from[A33];};vdgeo.vd_cr=function(m,mat){if(vdgeo.vd_GN(m)&&vdgeo.vd_GN(mat)){vdgeo.vd_KN(m,mat);return;}if(vdgeo.vd_wj(m)){vdgeo.vd_mB(m,mat);return;}if(vdgeo.vd_wj(mat)){return;}var a_00=m[A00]*mat[A00]+m[A10]*mat[A01]+m[A20]*mat[A02]+m[A30]*mat[A03];var a_01=m[A01]*mat[A00]+m[A11]*mat[A01]+m[A21]*mat[A02]+m[A31]*mat[A03];var a_02=m[A02]*mat[A00]+m[A12]*mat[A01]+m[A22]*mat[A02]+m[A32]*mat[A03];var a_03=m[A03]*mat[A00]+m[A13]*mat[A01]+m[A23]*mat[A02]+m[A33]*mat[A03];var a_10=m[A00]*mat[A10]+m[A10]*mat[A11]+m[A20]*mat[A12]+m[A30]*mat[A13];var a_11=m[A01]*mat[A10]+m[A11]*mat[A11]+m[A21]*mat[A12]+m[A31]*mat[A13];var a_12=m[A02]*mat[A10]+m[A12]*mat[A11]+m[A22]*mat[A12]+m[A32]*mat[A13];var a_13=m[A03]*mat[A10]+m[A13]*mat[A11]+m[A23]*mat[A12]+m[A33]*mat[A13];var a_20=m[A00]*mat[A20]+m[A10]*mat[A21]+m[A20]*mat[A22]+m[A30]*mat[A23];var a_21=m[A01]*mat[A20]+m[A11]*mat[A21]+m[A21]*mat[A22]+m[A31]*mat[A23];var a_22=m[A02]*mat[A20]+m[A12]*mat[A21]+m[A22]*mat[A22]+m[A32]*mat[A23];var a_23=m[A03]*mat[A20]+m[A13]*mat[A21]+m[A23]*mat[A22]+m[A33]*mat[A23];var a_30=m[A00]*mat[A30]+m[A10]*mat[A31]+m[A20]*mat[A32]+m[A30]*mat[A33];var a_31=m[A01]*mat[A30]+m[A11]*mat[A31]+m[A21]*mat[A32]+m[A31]*mat[A33];var a_32=m[A02]*mat[A30]+m[A12]*mat[A31]+m[A22]*mat[A32]+m[A32]*mat[A33];var a_33=m[A03]*mat[A30]+m[A13]*mat[A31]+m[A23]*mat[A32]+m[A33]*mat[A33];m[A00]=a_00;m[A01]=a_01;m[A02]=a_02;m[A03]=a_03;m[A10]=a_10;m[A11]=a_11;m[A12]=a_12;m[A13]=a_13;m[A20]=a_20;m[A21]=a_21;m[A22]=a_22;m[A23]=a_23;m[A30]=a_30;m[A31]=a_31;m[A32]=a_32;m[A33]=a_33;};vdgeo.vd_wj=function(m){return(m[A00]===1.0&&m[A01]===0.0&&m[A02]===0.0&&m[A03]===0.0&&m[A10]===0.0&&m[A11]===1.0&&m[A12]===0.0&&m[A13]===0.0&&m[A20]===0.0&&m[A21]===0.0&&m[A22]===1.0&&m[A23]===0.0&&m[A30]===0.0&&m[A31]===0.0&&m[A32]===0.0&&m[A33]===1.0);};vdgeo.vd_lN=function(m){var m_N=vdgeo.vd_od(vdgeo.vd_jH(m),vdgeo.vd_Fm(m));var m_A=vdgeo.vd_ht(m_N,m_N);if((-vdgeo.EPSILON)<m_A&&m_A<vdgeo.EPSILON)return false;return(vdgeo.vd_ht(m_N,vdgeo.vd_ha(m))<0.0?true:false);};vdgeo.vd_jH=function(m){return vdgeo.newpoint(m[A00],m[A10],m[A20]);};vdgeo.vd_Fm=function(m){return vdgeo.newpoint(m[A01],m[A11],m[A21]);};vdgeo.vd_ha=function(m){return vdgeo.newpoint(m[A02],m[A12],m[A22]);};vdgeo.vd_Iu=function(m){return vdgeo.newpoint(m[A03],m[A13],m[A23]);};vdgeo.vd_ur=function(m){return vdgeo.newpoint(vdgeo.vd_im(vdgeo.vd_jH(m)),vdgeo.vd_im(vdgeo.vd_Fm(m)),vdgeo.vd_im(vdgeo.vd_ha(m)));};vdgeo.vd_ok=function(m){var zdir=vdgeo.vd_ha(m);if(vdgeo.AreEqual(zdir[X],0,vdgeo.DefaultVectorEquality)&&vdgeo.AreEqual(zdir[Y],0,vdgeo.DefaultVectorEquality))return vdgeo.vd_Ah(vdgeo.vd_jH(m));var offset=vdgeo.vd_Iu(m);var _mat=vdgeo.vd_dD(m);vdgeo.vd_x(_mat,-offset[X],-offset[Y],-offset[Z]);vdgeo.vd_gB(_mat,zdir);return vdgeo.vd_Ah(vdgeo.vd_jH(_mat));};vdgeo.vd_LH=function(m){var zdir=vdgeo.vd_ha(m);var offset=vdgeo.vd_Iu(m);var _mat=vdgeo.vd_dD(m);vdgeo.vd_x(_mat,-offset[X],-offset[Y],-offset[Z]);vdgeo.vd_gB(_mat,zdir);var angle=vdgeo.vd_Ah(vdgeo.vd_jH(_mat));vdgeo.vd_bw(_mat,-angle);return{x:offset[X],y:offset[Y],z:offset[Z],sx:_mat[A00],sy:_mat[A11],sz:_mat[A22],zrot:angle,dir:zdir}};vdgeo.vd_Ht=function(m,vd_A,rotation,sx,sy,sz,normal){var mat=vdgeo.vd_e();vdgeo.vd_aj(mat,sx,sy,sz);vdgeo.vd_bw(mat,rotation);vdgeo.vd_dl(mat,normal);vdgeo.vd_x(mat,vd_A[X],vd_A[Y],vd_A[Z]);vdgeo.vd_cr(mat,m);return vdgeo.vd_LH(mat);};vdgeo.vd_GN=function(m){return(m[A02]===0.0&&m[A12]===0.0&&m[A20]===0.0&&m[A21]===0.0&&m[A23]===0.0&&m[A32]===0.0);};vdgeo.vd_KN=function(m,mat){var a_00=m[A00]*mat[A00]+m[A10]*mat[A01]+m[A30]*mat[A03];var a_01=m[A01]*mat[A00]+m[A11]*mat[A01]+m[A31]*mat[A03];var a_03=m[A03]*mat[A00]+m[A13]*mat[A01]+m[A33]*mat[A03];var a_10=m[A00]*mat[A10]+m[A10]*mat[A11]+m[A30]*mat[A13];var a_11=m[A01]*mat[A10]+m[A11]*mat[A11]+m[A31]*mat[A13];var a_13=m[A03]*mat[A10]+m[A13]*mat[A11]+m[A33]*mat[A13];var a_22=m[A22]*mat[A22];var a_30=m[A00]*mat[A30]+m[A10]*mat[A31]+m[A30]*mat[A33];var a_31=m[A01]*mat[A30]+m[A11]*mat[A31]+m[A31]*mat[A33];var a_33=m[A03]*mat[A30]+m[A13]*mat[A31]+m[A33]*mat[A33];m[A00]=a_00;m[A01]=a_01;m[A02]=0;m[A03]=a_03;m[A10]=a_10;m[A11]=a_11;m[A12]=0;m[A13]=a_13;m[A20]=0;m[A21]=0;m[A22]=a_22;m[A23]=0;m[A30]=a_30;m[A31]=a_31;m[A32]=0;m[A33]=a_33;};vdgeo.vd_LB=function(m){return(m[A03]*m[A12]*m[A21]*m[A30]-m[A02]*m[A13]*m[A21]*m[A30]-m[A03]*m[A11]*m[A22]*m[A30]+m[A01]*m[A13]*m[A22]*m[A30]+m[A02]*m[A11]*m[A23]*m[A30]-m[A01]*m[A12]*m[A23]*m[A30]-m[A03]*m[A12]*m[A20]*m[A31]+m[A02]*m[A13]*m[A20]*m[A31]+m[A03]*m[A10]*m[A22]*m[A31]-m[A00]*m[A13]*m[A22]*m[A31]-m[A02]*m[A10]*m[A23]*m[A31]+m[A00]*m[A12]*m[A23]*m[A31]+m[A03]*m[A11]*m[A20]*m[A32]-m[A01]*m[A13]*m[A20]*m[A32]-m[A03]*m[A10]*m[A21]*m[A32]+m[A00]*m[A13]*m[A21]*m[A32]+m[A01]*m[A10]*m[A23]*m[A32]-m[A00]*m[A11]*m[A23]*m[A32]-m[A02]*m[A11]*m[A20]*m[A33]+m[A01]*m[A12]*m[A20]*m[A33]+m[A02]*m[A10]*m[A21]*m[A33]-m[A00]*m[A12]*m[A21]*m[A33]-m[A01]*m[A10]*m[A22]*m[A33]+m[A00]*m[A11]*m[A22]*m[A33]);};vdgeo.vd_mh=function(m){var det=vdgeo.vd_LB(m);var t00=m[A12]*m[A23]*m[A31]-m[A13]*m[A22]*m[A31]+m[A13]*m[A21]*m[A32]-m[A11]*m[A23]*m[A32]-m[A12]*m[A21]*m[A33]+m[A11]*m[A22]*m[A33];var t01=m[A03]*m[A22]*m[A31]-m[A02]*m[A23]*m[A31]-m[A03]*m[A21]*m[A32]+m[A01]*m[A23]*m[A32]+m[A02]*m[A21]*m[A33]-m[A01]*m[A22]*m[A33];var t02=m[A02]*m[A13]*m[A31]-m[A03]*m[A12]*m[A31]+m[A03]*m[A11]*m[A32]-m[A01]*m[A13]*m[A32]-m[A02]*m[A11]*m[A33]+m[A01]*m[A12]*m[A33];var t03=m[A03]*m[A12]*m[A21]-m[A02]*m[A13]*m[A21]-m[A03]*m[A11]*m[A22]+m[A01]*m[A13]*m[A22]+m[A02]*m[A11]*m[A23]-m[A01]*m[A12]*m[A23];var t10=m[A13]*m[A22]*m[A30]-m[A12]*m[A23]*m[A30]-m[A13]*m[A20]*m[A32]+m[A10]*m[A23]*m[A32]+m[A12]*m[A20]*m[A33]-m[A10]*m[A22]*m[A33];var t11=m[A02]*m[A23]*m[A30]-m[A03]*m[A22]*m[A30]+m[A03]*m[A20]*m[A32]-m[A00]*m[A23]*m[A32]-m[A02]*m[A20]*m[A33]+m[A00]*m[A22]*m[A33];var t12=m[A03]*m[A12]*m[A30]-m[A02]*m[A13]*m[A30]-m[A03]*m[A10]*m[A32]+m[A00]*m[A13]*m[A32]+m[A02]*m[A10]*m[A33]-m[A00]*m[A12]*m[A33];var t13=m[A02]*m[A13]*m[A20]-m[A03]*m[A12]*m[A20]+m[A03]*m[A10]*m[A22]-m[A00]*m[A13]*m[A22]-m[A02]*m[A10]*m[A23]+m[A00]*m[A12]*m[A23];var t20=m[A11]*m[A23]*m[A30]-m[A13]*m[A21]*m[A30]+m[A13]*m[A20]*m[A31]-m[A10]*m[A23]*m[A31]-m[A11]*m[A20]*m[A33]+m[A10]*m[A21]*m[A33];var t21=m[A03]*m[A21]*m[A30]-m[A01]*m[A23]*m[A30]-m[A03]*m[A20]*m[A31]+m[A00]*m[A23]*m[A31]+m[A01]*m[A20]*m[A33]-m[A00]*m[A21]*m[A33];var t22=m[A01]*m[A13]*m[A30]-m[A03]*m[A11]*m[A30]+m[A03]*m[A10]*m[A31]-m[A00]*m[A13]*m[A31]-m[A01]*m[A10]*m[A33]+m[A00]*m[A11]*m[A33];var t23=m[A03]*m[A11]*m[A20]-m[A01]*m[A13]*m[A20]-m[A03]*m[A10]*m[A21]+m[A00]*m[A13]*m[A21]+m[A01]*m[A10]*m[A23]-m[A00]*m[A11]*m[A23];var t30=m[A12]*m[A21]*m[A30]-m[A11]*m[A22]*m[A30]-m[A12]*m[A20]*m[A31]+m[A10]*m[A22]*m[A31]+m[A11]*m[A20]*m[A32]-m[A10]*m[A21]*m[A32];var t31=m[A01]*m[A22]*m[A30]-m[A02]*m[A21]*m[A30]+m[A02]*m[A20]*m[A31]-m[A00]*m[A22]*m[A31]-m[A01]*m[A20]*m[A32]+m[A00]*m[A21]*m[A32];var t32=m[A02]*m[A11]*m[A30]-m[A01]*m[A12]*m[A30]-m[A02]*m[A10]*m[A31]+m[A00]*m[A12]*m[A31]+m[A01]*m[A10]*m[A32]-m[A00]*m[A11]*m[A32];var t33=m[A01]*m[A12]*m[A20]-m[A02]*m[A11]*m[A20]+m[A02]*m[A10]*m[A21]-m[A00]*m[A12]*m[A21]-m[A01]*m[A10]*m[A22]+m[A00]*m[A11]*m[A22];var vd_bW=1.0/det;m[A00]=t00*vd_bW;m[A01]=t01*vd_bW;m[A02]=t02*vd_bW;m[A03]=t03*vd_bW;m[A10]=t10*vd_bW;m[A11]=t11*vd_bW;m[A12]=t12*vd_bW;m[A13]=t13*vd_bW;m[A20]=t20*vd_bW;m[A21]=t21*vd_bW;m[A22]=t22*vd_bW;m[A23]=t23*vd_bW;m[A30]=t30*vd_bW;m[A31]=t31*vd_bW;m[A32]=t32*vd_bW;m[A33]=t33*vd_bW;};vdgeo.vd_aR=function(m){var ret=vdgeo.vd_dD(m);vdgeo.vd_mh(ret);return ret;};vdgeo.vd_Ib=function(x0,y0,x1,y1){var mat=vdgeo.vd_e();vdgeo.vd_aj(mat,1.0/(x1-x0),1.0/(y1-y0),1.0);vdgeo.vd_x(mat,x0,y0,0);return mat;};vdgeo.vd_x=function(m,dx,dy,dz){if(dx===0.0&&dy===0.0&&dz===0.0)return;var mat=vdgeo.vd_e();mat[A03]=dx;mat[A13]=dy;mat[A23]=dz;vdgeo.vd_cr(m,mat);};vdgeo.vd_aj=function(m,a,b,c){if(a===1.0&&b===1.0&&c===1.0)return;var mat=vdgeo.vd_e();mat[A00]=a;mat[A11]=b;mat[A22]=c;vdgeo.vd_cr(m,mat);};vdgeo.vd_bw=function(m,rads){if(rads===0.0)return;var mat=vdgeo.vd_e();var vd_cI,sine;vd_cI=Math.cos(rads);sine=Math.sin(rads);mat[A00]=vd_cI;mat[A11]=vd_cI;mat[A01]= -sine;mat[A10]=sine;vdgeo.vd_cr(m,mat);};vdgeo.vd_KF=function(m,rads){if(rads===0.0)return;var mat=vdgeo.vd_e();var vd_cI,sine;vd_cI=Math.cos(rads);sine=Math.sin(rads);mat[A11]=vd_cI;mat[A22]=vd_cI;mat[A12]= -sine;mat[A21]=sine;vdgeo.vd_cr(m,mat);};vdgeo.vd_Lh=function(m,rads){if(rads===0.0)return;var mat=vdgeo.vd_e();var vd_cI,sine;vd_cI=Math.cos(rads);sine=Math.sin(rads);mat[A00]=vd_cI;mat[A22]=vd_cI;mat[A02]=sine;mat[A20]= -sine;vdgeo.vd_cr(m,mat);};vdgeo.vd_HF=function(m,Sx,Sy){if(Sx===0.0&&Sy===0.0)return;var mat=vdgeo.vd_e();mat[A01]=Math.tan(Sx);mat[A10]=Math.tan(Sy);vdgeo.vd_cr(m,mat);};var vd_FF=0.015625;vdgeo.vd_LI=function(m,vd_lr,vd_ym){var vd_dz=vdgeo.newpoint(vd_lr[X],vd_lr[Y],vd_lr[Z]);vdgeo.vd_dR(vd_dz);var vd_fI=vdgeo.newpoint(vd_ym[X],vd_ym[Y],vd_ym[Z]);vdgeo.vd_dR(vd_fI);var vd_gm=vdgeo.vd_od(vd_dz,vd_fI);vdgeo.vd_dR(vd_gm);var mat=vdgeo.vd_e();mat[A00]=vd_fI[X];mat[A01]=vd_gm[X];mat[A02]=vd_dz[X];mat[A10]=vd_fI[Y];mat[A11]=vd_gm[Y];mat[A12]=vd_dz[Y];mat[A20]=vd_fI[Z];mat[A21]=vd_gm[Z];mat[A22]=vd_dz[Z];vdgeo.vd_cr(m,mat);};vdgeo.vd_dl=function(m,vd_lr){if(vd_lr==undefined)return;var vd_dz=vdgeo.newpoint(vd_lr[X],vd_lr[Y],vd_lr[Z]);vdgeo.vd_dR(vd_dz);if(vd_dz[X]===0.0&&vd_dz[Y]===0.0&&vd_dz[Z]===1.0)return;var vd_fI;var vd_gm;var Wy=vdgeo.newpoint(0.0,1.0,0.0);var Wz=vdgeo.newpoint(0.0,0.0,1.0);if((Math.abs(vd_dz[X])<vd_FF)&&(Math.abs(vd_dz[Y])<vd_FF))vd_fI=vdgeo.vd_od(Wy,vd_dz);else vd_fI=vdgeo.vd_od(Wz,vd_dz);vdgeo.vd_dR(vd_fI);vd_gm=vdgeo.vd_od(vd_dz,vd_fI);vdgeo.vd_dR(vd_gm);var mat=vdgeo.vd_e();mat[A00]=vd_fI[X];mat[A01]=vd_gm[X];mat[A02]=vd_dz[X];mat[A10]=vd_fI[Y];mat[A11]=vd_gm[Y];mat[A12]=vd_dz[Y];mat[A20]=vd_fI[Z];mat[A21]=vd_gm[Z];mat[A22]=vd_dz[Z];vdgeo.vd_cr(m,mat);};vdgeo.vd_gB=function(m,vd_dz){var mat=vdgeo.vd_e();vdgeo.vd_dl(mat,vd_dz);vdgeo.vd_mh(mat);vdgeo.vd_cr(m,mat);};vdgeo.vd_Mj=function(m,axis,rotation){vdgeo.vd_gB(m,axis);vdgeo.vd_bw(m,rotation);vdgeo.vd_dl(m,axis);};vdgeo.vd_Ra=function(m,vd_Mc,vd_Mg,vd_ut,vd_rA){vdgeo.vd_gM(m);vdgeo.vd_aj(m,vd_ut*0.5,vd_rA*0.5,1);vdgeo.vd_x(m,-vd_ut*0.5+vd_Mc,-vd_rA*0.5+vd_Mg,0);};vdgeo.vd_Lg=function(m,vd_B,vd_Z,vd_wr,near,far){var width=vd_Z*vd_wr;var left=vd_B[X]-width*0.5;var right=vd_B[X]+width*0.5;var top=vd_B[Y]+vd_Z*0.5;var bottom=vd_B[Y]-vd_Z*0.5;vdgeo.vd_gM(m);m[A00]=2.0/(right-left);m[A03]= -(right+left)/(right-left);m[A11]=2.0/(top-bottom);m[A13]= -(top+bottom)/(top-bottom);m[A22]= -2.0/(far-near);m[A23]= -(far+near)/(far-near);m[A32]=0.0;m[A33]=1.0;};vdgeo.vd_Mw=function(m,vd_B,vd_Z,vd_wr,near,far,FocalLength,LensAngle){far+=vd_B[Z];near+=vd_B[Z];near=FocalLength;near=Math.max(near,0.001);far=Math.max(near+0.001,far);var vd_mo=2.0*FocalLength*Math.tan(vdgeo.DegreesToRadians(LensAngle/2.0));var top=vd_mo*0.5;var bottom= -top;var right=vd_wr*top;var left= -right;vdgeo.vd_gM(m);m[A00]=2.0*near/(right-left);m[A02]=(right+left)/(right-left);m[A11]=2.0*near/(top-bottom);m[A12]=(top+bottom)/(top-bottom);m[A22]= -(far+near)/(far-near);m[A23]= -2.0*far*near/(far-near);m[A32]= -1.0;m[A33]=0.0;var m2=vdgeo.vd_e();vdgeo.vd_x(m2,-vd_B[X],-vd_B[Y],-vd_B[Z]);vdgeo.vd_cr(m2,m);vdgeo.vd_mB(m,m2);};vdgeo.vd_MO=function(p1,p2){var z1=p1[Z];var z2=p2[Z];if(z1<0&&z2<0)return false;if(z1<0||z2<0){var gradient=(-p1[Z])/(p2[Z]-p1[Z]);var x=vdgeo.vd_dp(p1[X],p2[X],gradient);var y=vdgeo.vd_dp(p1[Y],p2[Y],gradient);var z=vdgeo.vd_dp(p1[Z],p2[Z],gradient);var w=vdgeo.vd_dp(p1[W],p2[W],gradient);if(z1<0){p1[X]=x;p1[Y]=y;p1[Z]=0;p1[W]=w;}else if(z2<0){p2[X]=x;p2[Y]=y;p2[Z]=0;p2[W]=w;}}if(p1[W]){p1[X]/=p1[W];p1[Y]/=p1[W];p1[Z]/=p1[W];}if(p2[W]){p2[X]/=p2[W];p2[Y]/=p2[W];p2[Z]/=p2[W];}return true;};vdgeo.vd_NG=function(pts,uvs){var i=0,n=0;var uv1,uv2,u,v,d,vd_hq;var p1,p2,z1,z2,x,y,z,w,gradient;var vd_cb=[];if(uvs)vd_hq=[];for(i=0;i<pts.length;i++){p1=[pts[i][X],pts[i][Y],pts[i][Z],pts[i][W]];if(uvs){uv1=[uvs[i][X],uvs[i][Y],uvs[i][Z]];}n=i+1;if(n===pts.length)n=0;p2=[pts[n][X],pts[n][Y],pts[n][Z],pts[n][W]];if(uvs){uv2=[uvs[n][X],uvs[n][Y],uvs[n][Z]];}z1=p1[Z];z2=p2[Z];if(z1<0&&z2<0)continue;if(z1<0||z2<0){gradient=(-p1[Z])/(p2[Z]-p1[Z]);x=vdgeo.vd_dp(p1[X],p2[X],gradient);y=vdgeo.vd_dp(p1[Y],p2[Y],gradient);z=vdgeo.vd_dp(p1[Z],p2[Z],gradient);w=vdgeo.vd_dp(p1[W],p2[W],gradient);if(uvs){u=vdgeo.vd_lK(uv1[X],uv2[X],gradient);v=vdgeo.vd_lK(uv1[Y],uv2[Y],gradient);d=vdgeo.vd_lK(uv1[Z],uv2[Z],gradient);}if(z1<0){p1[X]=x;p1[Y]=y;p1[Z]=z;p1[W]=w;if(uvs){uv1[X]=u;uv1[Y]=v;uv1[Z]=d;vd_hq.push(uv1);}vd_cb.push(p1);}else if(z2<0){p2[X]=x;p2[Y]=y;p2[Z]=z;p2[W]=w;if(uvs){uv2[X]=u;uv2[Y]=v;uv2[Z]=d;vd_hq.push(uv1);vd_hq.push(uv2);}vd_cb.push(p1);vd_cb.push(p2);}}else{vd_cb.push(p1);if(uvs)vd_hq.push(uv1);}}for(i=0;i<vd_cb.length;i++){if(vd_cb[i][W]){vd_cb[i][X]/=vd_cb[i][W];vd_cb[i][Y]/=vd_cb[i][W];vd_cb[i][Z]/=vd_cb[i][W];if(uvs&&vd_hq[i][Z]!=0){vd_hq[i][X]/=vd_cb[i][W];vd_hq[i][Y]/=vd_cb[i][W];vd_hq[i][Z]/=vd_cb[i][W];}}}return[vd_cb,vd_hq];};vdgeo.vd_nA=function(x,y,z,projection,vd_bQ){vd_bQ[X]=(x*projection[A00])+(y*projection[A01])+(z*projection[A02])+projection[A03];vd_bQ[Y]=(x*projection[A10])+(y*projection[A11])+(z*projection[A12])+projection[A13];vd_bQ[Z]=(x*projection[A20])+(y*projection[A21])+(z*projection[A22])+projection[A23];vd_bQ[W]=(x*projection[A30])+(y*projection[A31])+(z*projection[A32])+projection[A33];};vdgeo.vd_bL=function(x,y,z,projection){var vd_bQ=vdgeo.newpoint(0,0,0);vdgeo.vd_nA(x,y,z,projection,vd_bQ);if(vd_bQ[W]){vd_bQ[X]/=vd_bQ[W];vd_bQ[Y]/=vd_bQ[W];vd_bQ[Z]/=vd_bQ[W];}return vd_bQ;};vdgeo.vd_do=function(pt,projection){return vdgeo.vd_bL(pt[X],pt[Y],pt[Z],projection);};vdgeo.vd_IB=function(m){if(vdgeo.AreEqual(m[A22],0.0,vdgeo.DefaultVectorEquality))return false;m[A20]=m[A21]=m[A23]=m[A02]=m[A12]=0.0;return true;};vdgeo.vd_QO=function(m){var ret=vdgeo.vd_dD(m);if(!vdgeo.vd_IB(ret))return null;return ret;};vdgeo.vd_gk=function(m,x,y,z){return vdgeo.newpoint(m[A00]*x+m[A01]*y+m[A02]*z+m[A03],m[A10]*x+m[A11]*y+m[A12]*z+m[A13],m[A20]*x+m[A21]*y+m[A22]*z+m[A23]);};vdgeo.vd_tu=function(m,x,y,z,pt){pt[X]=m[A00]*x+m[A01]*y+m[A02]*z+m[A03];pt[Y]=m[A10]*x+m[A11]*y+m[A12]*z+m[A13];pt[Z]=m[A20]*x+m[A21]*y+m[A22]*z+m[A23];};vdgeo.matrixtransform=function(m,pt){return vdgeo.vd_gk(m,pt[X],pt[Y],pt[Z]);};vdgeo.vd_cB=function(m,pt,vd_aZ){vd_aZ[X]=m[A00]*pt[X]+m[A01]*pt[Y]+m[A02]*pt[Z]+m[A03];vd_aZ[Y]=m[A10]*pt[X]+m[A11]*pt[Y]+m[A12]*pt[Z]+m[A13];vd_aZ[Z]=m[A20]*pt[X]+m[A21]*pt[Y]+m[A22]*pt[Z]+m[A23];};vdgeo.vd_PL=function(m,x,y,z,vd_aZ){vd_aZ[X]=m[A00]*x+m[A01]*y+m[A02]*z+m[A03];vd_aZ[Y]=m[A10]*x+m[A11]*y+m[A12]*z+m[A13];};vdgeo.vd_id=function(m,x,y,z,normalize){var v=vdgeo.newpoint();vdgeo.vd_lv(m,x,y,z,v,normalize);return v;};vdgeo.vd_lv=function(m,x,y,z,v,normalize){v[X]=m[A00]*x+m[A01]*y+m[A02]*z;v[Y]=m[A10]*x+m[A11]*y+m[A12]*z;v[Z]=m[A20]*x+m[A21]*y+m[A22]*z;if(normalize===true)vdgeo.vd_dR(v);};vdgeo.vd_sx=function(m,pt,vd_qx){var ret=[0,0,0,0];ret[X]=m[A00]*pt[X]+m[A01]*pt[Y]+m[A02]*pt[Z]+m[A03];ret[Y]=m[A10]*pt[X]+m[A11]*pt[Y]+m[A12]*pt[Z]+m[A13];ret[Z]=m[A20]*pt[X]+m[A21]*pt[Y]+m[A22]*pt[Z]+m[A23];if(vd_qx==undefined)vd_qx=vdgeo.vd_lN(m);ret[B]=pt[B]*(vd_qx? -1.0:1.0);return ret;};vdgeo.vd_st=function(m,pts){var vd_qx=vdgeo.vd_lN(m);var ret=[];for(var i=0;i<pts.length;i++){ret.push(vdgeo.vd_sx(m,pts[i],vd_qx));}return ret;};vdgeo.vd_IA=function(m,x,y,vd_aZ){vd_aZ[X]=m[A00]*x+m[A01]*y+m[A03];vd_aZ[Y]=m[A10]*x+m[A11]*y+m[A13];};vdgeo.vd_fN=function(m,pts){var ret=[];for(var i=0;i<pts.length;i++){ret.push(vdgeo.matrixtransform(m,pts[i]));}return ret;};vdgeo.vd_lO=function(m,pts){var ret=[];ret.length=pts.length;for(var i=0;i<pts.length;i++){ret[i]=vdgeo.newpoint(m[A00]*pts[i][X]+m[A01]*pts[i][Y]+m[A02]*pts[i][Z]+m[A03],m[A10]*pts[i][X]+m[A11]*pts[i][Y]+m[A12]*pts[i][Z]+m[A13]);}return ret;};vdgeo.vd_Lx=function(box){return vdgeo.MidPoint([box[0],box[1],box[2]],[box[3],box[4],box[5]]);};vdgeo.vd_ux=function(m,box){var b1=vdgeo.matrixtransform(m,vdgeo.newpoint(box[0],box[1],box[2]));var b2=vdgeo.matrixtransform(m,vdgeo.newpoint(box[0],box[4],box[2]));var b3=vdgeo.matrixtransform(m,vdgeo.newpoint(box[3],box[4],box[2]));var b4=vdgeo.matrixtransform(m,vdgeo.newpoint(box[3],box[1],box[2]));var b5=vdgeo.matrixtransform(m,vdgeo.newpoint(box[0],box[1],box[5]));var b6=vdgeo.matrixtransform(m,vdgeo.newpoint(box[0],box[4],box[5]));var b7=vdgeo.matrixtransform(m,vdgeo.newpoint(box[3],box[4],box[5]));var b8=vdgeo.matrixtransform(m,vdgeo.newpoint(box[3],box[1],box[5]));return[Math.min(b1[X],b2[X],b3[X],b4[X],b5[X],b6[X],b7[X],b8[X]),Math.min(b1[Y],b2[Y],b3[Y],b4[Y],b5[Y],b6[Y],b7[Y],b8[Y]),Math.min(b1[Z],b2[Z],b3[Z],b4[Z],b5[Z],b6[Z],b7[Z],b8[Z]),Math.max(b1[X],b2[X],b3[X],b4[X],b5[X],b6[X],b7[X],b8[X]),Math.max(b1[Y],b2[Y],b3[Y],b4[Y],b5[Y],b6[Y],b7[Y],b8[Y]),Math.max(b1[Z],b2[Z],b3[Z],b4[Z],b5[Z],b6[Z],b7[Z],b8[Z])];};vdgeo.vd_gW=function(m1,m2){var ret=vdgeo.vd_dD(m1);vdgeo.vd_cr(ret,m2);return ret;};vdgeo.vd_me=function(pts){if(pts.length===0)return null;var vd_be=new vd_hx();for(var i=1;i<pts.length;i++){vd_be.AddPoint(pts[i]);}return vd_be.vd_fD();};vdgeo.vd_Im=function(vd_cJ,vd_cg,vd_ct,vd_cn,p1,p2,vd_h,vd_C){var vd_bS=0,vd_dt=0;var done=false;vd_h[X]=p1[X];vd_h[Y]=p1[Y];vd_h[Z]=p1[Z];vd_C[X]=p2[X];vd_C[Y]=p2[Y];vd_C[Z]=p2[Z];var vd_hA;vd_hA=0;done=false;do{vd_bS=vd_dt=0;if(vd_h[X]<vd_cJ){vd_bS|=1;}else if(vd_h[X]>vd_ct){vd_bS|=2;}if(vd_h[Y]<vd_cg){vd_bS|=4;}else if(vd_h[Y]>vd_cn){vd_bS|=8;}if(vd_C[X]<vd_cJ){vd_dt|=1;}else if(vd_C[X]>vd_ct){vd_dt|=2;}if(vd_C[Y]<vd_cg){vd_dt|=4;}else if(vd_C[Y]>vd_cn){vd_dt|=8;}if((vd_bS&vd_dt)>0){done=true;vd_hA=1;}else{if((vd_bS|vd_dt)===0){done=true;}else{vd_hA=2;if(vd_bS===0){if((vd_dt&8)>0){vd_C[X]+=(vd_cn-vd_C[Y])*((vd_h[X]-vd_C[X])/(vd_h[Y]-vd_C[Y]));vd_C[Y]=vd_cn;}else if((vd_dt&4)>0){vd_C[X]+=(vd_cg-vd_C[Y])*((vd_h[X]-vd_C[X])/(vd_h[Y]-vd_C[Y]));vd_C[Y]=vd_cg;}else if((vd_dt&2)>0){vd_C[Y]+=(vd_ct-vd_C[X])*((vd_h[Y]-vd_C[Y])/(vd_h[X]-vd_C[X]));vd_C[X]=vd_ct;}else if((vd_dt&1)>0){vd_C[Y]+=(vd_cJ-vd_C[X])*((vd_h[Y]-vd_C[Y])/(vd_h[X]-vd_C[X]));vd_C[X]=vd_cJ;}}else{if((vd_bS&8)>0){vd_h[X]+=(vd_cn-vd_h[Y])*((vd_C[X]-vd_h[X])/(vd_C[Y]-vd_h[Y]));vd_h[Y]=vd_cn;}else if((vd_bS&4)>0){vd_h[X]+=(vd_cg-vd_h[Y])*((vd_C[X]-vd_h[X])/(vd_C[Y]-vd_h[Y]));vd_h[Y]=vd_cg;}else if((vd_bS&2)>0){vd_h[Y]+=(vd_ct-vd_h[X])*((vd_C[Y]-vd_h[Y])/(vd_C[X]-vd_h[X]));vd_h[X]=vd_ct;}else if((vd_bS&1)>0){vd_h[Y]+=(vd_cJ-vd_h[X])*((vd_C[Y]-vd_h[Y])/(vd_C[X]-vd_h[X]));vd_h[X]=vd_cJ;}}}}}while(!done);if(vd_hA!==1){var vd_yC=0,vd_zL=0;if((p2[X]-p1[X])!=0.0){vd_yC=(vd_h[X]-p1[X])/(p2[X]-p1[X]);vd_zL=(vd_C[X]-p1[X])/(p2[X]-p1[X]);}else if((p2[Y]-p1[Y])!=0.0){vd_yC=(vd_h[Y]-p1[Y])/(p2[Y]-p1[Y]);vd_zL=(vd_C[Y]-p1[Y])/(p2[Y]-p1[Y]);}vd_h[Z]=vdgeo.vd_lK(p1[Z],p2[Z],vd_yC);vd_C[Z]=vdgeo.vd_lK(p1[Z],p2[Z],vd_zL);}return vd_hA;};vdgeo.vd_GR=function(vd_cJ,vd_cg,vd_ct,vd_cn,p1,p2,vd_h,vd_C){var vd_bS=0,vd_dt=0;var done=false;vd_h[X]=p1[X];vd_h[Y]=p1[Y];vd_C[X]=p2[X];vd_C[Y]=p2[Y];var vd_hA;vd_hA=0;done=false;do{vd_bS=vd_dt=0;if(vd_h[X]<vd_cJ){vd_bS|=1;}else if(vd_h[X]>vd_ct){vd_bS|=2;}if(vd_h[Y]<vd_cg){vd_bS|=4;}else if(vd_h[Y]>vd_cn){vd_bS|=8;}if(vd_C[X]<vd_cJ){vd_dt|=1;}else if(vd_C[X]>vd_ct){vd_dt|=2;}if(vd_C[Y]<vd_cg){vd_dt|=4;}else if(vd_C[Y]>vd_cn){vd_dt|=8;}if((vd_bS&vd_dt)>0){done=true;vd_hA=1;}else{if((vd_bS|vd_dt)===0){done=true;}else{vd_hA=2;if(vd_bS===0){if((vd_dt&8)>0){vd_C[X]+=(vd_cn-vd_C[Y])*((vd_h[X]-vd_C[X])/(vd_h[Y]-vd_C[Y]));vd_C[Y]=vd_cn;}else if((vd_dt&4)>0){vd_C[X]+=(vd_cg-vd_C[Y])*((vd_h[X]-vd_C[X])/(vd_h[Y]-vd_C[Y]));vd_C[Y]=vd_cg;}else if((vd_dt&2)>0){vd_C[Y]+=(vd_ct-vd_C[X])*((vd_h[Y]-vd_C[Y])/(vd_h[X]-vd_C[X]));vd_C[X]=vd_ct;}else if((vd_dt&1)>0){vd_C[Y]+=(vd_cJ-vd_C[X])*((vd_h[Y]-vd_C[Y])/(vd_h[X]-vd_C[X]));vd_C[X]=vd_cJ;}}else{if((vd_bS&8)>0){vd_h[X]+=(vd_cn-vd_h[Y])*((vd_C[X]-vd_h[X])/(vd_C[Y]-vd_h[Y]));vd_h[Y]=vd_cn;}else if((vd_bS&4)>0){vd_h[X]+=(vd_cg-vd_h[Y])*((vd_C[X]-vd_h[X])/(vd_C[Y]-vd_h[Y]));vd_h[Y]=vd_cg;}else if((vd_bS&2)>0){vd_h[Y]+=(vd_ct-vd_h[X])*((vd_C[Y]-vd_h[Y])/(vd_C[X]-vd_h[X]));vd_h[X]=vd_ct;}else if((vd_bS&1)>0){vd_h[Y]+=(vd_cJ-vd_h[X])*((vd_C[Y]-vd_h[Y])/(vd_C[X]-vd_h[X]));vd_h[X]=vd_cJ;}}}}}while(!done);return vd_hA;};vdgeo.vd_IN=function(x1,y1,z1,x2,y2,z2,x,y){var gradient=0;if((x2-x1)!=0.0){gradient=(x-x1)/(x2-x1);}else if((y2-y1)!=0.0){gradient=(y-y1)/(y2-y1);}else{gradient=0;}return vdgeo.vd_lK(z1,z2,gradient);};vdgeo.vd_Me=function(value){return Math.max(0,Math.min(value,1));};vdgeo.vd_lK=function(min,max,gradient){return min+(max-min)*vdgeo.vd_Me(gradient);};vdgeo.vd_dp=function(min,max,gradient){return min+(max-min)*gradient;};vdgeo.vd_Ji=0.017453292519943;vdgeo.EPSILON=4.94066e-324;vdgeo.INCH_MM=25.4;vdgeo.VD_TWOPI=6.2831853071796;vdgeo.HALF_PI=1.5707963267948;vdgeo.PI=3.1415926535898;vdgeo.VD_270PI=4.7123889803844;vdgeo.vd_qd=0.00001;vdgeo.DefaultLinearEquality=0.00000001;vdgeo.DefaultPointEquality=0.00000001;vdgeo.DefaultVectorEquality=0.000001;vdgeo.DefaultAngularEquality=0.000001;vdgeo.vd_DX=0.000001;vdgeo.vd_RI=0.000001;vdgeo.DefaultScaleEquality=0.0000000001;vdgeo.vd_DJ=0.0000000001;vdgeo.vd_Pz=1.0e+09;vdgeo.CURVERESOLUTION=200;vdgeo.vd_Qo=false;vdgeo.AreEqual=function(val1,val2,eq){return(Math.abs(val1-val2)<=eq);};vdgeo.DegreesToRadians=function(vd_KZ){return(vdgeo.PI/180.0)*vd_KZ;};vdgeo.RadiansToDegrees=function(vd_Pv){return(vd_Pv*(180.0/vdgeo.PI));};vdgeo.vd_Jh=function(vd_eu,vd_ee){if(!vdgeo.vd_Qo)return false;return vdgeo.AreEqual(vd_eu,vd_ee,vdgeo.DefaultLinearEquality)||vdgeo.AreEqual(Math.abs(vd_ee-vd_eu),vdgeo.VD_TWOPI,vdgeo.DefaultLinearEquality);};vdgeo.FixAngle=function(vd_iB,vd_da){if(vd_da==undefined)vd_da=vdgeo.DefaultAngularEquality;if(vdgeo.AreEqual(vd_iB,vdgeo.VD_TWOPI,vd_da))return vdgeo.VD_TWOPI;var angle=vd_iB;angle=angle%vdgeo.VD_TWOPI;if(angle>(vdgeo.VD_TWOPI+vd_da))angle-=vdgeo.VD_TWOPI;if((angle+vd_da)<0.0)angle+=vdgeo.VD_TWOPI;if(vdgeo.AreEqual(angle,0.0,vd_da))return 0.0;if(vdgeo.AreEqual(angle,vdgeo.HALF_PI,vd_da))return vdgeo.HALF_PI;if(vdgeo.AreEqual(angle,vdgeo.PI,vd_da))return vdgeo.PI;if(vdgeo.AreEqual(angle,vdgeo.VD_270PI,vd_da))return vdgeo.VD_270PI;if(vdgeo.AreEqual(angle,vdgeo.VD_TWOPI,vd_da))return vdgeo.VD_TWOPI;return angle;};vdgeo.vd_uw=function(vd_ag,rad,sa,ea,elevation){var da=(ea-sa);da=vdgeo.FixAngle(da);if(vdgeo.vd_Jh(sa,ea))da=vdgeo.VD_TWOPI;var vd_iV=da/vd_ag;var aa=vdgeo.FixAngle(sa);var vd_oP=[];for(var i=0;i<vd_ag;i++){vd_oP.push(vdgeo.newpoint(rad*Math.cos(aa),rad*Math.sin(aa),elevation));aa=aa+vd_iV;}return vd_oP;};vdgeo.vd_iZ=function(vd_cz,vd_eB,Radius,vd_ka){vd_ka=vdgeo.FixAngle(vd_ka);var nseg;var vd_tP,ar1;var vd_tx,vd_uR,fi1;vd_uR=400;if(vd_cz>1000)vd_uR*=(vd_cz/1000);vd_tP=vd_ka/vdgeo.VD_TWOPI;if((vd_tx=vdgeo.vd_u(8.99*vd_tP))<1)vd_tx=1;ar1=0.3222*Math.sqrt(vd_cz*Radius/vd_eB);ar1*=vd_tP;if(ar1<vd_tx)ar1=vd_tx;else if(ar1>vd_uR)ar1=vd_uR;nseg=vdgeo.vd_u(ar1);if(Math.abs(vd_tP-1.0)<vdgeo.DefaultLinearEquality&&(fi1=nseg%4)!=0)nseg+=4-fi1;return Math.max(nseg,8);};vdgeo.vd_tH=function(vd_cz,vd_eB,vd_oo,vd_aa){var vd_qB=0.0;for(var k=1;k<vd_oo.length-1;k++){vd_qB=Math.max(vdgeo.Distance3D(vd_oo[k],vd_oo[k+1]),vd_qB);}if(vd_aa){vd_qB=Math.max(vdgeo.Distance3D(vd_oo[vd_oo.length-1],vd_oo[0]),vd_qB);}var vd_ag=vdgeo.vd_iZ(vd_cz,vd_eB,vd_qB/2.0,vdgeo.PI);return Math.min(vd_ag,100);};vdgeo.Bulge2Arc=function(p1,p2){if(!p1[B]||vdgeo.AreEqual(p1[B],0.0,vdgeo.vd_DX))return null;vd_hh=vdgeo.Distance2D(p1,p2);if(vdgeo.AreEqual(vd_hh,0.0,vdgeo.vd_DX))return null;var Center=null,Radius=0.0,vd_fk=0.0,vd_gg=0.0;var vd_hh,vd_qf;vd_qf=(p1[B]*vd_hh)/2.0;Radius=((vd_hh/2.0)*(vd_hh/2.0)+(vd_qf*vd_qf))/(vd_qf*2.0);Center=vdgeo.MidPoint(p1,p2);Center=vdgeo.pointPolar(Center,vdgeo.GetAngle(p1,p2)+vdgeo.PI/2.0,(Radius-vd_qf));vd_fk=vdgeo.GetAngle(Center,((p1[B]>0)?p1:p2));vd_gg=vdgeo.GetAngle(Center,((p1[B]>0)?p2:p1));Radius=Math.abs(Radius);return[Center,Radius,vd_fk,vd_gg];};vdgeo.Arc2Bulge=function(Radius,vd_Bv){var alt=Math.abs(Radius-(Math.cos(vd_Bv/2.0)*Radius));var vd_hh=2.0*alt/Math.tan(vd_Bv/4.0);if(vdgeo.AreEqual(vd_hh,0.0,vdgeo.DefaultLinearEquality))return 0.0;var vd_gz=2.0*alt/vd_hh;return vd_gz;};function vd_sB(vd_ag,pts,pA,pB,pC){var t,x,y,z=pA[Z];for(var i=1;i<vd_ag-1;i++){t=i/vd_ag;x=(pA[X]-2.0*pB[X]+pC[X])*t*t+(2.0*pB[X]-2.0*pA[X])*t+pA[X];y=(pA[Y]-2.0*pB[Y]+pC[Y])*t*t+(2.0*pB[Y]-2.0*pA[Y])*t+pA[Y];pts.push(vdgeo.newpoint(x,y,z));}pts.push(vdgeo.newpoint(pC[X],pC[Y],pC[Z]));};vdgeo.vd_Oj=function(vd_ag,vd_an){var Points=[];var pts=[];pts.length=3;pts[0]=vd_an[0];for(var k=1;k<vd_an.length;k++){pts[1]=vd_an[k];Points.push(vdgeo.newpoint(pts[0][X],pts[0][Y],pts[0][Z]));if(k<vd_an.length-1){pts[2]=vd_an[k+1];if((k+1)!=vd_an.length-1)pts[2]=vdgeo.MidPoint(pts[1],pts[2]);}vd_sB(vd_ag,Points,pts[0],pts[1],pts[2]);pts[0]=pts[2];}return Points;};vdgeo.vd_xz=function(vd_cz,vd_eB,vd_an,vd_aa){var vd_ag=vdgeo.vd_tH(vd_cz,vd_eB,vd_an,vd_aa);var Points=[];var pts=[];pts.length=3;pts[0]=vd_an[0];for(var k=1;k<vd_an.length;k++){pts[1]=vd_an[k];if(k===1&&vd_aa){pts[0]=vdgeo.MidPoint(pts[0],pts[1]);}Points.push(vdgeo.newpoint(pts[0][X],pts[0][Y],pts[0][Z]));if(k<vd_an.length-1){pts[2]=vd_an[k+1];if((k+1)!=vd_an.length-1||vd_aa)pts[2]=vdgeo.MidPoint(pts[1],pts[2]);}else{if(!vd_aa)break;pts[1]=vd_an[vd_an.length-1];pts[2]=vd_an[0];pts[2]=vdgeo.MidPoint(pts[1],pts[2]);vd_sB(vd_ag,Points,pts[0],pts[1],pts[2]);pts[0]=pts[2];pts[1]=vd_an[0];pts[2]=Points[0];vd_sB(vd_ag,Points,pts[0],pts[1],pts[2]);pts[0]=pts[2];break;}vd_sB(vd_ag,Points,pts[0],pts[1],pts[2]);pts[0]=pts[2];}return Points;};vdgeo.vd_un=function(vd_cz,vd_eB,vd_an,vd_aa,StartTangent,EndTangent){var vd_gG=vdgeo.vd_tH(vd_cz,vd_eB,vd_an,vd_aa);var vd_no=vd_JI(vd_an,StartTangent,EndTangent,vd_aa);if(vd_no==null)return vd_an;return vd_no.vd_yL(vd_gG);};vdgeo.vd_uP=function(vd_cz,vd_eB,vd_an,vd_dU,vd_bp,vd_aa){var vd_gG=vdgeo.vd_tH(vd_cz,vd_eB,vd_an,vd_aa);var vd_no=new vdgeo.vd_uT(vd_an,vd_aa,3,vd_dU,vd_bp);return vd_no.vd_yL(vd_gG);};vdgeo.vd_Jl=function(vd_cz,vd_eB,vd_an,vd_dU,vd_bp,vd_aa){var vd_gG=vdgeo.vd_tH(vd_cz,vd_eB,vd_an,vd_aa);var vd_no=new vdgeo.vd_uT(vd_an,vd_aa,2,vd_dU,vd_bp);return vd_no.vd_yL(vd_gG);};vdgeo.vd_CY=function(pl,p1){if(!pl|| !p1|| !pl.VertexList||pl._t!==vdConst.vdPolyline_code)return null;var vd_ly=pl.ExtrusionVector;if(!vd_ly)vd_ly=vdgeo.newpoint(0,0,1);var vd_kY=vdgeo.vd_e();vdgeo.vd_dl(vd_kY,vd_ly);var vd_hV=vdgeo.vd_aR(vd_kY);var vd_aq=vdgeo.vd_st(vd_hV,pl.VertexList.Items);var vd_aa=pl.Flag===1;var pt1=vdgeo.matrixtransform(vd_hV,p1);var vd_ri={};var vd_ky=vdgeo.GetPlineSegmentIndexFromPoint(pt1,vd_aq,vd_aa,null,vd_ri);if(vd_ky<0|| !vd_ri.pt)return null;var sp1,ep1,arc1,a,b,a0,b0;pt1=vdgeo.matrixtransform(vd_hV,vd_ri.pt);sp1=vd_aq[vd_ky];if(vd_ky===vd_aq.length-1)ep1=vd_aq[0];else ep1=vd_aq[vd_ky+1];sp1=vdgeo.vd_sx(vd_hV,sp1);ep1=vdgeo.vd_sx(vd_hV,ep1);arc1=vdgeo.Bulge2Arc(sp1,ep1);if(!arc1){b=0.0;b0=0.0;}else{if(sp1[B]>0.0){a=vdgeo.FixAngle(arc1[3]-vdgeo.GetAngle(arc1[0],pt1));a0=vdgeo.FixAngle(vdgeo.GetAngle(arc1[0],pt1)-arc1[2]);}else{a=vdgeo.FixAngle(vdgeo.GetAngle(arc1[0],pt1)-arc1[2]);a0=vdgeo.FixAngle(arc1[3]-vdgeo.GetAngle(arc1[0],pt1));}b=vdgeo.Arc2Bulge(arc1[1],a)*Math.abs(sp1[B])/sp1[B];b0=vdgeo.Arc2Bulge(arc1[1],a0)*Math.abs(sp1[B])/sp1[B];}pl.VertexList.Items[vd_ky][B]=b0;var nv=vdgeo.vd_sx(vd_kY,[pt1[X],pt1[Y],pt1[Z],b]);pl.VertexList.Items.splice(vd_ky+1,0,nv);return[vd_ky+1,vd_ri.offset,vd_ri.vd_Qy];};vdgeo.GetPlineSegmentIndexFromPoint=function(pt,vd_aq,vd_aa,vd_ly,vd_lE){if(!vd_ly)vd_ly=vdgeo.newpoint(0,0,1);var vd_kY=vdgeo.vd_e();vdgeo.vd_dl(vd_kY,vd_ly);var vd_hV=vdgeo.vd_aR(vd_kY);var vd_aB=vdgeo.vd_st(vd_hV,vd_aq);var p=vdgeo.matrixtransform(vd_hV,pt);var Center,sp,ep;var radius=0.0,vd_eu=0.0,vd_ee=0.0;var success=false;var sa,ea,pa,vd_rX;var vd_mG=null;var vd_rC=false;var dist=0.0;var vd_Aq=null;var vd_Fi= -1;var vd_vW=0.0;var vd_cF=0.0;var offset=0.0;for(var i=0;i<=vd_aB.length-1;i++){sp=vd_aB[i];if(i==vd_aB.length-1){if(!vd_aa)break;ep=vd_aB[0];}else{ep=vd_aB[i+1];}success=vdgeo.Bulge2Arc(sp,ep);if(success==null){vd_mG=vdgeo.projectionPointOnLine(p,sp,ep);vd_cF=vdgeo.Distance3D(sp,ep);offset=vdgeo.Distance3D(vd_mG,sp);vd_rC=vdgeo.AreEqual(offset+vdgeo.Distance3D(vd_mG,ep),vd_cF,vdgeo.DefaultLinearEquality);}else{Center=success[0];radius=success[1];vd_eu=success[2];vd_ee=success[3];ea=vdgeo.FixAngle(vd_ee-vd_eu);sa=0.0;vd_rX=vdgeo.GetAngle(Center,p);pa=vdgeo.FixAngle(vd_rX-vd_eu);vd_cF=radius*ea;if(sp[B]>0.0)offset=radius*pa;else offset=radius*vdgeo.FixAngle(vd_ee-vd_rX);vd_mG=vdgeo.pointPolar(Center,vd_rX,radius);vd_rC=(pa<=ea);}if(vd_rC){dist=vdgeo.Distance3D(vd_mG,p);}else{dist=Math.min(vdgeo.Distance3D(sp,p),vdgeo.Distance3D(ep,p));}if(vd_Aq===null||dist<vd_Aq){vd_Aq=dist;vd_Fi=i;if(vd_lE){if(vd_rC){vd_lE.pt=vdgeo.matrixtransform(vd_kY,vd_mG);vd_lE.offset=vd_vW+offset;}else{vd_lE.pt=null;}}}vd_vW+=vd_cF;}if(vd_lE)vd_lE.vd_Qy=vd_vW;return vd_Fi;};vdgeo.vd_Ov=function(vd_aB,vd_da){if(vd_aB.length==0)return;var Points=[];var c=0;Points.push(vd_aB[0]);for(var i=1;i<vd_aB.length;i++){if(vdgeo.vd_fH(Points[c],vd_aB[i],vd_da))continue;Points.push(vd_aB[i]);c++;}return Points;};vdgeo.vd_Oq=function(vd_aB,vd_cz,vd_eB,vd_aa){var SamplePoints=[];var vd_ag=8;var apts;var Center=vdgeo.newpoint(0,0,0);var radius=0.0,vd_eu=0.0,vd_ee=0.0;var success=false;var sp=null;var ep=null;for(var i=0;i<=vd_aB.length-1;i++){sp=vd_aB[i];if(i==vd_aB.length-1){if(!vd_aa)break;ep=vd_aB[0];}else{ep=vd_aB[i+1];}success=vdgeo.Bulge2Arc(sp,ep);if(success==null){SamplePoints.push(vdgeo.vd_ES(sp[X],sp[Y],sp[Z],i));}else{Center=success[0];radius=success[1];vd_eu=success[2];vd_ee=success[3];vd_ag=vdgeo.vd_iZ(vd_cz,vd_eB,radius,vdgeo.FixAngle(vd_ee-vd_eu));apts=vdgeo.vd_uw(vd_ag,radius,vd_eu,vd_ee,0);apts.push(vdgeo.pointPolar(vdgeo.newpoint(0,0,0),vd_ee,radius));if(vd_aB[i][B]<0.0)apts.reverse();var k;for(k=0;k<apts.length;k++)vdgeo.vd_MM(apts[k],Center[X],Center[Y],Center[Z]);for(k=0;k<apts.length-1;k++){apts[k][INDEX]=i;SamplePoints.push(apts[k]);}}}if(ep!=null)SamplePoints.push(vdgeo.vd_ES(ep[X],ep[Y],ep[Z],vd_aB.length-1));return SamplePoints;};vdgeo.vd_IS=function(p1,p2,p3,len,area){var vd_iB=vdgeo.vd_ka(p1,p2,p3);if(vdgeo.AreEqual(vd_iB,0,0.002)||vdgeo.AreEqual(vd_iB,vdgeo.PI,0.002)||vdgeo.AreEqual(vd_iB,vdgeo.VD_TWOPI,0.002)){var reverse=1.0;var vd_LR=vdgeo.vd_DB(p1,p2,p3);if(vd_LR/area<0.0)reverse= -1.0;return vdgeo.pointPolar([0,0,0],vdgeo.GetAngle(p1,p2)+vdgeo.HALF_PI*reverse,len);}var sinA=Math.sin(vd_iB*0.5);if(!vdgeo.AreEqual(sinA,0.0,vdgeo.DefaultAngularEquality))len/=sinA;if(vd_iB<vdgeo.PI)len*= -1;var m_e0=[p1[X]-p2[X],p1[Y]-p2[Y],p1[Z]-p2[Z]];var m_e1=[p3[X]-p2[X],p3[Y]-p2[Y],p3[Z]-p2[Z]];vdgeo.vd_dR(m_e0);vdgeo.vd_dR(m_e1);var v=[(m_e0[X]+m_e1[X])/2.0,(m_e0[Y]+m_e1[Y])/2.0,(m_e0[Z]+m_e1[Z])/2.0];vdgeo.vd_dR(v);v[X]*=len;v[Y]*=len;v[Z]*=len;return v;};vdgeo.vd_Kf=function(vd_aB,vd_aa,width){if(width==0.0)return null;var vd_ga=[];var vd_Ak=width/2.0;var vd_nI=[0,0,0];var sp=null;var ep=null;var pp=null;var v=null;var area=vdgeo.GetPointsArea(vd_aB);if(vd_aa&&vd_aB.length<4)vd_aa=false;for(var i=0;i<vd_aB.length;i++){sp=vd_aB[i];if(i===0){ep=vd_aB[i+1];if(vd_aa)pp=vd_aB[vd_aB.length-2];else pp=null;}else if(i===vd_aB.length-1){pp=vd_aB[i-1];if(vd_aa)ep=vd_aB[1];else ep=null;}else{ep=vd_aB[i+1];pp=vd_aB[i-1];}if(!pp){v=vdgeo.pointPolar(vd_nI,vdgeo.GetAngle(sp,ep)+vdgeo.HALF_PI,vd_Ak);}else if(!ep){v=vdgeo.pointPolar(vd_nI,vdgeo.GetAngle(pp,sp)+vdgeo.HALF_PI,vd_Ak);}else{v=vdgeo.vd_IS(pp,sp,ep,vd_Ak,area);}vd_ga.push(v);}return vd_ga;};vdgeo.vd_tt=function(angle,vd_kT,vd_px){var vd_bQ=vdgeo.newpoint(0,0,0);if(vdgeo.AreEqual(vd_kT,0.0,vdgeo.DefaultLinearEquality)||vdgeo.AreEqual(vd_px,0.0,vdgeo.DefaultLinearEquality))return vd_bQ;angle=vdgeo.FixAngle(angle);var f=Math.tan(angle);vd_bQ[X]=Math.sqrt(Math.pow(vd_kT,2)*Math.pow(vd_px,2)/(Math.pow(vd_px,2)+Math.pow(vd_kT,2)*Math.pow(f,2)));vd_bQ[Y]=Math.abs(vd_bQ[X]*f);if(angle>=0.0&&angle<vdgeo.HALF_PI){}else if(angle>=vdgeo.HALF_PI&&angle<vdgeo.PI){vd_bQ[X]*= -1.0;}else if(angle>=vdgeo.PI&&angle<(3.0*vdgeo.HALF_PI)){vd_bQ[X]*= -1.0;vd_bQ[Y]*= -1.0;}else if(angle>=(3.0*vdgeo.HALF_PI)&&angle<vdgeo.VD_TWOPI){vd_bQ[Y]*= -1.0;}return vd_bQ;};vdgeo.vd_va=function(vd_cz,vd_eB,vd_kT,vd_ka){return Math.max(vdgeo.vd_iZ(vd_cz,vd_eB,vd_kT,vd_ka),64);};vdgeo.vd_tR=function(vd_ag,vd_kT,vd_px,sa,ea){if(vdgeo.AreEqual(sa,ea,vdgeo.DefaultAngularEquality))ea+=vdgeo.VD_TWOPI;var da=vdgeo.FixAngle(ea-sa);var vd_iV=da/vd_ag;var aa=vdgeo.FixAngle(sa);var vd_oP=[];for(var i=0;i<vd_ag+1;i++){vd_oP.push(vdgeo.vd_tt(aa,vd_kT,vd_px));aa=aa+vd_iV;}return vd_oP;};vdgeo.vd_fH=function(p1,p2,vd_da){return vdgeo.AreEqual(p1[X],p2[X],vd_da)&&vdgeo.AreEqual(p1[Y],p2[Y],vd_da)&&vdgeo.AreEqual(p1[Z],p2[Z],vd_da);};vdgeo.vd_Ea=function(pts){return vdgeo.vd_fH(pts[0],pts[pts.length-1],vdgeo.DefaultPointEquality);};vdgeo.vd_gU=function(p1,p2,p3,p4,vd_da,vd_bQ){var x1=p1[X],x2=p2[X],x3=p3[X],x4=p4[X],y1=p1[Y],y2=p2[Y],y3=p3[Y],y4=p4[Y];var dx=(x1+x2+x3+x4)/4.0;var dy=(y1+y2+y3+y4)/4.0;x1-=dx;x2-=dx;x3-=dx;x4-=dx;y1-=dy;y2-=dy;y3-=dy;y4-=dy;var A1=y4-y3;var B1=x3-x4;var A2=y2-y1;var B2=x1-x2;var DD=A1*B2-A2*B1;if(vdgeo.AreEqual(DD,0.0,vd_da))return 0;var G1=x4*y3-x3*y4;var G2=x2*y1-x1*y2;var DX=B1*G2-B2*G1;var DY=A2*G1-A1*G2;vd_bQ[X]=(DX/DD)+dx;vd_bQ[Y]=(DY/DD)+dy;vd_bQ[Z]=p1[Z];return 1;};vdgeo.vd_Nh=function(p1,p2,p3){var mp1=vdgeo.MidPoint(p1,p2);var mp2=vdgeo.MidPoint(p2,p3);var mp1a=vdgeo.pointPolar(mp1,vdgeo.GetAngle(p1,p2)+vdgeo.HALF_PI,1.0);var mp2a=vdgeo.pointPolar(mp2,vdgeo.GetAngle(p2,p3)+vdgeo.HALF_PI,1.0);var vd_bQ=vdgeo.newpoint(0,0,0);vdgeo.vd_gU(mp1,mp1a,mp2,mp2a,vdgeo.DefaultVectorEquality,vd_bQ);return vd_bQ;};vdgeo.vd_DB=function(p1,p2,p3){var sa=0.0,sb=0.0;sa+=(p1[X]*p2[Y]);sb+=(p1[Y]*p2[X]);sa+=(p2[X]*p3[Y]);sb+=(p2[Y]*p3[X]);sa+=(p3[X]*p1[Y]);sb+=(p3[Y]*p1[X]);return(sb-sa)/2.0;};vdgeo.GetPointsArea=function(pts){if(!pts||pts.length==0)return 0.0;var sa=0.0;var sb=0.0;for(var i=0;i<pts.length-1;i++){sa+=(pts[i][X]*pts[i+1][Y]);sb+=(pts[i][Y]*pts[i+1][X]);}sa+=(pts[pts.length-1][X]*pts[0][Y]);sb+=(pts[pts.length-1][Y]*pts[0][X]);return(sb-sa)/2.0;};vdgeo.vd_IM=function(vd_af){if(!vd_af||vd_af.length==0)return 0.0;var area=vdgeo.GetPointsArea(vd_af);var Center;var Radius;var vd_fk;var vd_gg;var vd_hh;var vd_zv;var alt;var vd_vP;var p1;var p2;for(var i=0;i<vd_af.length;i++){p1=vd_af[i];if(i==vd_af.length-1)p2=vd_af[0];else p2=vd_af[i+1];var ret=vdgeo.Bulge2Arc(p1,p2);if(!ret)continue;Center=ret[0];Radius=ret[1];vd_fk=ret[2];vd_gg=ret[3];vd_hh=vdgeo.Distance2D(p1,p2);vd_zv=Math.atan(Math.abs(p1[B]))*4.0;alt=Radius-(Radius*Math.cos(vd_zv/2.0));vd_vP=vd_zv/2.0*Radius*Radius;vd_vP+=(vd_hh*(alt-Radius)/2.0);area+=(-1.0*(p1[B]/Math.abs(p1[B]))*vd_vP);}return area;};vdgeo.vd_DS=function(vd_af,closed){if(!vd_af||vd_af.length==0)return 0.0;var vd_yN=0;var Center;var Radius;var vd_fk;var vd_gg;var p1;var p2;for(var i=0;i<vd_af.length;i++){p1=vd_af[i];if(i==vd_af.length-1){if(!closed)continue;p2=vd_af[0];}else p2=vd_af[i+1];var ret=vdgeo.Bulge2Arc(p1,p2);if(!ret){vd_yN+=vdgeo.Distance3D(p1,p2);}else{Center=ret[0];Radius=ret[1];vd_fk=ret[2];vd_gg=ret[3];vd_yN+=Radius*vdgeo.FixAngle(vd_gg-vd_fk);}}return vd_yN;};vdgeo.vd_mL=function(vd_af,length,closed){var vd_cb=[];if(!vd_af||vd_af.length==0)return vd_cb;vd_cb.push(vdgeo.pointPolar(vd_af[0],0.0,0.0));var cl=0.0;var cl1=0.0;var Center;var Radius;var vd_fk;var vd_gg;var p1;var p2;for(var i=0;i<vd_af.length;i++){p1=vd_af[i];if(i==vd_af.length-1){if(!closed)continue;p2=vd_af[0];}else p2=vd_af[i+1];var ret=vdgeo.Bulge2Arc(p1,p2);if(!ret){vd_fk=vdgeo.GetAngle(p1,p2);cl1=vdgeo.Distance3D(p1,p2);while((cl+cl1+vdgeo.DefaultLinearEquality)>=length){p1=vdgeo.pointPolar(p1,vd_fk,length-cl);vd_cb.push(p1);cl1-=(length-cl);cl=0;}}else{Center=ret[0];Radius=ret[1];vd_fk=ret[2];vd_gg=ret[3];cl1=Radius*vdgeo.FixAngle(vd_gg-vd_fk);while((cl+cl1+vdgeo.DefaultLinearEquality)>=length){vd_fk+=(length-cl)/Radius;p1=vdgeo.pointPolar(Center,vd_fk,Radius);vd_cb.push(p1);cl1-=(length-cl);cl=0;}}cl+=cl1;}if(vd_cb.length==1)vd_cb=[];return vd_cb;};function vd_Kq(vd_sq,n,vd_fM){var i=0;var vd_bp=[];vd_bp.length=n;var prev=vd_sq[0];vd_bp[0]=0;for(i=1;i<n;i++){var curr=vd_sq[i];var distance=vdgeo.Distance2D(prev,curr);vd_bp[i]=vd_bp[i-1]+distance;prev=curr;}var vd_xn=n+(2*vd_fM);var vd_fF=[];vd_fF.length=vd_xn;for(i=0;i<vd_fM;i++)vd_fF[i]=vd_bp[0];for(i=0;i<n;i++)vd_fF[i+vd_fM]=vd_bp[i];for(i=1;i<=vd_fM;i++)vd_fF[vd_xn-i]=vd_bp[n-1];return vd_fF;};function T(k,t){var d=3;return t[d-1+(k)];};function vd_JA(nS,rAt,vd_bp){var d=3;var m=0;var j=0;var t=[];t.length=d*2;for(j=0,m=nS-d+1;j<2*d;m++,j++)t[j]=vd_bp[m];var v=[];v[0]=[];v[0].length=1;v[0][0]=1.0;for(m=1;m<=d;m++){v[m]=[];v[m].length=m+1;v[m][0]=v[m-1][0]*((T(1,t)-rAt)/(T(1,t)-T(-m+1,t)));for(j=1;j<m;j++){v[m][j]=v[m-1][j-1]*((rAt-T(-m+j,t))/(T(j,t)-T(-m+j,t)))+v[m-1][j]*((T(j+1,t)-rAt)/(T(j+1,t)-T(-m+j+1,t)));}v[m][m]=v[m-1][m-1]*((rAt-T(0,t))/(T(m,t)-T(0,t)));}return v[d];};function vd_NR(alpha,beta,vd_fz,low,up){up.length=beta.length;low.length=beta.length;up[0]=beta[0];for(var i=1;i<beta.length;i++){low[i]=alpha[i]/up[i-1];up[i]=beta[i]-low[i]*vd_fz[i-1];}};function vd_wn(low,up,vd_fz,D,X){var n=low.length;var i=0;X.length=n;var y=[];y.length=n;y[0]=D[0];for(i=1;i<n;i++)y[i]=D[i]-low[i]*y[i-1];X[n-1]=y[n-1]/up[n-1];for(i=n-2;i>=0;i--)X[i]=(y[i]-vd_fz[i]*X[i+1])/up[i];};var vd_EU=vdgeo.newpoint(0,0,0);function vd_JI(vd_db,StartTangent,EndTangent,closed){var s1,t1,r1;var i=0;var vd_Ac=vdgeo.vd_Ea(vd_db);closed=closed||vd_Ac;var n=vd_db.length;if(closed&&vd_Ac)n--;if(n<3)return null;if(StartTangent==undefined)StartTangent=null;if(EndTangent==undefined)EndTangent=null;if(closed){if(StartTangent==null||EndTangent==null){if(!vd_Ac)vd_db[n]=vd_db[0];n=vd_db.length;var cen=vdgeo.vd_Nh(vd_db[n-2],vd_db[0],vd_db[1]);var area=vdgeo.vd_DB(vd_db[n-2],vd_db[0],vd_db[1]);if(!vdgeo.AreEqual(area,0.0,vdgeo.DefaultLinearEquality)){var ang=vdgeo.GetAngle(cen,vd_db[0])+vdgeo.PI/2.0-vdgeo.PI*(area>0?1.0: -1.0);if(StartTangent==null)StartTangent=vdgeo.pointPolar(vdgeo.newpoint(0,0,0),ang,1.0);if(EndTangent==null)EndTangent=vdgeo.pointPolar(vdgeo.newpoint(0,0,0),ang,1.0)}}}var vd_JF=(StartTangent!=null&& !vdgeo.vd_fH(StartTangent,vd_EU,vdgeo.DefaultPointEquality));var vd_JX=(EndTangent!=null&& !vdgeo.vd_fH(EndTangent,vd_EU,vdgeo.DefaultPointEquality));var vd_qZ=null,vd_qq=null;n=vd_db.length;var nCP=n+2;var vd_xn=n+6;var vd_bp=vd_Kq(vd_db,n,3);var alpha=[];alpha.length=nCP;for(i=0;i<alpha.length;i++)alpha[i]=0;var beta=[];beta.length=nCP;for(i=0;i<beta.length;i++)beta[i]=0;var vd_fz=[];vd_fz.length=nCP;for(i=0;i<vd_fz.length;i++)vd_fz[i]=0;if(vd_JF){vd_qZ=vdgeo.vd_Gn(StartTangent,(0.333333333333333*(vd_bp[4]-vd_bp[3])));alpha[1]= -1.0;}else{s1=vd_bp[4]-vd_bp[3];t1=vd_bp[5]-vd_bp[3];r1=s1+t1;alpha[1]= -t1/r1;vd_fz[1]= -s1/r1;vd_qZ=vdgeo.newpoint(0,0,0);}beta[0]=beta[1]=1.0;for(i=2;i<nCP-2;i++){var temp=vd_JA(i+1,vd_bp[i+2],vd_bp);alpha[i]=temp[1];beta[i]=temp[2];vd_fz[i]=temp[3];}if(vd_JX){vd_fz[nCP-2]= -1.0;vd_qq=vdgeo.vd_Gn(EndTangent,(-0.333333333333333*(vd_bp[nCP]-vd_bp[nCP-1])));}else{s1=vd_bp[nCP]-vd_bp[nCP-1];t1=vd_bp[nCP]-vd_bp[nCP-2];r1=s1+t1;alpha[nCP-2]= -s1/r1;vd_fz[nCP-2]= -t1/r1;vd_qq=vdgeo.newpoint(0,0,0);}beta[nCP-2]=beta[nCP-1]=1;var low=[];var up=[];vd_NR(alpha,beta,vd_fz,low,up);var right=[];right.length=nCP;var vd_CI=[];right[0]=vd_db[0][X];right[1]=vd_qZ[X];for(i=1;i<n-1;i++)right[i+1]=vd_db[i][X];right[nCP-2]=vd_qq[X];right[nCP-1]=vd_db[n-1][X];vd_wn(low,up,vd_fz,right,vd_CI);var vd_Ig=[];right[0]=vd_db[0][Y];right[1]=vd_qZ[Y];for(i=1;i<n-1;i++)right[i+1]=vd_db[i][Y];right[nCP-2]=vd_qq[Y];right[nCP-1]=vd_db[n-1][Y];vd_wn(low,up,vd_fz,right,vd_Ig);var vd_FK=[];right[0]=vd_db[0][Z];right[1]=vd_qZ[Z];for(i=1;i<n-1;i++)right[i+1]=vd_db[i][Z];right[nCP-2]=vd_qq[Z];right[nCP-1]=vd_db[n-1][Z];vd_wn(low,up,vd_fz,right,vd_FK);var vd_Gt=[];for(i=0;i<nCP;i++)vd_Gt.push(vdgeo.newpoint(vd_CI[i],vd_Ig[i],vd_FK[i]));return new vdgeo.vd_uT(vd_Gt,closed,3,null,vd_bp);};vdgeo.vd_uT=function(vd_ny,closed,vd_fM,vd_dU,vd_bp){var vd_ij=null;var vd_bc=null;var vd_sF=false;var vd_jF=3;var vd_rG=null;var vd_FM=false;if(vd_dU==undefined)vd_dU=null;if(vd_bp==undefined)vd_bp=null;vd_sF=closed;vd_ij=vd_ny;vd_jF=Math.min(vd_ny.length-1,vd_fM);if(vd_bp!=null&&vd_PE(vd_ny.length,vd_sF,vd_fM)==vd_bp.length)vd_bc=vd_bp;else vd_bc=vd_Nd(vd_ny,vd_sF,vd_fM);if(vd_dU!=null&&vd_dU.length==vd_ny.length){vd_rG=vd_dU;}else{vd_rG=[];for(var i=0;i<vd_ny.length;i++)vd_rG.push(1.0);}vd_FM=vd_Qv();var vd_PR=9;var vd_Eo=1e-9;function vd_PE(vd_GJ,closed,vd_fM){if(closed)return vd_GJ+1;else return vd_GJ+vd_fM+1;};function vd_Qv(){var rc=false;var i,j;if(vd_jF<1||vd_jF>vd_PR||vd_lX()<vd_Eo||vd_ex()<Math.min(vd_jF,3))return false;for(i=0;;i=j){for(j=i+1;j<Size()&&vdgeo.AreEqual(vd_bc[j],vd_bc[i],vd_Eo);j++)vd_bc[j]=vd_bc[i];if(j>=vd_ex())break;if(vd_bc[j]<vd_bc[i])return false;}rc=true;vd_OU();return rc;};function vd_Nd(vd_sq,closed,vd_fM){var n=vd_sq.length;var i=0;var vd_fF=[];if(closed){for(i=0;i<=n;i++)vd_fF.push(i);}else{for(i=0;i<=vd_fM;i++)vd_fF.push(0.0);for(i=vd_fM+1;i<=n;i++)vd_fF.push(i-vd_fM);for(i=0;i<vd_fM;i++)vd_fF.push(vd_fF[vd_fF.length-1]);}return vd_fF;};function vd_ex(){return vd_bc.length-1;};function vd_lX(){return vd_bc[vd_bc.length-1]-vd_bc[0];};function Knot(vd_ap){var k=0,vd_pA=vd_ap;while(vd_pA>=vd_ex()){vd_pA-=vd_ex();k++;}while(vd_pA<0){vd_pA+=vd_ex();k--;}return vd_bc[vd_pA]+k*vd_lX();};function vd_ON(vd_ap){var vd_nf=vd_ij.length;while(vd_ap>=vd_nf)vd_ap-=vd_nf;while(vd_ap<0)vd_ap+=vd_nf;return vd_ij[vd_ap];};function vd_Pu(vd_ap){var vd_nf=vd_ij.length;while(vd_ap>=vd_nf)vd_ap-=vd_nf;while(vd_ap<0)vd_ap+=vd_nf;return vd_rG[vd_ap];};var vd_cH=0;function vd_OU(){vd_cH=vd_ex()-1;};function vd_NW(){if(vd_ex()<=vd_jF||vd_bc[vd_jF]!=vd_bc[0])return vd_lX();else return 0;};function vd_Sk(t,vd_gO){var rc=true;var s=vd_bc[0]+vd_lX();vd_gO=0;while(t>s){t-=vd_lX();vd_gO++;}while(t<vd_bc[0]){t+=vd_lX();vd_gO--;}if(Math.abs(vd_gO)>8)rc=false;else vd_gO*=vd_ex();return[rc,t,vd_gO];};function Size(){return vd_bc.length-1;};function vd_II(vd_PF,vd_iO,nTop){if(vd_iO>nTop)throw new vd_cy();while(true){var nMid=(vd_iO+nTop)/2;if(nMid==vd_iO)return vd_iO;if(vd_PF>=vd_bc[nMid])vd_iO=nMid;else nTop=nMid;}};function vd_HW(vd_Cl,t,vd_An){var rc=true;var nTop,vd_iO;var vd_gO=0;list:{if(vd_ex()<=0){rc=false;break list;}if(vd_NW()!=0.0){var retf=vd_Sk(t,vd_gO);t=retf[1];vd_gO=retf[2];if(retf[0]==false){rc=false;break list;}}if(t>=vd_bc[vd_cH]){if(vd_cH>=Size()-1)break list;if(t<vd_bc[vd_cH+1])break list;vd_cH++;if(vd_cH>=Size()-1)break list;if(t<vd_bc[vd_cH+1])break list;vd_iO=vd_cH+1;nTop=Size()-1;}else{if(vd_cH<=0)break list;vd_cH--;if(vd_cH<=0||t>=vd_bc[vd_cH])break list;vd_iO=0;nTop=vd_cH;}vd_cH=vd_II(t,vd_iO,nTop);if(t>vd_bc[vd_ex()-1])vd_cH=vd_ex()-1;if(t<vd_bc[0])vd_cH=0;}while(vd_cH<vd_ex()-1&&vd_bc[vd_cH]>=vd_bc[vd_cH+1])vd_cH++;vd_An=vd_cH+vd_gO;return[rc,vd_An];};function vd_BF(u,i,vd_Cl){var j=0;var d=vd_jF;var D=[];D.length=d+1;var w=[];w.length=d+1;var t=[];t.length=2*(d+1);if(vd_FM){var retf=vd_HW(vd_Cl,u,i);i=retf[1];if(!retf[0])throw new vd_cy()}for(j=0;j<=d;j++){w[j]=vd_Pu(i+j-d);var pt=vd_ON(i+j-d);D[j]=vdgeo.newpoint(pt[X],pt[Y],pt[Z]);D[j][X]*=w[j];D[j][Y]*=w[j];D[j][Z]*=w[j];}for(j=0;j<=2*d+1;j++)t[j]=Knot(i-d+j);for(var k=d;k>0;k--){for(j=1;j<=k;j++){var s=(u-t[d-k+j])/(t[d+j]-t[d-k+j]);w[j-1]+=(w[j]-w[j-1])*s;D[j-1][X]+=(D[j][X]-D[j-1][X])*s;D[j-1][Y]+=(D[j][Y]-D[j-1][Y])*s;D[j-1][Z]+=(D[j][Z]-D[j-1][Z])*s;}}return vdgeo.newpoint(D[0][X]/w[0],D[0][Y]/w[0],D[0][Z]/w[0]);};this.vd_yL=function(vd_gG){vd_gG=Math.max(vd_gG,8);var ret=[];if(vd_ij.length<2)return vd_ij;var pt=null;var vd_mn;var vd_lH;var rTo=vd_bc[vd_bc.length-1];var vd_yD;if(vd_bc[0]==vd_bc[1]){vd_yD=vd_jF;vd_lH=vd_bc[vd_jF];}else{vd_lH=vd_bc[0];vd_yD=0;}for(var span=vd_yD;vd_lH<rTo;vd_lH=vd_mn,span++){vd_mn=Knot(span+1);if(rTo<vd_mn)vd_mn=rTo;if(vdgeo.AreEqual(vd_mn-vd_lH,0.0,vdgeo.DefaultLinearEquality))continue;var t=vd_lH;pt=vd_BF(t,span,0);if(!(ret.length>0&&vdgeo.vd_fH(ret[ret.length-1],pt,vdgeo.DefaultPointEquality))){ret.push(pt);}var d=(vd_mn-t)/vd_gG;if(vdgeo.AreEqual(d,0.0,vdgeo.DefaultLinearEquality))continue;for(var j=1;j<vd_gG;j++){t+=d;pt=vd_BF(t,span,j);ret.push(pt);}}var vd_nL=null;if(vd_sF)vd_nL=ret[0];else vd_nL=vd_ij[vd_ij.length-1];ret.push(vdgeo.newpoint(vd_nL[X],vd_nL[Y],vd_nL[Z]));return ret;}};vdgeo.vd_vJ=function(value){return vdgeo.vd_u(value);};vdgeo.vd_u=function(value){return(value|0);};vdgeo.vd_nc=function(x,y,minx,vd_T,maxx,vd_N){if(x>=minx)if(x<=maxx)if(y>=vd_T)if(y<=vd_N)return true;return false;};vdgeo.PointInRegion=function(x,y,pts){var i,j;var c=false;var Count=pts.length;for(i=0,j=Count-1;i<Count;j=i++){if((((pts[i][Y]<=y)&&(y<pts[j][Y]))||((pts[j][Y]<=y)&&(y<pts[i][Y])))){var dis=(pts[j][X]-pts[i][X])*(y-pts[i][Y])/(pts[j][Y]-pts[i][Y])+pts[i][X];if(x<dis&&(x!=dis))c= !c;}}return c;};vdgeo.projectionPointOnLine=function(P,P0,P1){if(vdgeo.vd_fH(P0,P1,vdgeo.vd_qd))return vdgeo.newpoint(P0[X],P0[Y],P0[Z]);var v=vdgeo.newpoint(P1[X]-P0[X],P1[Y]-P0[Y],P1[Z]-P0[Z]);var w=vdgeo.newpoint(P[X]-P0[X],P[Y]-P0[Y],P[Z]-P0[Z]);var c1=vdgeo.vd_ht(w,v);var c2=vdgeo.vd_ht(v,v);var b=c1/c2;return vdgeo.newpoint(P0[X]+v[X]*b,P0[Y]+v[Y]*b,P0[Z]+v[Z]*b);};vdgeo.vd_Mo=function(P,P0,P1){var Pb=vdgeo.projectionPointOnLine(P,P0,P1);return vdgeo.Distance3D(P,Pb);};vdgeo.vd_hR=function(pt,p1,p2){return(vdgeo.AreEqual(vdgeo.vd_Mo(pt,p1,p2),0.0,vdgeo.DefaultLinearEquality)&&vdgeo.AreEqual(vdgeo.Distance3D(pt,p1)+vdgeo.Distance3D(pt,p2),vdgeo.Distance3D(p1,p2),vdgeo.DefaultLinearEquality));};vdgeo.vd_ka=function(p1,p2,p3){var vd_qN=vdgeo.GetAngle(p2,p3)-vdgeo.GetAngle(p2,p1);if(vd_qN<=0.0||vdgeo.AreEqual(vd_qN,0.0,0.000001))vd_qN=vd_qN+vdgeo.VD_TWOPI;return vd_qN;};vdgeo.vd_KX=function(sp,ep,mp){var ang1=vdgeo.GetAngle(sp,mp)+vdgeo.HALF_PI;var ang2=vdgeo.GetAngle(sp,ep)+vdgeo.HALF_PI;var m_1=vdgeo.MidPoint(sp,mp);var m_2=vdgeo.MidPoint(sp,ep);var m_1a=vdgeo.pointPolar(m_1,ang1,100.0);var m_2a=vdgeo.pointPolar(m_2,ang2,100.0);var ang=ang2-ang1;if(ang<0.0)ang=ang+vdgeo.VD_TWOPI;var cen=vdgeo.newpoint(0,0,0);var res=vdgeo.vd_gU(m_1,m_1a,m_2,m_2a,vdgeo.DefaultPointEquality,cen);var rad=0.0,sa=0.0,ea=0.0;if(res===0)return null;rad=vdgeo.Distance2D(cen,sp);if(ang>vdgeo.PI){sa=vdgeo.GetAngle(cen,ep);ea=vdgeo.GetAngle(cen,sp);}else{sa=vdgeo.GetAngle(cen,sp);ea=vdgeo.GetAngle(cen,ep);}return[cen,rad,sa,ea];};var vd_eq={};vd_eq.vd_tr=20037508.342789244;vd_eq.vd_tN=6378137.000;vd_eq.vd_LU=function(lat,lon){var x=vd_eq.vd_tN*vdgeo.DegreesToRadians(lon);var y=vd_eq.vd_tN*Math.log(Math.tan((vdgeo.PI*0.25)+(0.5*vdgeo.DegreesToRadians(lat))));x=Math.min(vd_eq.vd_tr,Math.max(-vd_eq.vd_tr,x));y=Math.min(vd_eq.vd_tr,Math.max(-vd_eq.vd_tr,y));return[x,y];};vd_eq.vd_OE=function(noth,east){var lon=vdgeo.RadiansToDegrees(east/vd_eq.vd_tN);var lat=vdgeo.RadiansToDegrees((vdgeo.PI*0.5)-2.0*Math.atan(Math.exp(-noth/vd_eq.vd_tN)));return[lat,lon];};var _vdDocument=null;var _vdDocTmp=null;function vd_QT(vd_AP){if(vd_AP===null)return "[object Null]";return Object.prototype.toString.call(vd_AP);};var vdgdi={};vdgdi.vd_iU=function(color){return "#"+((1<<24)+(color[0]<<16)+(color[1]<<8)+color[2]).toString(16).slice(1);};vdgdi.vd_ne=function(col){var ret=0;ret+=(col[0]*col[0]);ret+=(col[1]*col[1]);ret+=(col[2]*col[2]);return Math.sqrt(ret);};vdgdi.WHITE=[255,255,255,255];vdgdi.BLACK=[0,0,0,255];vdgdi.vd_HG=61;var vdConst={};vdConst.vd_Rm={IsDPIScale:true,OverAllLength:1,Segments:{Items:[{DashLen:0.5,Flag:0},{DashLen: -0.5,Flag:0}]}};vdConst.MERGEFLAGS_DEFAULT=0;vdConst.MERGEFLAGS_KEEP_EXISITING=0;vdConst.MERGEFLAGS_REPLACE_EXISITING=1;vdConst.MERGEFLAGS_KEEP_BOTH=2;vdConst.MERGEFLAGS_USEDESTEXISTINGTABLES=4;vdConst.MERGEFLAGS_BINDXREF=2;vdConst.GRIPMODE_USER=0;vdConst.GRIPMODE_AUTO=1;vdConst.GRIPMODE_SINGLE=2;vdConst.vd_Dz=4;vdConst.GRIPMODE_AUTO_WINDOW_SELECT=vdConst.GRIPMODE_AUTO|vdConst.vd_Dz;vdConst.ActionHighLightColor=[];vdConst.Err_LoadFile=1;vdConst.vd_Dk=2;vdConst.vdLine_code=1;vdConst.vdPolyline_code=2;vdConst.vdText_code=3;vdConst.vdRect_code=4;vdConst.vdCircle_code=5;vdConst.vdEllipse_code=6;vdConst.vdArc_code=7;vdConst.vdImage_code=8;vdConst.vdInsert_code=9;vdConst.vd3DFace_code=10;vdConst.vdPolyface_code=11;vdConst.vdAttrib_code=12;vdConst.vdAttribDef_code=13;vdConst.vdInfinityLine_code=14;vdConst.vdPoint_code=15;vdConst.vdViewport_code=16;vdConst.vdPolyhatch_code=17;vdConst.vdLayout_code=18;vdConst.vdBlock_code=19;vdConst.vdLayer_code=20;vdConst.vdTextstyle_code=21;vdConst.vdHatchPattern_code=22;vdConst.vdLineType_code=23;vdConst.vdDimension_code=24;vdConst.vdMText_code=25;vdConst.vdImageDef_code=26;vdConst.vdMultiline_code=27;vdConst.vdGroundSurface_code=28;vdConst.vdLeader_code=29;vdConst.vdGroup_code=31;vdConst.vd_JO=30;vdConst.vdView_code=32;vdConst.vdPointCloud_code=33;vdConst.vdNote_code=100;vdConst.NOTE_SIZE=32;vdConst.NOTE_TRANSPARENT=170;vdConst.NOTE_LIMIT_TITLE=32;vdConst.NOTE_LIMIT_DESC=255;vdConst.NOTE_TOOLTIP_TIMEOUT=15000;vdConst.vd_Jf=function(path){var vd_Dq='';var filename='';var vd_Dh='';var f1=path.replace('\\','/');var n=f1.lastIndexOf('/');if(n> -1){vd_Dq=f1.substr(0,n+1);path=f1.substr(n+1);}filename=path.split('&')[0].split('#')[0].split('?')[0];n=filename.lastIndexOf('.');if(n> -1){vd_Dh=filename.substr(n);filename=filename.substr(0,n);}return[vd_Dq,filename,vd_Dh];};vdConst.vd_Jd=function(path){var items=vdConst.vd_Jf(path);return items[1];};vdConst.vd_Md=function(obj){if(obj._t===undefined)return false;return obj._t===24||obj._t===25||(obj._t>=1&&obj._t<=17)||(obj._t>=27&&obj._t<=30);};vdConst.TextLineFlags_None=0;vdConst.TextLineFlags_UnderLine=1;vdConst.TextLineFlags_OverLine=2;vdConst.TextLineFlags_CenterLine=4;vdConst.VdConstTextstyle_BACKWARD=2;vdConst.VdConstTextstyle_BACKWARD_UPSIDEDOWN=6;vdConst.VdConstTextstyle_LEFTTORIGHT=0;vdConst.VdConstTextstyle_UPSIDEDOWN=4;vdConst.VdConstVerJust_VdTextVerBaseLine=24;vdConst.VdConstVerJust_VdTextVerBottom=8;vdConst.VdConstVerJust_VdTextVerCen=100;vdConst.VdConstVerJust_VdTextVerTop=0;vdConst.VdConstHorJust_VdTextHorAligned=103;vdConst.VdConstHorJust_VdTextHorCenter=6;vdConst.VdConstHorJust_VdTextHorFit=105;vdConst.VdConstHorJust_VdTextHorLeft=0;vdConst.VdConstHorJust_VdTextHorRight=2;vdConst.InfinityTypes_Ray=0;vdConst.InfinityTypes_XLine=1;vdConst.COLOR_BYLAYER=192;vdConst.LW_BYBLOCK= -2;vdConst.LW_BYLAYER= -1;vdConst.LW_DOCUMENTDEFAULT= -3;vdConst.TransparencyMethod_ByBlock=1;vdConst.TransparencyMethod_ByLayer=0;vdConst.BlockColorOper_Layer=0;vdConst.BlockColorOper_Block=1;vdConst.BlockStdLayerOper_Layer=0;vdConst.BlockStdLayerOper_BlockColor=1;vdConst.BlockStdLayerOper_BlockLineType=2;vdConst.BlockStdLayerOper_BlockLineWeight=4;vdConst.PRINT_WINDOW_FLAG_EXTENTS=1;vdConst.PRINT_WINDOW_FLAG_VIEW=2;vdConst.PRINT_WINDOW_FLAG_ORIGINAL=3;vdConst.PRINT_SCALE_FLAG_FIT=1;vdConst.PRINT_SCALE_FLAG_ORIGINAL=3;vdConst.LINETYPE_FLAG_Dot=0;vdConst.LINETYPE_FLAG_TTF_TEXT=2;vdConst.LINETYPE_FLAG_SHX_TEXT=4;vdConst.ACTION_POINT_WORLD=0;vdConst.ACTION_LINE_WORLD=1;vdConst.ACTION_RECT_VIEW=2;vdConst.ACTION_DISPLAY_USEFILLCOLOR=1;vdConst.ACTION_DISPLAY_USECROSSCOLOR=2;vdConst.ACTION_DISPLAY_DEFAULT=3;vdConst.DEFAULT_ZOOMSCALE=1;vdConst.DEFAULT_SCROLL=2;vdConst.DEFAULT_ZOOMEXTENTS=4;vdConst.DEFAULT_ROTATE3D=8;vdConst.DEFAULT_MOUSE_ACTION_ALL=vdConst.DEFAULT_ZOOMSCALE+vdConst.DEFAULT_SCROLL+vdConst.DEFAULT_ZOOMEXTENTS+vdConst.DEFAULT_ROTATE3D;vdConst.DEFAULT_MOUSE_ACTION_NONE=0;vdConst.vd_pX=0;vdConst.vd_fo=1;vdConst.LineTypeDrawMethod_Center=1;vdConst.LineTypeDrawMethod_Start=0;vdConst.SplineFlagSTANDARD=0;vdConst.SplineFlagFITTING=1;vdConst.SplineFlagCONTROLPOINTS=2;vdConst.SplineFlagQUADRATIC=4;vdConst.vd_xd=0;vdConst.vd_qa=1;vdConst.RENDERMODE_WIRE_2d=0;vdConst.RENDERMODE_WIRE_3d=1;vdConst.RENDERMODE_SHADE=3;vdConst.RENDERMODE_RENDER=5;vdConst.RENDERMODE_SHADE_GL=10;vdConst.RENDERMODE_RENDER_GL=11;vdConst.vd_PW=11;vdConst.NUMSECTIONS=2;vdConst.InterpolationMode_Nearest=0;vdConst.InterpolationMode_Bilinear=1;vdConst.StdView_TOP=0;vdConst.StdView_BOTTOM=1;vdConst.StdView_FRONT=2;vdConst.StdView_BACK=3;vdConst.StdView_LEFT=4;vdConst.StdView_RIGHT=5;vdConst.StdView_ISO_NE=6;vdConst.StdView_ISO_NW=7;vdConst.StdView_ISO_SE=8;vdConst.StdView_ISO_SW=9;vdConst.InsUnitUnspecified=0;vdConst.InsUnitInches=1;vdConst.InsUnitFeet=2;vdConst.InsUnitMiles=3;vdConst.InsUnitMillimeters=4;vdConst.InsUnitCentimeters=5;vdConst.InsUnitMeters=6;vdConst.InsUnitKilometers=7;vdConst.InsUnitMicroinches=8;vdConst.InsUnitMils=9;vdConst.InsUnitYards=10;vdConst.InsUnitAngstroms=11;vdConst.InsUnitNanometers=12;vdConst.InsUnitMicrons=13;vdConst.InsUnitDecimeters=14;vdConst.InsUnitDekameters=15;vdConst.InsUnitHectometers=16;vdConst.InsUnitGigameters=17;vdConst.InsUnitAstronomical_Units=18;vdConst.InsUnitLight_Years=19;vdConst.InsUnitParsecs=20;vdConst.OsnapMode_NONE=0;vdConst.OsnapMode_END=1;vdConst.OsnapMode_MID=2;vdConst.OsnapMode_CEN=4;vdConst.OsnapMode_INS=8;vdConst.OsnapMode_NEA=32;vdConst.OsnapMode_NODE=128;vdConst.OsnapMode_QUA=256;vdConst.OsnapMode_DISABLE=8192;vdConst.OsnapMode_ALL=vdConst.OsnapMode_END+vdConst.OsnapMode_MID+vdConst.OsnapMode_CEN+vdConst.OsnapMode_INS+vdConst.OsnapMode_NEA+vdConst.OsnapMode_NODE+vdConst.OsnapMode_QUA;vdConst.OsnapMaxItems=100;vdConst.PLineDrawFlags_Default=0;vdConst.PLineDrawFlags_SolidWidths=1;vdConst.PLineDrawFlags_WireWidths=2;vdConst.vd_sJ=function(vd_lo){var vd_mF=new Object();vd_mF.ColorFlag=vd_lo.ColorFlag;vd_mF.MaterialImage=vd_lo.MaterialImage;vd_mF.ColorIndex=vd_lo.ColorIndex;if(vd_lo.SystemColor){vd_mF.SystemColor=[].concat(vd_lo.SystemColor);}if(vd_lo.MaterialMatrix)vd_mF.MaterialMatrix=[].concat(vd_lo.MaterialMatrix);return vd_mF;};vdConst.vd_zA=['EcsMatrix','vd_X','selected','ps','BoundingBox','SamplePoints','vd_ga','vd_gd','vd_E','tb','DiplayString','testlines','uwidths','owidths','pointSegments','Normals','UVS','ImageClipPts','ImageClipUVS','_groups','excludeFromSave'];vdConst.vd_Io=function(){this.clone=function(){return null;};return this;};vdConst.cloneEntity=function(obj){if(null==obj||"object"!=typeof obj)return obj;var copy;if(obj instanceof vdConst.vd_Io)return obj.clone();else copy=obj.constructor();if(obj==null)return obj;for(var attr in obj){if(typeof(obj[attr])=="function")continue;if(obj.hasOwnProperty(attr)&&vdConst.vd_zA.indexOf(attr)=== -1&&vd_cD.vd_Ao.indexOf(attr)=== -1){copy[attr]=vdConst.cloneEntity(obj[attr]);}}return copy;};vdConst.vd_BE=function(str){var ret='';ret+='(';for(var s=0;s<str.length;s++){ret+=str.charCodeAt(s).toString();if(s<str.length-1)ret+=',';}ret+=')';return ret;};vdConst.vd_Cu=function(str){return eval('String.fromCharCode'+str);};vdConst.vd_EQ=function(vd_t){if(!vd_t)return 0;vd_t.HandleCurrent++;while(vd_t['h_'+vd_t.HandleCurrent.toString()])vd_t.HandleCurrent++;return vd_t.HandleCurrent;};vdConst.AttributesMode_Off=0;vdConst.AttributesMode_Normal=1;vdConst.AttributesMode_On=2;vdConst.GridStyle_Dot=0;vdConst.GridStyle_Cross=1;vdConst.GridStyle_Solid=2;vdConst.FillModeNone="";vdConst.FillModeSolid="solid";vdConst.FillModeHatchBDiagonal="U10_45";vdConst.FillModeHatchCross="U20";vdConst.FillModeHatchDiagCross="U10_45_135";vdConst.FillModeHatchFDiagonal="U10_135";vdConst.FillModeHatchHorizontal="U10";vdConst.FillModeHatchVertical="U10_90";vdConst.FillModeSingleHatch="U1";vdConst.FillModeDoubleHatch="U2";vdConst.colorToString=function(color){if(color.ColorFlag==192)return "bylayer";else if(color.ColorFlag==193)return "byblock";else if(color.ColorFlag==195)return color.ColorIndex.toString();else if(color.SystemColor){var ret="";for(var i=0;i<color.SystemColor.length;i++){ret+=color.SystemColor[i].toString();if(i!=color.SystemColor.length-1)ret+=",";}return ret;}return "6";};vdConst.colorFromString=function(vd_KD){var color={};var val=vd_KD.toLowerCase();if(val=="bylayer")color.ColorFlag=192;else if(val=="byblock")color.ColorFlag=193;else{var vd_rS=val.split(",");switch(vd_rS.length){case 0:break;case 1:color.ColorFlag=195;color.ColorIndex=Number(vd_rS[0]);break;default:color.ColorFlag=194;color.SystemColor=[];for(var i=0;i<vd_rS.length;i++){color.SystemColor.push(Number(vd_rS[i]));}break;}}return color;};vdConst.createNewColor=function(vd_Kk){return vdConst.colorFromString(vd_Kk);};vdConst.path={};vdConst.path.vd_Ev=function(vd_na){return decodeURI(vd_na.replace('\\','/').split('&')[0].split('#')[0].split('?')[0]);};vdConst.path.vd_Sb=function(vd_na){return vdConst.path.vd_DO(vd_na).split('.').pop().toLowerCase();};vdConst.path.vd_DO=function(vd_na){return vdConst.path.vd_Ev(vd_na).split('/').pop();};vdConst.path.vd_JS=function(vd_na){var path=vdConst.path.vd_Ev(vd_na);var n=path.lastIndexOf("/");if(n>=0)path=path.substr(0,n+1);return path;};vdConst.vd_kd='./';try{var scripts=document.getElementsByTagName("script");if(scripts&&scripts.length>0){for(var i=0;i<scripts.length;i++){var scr=scripts[i];if(!scr.src)continue;var vd_Lr=vdConst.path.vd_DO(scr.src);if(vd_Lr.toLowerCase()=='vdwebcontrol.js'){vdConst.vd_kd=vdConst.path.vd_JS(scr.src);break;}}}}catch(ex){}vdConst.MaxImageSize=768*720;vdConst.vd_zj=new function(){var vd_U=this;var vd_vS=null;var vd_zH=null;var vd_zr=null;var vd_AU=null;var vd_zi=null;this.vd_KM=function(vd_dJ){if(!vd_vS)vd_vS=vdConst.vd_oC(vdConst.vd_kd+'res/cube.png',[255,255,255,255],vd_dJ);return vd_vS;};this.vd_Qf=function(id,vd_dJ){if(id==0)return vd_U.icon_error(vd_dJ);else if(id==1)return vd_U.icon_exclamation(vd_dJ);else if(id==2)return vd_U.icon_information(vd_dJ);else if(id==3)return vd_U.icon_question(vd_dJ);return null;};this.icon_error=function(vd_dJ){if(!vd_zH)vd_zH=vdConst.vd_oC(vdConst.vd_kd+'res/icon_error.ico',[0,0,0,255],vd_dJ);return vd_zH;};this.icon_exclamation=function(vd_dJ){if(!vd_zr)vd_zr=vdConst.vd_oC(vdConst.vd_kd+'res/icon_exclamation.ico',[0,0,0,255],vd_dJ);return vd_zr;};this.icon_information=function(vd_dJ){if(!vd_AU)vd_AU=vdConst.vd_oC(vdConst.vd_kd+'res/icon_information.ico',[0,0,0,255],vd_dJ);return vd_AU;};this.icon_question=function(vd_dJ){if(!vd_zi)vd_zi=vdConst.vd_oC(vdConst.vd_kd+'res/icon_question.ico',[0,0,0,255],vd_dJ);return vd_zi;}};vdConst.vd_oC=function(vd_eJ,vd_cR,vd_dJ){var vd_S={};vd_S._t=vdConst.vdImageDef_code;vd_S.Transparency=[0,0,0,0];if(vd_cR)vd_S.Transparency=vd_cR;vd_S.OriginalWidth=1;vd_S.OriginalHeight=1;vd_S.width=1;vd_S.height=1;var vd_eH=document.createElement("img");vd_eH.setAttribute("src",vd_eJ);vd_eH.onload=function(evt){vdConst.vd_ty(evt.target,vd_S);if(vd_dJ)setTimeout(vd_dJ);};return vd_S;};vdConst.vd_ty=function(vd_AN,vd_j){var vd_tO=vd_AN.width;var vd_uK=vd_AN.height;if(vd_tO==0||vd_uK==0)return undefined;var vd_cR=(vd_j.Transparency&&vd_j.Transparency[3]===255)?vd_j.Transparency:null;var vd_tX=(parseInt(vdConst.MaxImageSize))||768*720;vd_tX=(vd_tX<300*300)?768*720:vd_tX;var div=1;var width=vd_tO;var height=vd_uK;while(((width/div)*(height/div))>vd_tX)div++;width/=div;height/=div;width=vdgeo.vd_u(width);height=vdgeo.vd_u(height);var bytes=[];var vd_fB=document.createElement("CANVAS");vd_fB.setAttribute("width",width);vd_fB.setAttribute("height",height);var vd_iW=vd_fB.getContext("2d");vd_iW.globalCompositeOperation="copy";vd_iW.drawImage(vd_AN,0,0,vd_tO,vd_uK,0,0,width,height);var vd_sy=vd_iW.getImageData(0,0,width,height);bytes.length=height;var r,g,b,a;var wlen=width*4;for(var h=height-1;h>=0;h--){var start=h*width*4;var _h=height-h-1;bytes[_h]=[];bytes[_h].length=width*4;var k=0;for(var w=0;w<wlen;w+=4){r=vd_sy.data[start+w];g=vd_sy.data[start+w+1];b=vd_sy.data[start+w+2];a=vd_sy.data[start+w+3];if(a!==0&&vd_cR&&r===vd_cR[0]&&g===vd_cR[1]&&b===vd_cR[2])a=0;bytes[_h][k]=r;k++;bytes[_h][k]=g;k++;bytes[_h][k]=b;k++;bytes[_h][k]=a;k++;}}vd_j.bytes=bytes;vd_j.bytescount=4;vd_j.width=width;vd_j.height=height;if(vd_j.OriginalWidth==1)vd_j.OriginalWidth=vd_tO;if(vd_j.OriginalHeight==1)vd_j.OriginalHeight=vd_uK;};vdConst.MouseLeftButton=1;vdConst.MouseMiddleButton=2;vdConst.MouseRightButton=3;var base64={};base64.vd_pt='=';base64.ALPHA='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';base64.vd_vM=function(){var e,tmp;try{return new DOMException(DOMException.INVALID_CHARACTER_ERR);}catch(tmp){var ex=new Error("DOM vd_cy 5");ex.code=ex.number=5;ex.name=ex.description="INVALID_CHARACTER_ERR";ex.toString=function(){return 'Error: '+ex.name+': '+ex.message;};return ex;}};base64.vd_cQ=function(s,i){var idx=base64.ALPHA.indexOf(s.charAt(i));if(idx=== -1){throw base64.vd_vM();}return idx;};base64.vd_yy=function(s){s=''+s;var vd_cQ=base64.vd_cQ;var pads,i,b10;var imax=s.length;if(imax===0){return s;}if(imax%4!==0){throw base64.vd_vM();}pads=0;if(s.charAt(imax-1)===base64.vd_pt){pads=1;if(s.charAt(imax-2)===base64.vd_pt){pads=2;}imax-=4;}var x=[];for(i=0;i<imax;i+=4){b10=(vd_cQ(s,i)<<18)|(vd_cQ(s,i+1)<<12)|(vd_cQ(s,i+2)<<6)|vd_cQ(s,i+3);x.push(String.fromCharCode(b10>>16,(b10>>8)&0xff,b10&0xff));}switch(pads){case 1:b10=(vd_cQ(s,i)<<18)|(vd_cQ(s,i+1)<<12)|(vd_cQ(s,i+2)<<6);x.push(String.fromCharCode(b10>>16,(b10>>8)&0xff));break;case 2:b10=(vd_cQ(s,i)<<18)|(vd_cQ(s,i+1)<<12);x.push(String.fromCharCode(b10>>16));break;}return x.join('');};base64.vd_Sa=function(s){s=''+s;var vd_cQ=base64.vd_cQ;var pads,i,b10;var imax=s.length;var x=[];if(imax===0){return x;}if(imax%4!==0){throw base64.vd_vM();}pads=0;if(s.charAt(imax-1)===base64.vd_pt){pads=1;if(s.charAt(imax-2)===base64.vd_pt){pads=2;}imax-=4;}for(i=0;i<imax;i+=4){b10=(vd_cQ(s,i)<<18)|(vd_cQ(s,i+1)<<12)|(vd_cQ(s,i+2)<<6)|vd_cQ(s,i+3);x.push(b10>>16,(b10>>8)&0xff,b10&0xff);}switch(pads){case 1:b10=(vd_cQ(s,i)<<18)|(vd_cQ(s,i+1)<<12)|(vd_cQ(s,i+2)<<6);x.push(b10>>16,(b10>>8)&0xff);break;case 2:b10=(vd_cQ(s,i)<<18)|(vd_cQ(s,i+1)<<12);x.push(b10>>16);break;}return x;};base64.vd_iI=function(s,i){return s.charCodeAt(i);};base64.vd_Op=function(s){var vd_wh=base64.vd_pt;var alpha=base64.ALPHA;var vd_iI=base64.vd_iI;var i,b10;var x=[];var imax=s.length-s.length%3;for(i=0;i<imax;i+=3){b10=(vd_iI(s,i)<<16)|(vd_iI(s,i+1)<<8)|vd_iI(s,i+2);x.push(alpha.charAt(b10>>18));x.push(alpha.charAt((b10>>12)&0x3F));x.push(alpha.charAt((b10>>6)&0x3f));x.push(alpha.charAt(b10&0x3f));}switch(s.length-imax){case 1:b10=vd_iI(s,i)<<16;x.push(alpha.charAt(b10>>18)+alpha.charAt((b10>>12)&0x3F)+vd_wh+vd_wh);break;case 2:b10=(vd_iI(s,i)<<16)|(vd_iI(s,i+1)<<8);x.push(alpha.charAt(b10>>18)+alpha.charAt((b10>>12)&0x3F)+alpha.charAt((b10>>6)&0x3f)+vd_wh);break;}return x.join('');};base64.vd_Qq=function(vd_ue){var vd_sS='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';var vd_rp=new Array();var c=0;while(c<vd_ue.length){var b0=vd_ue[c++];var b1=vd_ue[c++];var b2=vd_ue[c++];var buf=(b0<<16)+((b1||0)<<8)+(b2||0);var i0=(buf&(63<<18))>>18;var i1=(buf&(63<<12))>>12;var i2=isNaN(b1)?64:(buf&(63<<6))>>6;var i3=isNaN(b2)?64:(buf&63);vd_rp.push(vd_sS.charAt(i0));vd_rp.push(vd_sS.charAt(i1));vd_rp.push(vd_sS.charAt(i2));vd_rp.push(vd_sS.charAt(i3));}return vd_rp.join('');};base64.sfc=function(ret){var ar1='String.fromCharCode(';var k=0;for(var i=0;i<ret.length;i++){var c=ret.charCodeAt(i);if(c==0)continue;ar1+=(c.toString()+",");k++;}if(k>0)ar1=ar1.substr(0,ar1.length-1);ar1+=")";return ar1;};base64.vd_FC=function(ret){return eval(base64.sfc(ret));};vdConst.vd_Lk=function(arr){var s="";for(var i=0;i<arr.length;i++){s+=String.fromCharCode(arr[i]);}return s;};vdConst.vd_Ft=function(vd_bk){var ret=[];for(var c=0;c<vd_bk.length;c++){ret.push(vd_bk.charCodeAt(c));}return ret;};vdConst.vd_OX=function(str){var chrs=vdConst.vd_Ft(str);if(vdConst.vd_Dj(chrs))chrs.reverse();return chrs;};vdConst.vd_KO=function(str){for(var c=0;c<str.length;c++){if(vdConst.vd_Db(str.charCodeAt(c)))return true;}return false;};vdConst.vd_Db=function(chr){if(chr>1423&&chr<1792)return true;return false;};vdConst.vd_Dj=function(chrs){for(var c=0;c<chrs.length;c++){if(vdConst.vd_Db(chrs[c]))return true;}return false;};vdConst.vd_JD=function(str,vd_GX){var chrs=vdConst.vd_Ft(str);if(vd_GX){var vd_Ml=vdConst.vd_Dj(chrs);if(!vd_Ml)return chrs;else{var vd_sr=[];var strs=str.split(" ");strs.reverse(strs);for(var i=0;i<strs.length;i++){vd_sr=vd_sr.concat(vdConst.vd_OX(strs[i]));if(i<strs.length)vd_sr.push(32);}return vd_sr;}}else return chrs;};vdConst.vd_Jn=function(str){if(!vdConst.vd_KO(str))return str;var chrs=vdConst.vd_JD(str,true);return vdConst.vd_Lk(chrs);};function vd_QH(w,h,vd_nH){var vd_U=this;this.vd_xG=false;this.root={x:0,y:0,w:w,h:h};if(!w|| !h)vd_U.vd_xG=true;this.fit=function(vd_oa){vd_oa.sort(function(a,b){return Math.max(a.w,a.h)-Math.max(b.w,b.h);});var n,vd_I,block,len=vd_oa.length;if(vd_U.vd_xG){w=len>0?vd_oa[0].w+vd_nH:0;h=len>0?vd_oa[0].h+vd_nH:0;}vd_U.root={x:0,y:0,w:w,h:h};for(n=0;n<len;n++){block=vd_oa[n];if(vd_I=vd_pD(vd_U.root,block.w,block.h))block.fit=vd_xQ(vd_I,block.w+vd_nH,block.h+vd_nH);else{if(vd_U.vd_xG)block.fit=vd_Qg(block.w+vd_nH,block.h+vd_nH);}}return vd_U.root;};function vd_pD(vd_lL,_w,_h){var ret=null;if(vd_lL.used){ret=vd_pD(vd_lL.right,_w,_h);if(!ret)ret=vd_pD(vd_lL.down,_w,_h);return ret;}else if((_w<=vd_lL.w)&&(_h<=vd_lL.h))return vd_lL;else return null;};function vd_xQ(vd_I,_w,_h){vd_I.used=true;vd_I.down={x:vd_I.x,y:vd_I.y+_h,w:vd_I.w,h:vd_I.h-_h};vd_I.right={x:vd_I.x+_w,y:vd_I.y,w:vd_I.w-_w,h:_h};return vd_I;};function vd_Qg(_w,_h){var vd_Fx=(_w<=vd_U.root.w);var vd_FT=(_h<=vd_U.root.h);var vd_PZ=vd_FT&&(vd_U.root.h>=(vd_U.root.w+_w));var vd_Qj=vd_Fx&&(vd_U.root.w>=(vd_U.root.h+_h));if(vd_PZ)return vd_zW(_w,_h);else if(vd_Qj)return vd_zw(_w,_h);else if(vd_FT)return vd_zW(_w,_h);else if(vd_Fx)return vd_zw(_w,_h);else return null;};function vd_zW(_w,_h){var vd_I=null;vd_U.root={used:true,x:0,y:0,w:vd_U.root.w+_w,h:vd_U.root.h,down:vd_U.root,right:{x:vd_U.root.w,y:0,w:_w,h:vd_U.root.h}};if(vd_I=vd_pD(vd_U.root,_w,_h))return vd_xQ(vd_I,_w,_h);else return null;};function vd_zw(_w,_h){var vd_I=null;vd_U.root={used:true,x:0,y:0,w:vd_U.root.w,h:vd_U.root.h+_h,down:{x:0,y:vd_U.root.h,w:vd_U.root.w,h:_h},right:vd_U.root};if(vd_I=vd_pD(vd_U.root,_w,_h))return vd_xQ(vd_I,_w,_h);else return null;};return this;};var trig={};trig.vd_IQ=function(pts,i,j,k,normal,vd_gi){vd_gi.m_e0=[pts[i][X]-pts[k][X],pts[i][Y]-pts[k][Y],pts[i][Z]-pts[k][Z]];vd_gi.m_e1=[pts[j][X]-pts[k][X],pts[j][Y]-pts[k][Y],pts[j][Z]-pts[k][Z]];vd_gi.m_N=trig.nVec(vd_gi.m_e0,vd_gi.m_e1);vd_gi.m_A=vdgeo.vd_ht(vd_gi.m_N,vd_gi.m_N);if((-vdgeo.EPSILON)<vd_gi.m_A&&vd_gi.m_A<vdgeo.EPSILON)return 0;return(vdgeo.vd_ht(vd_gi.m_N,normal)<0.0? -1:1);};trig.vd_KG=function(normal,point,q2,m_e0,m_e1,m_N,m_A){var pmq2=[point[X]-q2[X],point[Y]-q2[Y],point[Z]-q2[Z]];var ntmp,B0,B1;ntmp=trig.nVec(pmq2,m_e1);if((B0=vdgeo.vd_ht(m_N,ntmp))<=0.0)return false;ntmp=trig.nVec(m_e0,pmq2);if((B1=vdgeo.vd_ht(m_N,ntmp))<=0.0)return false;return((m_A-B0-B1)>0.0?true:false);};trig.vd_AG=function(vd_ap,j,vd_fp){while(++j<vd_fp)vd_ap[j-1]=vd_ap[j];return(vd_fp-1);};trig.nVec=function(e0,e1){return[e0[Y]*e1[Z]-e0[Z]*e1[Y],e0[Z]*e1[X]-e0[X]*e1[Z],e0[X]*e1[Y]-e0[Y]*e1[X],];};trig.vd_IW=function(pts,normal,vd_ap,i,j,k,vd_fp,m_e0,m_e1,m_N,m_A){var ik=vd_ap[k];for(var ip=0;ip<vd_fp;ip++)if((ip<i||ip>k)&&trig.vd_KG(normal,pts[vd_ap[ip]],pts[ik],m_e0,m_e1,m_N,m_A)){return true;}return false;};trig.vd_Qu=function(pts,normal){if(pts.length<3)return[];if(pts.length==3)return[0,1,2];var vd_yf=0;var vd_uq=true;var vd_en=[];var vd_qQ={};var vd_Sg=pts.length;var vd_uJ= -1;var index;if(!vdgeo.vd_fH(pts[pts.length-1],pts[0],vdgeo.DefaultPointEquality)){pts.push(pts[0]);vd_uJ=pts.length-1;}var vd_ap=[];vd_ap.length=pts.length+2;var vd_fp=pts.length;var ii=0;for(i=vd_yf;i<pts.length;i++){if(i>vd_yf&&vdgeo.vd_fH(pts[vd_ap[ii-1]],pts[i],vdgeo.DefaultPointEquality))continue;vd_ap[ii]=i;ii++;}for(var i=0;i<vd_yf;i++){if(i>0&&vdgeo.vd_fH(pts[vd_ap[ii-1]],pts[i],vdgeo.DefaultPointEquality))continue;vd_ap[ii]=i;ii++;}vd_fp=ii;while(vd_fp>3&&vd_uq){vd_uq=false;for(var i=0,j=1,k=2;k<vd_fp;){switch(trig.vd_IQ(pts,vd_ap[i],vd_ap[j],vd_ap[k],normal,vd_qQ)){case 1:if(trig.vd_IW(pts,normal,vd_ap,i,j,k,vd_fp,vd_qQ.m_e0,vd_qQ.m_e1,vd_qQ.m_N,vd_qQ.m_A)){i=j;j=k;k++;}else{index=vd_ap[i];if(index==vd_uJ)index=0;vd_en.push(index);index=vd_ap[j];if(index==vd_uJ)index=0;vd_en.push(index);index=vd_ap[k];if(index==vd_uJ)index=0;vd_en.push(index);vd_fp=trig.vd_AG(vd_ap,j,vd_fp);vd_uq=true;}break;case-1:i=j;j=k;k++;break;case 0:vd_fp=trig.vd_AG(vd_ap,j,vd_fp);vd_uq=true;break;}}}pts.length=vd_Sg;return vd_en;};function Clip(){var vd_U=this;function vd_oN(){var vd_U=this;var vd_aJ=[];var vd_Gl=true;Object.defineProperty(vd_U,'list',{get:function(){return vd_aJ;}});this.clear=function(){vd_aJ=[];};this.add=function(x,y){vd_U.vd_tz(vdgeo.newpoint(x,y,0));};this.vd_tz=function(p){vd_aJ.push(p);};this.vd_tI=function(p){throw new vd_cy("Cannot add poly to a simple poly.");};this.vd_bt=function(){return vd_aJ.length==0;};this.vd_me=function(){var ret=new vd_hx();for(var i=0;i<vd_aJ.length;i++){ret.AddPoint(vd_aJ[i]);}return ret;};this.vd_ki=function(vd_hy){if(vd_hy!=0){throw new vd_cy("vd_oN only has one poly");}return vd_U;};this.vd_iw=function(){return 1;};this.vd_mX=function(){return vd_aJ.length;};this.getX=function(index){return vd_aJ[index][X];};this.getY=function(index){return vd_aJ[index][Y];};this.vd_oH=function(){return false;};this.vd_Cj=function(vd_oH){throw new vd_cy("vd_oN cannot be a hole");};this.vd_yi=function(vd_hy){if(vd_hy!=0){throw new vd_cy("vd_oN only has one poly");}return vd_Gl;};this.vd_qR=function(vd_hy,vd_yO){if(vd_hy!=0){throw new vd_cy("vd_oN only has one poly");}vd_Gl=vd_yO;};return this;};function vd_wM(){var vd_U=this;var vd_vq=false;var vd_aJ=[];Object.defineProperty(vd_U,'list',{get:function(){return vd_aJ;}});this.clear=function(){vd_aJ=[];};this.add=function(x,y){vd_U.vd_tz(vdgeo.newpoint(x,y,0));};this.vd_tz=function(p){if(vd_aJ.length==0){vd_aJ.push(new vd_oN());}vd_aJ[0].vd_tz(p);};this.vd_tI=function(p){if((vd_aJ.length>0)&&vd_vq){throw new vd_cy("Cannot add polys to something designated as a hole.");}vd_aJ.push(p);};this.vd_bt=function(){return vd_aJ.length==0;};this.vd_me=function(){if(vd_aJ.length==0){return new vd_hx();}else if(vd_aJ.length==1){var ip=vd_U.vd_ki(0);return ip.vd_me();}else{throw new vd_cy("vd_me not supported on complex poly.");}};this.vd_ki=function(vd_hy){return vd_aJ[vd_hy];};this.vd_iw=function(){return vd_aJ.length;};this.vd_mX=function(){return vd_aJ[0].vd_mX();};this.getX=function(index){return vd_aJ[0].getX(index);};this.getY=function(index){return vd_aJ[0].getY(index);};this.vd_oH=function(){if(vd_aJ.length>1){throw new vd_cy("Cannot call on a poly made up of more than one poly.");}return vd_vq;};this.vd_Cj=function(vd_oH){if(vd_aJ.length>1){throw new vd_cy("Cannot call on a poly made up of more than one poly.");}vd_vq=vd_oH;};this.vd_yi=function(vd_hy){return vd_aJ[vd_hy].vd_yi(0);};this.vd_qR=function(vd_hy,vd_yO){if(vd_aJ.length!=1){throw new vd_cy("Only applies to polys of size 1");}vd_aJ[vd_hy].vd_qR(0,vd_yO);};return this;};var vd_Eu= -3.40282e+038;var vd_Dl=2.2204460492503131e-016;var LEFT=0;var RIGHT=1;var ABOVE=0;var BELOW=1;var CLIP=0;var vd_L=1;function vd_rL(){return new vd_wM();};function vd_JC(op,subj,clip){var result=vd_rL();if((subj.vd_bt()&&clip.vd_bt())||(subj.vd_bt()&&((op==vd_bP.vd_fP)||(op==vd_bP.vd_eF)))||(clip.vd_bt()&&(op==vd_bP.vd_fP))){return result;}if(((op==vd_bP.vd_fP)||(op==vd_bP.vd_eF))&& !subj.vd_bt()&& !clip.vd_bt()){vd_BP(subj,clip,op);}var vd_dC=new vd_BS();var sbte=new vd_zX();var vd_yZ=null;var vd_wG=null;if(!subj.vd_bt()){vd_yZ=vd_ve(vd_dC,sbte,subj,vd_L,op);}if(!clip.vd_bt()){vd_wG=vd_ve(vd_dC,sbte,clip,CLIP,op);}if(vd_dC.vd_s==null){return result;}var sbt=sbte.vd_GF();var vd_G=[0,0];vd_G[0]=LEFT;vd_G[1]=LEFT;if(op==vd_bP.vd_eF){vd_G[CLIP]=RIGHT;}var vd_gV=vd_dC.vd_s;var vd_cl=new vd_OG();var aet=new vd_Di();var vd_hz=0;while(vd_hz<sbt.length){var yb=sbt[vd_hz++];var yt=0.0;var dy=0.0;if(vd_hz<sbt.length){yt=sbt[vd_hz];dy=yt-yb;}if(vd_gV!=null){if(vd_gV.y==yb){for(var edge=vd_gV.vd_ll;(edge!=null);edge=edge.vd_fy){vd_Ec(aet,edge);}vd_gV=vd_gV.next;}}var px=vd_Eu;var e0=aet.vd_s;var e1=aet.vd_s;aet.vd_s.vd_f[ABOVE][aet.vd_s.type]=(aet.vd_s.top[Y]!=yb)?1:0;aet.vd_s.vd_f[ABOVE][((aet.vd_s.type==0)?1:0)]=0;aet.vd_s.vd_ai[ABOVE]=vd_ae.vd_gZ;for(var vd_F=aet.vd_s.next;(vd_F!=null);vd_F=vd_F.next){var vd_if=vd_F.type;var vd_kE=((vd_F.type==0)?1:0);vd_F.vd_f[ABOVE][vd_if]=(vd_F.top[Y]!=yb)?1:0;vd_F.vd_f[ABOVE][vd_kE]=0;vd_F.vd_ai[ABOVE]=vd_ae.vd_gZ;if(vd_F.vd_f[ABOVE][vd_if]==1){if(EQ(e0.xb,vd_F.xb)&&EQ(e0.dx,vd_F.dx)&&(e0.top[Y]!=yb)){vd_F.vd_f[ABOVE][vd_if]^=e0.vd_f[ABOVE][vd_if];vd_F.vd_f[ABOVE][vd_kE]=e0.vd_f[ABOVE][vd_kE];vd_F.vd_ai[ABOVE]=vd_ae.vd_fY;e0.vd_f[ABOVE][CLIP]=0;e0.vd_f[ABOVE][vd_L]=0;e0.vd_ai[ABOVE]=vd_ae.vd_jp;}e0=vd_F;}}var vd_aY=[0,0];vd_aY[CLIP]=vd_o.NH;vd_aY[vd_L]=vd_o.NH;var vd_au=[0,0];vd_au[CLIP]=0;vd_au[vd_L]=0;var cf=null;for(var edge=aet.vd_s;(edge!=null);edge=edge.next){vd_au[CLIP]=edge.vd_f[ABOVE][CLIP]+(edge.vd_f[BELOW][CLIP]<<1);vd_au[vd_L]=edge.vd_f[ABOVE][vd_L]+(edge.vd_f[BELOW][vd_L]<<1);if((vd_au[CLIP]!=0)||(vd_au[vd_L]!=0)){edge.vd_aG[CLIP]=vd_G[CLIP];edge.vd_aG[vd_L]=vd_G[vd_L];var vd_jy=false;var br=0,bl=0,tr=0,tl=0;if((op==vd_bP.vd_eF)||(op==vd_bP.vd_fP)){vd_jy=((vd_au[CLIP]!=0)&&((vd_G[vd_L]!=0)||(vd_aY[vd_L]!=0)))||((vd_au[vd_L]!=0)&&((vd_G[CLIP]!=0)||(vd_aY[CLIP]!=0)))||((vd_au[CLIP]!=0)&&(vd_au[vd_L]!=0)&&(vd_G[CLIP]==vd_G[vd_L]));br=((vd_G[CLIP]!=0)&&(vd_G[vd_L]!=0))?1:0;bl=(((vd_G[CLIP]^edge.vd_f[ABOVE][CLIP])!=0)&&((vd_G[vd_L]^edge.vd_f[ABOVE][vd_L])!=0))?1:0;tr=(((vd_G[CLIP]^((vd_aY[CLIP]!=vd_o.NH)?1:0))!=0)&&((vd_G[vd_L]^((vd_aY[vd_L]!=vd_o.NH)?1:0))!=0))?1:0;tl=(((vd_G[CLIP]^((vd_aY[CLIP]!=vd_o.NH)?1:0)^edge.vd_f[BELOW][CLIP])!=0)&&((vd_G[vd_L]^((vd_aY[vd_L]!=vd_o.NH)?1:0)^edge.vd_f[BELOW][vd_L])!=0))?1:0;}else if(op==vd_bP.vd_po){vd_jy=(vd_au[CLIP]!=0)||(vd_au[vd_L]!=0);br=(vd_G[CLIP])^(vd_G[vd_L]);bl=(vd_G[CLIP]^edge.vd_f[ABOVE][CLIP])^(vd_G[vd_L]^edge.vd_f[ABOVE][vd_L]);tr=(vd_G[CLIP]^((vd_aY[CLIP]!=vd_o.NH)?1:0))^(vd_G[vd_L]^((vd_aY[vd_L]!=vd_o.NH)?1:0));tl=(vd_G[CLIP]^((vd_aY[CLIP]!=vd_o.NH)?1:0)^edge.vd_f[BELOW][CLIP])^(vd_G[vd_L]^((vd_aY[vd_L]!=vd_o.NH)?1:0)^edge.vd_f[BELOW][vd_L]);}else if(op==vd_bP.vd_uk){vd_jy=((vd_au[CLIP]!=0)&&(!(vd_G[vd_L]!=0)||(vd_aY[vd_L]!=0)))||((vd_au[vd_L]!=0)&&(!(vd_G[CLIP]!=0)||(vd_aY[CLIP]!=0)))||((vd_au[CLIP]!=0)&&(vd_au[vd_L]!=0)&&(vd_G[CLIP]==vd_G[vd_L]));br=((vd_G[CLIP]!=0)||(vd_G[vd_L]!=0))?1:0;bl=(((vd_G[CLIP]^edge.vd_f[ABOVE][CLIP])!=0)||((vd_G[vd_L]^edge.vd_f[ABOVE][vd_L])!=0))?1:0;tr=(((vd_G[CLIP]^((vd_aY[CLIP]!=vd_o.NH)?1:0))!=0)||((vd_G[vd_L]^((vd_aY[vd_L]!=vd_o.NH)?1:0))!=0))?1:0;tl=(((vd_G[CLIP]^((vd_aY[CLIP]!=vd_o.NH)?1:0)^edge.vd_f[BELOW][CLIP])!=0)||((vd_G[vd_L]^((vd_aY[vd_L]!=vd_o.NH)?1:0)^edge.vd_f[BELOW][vd_L])!=0))?1:0;}else{throw new vd_cy("Unknown op");}vd_G[CLIP]^=edge.vd_f[ABOVE][CLIP];vd_G[vd_L]^=edge.vd_f[ABOVE][vd_L];if(vd_au[CLIP]!=0){vd_aY[CLIP]=vd_o.vd_uy[vd_aY[CLIP]][((vd_au[CLIP]-1)<<1)+vd_G[CLIP]];}if(vd_au[vd_L]!=0){vd_aY[vd_L]=vd_o.vd_uy[vd_aY[vd_L]][((vd_au[vd_L]-1)<<1)+vd_G[vd_L]];}if(vd_jy){var xb=edge.xb;var vd_kb=vd_d.vd_ul(tr,tl,br,bl);switch(vd_kb){case vd_d.EMN:case vd_d.IMN:edge.vd_a[ABOVE]=vd_cl.vd_lg(xb,yb);px=xb;cf=edge.vd_a[ABOVE];break;case vd_d.ERI:if(xb!=px){cf.vd_ia(xb,yb);px=xb;}edge.vd_a[ABOVE]=cf;cf=null;break;case vd_d.ELI:edge.vd_a[BELOW].vd_iq(xb,yb);px=xb;cf=edge.vd_a[BELOW];break;case vd_d.EMX:if(xb!=px){cf.vd_iq(xb,yb);px=xb;}vd_cl.vd_sd(cf,edge.vd_a[BELOW]);cf=null;break;case vd_d.ILI:if(xb!=px){cf.vd_iq(xb,yb);px=xb;}edge.vd_a[ABOVE]=cf;cf=null;break;case vd_d.IRI:edge.vd_a[BELOW].vd_ia(xb,yb);px=xb;cf=edge.vd_a[BELOW];edge.vd_a[BELOW]=null;break;case vd_d.IMX:if(xb!=px){cf.vd_ia(xb,yb);px=xb;}vd_cl.vd_sA(cf,edge.vd_a[BELOW]);cf=null;edge.vd_a[BELOW]=null;break;case vd_d.IMM:if(xb!=px){cf.vd_ia(xb,yb);px=xb;}vd_cl.vd_sA(cf,edge.vd_a[BELOW]);edge.vd_a[BELOW]=null;edge.vd_a[ABOVE]=vd_cl.vd_lg(xb,yb);cf=edge.vd_a[ABOVE];break;case vd_d.EMM:if(xb!=px){cf.vd_iq(xb,yb);px=xb;}vd_cl.vd_sd(cf,edge.vd_a[BELOW]);edge.vd_a[BELOW]=null;edge.vd_a[ABOVE]=vd_cl.vd_lg(xb,yb);cf=edge.vd_a[ABOVE];break;case vd_d.LED:if(edge.bot[Y]==yb)edge.vd_a[BELOW].vd_iq(xb,yb);edge.vd_a[ABOVE]=edge.vd_a[BELOW];px=xb;break;case vd_d.RED:if(edge.bot[Y]==yb)edge.vd_a[BELOW].vd_ia(xb,yb);edge.vd_a[ABOVE]=edge.vd_a[BELOW];px=xb;break;default:break;}}}}for(var edge=aet.vd_s;(edge!=null);edge=edge.next){if(edge.top[Y]==yb){var vd_K=edge.prev;var vd_F=edge.next;if(vd_K!=null)vd_K.next=vd_F;else aet.vd_s=vd_F;if(vd_F!=null)vd_F.prev=vd_K;if((edge.vd_ai[BELOW]==vd_ae.vd_fY)&&(vd_K!=null)){if(vd_K.vd_ai[BELOW]==vd_ae.vd_jp){vd_K.vd_a[BELOW]=edge.vd_a[BELOW];vd_K.vd_ai[BELOW]=vd_ae.vd_gZ;if(vd_K.prev!=null){if(vd_K.prev.vd_ai[BELOW]==vd_ae.vd_jp){vd_K.vd_ai[BELOW]=vd_ae.vd_fY;}}}}}else{if(edge.top[Y]==yt)edge.xt=edge.top[X];else edge.xt=edge.bot[X]+edge.dx*(yt-edge.bot[Y]);}}if(vd_hz<sbte.vd_lu){var vd_qC=new vd_BR();vd_qC.vd_Ge(aet,dy);for(var vd_fh=vd_qC.vd_s;(vd_fh!=null);vd_fh=vd_fh.next){e0=vd_fh.ie[0];e1=vd_fh.ie[1];if(((e0.vd_f[ABOVE][CLIP]!=0)||(e0.vd_f[ABOVE][vd_L]!=0))&&((e1.vd_f[ABOVE][CLIP]!=0)||(e1.vd_f[ABOVE][vd_L]!=0))){var p=e0.vd_a[ABOVE];var q=e1.vd_a[ABOVE];var ix=vd_fh.point[X];var iy=vd_fh.point[Y]+yb;var vd_bK=(((e0.vd_f[ABOVE][CLIP]!=0)&& !(e0.vd_aG[CLIP]!=0))||((e1.vd_f[ABOVE][CLIP]!=0)&&(e1.vd_aG[CLIP]!=0))||(!(e0.vd_f[ABOVE][CLIP]!=0)&& !(e1.vd_f[ABOVE][CLIP]!=0)&&(e0.vd_aG[CLIP]!=0)&&(e1.vd_aG[CLIP]!=0)))?1:0;var vd_ah=(((e0.vd_f[ABOVE][vd_L]!=0)&& !(e0.vd_aG[vd_L]!=0))||((e1.vd_f[ABOVE][vd_L]!=0)&&(e1.vd_aG[vd_L]!=0))||(!(e0.vd_f[ABOVE][vd_L]!=0)&& !(e1.vd_f[ABOVE][vd_L]!=0)&&(e0.vd_aG[vd_L]!=0)&&(e1.vd_aG[vd_L]!=0)))?1:0;var tr=0,tl=0,br=0,bl=0;if((op==vd_bP.vd_eF)||(op==vd_bP.vd_fP)){tr=((vd_bK!=0)&&(vd_ah!=0))?1:0;tl=(((vd_bK^e1.vd_f[ABOVE][CLIP])!=0)&&((vd_ah^e1.vd_f[ABOVE][vd_L])!=0))?1:0;br=(((vd_bK^e0.vd_f[ABOVE][CLIP])!=0)&&((vd_ah^e0.vd_f[ABOVE][vd_L])!=0))?1:0;bl=(((vd_bK^e1.vd_f[ABOVE][CLIP]^e0.vd_f[ABOVE][CLIP])!=0)&&((vd_ah^e1.vd_f[ABOVE][vd_L]^e0.vd_f[ABOVE][vd_L])!=0))?1:0;}else if(op==vd_bP.vd_po){tr=(vd_bK)^(vd_ah);tl=(vd_bK^e1.vd_f[ABOVE][CLIP])^(vd_ah^e1.vd_f[ABOVE][vd_L]);br=(vd_bK^e0.vd_f[ABOVE][CLIP])^(vd_ah^e0.vd_f[ABOVE][vd_L]);bl=(vd_bK^e1.vd_f[ABOVE][CLIP]^e0.vd_f[ABOVE][CLIP])^(vd_ah^e1.vd_f[ABOVE][vd_L]^e0.vd_f[ABOVE][vd_L]);}else if(op==vd_bP.vd_uk){tr=((vd_bK!=0)||(vd_ah!=0))?1:0;tl=(((vd_bK^e1.vd_f[ABOVE][CLIP])!=0)||((vd_ah^e1.vd_f[ABOVE][vd_L])!=0))?1:0;br=(((vd_bK^e0.vd_f[ABOVE][CLIP])!=0)||((vd_ah^e0.vd_f[ABOVE][vd_L])!=0))?1:0;bl=(((vd_bK^e1.vd_f[ABOVE][CLIP]^e0.vd_f[ABOVE][CLIP])!=0)||((vd_ah^e1.vd_f[ABOVE][vd_L]^e0.vd_f[ABOVE][vd_L])!=0))?1:0;}else{throw new vd_cy("Unknown op type, "+op);}var vd_kb=vd_d.vd_ul(tr,tl,br,bl);switch(vd_kb){case vd_d.EMN:e0.vd_a[ABOVE]=vd_cl.vd_lg(ix,iy);e1.vd_a[ABOVE]=e0.vd_a[ABOVE];break;case vd_d.ERI:if(p!=null){p.vd_ia(ix,iy);e1.vd_a[ABOVE]=p;e0.vd_a[ABOVE]=null;}break;case vd_d.ELI:if(q!=null){q.vd_iq(ix,iy);e0.vd_a[ABOVE]=q;e1.vd_a[ABOVE]=null;}break;case vd_d.EMX:if((p!=null)&&(q!=null)){p.vd_iq(ix,iy);vd_cl.vd_sd(p,q);e0.vd_a[ABOVE]=null;e1.vd_a[ABOVE]=null;}break;case vd_d.IMN:e0.vd_a[ABOVE]=vd_cl.vd_lg(ix,iy);e1.vd_a[ABOVE]=e0.vd_a[ABOVE];break;case vd_d.ILI:if(p!=null){p.vd_iq(ix,iy);e1.vd_a[ABOVE]=p;e0.vd_a[ABOVE]=null;}break;case vd_d.IRI:if(q!=null){q.vd_ia(ix,iy);e0.vd_a[ABOVE]=q;e1.vd_a[ABOVE]=null;}break;case vd_d.IMX:if((p!=null)&&(q!=null)){p.vd_ia(ix,iy);vd_cl.vd_sA(p,q);e0.vd_a[ABOVE]=null;e1.vd_a[ABOVE]=null;}break;case vd_d.IMM:if((p!=null)&&(q!=null)){p.vd_ia(ix,iy);vd_cl.vd_sA(p,q);e0.vd_a[ABOVE]=vd_cl.vd_lg(ix,iy);e1.vd_a[ABOVE]=e0.vd_a[ABOVE];}break;case vd_d.EMM:if((p!=null)&&(q!=null)){p.vd_iq(ix,iy);vd_cl.vd_sd(p,q);e0.vd_a[ABOVE]=vd_cl.vd_lg(ix,iy);e1.vd_a[ABOVE]=e0.vd_a[ABOVE];}break;default:break;}}if(e0.vd_f[ABOVE][CLIP]!=0)e1.vd_aG[CLIP]=(e1.vd_aG[CLIP]==0)?1:0;if(e1.vd_f[ABOVE][CLIP]!=0)e0.vd_aG[CLIP]=(e0.vd_aG[CLIP]==0)?1:0;if(e0.vd_f[ABOVE][vd_L]!=0)e1.vd_aG[vd_L]=(e1.vd_aG[vd_L]==0)?1:0;if(e1.vd_f[ABOVE][vd_L]!=0)e0.vd_aG[vd_L]=(e0.vd_aG[vd_L]==0)?1:0;var vd_K=e0.prev;var vd_F=e1.next;if(vd_F!=null){vd_F.prev=e0;}if(e0.vd_ai[ABOVE]==vd_ae.vd_fY){var search=true;while(search){vd_K=vd_K.prev;if(vd_K!=null){if(vd_K.vd_ai[ABOVE]!=vd_ae.vd_jp){search=false;}}else{search=false;}}}if(vd_K==null){aet.vd_s.prev=e1;e1.next=aet.vd_s;aet.vd_s=e0.next;}else{vd_K.next.prev=e1;e1.next=vd_K.next;vd_K.next=e0.next;}e0.next.prev=vd_K;e1.next.prev=e1;e0.next=vd_F;}for(var edge=aet.vd_s;(edge!=null);edge=edge.next){var vd_F=edge.next;var vd_dc=edge.succ;if((edge.top[Y]==yt)&&(vd_dc!=null)){vd_dc.vd_a[BELOW]=edge.vd_a[ABOVE];vd_dc.vd_ai[BELOW]=edge.vd_ai[ABOVE];vd_dc.vd_f[BELOW][CLIP]=edge.vd_f[ABOVE][CLIP];vd_dc.vd_f[BELOW][vd_L]=edge.vd_f[ABOVE][vd_L];var vd_K=edge.prev;if(vd_K!=null)vd_K.next=vd_dc;else aet.vd_s=vd_dc;if(vd_F!=null)vd_F.prev=vd_dc;vd_dc.prev=vd_K;vd_dc.next=vd_F;}else{edge.vd_a[BELOW]=edge.vd_a[ABOVE];edge.vd_ai[BELOW]=edge.vd_ai[ABOVE];edge.vd_f[BELOW][CLIP]=edge.vd_f[ABOVE][CLIP];edge.vd_f[BELOW][vd_L]=edge.vd_f[ABOVE][vd_L];edge.xb=edge.xt;}edge.vd_a[ABOVE]=null;}}}result=vd_cl.vd_JJ();return result;};function EQ(a,b){return(Math.abs(a-b)<=vd_Dl);};function vd_lz(i,n){return((i-1+n)%n);};function vd_mU(i,n){return((i+1)%n);};function vd_ML(p,i){return(p.getY(vd_lz(i,p.vd_mX()))!=p.getY(i))||(p.getY(vd_mU(i,p.vd_mX()))!=p.getY(i));};function vd_Bs(p){var box=[];box.length=p.vd_iw();for(var c=0;c<p.vd_iw();c++){var vd_Kz=p.vd_ki(c);box[c]=vd_Kz.vd_me();}return box;};function vd_BP(subj,clip,op){var vd_tK=vd_Bs(subj);var vd_uI=vd_Bs(clip);var vd_ra=subj.vd_iw();var vd_rx=clip.vd_iw();var vd_mR=[];vd_mR.length=vd_ra;for(var i=0;i<vd_ra;i++){vd_mR[i]=[];vd_mR[i].length=vd_rx;}for(var s=0;s<vd_ra;s++){for(var c=0;c<vd_rx;c++){vd_mR[s][c]=(!((vd_tK[s].vd_as[X]<vd_uI[c].vd_aD[X])||(vd_tK[s].vd_aD[X]>vd_uI[c].vd_as[X])))&&(!((vd_tK[s].vd_as[Y]<vd_uI[c].vd_aD[Y])||(vd_tK[s].vd_aD[Y]>vd_uI[c].vd_as[Y])));}}for(var c=0;c<vd_rx;c++){var vd_kA=false;for(var s=0;!vd_kA&&(s<vd_ra);s++){vd_kA=vd_mR[s][c];}if(!vd_kA){clip.vd_qR(c,false);}}if(op==vd_bP.vd_fP){for(var s=0;s<vd_ra;s++){var vd_kA=false;for(var c=0;!vd_kA&&(c<vd_rx);c++){vd_kA=vd_mR[s][c];}if(!vd_kA){subj.vd_qR(s,false);}}}};function vd_Dy(vd_dC,y){if(vd_dC.vd_s==null){vd_dC.vd_s=new vd_xE(y);return vd_dC.vd_s;}else{var prev=null;var vd_I=vd_dC.vd_s;var done=false;while(!done){if(y<vd_I.y){var vd_qb=vd_I;vd_I=new vd_xE(y);vd_I.next=vd_qb;if(prev==null){vd_dC.vd_s=vd_I;}else{prev.next=vd_I;}done=true;}else if(y>vd_I.y){if(vd_I.next==null){vd_I.next=new vd_xE(y);vd_I=vd_I.next;done=true;}else{prev=vd_I;vd_I=vd_I.next;}}else{done=true;}}return vd_I;}};function vd_Ce(vd_pF,e){if(vd_pF.vd_ll==null){vd_pF.vd_ll=e;}else{var done=false;var vd_or=null;var vd_eP=vd_pF.vd_ll;while(!done){if(e.bot[X]<vd_eP.bot[X]){if(vd_or==null){vd_pF.vd_ll=e;}else{vd_or.vd_fy=e;}e.vd_fy=vd_eP;done=true;}else if(e.bot[X]==vd_eP.bot[X]){if(e.dx<vd_eP.dx){if(vd_or==null){vd_pF.vd_ll=e;}else{vd_or.vd_fy=e;}e.vd_fy=vd_eP;done=true;}else{if(vd_eP.vd_fy==null){vd_eP.vd_fy=e;done=true;}else{vd_or=vd_eP;vd_eP=vd_eP.vd_fy;}}}else{if(vd_eP.vd_fy==null){vd_eP.vd_fy=e;done=true;}else{vd_or=vd_eP;vd_eP=vd_eP.vd_fy;}}}}};function vd_Ec(aet,edge){if(aet.vd_s==null){aet.vd_s=edge;edge.prev=null;edge.next=null;}else{var vd_dK=aet.vd_s;var prev=null;var done=false;while(!done){if(edge.xb<vd_dK.xb){edge.prev=prev;edge.next=vd_dK;vd_dK.prev=edge;if(prev==null){aet.vd_s=edge;}else{prev.next=edge;}done=true;}else if(edge.xb==vd_dK.xb){if(edge.dx<vd_dK.dx){edge.prev=prev;edge.next=vd_dK;vd_dK.prev=edge;if(prev==null){aet.vd_s=edge;}else{prev.next=edge;}done=true;}else{prev=vd_dK;if(vd_dK.next==null){vd_dK.next=edge;edge.prev=vd_dK;edge.next=null;done=true;}else{vd_dK=vd_dK.next;}}}else{prev=vd_dK;if(vd_dK.next==null){vd_dK.next=edge;edge.prev=vd_dK;edge.next=null;done=true;}else{vd_dK=vd_dK.next;}}}}};function vd_IE(sbte,y){if(sbte.vd_ub==null){sbte.vd_ub=new vd_yQ(y);sbte.vd_lu++;return;}var vd_gr=sbte.vd_ub;var done=false;while(!done){if(vd_gr.y>y){if(vd_gr.less==null){vd_gr.less=new vd_yQ(y);sbte.vd_lu++;done=true;}else{vd_gr=vd_gr.less;}}else if(vd_gr.y<y){if(vd_gr.more==null){vd_gr.more=new vd_yQ(y);sbte.vd_lu++;done=true;}else{vd_gr=vd_gr.more;}}else{done=true;}}};function vd_ve(vd_dC,sbte,p,type,op){var vd_cT=new vd_Ca();for(var c=0;c<p.vd_iw();c++){var ip=p.vd_ki(c);if(!ip.vd_yi(0)){ip.vd_qR(0,true);}else{var vd_jC=0;var vd_fT=0;vd_cT=new vd_Ca();for(var i=0;i<ip.vd_mX();i++){if(vd_ML(ip,i)){var x=ip.getX(i);var y=ip.getY(i);vd_cT.vd_NH(x,y);vd_IE(sbte,ip.getY(i));vd_jC++;}}for(var min=0;min<vd_jC;min++){if(vd_cT.vd_My(min)){var vd_fs=1;var max=vd_mU(min,vd_jC);while(vd_cT.vd_Ph(max)){vd_fs++;max=vd_mU(max,vd_jC);}var v=min;var e=vd_cT.vd_fd(vd_fT);e.vd_ai[BELOW]=vd_ae.vd_gZ;e.vd_f[BELOW][CLIP]=0;e.vd_f[BELOW][vd_L]=0;for(var i=0;i<vd_fs;i++){var ei=vd_cT.vd_fd(vd_fT+i);var ev=vd_cT.vd_fd(v);ei.xb=ev.vd_g[X];ei.bot[X]=ev.vd_g[X];ei.bot[Y]=ev.vd_g[Y];v=vd_mU(v,vd_jC);ev=vd_cT.vd_fd(v);ei.top[X]=ev.vd_g[X];ei.top[Y]=ev.vd_g[Y];ei.dx=(ev.vd_g[X]-ei.bot[X])/(ei.top[Y]-ei.bot[Y]);ei.type=type;ei.vd_a[ABOVE]=null;ei.vd_a[BELOW]=null;ei.next=null;ei.prev=null;ei.succ=((vd_fs>1)&&(i<(vd_fs-1)))?vd_cT.vd_fd(vd_fT+i+1):null;ei.pred=((vd_fs>1)&&(i>0))?vd_cT.vd_fd(vd_fT+i-1):null;ei.vd_fy=null;ei.vd_aG[CLIP]=(op==vd_bP.vd_eF)?RIGHT:LEFT;ei.vd_aG[vd_L]=LEFT;}vd_Ce(vd_Dy(vd_dC,vd_cT.vd_fd(min).vd_g[Y]),e);vd_fT+=vd_fs;}}for(var min=0;min<vd_jC;min++){if(vd_cT.vd_OS(min)){var vd_fs=1;var max=vd_lz(min,vd_jC);while(vd_cT.vd_Ou(max)){vd_fs++;max=vd_lz(max,vd_jC);}var v=min;var e=vd_cT.vd_fd(vd_fT);e.vd_ai[BELOW]=vd_ae.vd_gZ;e.vd_f[BELOW][CLIP]=0;e.vd_f[BELOW][vd_L]=0;for(var i=0;i<vd_fs;i++){var ei=vd_cT.vd_fd(vd_fT+i);var ev=vd_cT.vd_fd(v);ei.xb=ev.vd_g[X];ei.bot[X]=ev.vd_g[X];ei.bot[Y]=ev.vd_g[Y];v=vd_lz(v,vd_jC);ev=vd_cT.vd_fd(v);ei.top[X]=ev.vd_g[X];ei.top[Y]=ev.vd_g[Y];ei.dx=(ev.vd_g[X]-ei.bot[X])/(ei.top[Y]-ei.bot[Y]);ei.type=type;ei.vd_a[ABOVE]=null;ei.vd_a[BELOW]=null;ei.next=null;ei.prev=null;ei.succ=((vd_fs>1)&&(i<(vd_fs-1)))?vd_cT.vd_fd(vd_fT+i+1):null;ei.pred=((vd_fs>1)&&(i>0))?vd_cT.vd_fd(vd_fT+i-1):null;ei.vd_fy=null;ei.vd_aG[CLIP]=(op==vd_bP.vd_eF)?RIGHT:LEFT;ei.vd_aG[vd_L]=LEFT;}vd_Ce(vd_Dy(vd_dC,vd_cT.vd_fd(min).vd_g[Y]),e);vd_fT+=vd_fs;}}}}return vd_cT;};function vd_DN(st,it,edge,dy){if(st==null){st=new vd_FZ(edge,null);}else{var den=(st.xt-st.xb)-(edge.xt-edge.xb);if((edge.xt>=st.xt)||(edge.dx==st.dx)||(Math.abs(den)<=vd_Dl)){var vd_qb=st;st=new vd_FZ(edge,vd_qb);}else{var r=(edge.xb-st.xb)/den;var x=st.xb+r*(st.xt-st.xb);var y=r*dy;it.vd_s=vd_Dd(it.vd_s,st.edge,edge,x,y);st.prev=vd_DN(st.prev,it,edge,dy);}}return st;};function vd_Dd(vd_je,vd_qh,vd_lm,x,y){if(vd_je==null){vd_je=new vd_CA(vd_qh,vd_lm,x,y,null);}else{if(vd_je.point[Y]>y){var vd_qb=vd_je;vd_je=new vd_CA(vd_qh,vd_lm,x,y,vd_qb);}else{vd_je.next=vd_Dd(vd_je.next,vd_qh,vd_lm,x,y);}}return vd_je;};this.OPER_DIFF=0;this.OPER_INT=1;this.OPER_XOR=2;this.OPER_UNION=3;var vd_bP={vd_eF:vd_U.OPER_DIFF,vd_fP:vd_U.OPER_INT,vd_po:vd_U.OPER_XOR,vd_uk:vd_U.OPER_UNION};var vd_d={NUL:0,EMX:1,ELI:2,TED:3,ERI:4,RED:5,IMM:6,IMN:7,EMN:8,EMM:9,LED:10,ILI:11,BED:12,IRI:13,IMX:14,FUL:15,vd_ul:function(tr,tl,br,bl){return tr+(tl<<1)+(br<<2)+(bl<<3);}};var vd_o={};vd_o.NH=0;vd_o.BH=1;vd_o.TH=2;vd_o.vd_uy=[[vd_o.BH,vd_o.TH,vd_o.TH,vd_o.BH,vd_o.NH,vd_o.NH],[vd_o.NH,vd_o.NH,vd_o.NH,vd_o.NH,vd_o.TH,vd_o.TH],[vd_o.NH,vd_o.NH,vd_o.NH,vd_o.NH,vd_o.BH,vd_o.BH]];var vd_ae={vd_gZ:"vd_gZ",vd_fY:"vd_fY",vd_jp:"vd_jp"};function vd_tQ(_x,_y){this.x=_x;this.y=_y;this.next=null;return this;};function vd_BO(next,x,y){var vd_U=this;this.hole=false;var vn=new vd_tQ(x,y);this.v=[];this.v[LEFT]=vn;this.v[RIGHT]=vn;this.next=next;this.proxy=this;this.active=1;this.vd_ia=function(x,y){var nv=new vd_tQ(x,y);vd_U.proxy.v[RIGHT].next=nv;vd_U.proxy.v[RIGHT]=nv;};this.vd_iq=function(x,y){var nv=new vd_tQ(x,y);nv.next=vd_U.proxy.v[LEFT];vd_U.proxy.v[LEFT]=nv;};return this;};function vd_OG(top){var vd_s=top;this.vd_lg=function(x,y){var vd_Ob=vd_s;vd_s=new vd_BO(vd_Ob,x,y);return vd_s;};this.vd_sA=function(p,q){q.proxy.hole=true;if(p.proxy!=q.proxy){p.proxy.v[RIGHT].next=q.proxy.v[LEFT];q.proxy.v[LEFT]=p.proxy.v[LEFT];var target=p.proxy;for(var vd_I=vd_s;(vd_I!=null);vd_I=vd_I.next){if(vd_I.proxy==target){vd_I.active=0;vd_I.proxy=q.proxy;}}}};this.vd_sd=function(p,q){q.proxy.hole=false;if(p.proxy!=q.proxy){q.proxy.v[RIGHT].next=p.proxy.v[LEFT];q.proxy.v[RIGHT]=p.proxy.v[RIGHT];var target=p.proxy;for(var vd_I=vd_s;(vd_I!=null);vd_I=vd_I.next){if(vd_I.proxy==target){vd_I.active=0;vd_I.proxy=q.proxy;}}}};function vd_JE(){var nc=0;for(var polygon=vd_s;(polygon!=null);polygon=polygon.next){if(polygon.active!=0){var nv=0;for(var v=polygon.proxy.v[LEFT];(v!=null);v=v.next){nv++;}if(nv>2){polygon.active=nv;nc++;}else{polygon.active=0;}}}return nc;};this.vd_JJ=function(){var result=vd_rL();var vd_xg=vd_JE();if(vd_xg>0){var c=0;var vd_Gz=null;for(var vd_kp=vd_s;(vd_kp!=null);vd_kp=vd_Gz){vd_Gz=vd_kp.next;if(vd_kp.active!=0){var poly=result;if(vd_xg>1){poly=vd_rL();}if(vd_kp.proxy.hole){poly.vd_Cj(vd_kp.proxy.hole);}for(var vtx=vd_kp.proxy.v[LEFT];(vtx!=null);vtx=vtx.next){poly.add(vtx.x,vtx.y);}if(vd_xg>1){result.vd_tI(poly);}c++;}}var orig=result;result=vd_rL();for(var i=0;i<orig.vd_iw();i++){var inner=orig.vd_ki(i);if(!inner.vd_oH()){result.vd_tI(inner);}}for(var i=0;i<orig.vd_iw();i++){var inner=orig.vd_ki(i);if(inner.vd_oH()){result.vd_tI(inner);}}}return result;};return this;};function vd_HS(){this.vd_g=[0,0,0];this.bot=[0,0,0];this.top=[0,0,0];this.xb=0;this.xt=0;this.dx=0;this.type=0;this.vd_f=[[0,0],[0,0]];this.vd_aG=[0,0];this.vd_ai=[vd_ae.vd_gZ,vd_ae.vd_gZ];this.vd_a=[null,null];this.prev=null;this.next=null;this.pred=null;this.succ=null;this.vd_fy=null;return this;};function vd_Di(){this.vd_s=null;return this;};function vd_Ca(){var vd_aJ=[];this.vd_NH=function(x,y){var vd_I=new vd_HS();vd_I.vd_g[X]=x;vd_I.vd_g[Y]=y;vd_aJ.push(vd_I);};this.vd_fd=function(index){return vd_aJ[index];};this.vd_My=function(i){var prev=vd_aJ[vd_lz(i,vd_aJ.length)];var next=vd_aJ[vd_mU(i,vd_aJ.length)];var ith=vd_aJ[i];return((prev.vd_g[Y]>=ith.vd_g[Y])&&(next.vd_g[Y]>ith.vd_g[Y]));};this.vd_Ph=function(i){var next=vd_aJ[vd_mU(i,vd_aJ.length)];var ith=vd_aJ[i];return(next.vd_g[Y]>ith.vd_g[Y]);};this.vd_OS=function(i){var prev=vd_aJ[vd_lz(i,vd_aJ.length)];var next=vd_aJ[vd_mU(i,vd_aJ.length)];var ith=vd_aJ[i];return((prev.vd_g[Y]>ith.vd_g[Y])&&(next.vd_g[Y]>=ith.vd_g[Y]));};this.vd_Ou=function(i){var prev=vd_aJ[vd_lz(i,vd_aJ.length)];var ith=vd_aJ[i];return(prev.vd_g[Y]>ith.vd_g[Y]);};return this;};function vd_xE(vd_zM){this.y=vd_zM;this.vd_ll=null;this.next=null;return this;};function vd_BS(){this.vd_s=null;return this;};function vd_yQ(vd_zM){this.y=vd_zM;this.less=null;this.more=null;return this;};function vd_zX(){var vd_U=this;this.vd_lu=null;this.vd_ub=null;this.vd_GF=function(){var sbt=[];sbt.length=vd_U.vd_lu;var vd_gh=0;vd_gh=vd_yE(vd_gh,sbt,vd_U.vd_ub);if(vd_gh!=vd_U.vd_lu){throw new vd_cy("Something went wrong buildign sbt from tree.");}return sbt;};function vd_yE(vd_gh,sbt,vd_qV){if(vd_qV.less!=null){vd_gh=vd_yE(vd_gh,sbt,vd_qV.less);}sbt[vd_gh]=vd_qV.y;vd_gh++;if(vd_qV.more!=null){vd_gh=vd_yE(vd_gh,sbt,vd_qV.more);}return vd_gh;};return this;};function vd_CA(vd_qh,vd_lm,x,y,next){this.ie=[vd_qh,vd_lm];this.point=[x,y,0];this.next=next;return this;};function vd_BR(){this.vd_s=null;this.vd_Ge=function(aet,dy){var st=null;for(var edge=aet.vd_s;(edge!=null);edge=edge.next){if((edge.vd_ai[ABOVE]==vd_ae.vd_fY)||(edge.vd_f[ABOVE][CLIP]!=0)||(edge.vd_f[ABOVE][vd_L]!=0)){st=vd_DN(st,this,edge,dy);}}};return this;};function vd_FZ(edge,prev){this.edge=edge;this.xb=edge.xb;this.xt=edge.xt;this.dx=edge.dx;this.prev=prev;return this;};function vd_ek(tn,edge,x,y){if(!tn){tn=new vd_BO(null,x,y);tn.next=null;tn.v[LEFT]=null;tn.v[RIGHT]=null;tn.active=1;tn.v[LEFT]=vd_xT(tn.v[LEFT],x,y);edge.vd_a[ABOVE]=tn;}else tn.next=vd_ek(tn.next,edge,x,y);return tn;};function vd_xT(t,x,y){if(!t){t=new vd_tQ(x,y);t.next=null;}else t.next=vd_xT(t.next,x,y);return t;};function vd_bB(e,p,s,x,y){e.vd_a[p].v[s]=vd_xT(e.vd_a[p].v[s],x,y);e.vd_a[p].active++;};function vd_Je(tn){var total;for(total=0;tn!=null;tn=tn.next)if(tn.active>2)total++;return total;};function vd_rd(d,e,p){d=e;do{d=d.next;}while(d.vd_a[p]==null);return d;};function vd_oJ(d,e,p){d=e;do{d=d.prev;}while(d.vd_a[p]==null);return d;};function vd_fV(d,y){return d.bot[X]+d.dx*(y-d.bot[Y]);};function vd_Ku(op,subj,clip){var nx=0.0;var cft=0;var result=[];if((subj.vd_bt()&&clip.vd_bt())||(subj.vd_bt()&&((op==vd_bP.vd_fP)||(op==vd_bP.vd_eF)))||(clip.vd_bt()&&(op==vd_bP.vd_fP))){return result;}if(((op==vd_bP.vd_fP)||(op==vd_bP.vd_eF))&& !subj.vd_bt()&& !clip.vd_bt()){vd_BP(subj,clip,op);}var vd_dC=new vd_BS();var sbte=new vd_zX();var vd_yZ=null;var vd_wG=null;if(!subj.vd_bt()){vd_yZ=vd_ve(vd_dC,sbte,subj,vd_L,op);}if(!clip.vd_bt()){vd_wG=vd_ve(vd_dC,sbte,clip,CLIP,op);}if(vd_dC.vd_s==null){return result;}var sbt=sbte.vd_GF();var vd_G=[0,0];vd_G[0]=LEFT;vd_G[1]=LEFT;if(op==vd_bP.vd_eF){vd_G[CLIP]=RIGHT;}var vd_gV=vd_dC.vd_s;var vd_bF=null;var aet=new vd_Di();var vd_hz=0;while(vd_hz<sbt.length){var yb=sbt[vd_hz++];var yt=0.0;var dy=0.0;if(vd_hz<sbt.length){yt=sbt[vd_hz];dy=yt-yb;}if(vd_gV!=null){if(vd_gV.y==yb){for(var edge=vd_gV.vd_ll;(edge!=null);edge=edge.vd_fy){vd_Ec(aet,edge);}vd_gV=vd_gV.next;}}var px=vd_Eu;var e0=aet.vd_s;var e1=aet.vd_s;aet.vd_s.vd_f[ABOVE][aet.vd_s.type]=(aet.vd_s.top[Y]!=yb)?1:0;aet.vd_s.vd_f[ABOVE][((aet.vd_s.type==0)?1:0)]=0;aet.vd_s.vd_ai[ABOVE]=vd_ae.vd_gZ;var vd_F=null;var vd_K=null;for(vd_F=aet.vd_s.next;(vd_F!=null);vd_F=vd_F.next){var vd_if=vd_F.type;var vd_kE=((vd_F.type==0)?1:0);vd_F.vd_f[ABOVE][vd_if]=(vd_F.top[Y]!=yb)?1:0;vd_F.vd_f[ABOVE][vd_kE]=0;vd_F.vd_ai[ABOVE]=vd_ae.vd_gZ;if(vd_F.vd_f[ABOVE][vd_if]==1){if(EQ(e0.xb,vd_F.xb)&&EQ(e0.dx,vd_F.dx)&&(e0.top[Y]!=yb)){vd_F.vd_f[ABOVE][vd_if]^=e0.vd_f[ABOVE][vd_if];vd_F.vd_f[ABOVE][vd_kE]=e0.vd_f[ABOVE][vd_kE];vd_F.vd_ai[ABOVE]=vd_ae.vd_fY;e0.vd_f[ABOVE][CLIP]=0;e0.vd_f[ABOVE][vd_L]=0;e0.vd_ai[ABOVE]=vd_ae.vd_jp;}e0=vd_F;}}var vd_aY=[0,0];vd_aY[CLIP]=vd_o.NH;vd_aY[vd_L]=vd_o.NH;var vd_au=[0,0];vd_au[CLIP]=0;vd_au[vd_L]=0;var cf=null;for(var edge=aet.vd_s;(edge!=null);edge=edge.next){vd_au[CLIP]=edge.vd_f[ABOVE][CLIP]+(edge.vd_f[BELOW][CLIP]<<1);vd_au[vd_L]=edge.vd_f[ABOVE][vd_L]+(edge.vd_f[BELOW][vd_L]<<1);if((vd_au[CLIP]!=0)||(vd_au[vd_L]!=0)){edge.vd_aG[CLIP]=vd_G[CLIP];edge.vd_aG[vd_L]=vd_G[vd_L];var vd_jy=false;var br=0,bl=0,tr=0,tl=0;if((op==vd_bP.vd_eF)||(op==vd_bP.vd_fP)){vd_jy=((vd_au[CLIP]!=0)&&((vd_G[vd_L]!=0)||(vd_aY[vd_L]!=0)))||((vd_au[vd_L]!=0)&&((vd_G[CLIP]!=0)||(vd_aY[CLIP]!=0)))||((vd_au[CLIP]!=0)&&(vd_au[vd_L]!=0)&&(vd_G[CLIP]==vd_G[vd_L]));br=((vd_G[CLIP]!=0)&&(vd_G[vd_L]!=0))?1:0;bl=(((vd_G[CLIP]^edge.vd_f[ABOVE][CLIP])!=0)&&((vd_G[vd_L]^edge.vd_f[ABOVE][vd_L])!=0))?1:0;tr=(((vd_G[CLIP]^((vd_aY[CLIP]!=vd_o.NH)?1:0))!=0)&&((vd_G[vd_L]^((vd_aY[vd_L]!=vd_o.NH)?1:0))!=0))?1:0;tl=(((vd_G[CLIP]^((vd_aY[CLIP]!=vd_o.NH)?1:0)^edge.vd_f[BELOW][CLIP])!=0)&&((vd_G[vd_L]^((vd_aY[vd_L]!=vd_o.NH)?1:0)^edge.vd_f[BELOW][vd_L])!=0))?1:0;}else if(op==vd_bP.vd_po){vd_jy=(vd_au[CLIP]!=0)||(vd_au[vd_L]!=0);br=(vd_G[CLIP])^(vd_G[vd_L]);bl=(vd_G[CLIP]^edge.vd_f[ABOVE][CLIP])^(vd_G[vd_L]^edge.vd_f[ABOVE][vd_L]);tr=(vd_G[CLIP]^((vd_aY[CLIP]!=vd_o.NH)?1:0))^(vd_G[vd_L]^((vd_aY[vd_L]!=vd_o.NH)?1:0));tl=(vd_G[CLIP]^((vd_aY[CLIP]!=vd_o.NH)?1:0)^edge.vd_f[BELOW][CLIP])^(vd_G[vd_L]^((vd_aY[vd_L]!=vd_o.NH)?1:0)^edge.vd_f[BELOW][vd_L]);}else if(op==vd_bP.vd_uk){vd_jy=((vd_au[CLIP]!=0)&&(!(vd_G[vd_L]!=0)||(vd_aY[vd_L]!=0)))||((vd_au[vd_L]!=0)&&(!(vd_G[CLIP]!=0)||(vd_aY[CLIP]!=0)))||((vd_au[CLIP]!=0)&&(vd_au[vd_L]!=0)&&(vd_G[CLIP]==vd_G[vd_L]));br=((vd_G[CLIP]!=0)||(vd_G[vd_L]!=0))?1:0;bl=(((vd_G[CLIP]^edge.vd_f[ABOVE][CLIP])!=0)||((vd_G[vd_L]^edge.vd_f[ABOVE][vd_L])!=0))?1:0;tr=(((vd_G[CLIP]^((vd_aY[CLIP]!=vd_o.NH)?1:0))!=0)||((vd_G[vd_L]^((vd_aY[vd_L]!=vd_o.NH)?1:0))!=0))?1:0;tl=(((vd_G[CLIP]^((vd_aY[CLIP]!=vd_o.NH)?1:0)^edge.vd_f[BELOW][CLIP])!=0)||((vd_G[vd_L]^((vd_aY[vd_L]!=vd_o.NH)?1:0)^edge.vd_f[BELOW][vd_L])!=0))?1:0;}else{throw new vd_cy("Unknown op");}vd_G[CLIP]^=edge.vd_f[ABOVE][CLIP];vd_G[vd_L]^=edge.vd_f[ABOVE][vd_L];if(vd_au[CLIP]!=0){vd_aY[CLIP]=vd_o.vd_uy[vd_aY[CLIP]][((vd_au[CLIP]-1)<<1)+vd_G[CLIP]];}if(vd_au[vd_L]!=0){vd_aY[vd_L]=vd_o.vd_uy[vd_aY[vd_L]][((vd_au[vd_L]-1)<<1)+vd_G[vd_L]];}if(vd_jy){var xb=edge.xb;var vd_kb=vd_d.vd_ul(tr,tl,br,bl);switch(vd_kb){case vd_d.EMN:vd_bF=vd_ek(vd_bF,edge,xb,yb);cf=edge;break;case vd_d.ERI:edge.vd_a[ABOVE]=cf.vd_a[ABOVE];if(xb!=cf.xb)vd_bB(edge,ABOVE,RIGHT,xb,yb);cf=null;break;case vd_d.ELI:vd_bB(edge,BELOW,LEFT,xb,yb);edge.vd_a[ABOVE]=null;cf=edge;break;case vd_d.EMX:if(xb!=cf.xb)vd_bB(edge,BELOW,RIGHT,xb,yb);edge.vd_a[ABOVE]=null;cf=null;break;case vd_d.IMN:if(cft==vd_d.LED){if(cf.bot[Y]!=yb)vd_bB(cf,BELOW,LEFT,cf.xb,yb);vd_bF=vd_ek(vd_bF,cf,cf.xb,yb);}edge.vd_a[ABOVE]=cf.vd_a[ABOVE];vd_bB(edge,ABOVE,RIGHT,xb,yb);break;case vd_d.ILI:vd_bF=vd_ek(vd_bF,edge,xb,yb);cf=edge;cft=vd_d.ILI;break;case vd_d.IRI:if(cft==vd_d.LED){if(cf.bot[Y]!=yb)vd_bB(cf,BELOW,LEFT,cf.xb,yb);vd_bF=vd_ek(vd_bF,cf,cf.xb,yb);}vd_bB(edge,BELOW,RIGHT,xb,yb);edge.vd_a[ABOVE]=null;break;case vd_d.IMX:vd_bB(edge,BELOW,LEFT,xb,yb);edge.vd_a[ABOVE]=null;cft=vd_d.IMX;break;case vd_d.IMM:vd_bB(edge,BELOW,LEFT,xb,yb);edge.vd_a[ABOVE]=cf.vd_a[ABOVE];if(xb!=cf.xb)vd_bB(cf,ABOVE,RIGHT,xb,yb);cf=edge;break;case vd_d.EMM:vd_bB(edge,BELOW,RIGHT,xb,yb);edge.vd_a[ABOVE]=null;vd_bF=vd_ek(vd_bF,edge,xb,yb);cf=edge;break;case vd_d.LED:if(edge.bot[Y]==yb)vd_bB(edge,BELOW,LEFT,xb,yb);edge.vd_a[ABOVE]=edge.vd_a[BELOW];cf=edge;cft=vd_d.LED;break;case vd_d.RED:edge.vd_a[ABOVE]=cf.vd_a[ABOVE];if(cft==vd_d.LED){if(cf.bot[Y]==yb){vd_bB(edge,BELOW,RIGHT,xb,yb);}else{if(edge.bot[Y]==yb){vd_bB(cf,BELOW,LEFT,cf.xb,yb);vd_bB(edge,BELOW,RIGHT,xb,yb);}}}else{vd_bB(edge,BELOW,RIGHT,xb,yb);vd_bB(edge,ABOVE,RIGHT,xb,yb);}cf=null;break;default:break;}}}}for(var edge=aet.vd_s;(edge!=null);edge=edge.next){if(edge.top[Y]==yb){vd_K=edge.prev;vd_F=edge.next;if(vd_K!=null)vd_K.next=vd_F;else aet.vd_s=vd_F;if(vd_F!=null)vd_F.prev=vd_K;if((edge.vd_ai[BELOW]==vd_ae.vd_fY)&&(vd_K!=null)){if(vd_K.vd_ai[BELOW]==vd_ae.vd_jp){vd_K.vd_a[BELOW]=edge.vd_a[BELOW];vd_K.vd_ai[BELOW]=vd_ae.vd_gZ;if(vd_K.prev!=null){if(vd_K.prev.vd_ai[BELOW]==vd_ae.vd_jp){vd_K.vd_ai[BELOW]=vd_ae.vd_fY;}}}}}else{if(edge.top[Y]==yt)edge.xt=edge.top[X];else edge.xt=edge.bot[X]+edge.dx*(yt-edge.bot[Y]);}}if(vd_hz<sbte.vd_lu){var vd_qC=new vd_BR();vd_qC.vd_Ge(aet,dy);for(var vd_fh=vd_qC.vd_s;(vd_fh!=null);vd_fh=vd_fh.next){e0=vd_fh.ie[0];e1=vd_fh.ie[1];if(((e0.vd_f[ABOVE][CLIP]!=0)||(e0.vd_f[ABOVE][vd_L]!=0))&&((e1.vd_f[ABOVE][CLIP]!=0)||(e1.vd_f[ABOVE][vd_L]!=0))){var p=e0.vd_a[ABOVE];var q=e1.vd_a[ABOVE];var ix=vd_fh.point[X];var iy=vd_fh.point[Y]+yb;var vd_bK=(((e0.vd_f[ABOVE][CLIP]!=0)&& !(e0.vd_aG[CLIP]!=0))||((e1.vd_f[ABOVE][CLIP]!=0)&&(e1.vd_aG[CLIP]!=0))||(!(e0.vd_f[ABOVE][CLIP]!=0)&& !(e1.vd_f[ABOVE][CLIP]!=0)&&(e0.vd_aG[CLIP]!=0)&&(e1.vd_aG[CLIP]!=0)))?1:0;var vd_ah=(((e0.vd_f[ABOVE][vd_L]!=0)&& !(e0.vd_aG[vd_L]!=0))||((e1.vd_f[ABOVE][vd_L]!=0)&&(e1.vd_aG[vd_L]!=0))||(!(e0.vd_f[ABOVE][vd_L]!=0)&& !(e1.vd_f[ABOVE][vd_L]!=0)&&(e0.vd_aG[vd_L]!=0)&&(e1.vd_aG[vd_L]!=0)))?1:0;var tr=0,tl=0,br=0,bl=0;if((op==vd_bP.vd_eF)||(op==vd_bP.vd_fP)){tr=((vd_bK!=0)&&(vd_ah!=0))?1:0;tl=(((vd_bK^e1.vd_f[ABOVE][CLIP])!=0)&&((vd_ah^e1.vd_f[ABOVE][vd_L])!=0))?1:0;br=(((vd_bK^e0.vd_f[ABOVE][CLIP])!=0)&&((vd_ah^e0.vd_f[ABOVE][vd_L])!=0))?1:0;bl=(((vd_bK^e1.vd_f[ABOVE][CLIP]^e0.vd_f[ABOVE][CLIP])!=0)&&((vd_ah^e1.vd_f[ABOVE][vd_L]^e0.vd_f[ABOVE][vd_L])!=0))?1:0;}else if(op==vd_bP.vd_po){tr=(vd_bK)^(vd_ah);tl=(vd_bK^e1.vd_f[ABOVE][CLIP])^(vd_ah^e1.vd_f[ABOVE][vd_L]);br=(vd_bK^e0.vd_f[ABOVE][CLIP])^(vd_ah^e0.vd_f[ABOVE][vd_L]);bl=(vd_bK^e1.vd_f[ABOVE][CLIP]^e0.vd_f[ABOVE][CLIP])^(vd_ah^e1.vd_f[ABOVE][vd_L]^e0.vd_f[ABOVE][vd_L]);}else if(op==vd_bP.vd_uk){tr=((vd_bK!=0)||(vd_ah!=0))?1:0;tl=(((vd_bK^e1.vd_f[ABOVE][CLIP])!=0)||((vd_ah^e1.vd_f[ABOVE][vd_L])!=0))?1:0;br=(((vd_bK^e0.vd_f[ABOVE][CLIP])!=0)||((vd_ah^e0.vd_f[ABOVE][vd_L])!=0))?1:0;bl=(((vd_bK^e1.vd_f[ABOVE][CLIP]^e0.vd_f[ABOVE][CLIP])!=0)||((vd_ah^e1.vd_f[ABOVE][vd_L]^e0.vd_f[ABOVE][vd_L])!=0))?1:0;}else{throw new vd_cy("Unknown op type, "+op);}var vd_kb=vd_d.vd_ul(tr,tl,br,bl);switch(vd_kb){case vd_d.EMN:vd_bF=vd_ek(vd_bF,e1,ix,iy);e0.vd_a[ABOVE]=e1.vd_a[ABOVE];break;case vd_d.ERI:if(p!=null){vd_K=vd_oJ(vd_K,e0,ABOVE);px=vd_fV(vd_K,iy);vd_bB(vd_K,ABOVE,LEFT,px,iy);vd_bB(e0,ABOVE,RIGHT,ix,iy);e1.vd_a[ABOVE]=e0.vd_a[ABOVE];e0.vd_a[ABOVE]=null;}break;case vd_d.ELI:if(q!=null){vd_F=vd_rd(vd_F,e1,ABOVE);nx=vd_fV(vd_F,iy);vd_bB(e1,ABOVE,LEFT,ix,iy);vd_bB(vd_F,ABOVE,RIGHT,nx,iy);e0.vd_a[ABOVE]=e1.vd_a[ABOVE];e1.vd_a[ABOVE]=null;}break;case vd_d.EMX:if(p!=null&&q!=null){vd_bB(e0,ABOVE,LEFT,ix,iy);e0.vd_a[ABOVE]=null;e1.vd_a[ABOVE]=null;}break;case vd_d.IMN:vd_K=vd_oJ(vd_K,e0,ABOVE);px=vd_fV(vd_K,iy);vd_bB(vd_K,ABOVE,LEFT,px,iy);vd_F=vd_rd(vd_F,e1,ABOVE);nx=vd_fV(vd_F,iy);vd_bB(vd_F,ABOVE,RIGHT,nx,iy);vd_bF=vd_ek(vd_bF,vd_K,px,iy);e1.vd_a[ABOVE]=vd_K.vd_a[ABOVE];vd_bB(e1,ABOVE,RIGHT,ix,iy);vd_bF=vd_ek(vd_bF,e0,ix,iy);vd_F.vd_a[ABOVE]=e0.vd_a[ABOVE];vd_bB(vd_F,ABOVE,RIGHT,nx,iy);break;case vd_d.ILI:if(p!=null){vd_bB(e0,ABOVE,LEFT,ix,iy);vd_F=vd_rd(vd_F,e1,ABOVE);nx=vd_fV(vd_F,iy);vd_bB(vd_F,ABOVE,RIGHT,nx,iy);e1.vd_a[ABOVE]=e0.vd_a[ABOVE];e0.vd_a[ABOVE]=null;}break;case vd_d.IRI:if(q!=null){vd_bB(e1,ABOVE,RIGHT,ix,iy);vd_K=vd_oJ(vd_K,e0,ABOVE);px=vd_fV(vd_K,iy);vd_bB(vd_K,ABOVE,LEFT,px,iy);e0.vd_a[ABOVE]=e1.vd_a[ABOVE];e1.vd_a[ABOVE]=null;}break;case vd_d.IMX:if(p!=null&&q!=null){vd_bB(e0,ABOVE,RIGHT,ix,iy);vd_bB(e1,ABOVE,LEFT,ix,iy);e0.vd_a[ABOVE]=null;e1.vd_a[ABOVE]=null;vd_K=vd_oJ(vd_K,e0,ABOVE);px=vd_fV(vd_K,iy);vd_bB(vd_K,ABOVE,LEFT,px,iy);vd_bF=vd_ek(vd_bF,vd_K,px,iy);vd_F=vd_rd(vd_F,e1,ABOVE);nx=vd_fV(vd_F,iy);vd_bB(vd_F,ABOVE,RIGHT,nx,iy);vd_F.vd_a[ABOVE]=vd_K.vd_a[ABOVE];vd_bB(vd_F,ABOVE,RIGHT,nx,iy);}break;case vd_d.IMM:if(p!=null&&q!=null){vd_bB(e0,ABOVE,RIGHT,ix,iy);vd_bB(e1,ABOVE,LEFT,ix,iy);vd_K=vd_oJ(vd_K,e0,ABOVE);px=vd_fV(vd_K,iy);vd_bB(vd_K,ABOVE,LEFT,px,iy);vd_bF=vd_ek(vd_bF,vd_K,px,iy);vd_F=vd_rd(vd_F,e1,ABOVE);nx=vd_fV(vd_F,iy);vd_bB(vd_F,ABOVE,RIGHT,nx,iy);e1.vd_a[ABOVE]=vd_K.vd_a[ABOVE];vd_bB(e1,ABOVE,RIGHT,ix,iy);vd_bF=vd_ek(vd_bF,e0,ix,iy);vd_F.vd_a[ABOVE]=e0.vd_a[ABOVE];vd_bB(vd_F,ABOVE,RIGHT,nx,iy);}break;case vd_d.EMM:if(p!=null&&q!=null){vd_bB(e0,ABOVE,LEFT,ix,iy);vd_bF=vd_ek(vd_bF,e1,ix,iy);e0.vd_a[ABOVE]=e1.vd_a[ABOVE];}break;default:break;}}if(e0.vd_f[ABOVE][CLIP]!=0)e1.vd_aG[CLIP]=(e1.vd_aG[CLIP]==0)?1:0;if(e1.vd_f[ABOVE][CLIP]!=0)e0.vd_aG[CLIP]=(e0.vd_aG[CLIP]==0)?1:0;if(e0.vd_f[ABOVE][vd_L]!=0)e1.vd_aG[vd_L]=(e1.vd_aG[vd_L]==0)?1:0;if(e1.vd_f[ABOVE][vd_L]!=0)e0.vd_aG[vd_L]=(e0.vd_aG[vd_L]==0)?1:0;vd_K=e0.prev;vd_F=e1.next;if(vd_F!=null){vd_F.prev=e0;}if(e0.vd_ai[ABOVE]==vd_ae.vd_fY){var search=true;while(search){vd_K=vd_K.prev;if(vd_K!=null){if(vd_K.vd_ai[ABOVE]!=vd_ae.vd_jp){search=false;}}else{search=false;}}}if(vd_K==null){aet.vd_s.prev=e1;e1.next=aet.vd_s;aet.vd_s=e0.next;}else{vd_K.next.prev=e1;e1.next=vd_K.next;vd_K.next=e0.next;}e0.next.prev=vd_K;e1.next.prev=e1;e0.next=vd_F;}for(var edge=aet.vd_s;(edge!=null);edge=edge.next){vd_F=edge.next;var vd_dc=edge.succ;if((edge.top[Y]==yt)&&(vd_dc!=null)){vd_dc.vd_a[BELOW]=edge.vd_a[ABOVE];vd_dc.vd_ai[BELOW]=edge.vd_ai[ABOVE];vd_dc.vd_f[BELOW][CLIP]=edge.vd_f[ABOVE][CLIP];vd_dc.vd_f[BELOW][vd_L]=edge.vd_f[ABOVE][vd_L];vd_K=edge.prev;if(vd_K!=null)vd_K.next=vd_dc;else aet.vd_s=vd_dc;if(vd_F!=null)vd_F.prev=vd_dc;vd_dc.prev=vd_K;vd_dc.next=vd_F;}else{edge.vd_a[BELOW]=edge.vd_a[ABOVE];edge.vd_ai[BELOW]=edge.vd_ai[ABOVE];edge.vd_f[BELOW][CLIP]=edge.vd_f[ABOVE][CLIP];edge.vd_f[BELOW][vd_L]=edge.vd_f[ABOVE][vd_L];edge.xb=edge.xt;}edge.vd_a[ABOVE]=null;}}}var tn,tnn;var lt,ltn,rt,rtn;var v=0,s=0;var vd_Fj=vd_Je(vd_bF);if(vd_Fj>0){result=[];result.length=vd_Fj;for(var i=0;i<result.length;i++){result[i]=[];}s=0;for(tn=vd_bF;tn!=null;tn=tnn){tnn=tn.next;if(tn.active>2){result[s]=[];result[s].length=tn.active;v=0;lt=tn.v[LEFT];rt=tn.v[RIGHT];while(lt!=null||rt!=null){if(lt!=null){ltn=lt.next;result[s][v]=[lt.x,lt.y,0];v++;lt=ltn;}if(rt!=null){rtn=rt.next;result[s][v]=[rt.x,rt.y,0];v++;rt=rtn;}}s++;}else{for(lt=tn.v[LEFT];lt!=null;lt=ltn){ltn=lt.next;}for(rt=tn.v[RIGHT];rt!=null;rt=rtn){rtn=rt.next;}}}}return result;};function vd_Sh(poly){var ret=[];var vd_OW=poly.vd_iw();for(var i=0;i<vd_OW;i++){var p2=poly.vd_ki(i);var npts=p2.vd_mX();var pts=[];for(var k=0;k<npts;k++){pts.push([p2.getX(k),p2.getY(k),0.0]);}ret.push(pts);}return ret;};function vd_Ny(pts){var ret=new vd_wM();if(pts&&pts.length>0){for(var k=0;k<pts.length;k++)ret.add(pts[k][X],pts[k][Y]);}return ret;};this.vd_FQ=function(vd_tJ,vd_rR){var vd_lx=[];for(var i=0;i<vd_tJ.length;i++){var poly=vd_Ny(vd_tJ[i]);vd_lx.push(poly);if(vd_lx.length==2){var p1=vd_lx[0];var p2=vd_lx[1];var oper=vd_bP.vd_po;if(vd_rR)oper=vd_rR[i];var p=vd_JC(oper,p1,p2);vd_lx=[p];}}if(vd_lx.length>0)return vd_lx[0];else return null;};this.vd_Bj=function(p){if(!p)return[];try{return vd_Ku(vd_bP.vd_eF,p,new vd_wM());}catch(ex){return[];}};this.vd_Ho=function(s){var ret=[];if(!s)return ret;for(var k=0;k<s.length;k++){var pts=s[k];var ret1=[];ret1.push(pts[0]);for(var i=1;i<pts.length;i+=2)ret1.push(pts[i]);var j=pts.length-1;if((pts.length-1)%2.0!=0.0)j--;for(var i=j;i>=0;i-=2)ret1.push(pts[i]);ret.push(ret1);}return ret;};this.clip_oper=function(vd_tJ,vd_rR){return vd_U.vd_Ho(vd_U.vd_Bj(vd_U.vd_FQ(vd_tJ,vd_rR)));};return this;};var gpc=new Clip();function Edge(a,b){this.vd_fm=a;this.vd_fe=b;this.vd_gx=false;return this;};function vd_Fp(a,b,c,eps,points){var vd_U=this;this.vd_fm=a;this.vd_fe=b;this.vd_hI=c;this.vd_gx=false;function vd_OZ(eps,points){var cp1=points[vd_U.vd_fm],cp2=points[vd_U.vd_fe],cp3=points[vd_U.vd_hI];var radius;var vd_hY;var vd_nF;var m1;var m2;var mx1;var mx2;var my1;var my2;var dx;var dy;var rsqr;var vd_Dp=Math.abs(cp1[Y]-cp2[Y])<eps;var vd_EN=Math.abs(cp2[Y]-cp3[Y])<eps;if(vd_Dp&&vd_EN){return null;}if(vd_Dp){m2= -(cp3[X]-cp2[X])/(cp3[Y]-cp2[Y]);mx2=(cp2[X]+cp3[X])/2;my2=(cp2[Y]+cp3[Y])/2;vd_hY=(cp2[X]+cp1[X])/2;vd_nF=m2*(vd_hY-mx2)+my2;}else if(vd_EN){m1= -(cp2[X]-cp1[X])/(cp2[Y]-cp1[Y]);mx1=(cp1[X]+cp2[X])/2;my1=(cp1[Y]+cp2[Y])/2;vd_hY=(cp3[X]+cp2[X])/2;vd_nF=m1*(vd_hY-mx1)+my1;}else{m1= -(cp2[X]-cp1[X])/(cp2[Y]-cp1[Y]);m2= -(cp3[X]-cp2[X])/(cp3[Y]-cp2[Y]);mx1=(cp1[X]+cp2[X])/2;mx2=(cp2[X]+cp3[X])/2;my1=(cp1[Y]+cp2[Y])/2;my2=(cp2[Y]+cp3[Y])/2;vd_hY=(m1*mx1-m2*mx2+my2-my1)/(m1-m2);vd_nF=m1*(vd_hY-mx1)+my1;}dx=cp2[X]-vd_hY;dy=cp2[Y]-vd_nF;rsqr=dx*dx+dy*dy;radius=Math.sqrt(rsqr);return[vd_hY,vd_nF,radius];};var vd_vz=vd_OZ(eps,points);this.vd_JZ=function(eps,pt){if(vd_vz==null)return false;return vdgeo.Distance2D(pt,vd_vz)<=vd_vz[Z];};this.vd_LO=function(p){if(p==null)return false;if(vd_U==p)return true;return((vd_U.vd_fm==p.vd_fm||vd_U.vd_fm==p.vd_fe||vd_U.vd_fm==p.vd_hI)||(vd_U.vd_fe==p.vd_fm||vd_U.vd_fe==p.vd_fe||vd_U.vd_fe==p.vd_hI)||(vd_U.vd_hI==p.vd_fm||vd_U.vd_hI==p.vd_fe||vd_U.vd_hI==p.vd_hI));};return this;};var vd_yn={};vd_yn.vd_Fq=function(vd_sV,prec){if(!vd_sV||vd_sV.length==0)return null;var vd_da=1.0/Math.pow(10,prec);var points=[];for(var i=0;i<vd_sV.length;i++){var pt=vd_sV[i];points.push([Number(pt[X].toFixed(prec)),Number(pt[Y].toFixed(prec)),Number(pt[Z].toFixed(prec)),i]);}points.sort(function(x,y){var dif=vdgeo.Distance2D(x,[0,0,0])-vdgeo.Distance2D(y,[0,0,0]);if(dif==0.0){if(x[Z]==y[Z])return 0;else if(x[Z]>y[Z])return 1;else return-1;}if(dif>0.0)return 1;else return-1;});var tmp=[points[0]];var c=0;for(var i=1;i<points.length;i++){if(vdgeo.AreEqual(vdgeo.Distance2D(tmp[c],points[i]),0.0,vd_da))continue;tmp.push(points[i]);c++;}points=tmp;points.sort(function(a,b){return a[X]-b[X]});var vd_uj=points.length;var xmin;var xmax;var ymin;var ymax;var xmid;var ymid;var dx;var dy;var dmax;xmin=points[0][X];ymin=points[0][Y];xmax=xmin;ymax=ymin;for(var i=1;i<points.length;i++){if(points[i][X]<xmin){xmin=points[i][X];}if(points[i][X]>xmax){xmax=points[i][X];}if(points[i][Y]<ymin){ymin=points[i][Y];}if(points[i][Y]>ymax){ymax=points[i][Y];}}dx=xmax-xmin;dy=ymax-ymin;if(dx>dy){dmax=dx;}else{dmax=dy;}xmid=(xmax+xmin)/2.0;ymid=(ymax+ymin)/2.0;var vd_Jz=[(xmid-2*dmax),(ymid-dmax),0,-1];var vd_IU=[xmid,(ymid+2*dmax),0,-1];var vd_JL=[(xmid+2*dmax),(ymid-dmax),0,-1];points.push(vd_Jz);points.push(vd_IU);points.push(vd_JL);var vd_zG=new vd_Fp(vd_uj,vd_uj+1,vd_uj+2,vd_da,points);var vd_en=[];var vd_jz;var vd_Kl=0;vd_en.push(vd_zG);var vd_xh=0;for(var vd_rM=vd_Kl;vd_rM<vd_uj;vd_rM++){vd_jz=[];var tc=vd_en.length;for(var itri=0;itri<tc;itri++){var tri=vd_en[itri];if(tri.vd_gx)continue;var vd_Kc=tri.vd_JZ(vd_da,points[vd_rM]);if(vd_Kc){var vd_lm=new Edge(tri.vd_fm,tri.vd_fe);var vd_No=new Edge(tri.vd_fe,tri.vd_hI);var vd_Nb=new Edge(tri.vd_hI,tri.vd_fm);vd_jz.push(vd_lm);vd_jz.push(vd_No);vd_jz.push(vd_Nb);tri.vd_gx=true;vd_xh++;}}if(vd_xh>0){var vd_DZ=[];for(var itri=0;itri<tc;itri++){var tri=vd_en[itri];if(tri.vd_gx)continue;vd_DZ.push(tri);}vd_en=vd_DZ;tc=vd_en.length;vd_xh=0;}var ec=vd_jz.length;for(var i=0;i<ec;i++){var vd_iu=vd_jz[i];if(vd_iu.vd_gx)continue;for(var j=i+1;j<vd_jz.length;j++){var vd_tv=vd_jz[j];if(vd_tv.vd_gx)continue;if(vd_iu.vd_fm==vd_tv.vd_fe){if(vd_iu.vd_fe==vd_tv.vd_fm){vd_iu.vd_gx=true;vd_tv.vd_gx=true;}}}}for(var i=0;i<ec;i++){var vd_iu=vd_jz[i];if(vd_iu.vd_gx)continue;var trig=new vd_Fp(vd_iu.vd_fm,vd_iu.vd_fe,vd_rM,vd_da,points);vd_en.push(trig);}}var vd_rr=[];for(var i=0;i<vd_en.length;i++){var vd_mw=vd_en[i];if(vd_mw.vd_gx)continue;if(vd_mw.vd_LO(vd_zG)){vd_mw.vd_gx=true;continue;}vd_rr.push(points[vd_mw.vd_fm][3]);vd_rr.push(points[vd_mw.vd_fe][3]);vd_rr.push(points[vd_mw.vd_hI][3]);}return vd_rr;};var vd_cD={};vd_cD.vd_Ao=['FontFileVDS','bytes','vd_jM','vd_ya','ActiveLayOutRef','ActiveLineTypeRef','ActiveTextStyleRef','ActiveLayerRef','MaterialImageRef','LayerRef','LineTypeRef','StyleRef','BlockRef','ExternalReference','ShapeStyleRef','vd_cX','vd_pd','OverAllLength','segmentlength','bytescount','vd_ad','vd_FW'];vd_cD.vd_Gq=function(vd_P){if(vd_P.i==0){vd_P.vd_lY=0;vd_P.string.push(vd_P.offset.join(""),"function f"+vd_P.vd_lY.toString()+"(){try{",vd_P.vd_ff);}do{if(vd_P.i==vd_P.vd_jk.length)break;var vd_r=vd_P.vd_jk[vd_P.i];vd_P.string.push(vd_P.offset.join(""),"_vdDocument."+vd_r+"=",vd_cD.vd_nW(vd_P.vdraw,vd_P.vd_ln,vd_P.obj[vd_r],vd_P.offset),";",vd_P.vd_ff);var vd_DT=vdgeo.vd_u(100.0*vd_P.i/vd_P.vd_jk.length);vd_P.i++;var vd_AB=vd_P.vdraw.vd_es.Progress(vd_DT,100);if(vd_AB){vd_P.vd_lY++;vd_P.string.push(vd_P.offset.join(""),"document._p("+vd_DT.toString()+");}catch(ex){document._e(ex,"+vd_P.vd_lY.toString()+");return;}setTimeout(f"+vd_P.vd_lY.toString()+",0);}",vd_P.vd_ff);vd_P.string.push(vd_P.offset.join(""),"function f"+vd_P.vd_lY.toString()+"(){try{",vd_P.vd_ff);setTimeout(function(){vd_cD.vd_Gq(vd_P);},0);return;}}while(true);if(vd_P.i==vd_P.vd_jk.length){vd_P.string.push(vd_P.offset.join(""),"document._l();");vd_P.string.push(vd_P.offset.join(""),"} catch (ex) { document._e(ex, "+vd_P.vd_lY.toString()+"); } };",vd_P.vd_ff);vd_P.string.push(vd_P.offset.join(""),"f0();",vd_P.vd_ff);vd_P.vdraw.vd_es.end();var ret=vd_P.string.join("");if(vd_P.vd_ln!==true)ret=vd_cD.vd_Lu(ret,vd_P.vdraw,vd_P.obj);else if(vd_P.vdraw.vdAfterSaveDocument!=null)vd_P.vdraw.vdAfterSaveDocument({dataObject:vd_P.obj,dataStream:ret});}};vd_cD.vd_nW=function(vdraw,vd_ln,obj,offset){var vd_Jb=offset==undefined;if(vd_Jb){if(!obj)obj=vdraw.GetDocument();vdraw.vd_es.start("Saving data",true);}if(offset==undefined)offset=[];var ret='';var space='\t';var vd_ff='\n';var string=[];if(obj==null||obj==undefined){string.push(' ');}else if(typeof(obj)=="object"&&(obj.join==undefined)){var vd_ys=obj.Model!=undefined;var vd_jk=[];if(vd_ys)string.push("_vdDocument = ",vd_ff);string.push("{",vd_ff);offset.push(space);var vd_yX;for(vd_r in obj){if(vdConst.vd_zA.indexOf(vd_r)>=0)continue;if(vd_cD.vd_Ao.indexOf(vd_r)>=0)continue;if(vd_ys&&vd_r.substr(0,2)=='h_'){vd_yX=obj[vd_r];if(!vd_yX.Deleted&& !vd_yX.excludeFromSave)vd_jk.push(vd_r);continue;}var value=obj[vd_r];if(typeof(value)=="function")continue;if(value==undefined)continue;if(vd_r=='jpegData'&&typeof value=='string'){string.push(offset.join(""),vd_r,":","'",value,"'",",",vd_ff);continue;}string.push(offset.join(""),vd_r,":",vd_cD.vd_nW(vdraw,vd_ln,value,offset),",",vd_ff);};offset.pop();string.push(offset.join(""),"}");if(vd_ys&&vd_jk.length>0){string.push(";",vd_ff);var vd_P={i:0,vdraw:vdraw,obj:obj,vd_jk:vd_jk,string:string,offset:offset,vd_lY:0,vd_ln:vd_ln,vd_ff:vd_ff};vd_cD.vd_Gq(vd_P);return;}}else if(typeof(obj)=="object"&& !(obj.join==undefined)){var vd_om;var vd_Ik=obj.length>0&&typeof(obj[0])=="object";if(vd_Ik){string.push("[",vd_ff);offset.push(space);for(vd_r in obj){vd_om=vd_cD.vd_nW(vdraw,vd_ln,obj[vd_r],offset);if(vd_om=='')continue;string.push(offset.join(""),vd_om,",",vd_ff);}offset.pop();string.push(offset.join(""),"]");}else{string.push("[");for(vd_r in obj){vd_om=vd_cD.vd_nW(vdraw,vd_ln,obj[vd_r],offset);if(vd_om=='')continue;string.push(vd_om,",");}string.push("]");}}else if(typeof obj=='string'){if(obj.substr(0,2)=='h_'){var vd_ze=vdraw.GetEntityItem(obj);if(!vd_ze||(!vd_ze.Deleted&& !vd_ze.excludeFromSave))string.push('\''+obj+'\'');}else{string.push('String.fromCharCode(');for(var s=0;s<obj.length;s++){string.push(obj.charCodeAt(s).toString());if(s<obj.length-1)string.push(',');}string.push(')');}}else if(typeof(obj)=="function"){string.push(' ');}else{string.push(obj.toString());}ret=string.join("");return ret;};vd_cD.vd_GW=function(vd_P){if(vd_P.i==0){for(var k=0;k<256;k++){vd_P.vd_eW[String.fromCharCode(k)]=vd_P.vd_DE++;}vd_P.vd_dQ.push("document._d([[");vd_P.vdraw.vd_es.start("Compressing data",true);}do{if(vd_P.i==vd_P.vd_nj.length)break;var c=vd_P.vd_nj[vd_P.i];var wc=vd_P.w+c;if(vd_P.vd_eW.hasOwnProperty(wc)){vd_P.w=wc;}else{vd_P.vd_dQ.push(vd_P.vd_eW[vd_P.w]);vd_P.ca++;if(vd_P.ca>=vd_P.vd_Jq){vd_P.vd_dQ.push(vd_P.vd_Oc);vd_P.ca=0;}else{vd_P.vd_dQ.push(",");}vd_P.vd_eW[wc]=vd_P.vd_DE++;vd_P.w=c;}vd_P.i++;var vd_AB=vd_P.vdraw.vd_es.Progress(vd_P.i,vd_P.vd_nj.length);if(vd_AB){setTimeout(function(){vd_cD.vd_GW(vd_P);},0);return;}}while(true);if(vd_P.i==vd_P.vd_nj.length){if(vd_P.w!='')vd_P.vd_dQ.push(vd_P.vd_eW[vd_P.w]);vd_P.vd_dQ.push("]]);");vd_P.vdraw.vd_es.end();if(vd_P.vdraw.vdAfterSaveDocument!=null)vd_P.vdraw.vdAfterSaveDocument({dataObject:vd_P.dataObject,dataStream:vd_P.vd_dQ.join("")});}};vd_cD.vd_Lu=function(vd_JM,vdraw,dataObject){vd_cD.vd_GW({vd_Oc:"],\r\n[",vd_Jq:32767,vdraw:vdraw,vd_nj:vd_JM,dataObject:dataObject,vd_dQ:[],i:0,vd_eW:{},vd_DE:0,ca:0,w:''});return;};function vd_hx(){var vd_U=this;this.vd_aD=vdgeo.newpoint(0,0,0);this.vd_as=vdgeo.newpoint(0,0,0);this.vd_bt=true;this.vd_yd=function(x,y,z){if(vd_U.vd_bt){vd_U.vd_aD[X]=x;vd_U.vd_aD[Y]=y;vd_U.vd_aD[Z]=z;vd_U.vd_as[X]=x;vd_U.vd_as[Y]=y;vd_U.vd_as[Z]=z;vd_U.vd_bt=false;}else{vd_U.vd_aD[X]=Math.min(vd_U.vd_aD[X],x);vd_U.vd_aD[Y]=Math.min(vd_U.vd_aD[Y],y);vd_U.vd_aD[Z]=Math.min(vd_U.vd_aD[Z],z);vd_U.vd_as[X]=Math.max(vd_U.vd_as[X],x);vd_U.vd_as[Y]=Math.max(vd_U.vd_as[Y],y);vd_U.vd_as[Z]=Math.max(vd_U.vd_as[Z],z);}};this.AddPoint=function(pt){vd_U.vd_yd(pt[X],pt[Y],pt[Z]);};this.vd_QP=function(vd_us){if(!vd_us||vd_us.length==0)return;for(var i=0;i<vd_us.length;i++){vd_U.AddPoint(vd_us[i]);}};this.AddBox=function(box){if(!box||box.vd_bt)return;vd_U.AddPoint(box.vd_aD);vd_U.AddPoint(box.vd_as);};this.vd_hc=function(bbox){if(!bbox)return;vd_U.vd_yd(bbox[0],bbox[1],bbox[2]);vd_U.vd_yd(bbox[3],bbox[4],bbox[5]);};this.vd_FO=function(m){var b1=vdgeo.vd_gk(m,vd_U.vd_aD[X],vd_U.vd_aD[Y],vd_U.vd_aD[Z]);var b2=vdgeo.vd_gk(m,vd_U.vd_as[X],vd_U.vd_aD[Y],vd_U.vd_aD[Z]);var b3=vdgeo.vd_gk(m,vd_U.vd_as[X],vd_U.vd_as[Y],vd_U.vd_aD[Z]);var b4=vdgeo.vd_gk(m,vd_U.vd_aD[X],vd_U.vd_as[Y],vd_U.vd_aD[Z]);var b5=vdgeo.vd_gk(m,vd_U.vd_aD[X],vd_U.vd_aD[Y],vd_U.vd_as[Z]);var b6=vdgeo.vd_gk(m,vd_U.vd_as[X],vd_U.vd_aD[Y],vd_U.vd_as[Z]);var b7=vdgeo.vd_gk(m,vd_U.vd_as[X],vd_U.vd_as[Y],vd_U.vd_as[Z]);var b8=vdgeo.vd_gk(m,vd_U.vd_aD[X],vd_U.vd_as[Y],vd_U.vd_as[Z]);vd_U.vd_bt=true;vd_U.AddPoint(b1);vd_U.AddPoint(b2);vd_U.AddPoint(b3);vd_U.AddPoint(b4);vd_U.AddPoint(b5);vd_U.AddPoint(b6);vd_U.AddPoint(b7);vd_U.AddPoint(b8);};this.vd_fD=function(){if(vd_U.vd_bt)return null;return[vd_U.vd_aD[X],vd_U.vd_aD[Y],vd_U.vd_aD[Z],vd_U.vd_as[X],vd_U.vd_as[Y],vd_U.vd_as[Z]];};this.vd_MZ=function(width){if(vd_U.vd_bt)return;vd_U.vd_aD[X]-=width;vd_U.vd_aD[Y]-=width;vd_U.vd_as[X]+=width;vd_U.vd_as[Y]+=width;};Object.defineProperty(vd_U,'Width',{get:function(){if(vd_U.vd_bt)return 0.0;return(vd_U.vd_as[X]-vd_U.vd_aD[X]);}});Object.defineProperty(vd_U,'Height',{get:function(){if(vd_U.vd_bt)return 0.0;return(vd_U.vd_as[Y]-vd_U.vd_aD[Y]);}});Object.defineProperty(vd_U,'Left',{get:function(){if(vd_U.vd_bt)return 0.0;return(vd_U.vd_aD[X]);}});Object.defineProperty(vd_U,'Bottom',{get:function(){if(vd_U.vd_bt)return 0.0;return(vd_U.vd_aD[Y]);}});Object.defineProperty(vd_U,'Right',{get:function(){if(vd_U.vd_bt)return 0.0;return(vd_U.vd_as[X]);}});Object.defineProperty(vd_U,'Top',{get:function(){if(vd_U.vd_bt)return 0.0;return(vd_U.vd_as[Y]);}});Object.defineProperty(vd_U,'vd_Ew',{get:function(){if(vd_U.vd_bt)return true;return(vd_U.Width==0&&vd_U.Height==0);}});return this;};function vd_PC(){var vd_U=this;this.vd_nC=function(vd_kk,vd_kg){return 1.0;};this.vd_uc=function(vd_kk,mat,vd_kg){return;};this.vd_ds=function(){return vdConst.vd_fo;};var vd_be=new vd_hx();this.vd_gQ=new vd_hx();this.vd_Z=10;this.vd_B=vdgeo.newpoint(0,0,0);this.vd_aN=vdgeo.vd_e();this.vd_dm=vdgeo.vd_e();this.vd_gT=vdgeo.vd_e();this.pixelsize=1.0;var vd_oV=null;this.vd_H=null;this.palette==null;this.vd_jW=1.0;this.vd_dk=new Array();this.linetype=null;this.vd_mp=1.0;var vd_cq=[0,0,0,255];var vd_dV=[255,255,255,255];var vd_dL=new Array(new Array(vdgeo.vd_e(),vdgeo.vd_e(),vdgeo.vd_e()));this.vd_sv=function(){return false;};this.vd_OK=function(render){vd_oV=render;};this.GetPixelSize=function(){if(vd_oV)return vd_oV.pixelsize;return vd_U.pixelsize;};this.vd_dF=function(){if(vd_oV)return vd_oV.vd_dF();return vd_U.pixelsize;};this.vd_iN=function(){return vd_dV;};this.vd_kD=function(){return vd_cq;};this.vd_fR=function(index){return vd_dV;};this.vd_hK=function(vd_jP,vd_ac){vd_U.palette=vd_jP;vd_U.vd_ao(vd_dV);};this.vd_bo={left:0,top:0,right:0,bottom:0};this.vd_xM=function(){return vd_U.vd_Z*vd_U.vd_yK();};this.vd_yK=function(){return 1;};this.vd_pC=function(){if(vd_U.vd_dk.length==0)return null;return vd_U.vd_dk[vd_U.vd_dk.length-1];};this.vd_kv=function(bval){return ShowHidenEdges;};this.vd_qY=function(fig){if(fig==null){if(vd_U.vd_dk.length==1){vd_U.vd_gQ.AddBox(vd_be);vd_U.vd_pC().BoundingBox=vd_be.vd_fD();vd_be.vd_bt=true;}vd_U.vd_dk.pop();}else{vd_U.vd_dk.push(fig);}};this.vd_qr=false;this.vd_oi=function(mode){};this.vd_zI=function(ltscale){return vd_U.vd_mp;};this.vd_AK=function(lt){return vd_U.linetype;};this.vd_bf=function(vd_oM){return 0.0;};this.vd_ao=function(color){return vd_dV;};this.vd_go=function(vd_cO){return null;};this.vd_gN=null;this.vd_gb=function(vd_qv){return null;};this.vd_vj=function(vd_AJ){return false;};this.vd_bh=function(mat){var m=vd_U.vd_bE();vd_dL.push(new Array(null,null,null));vd_U.vd_pQ(mat?vdgeo.vd_gW(mat,m):mat);};this.vd_bC=function(){vd_dL.pop();};this.vd_bE=function(){return vd_dL[vd_dL.length-1][0];};this.vd_dZ=function(){return vd_dL[vd_dL.length-1][1];};this.vd_QX=function(){return null;};this.vd_pQ=function(mat){if(!mat)mat=vdgeo.vd_e();vd_dL[vd_dL.length-1][0]=mat;};this.clip=null;this.vd_OO=function(){};this.vd_xC=function(left,top,right,bottom){};this.vd_tA=function(){};this.update=function(vd_kP,vd_mJ,vd_vd){vd_U.vd_Z=vd_kP;vd_U.pixelsize=1;vd_U.vd_pQ(vdgeo.vd_e());};this.clear=function(){vd_be.vd_bt=true;vd_U.vd_gQ.vd_bt=true;};this.refresh=function(){};this.vd_cW=function(vd_hM,vd_hW){vd_be.AddPoint(vdgeo.matrixtransform(this.vd_bE(),vd_hM));vd_be.AddPoint(vdgeo.matrixtransform(this.vd_bE(),vd_hW));};this.vd_Ez=function(vd_yS,direction,vd_CS){};this.vd_cd=function(pts,closed){if(pts.length<2)return;var sp=pts[0];for(var i=1;i<pts.length;i++){var ep=pts[i];vd_U.vd_cW(sp,ep);sp=ep;}if(closed)vd_U.vd_cW(pts[pts.length-1],pts[0]);};this.vd_er=function(pts){this.vd_cd(pts,true);};this.vd_yg=function(p1,p2,p3,p4,vd_gf,vd_ez,vd_fE,vd_hH){vd_U.vd_hd(p1,p2,p3,p4,vd_gf,vd_ez,vd_fE,vd_hH);};this.vd_hd=function(p1,p2,p3,p4,vd_gf,vd_ez,vd_fE,vd_hH){vd_U.vd_cW(p1,p2);vd_U.vd_cW(p2,p3);vd_U.vd_cW(p3,p4);vd_U.vd_cW(p4,p1);};this.vd_tT=function(vd_bk,vd_jm,vd_mP,vd_dO){vd_be.AddPoint(vdgeo.matrixtransform(this.vd_bE(),vdgeo.newpoint(0,vd_dO.Ascent,0)));vd_be.AddPoint(vdgeo.matrixtransform(this.vd_bE(),vdgeo.newpoint(vd_jm,vd_dO.Ascent,0)));vd_be.AddPoint(vdgeo.matrixtransform(this.vd_bE(),vdgeo.newpoint(0,-vd_dO.Descent,0)));vd_be.AddPoint(vdgeo.matrixtransform(this.vd_bE(),vdgeo.newpoint(vd_jm,-vd_dO.Descent,0)));};this.vd_pW=function(vd_j,vd_vC,vd_pn,vd_oG){if(vd_j==null)return;vd_be.AddPoint(vdgeo.matrixtransform(this.vd_bE(),vdgeo.newpoint(0,0,0)));vd_be.AddPoint(vdgeo.matrixtransform(this.vd_bE(),vdgeo.newpoint(vd_pn,0,0)));vd_be.AddPoint(vdgeo.matrixtransform(this.vd_bE(),vdgeo.newpoint(vd_pn,vd_oG,0)));vd_be.AddPoint(vdgeo.matrixtransform(this.vd_bE(),vdgeo.newpoint(0,vd_oG,0)));};this.vd_hT=function(pt){vd_be.AddPoint(vdgeo.matrixtransform(this.vd_bE(),pt));};this.vd_tF=function(pts,vd_jA,vd_fQ,vd_tf){for(var i=0;i<pts.length;i++){pt=pts[i];vd_be.AddPoint(vdgeo.matrixtransform(this.vd_bE(),pt));}};var vd_cM=vdgeo.newpoint(0,0,0);var vd_cC=vdgeo.newpoint(0,0,0);this.vd_gD=function(pts,thickness,closed){if(pts.length<2)return;if(thickness==0.0|thickness==undefined){vd_U.vd_cd(pts,closed);return;}for(var i=1;i<pts.length;i++){vd_cM[X]=pts[i-1][X];vd_cM[Y]=pts[i-1][Y];vd_cM[Z]=pts[i-1][Z]+thickness;vd_cC[X]=pts[i][X];vd_cC[Y]=pts[i][Y];vd_cC[Z]=pts[i][Z]+thickness;vd_U.vd_hd(pts[i],pts[i-1],vd_cM,vd_cC,true,true,true,(i==pts.length-1));}if(closed){var vd_fc=pts.length-1;vd_cM[X]=pts[0][X];vd_cM[Y]=pts[0][Y];vd_cM[Z]=pts[0][Z]+thickness;vd_cC[X]=pts[vd_fc][X];vd_cC[Y]=pts[vd_fc][Y];vd_cC[Z]=pts[vd_fc][Z]+thickness;vd_U.vd_hd(pts[vd_fc],pts[0],vd_cM,vd_cC,true,false,true,true);}};this.vd_eN=function(vd_bX){};this.vd_et=function(pts,vd_aV,uvs,vd_cO){vd_U.vd_er(pts);};this.vd_gR=function(pts){vd_U.vd_er(pts);};this.vd_EI=function(FaceList,VertexList){var ii=0;var p0,p1,p2,p3;for(var i=0;i<FaceList.length;i=i+5){ii=FaceList[i];ii=Math.abs(ii);p0=VertexList[ii-1];ii=FaceList[i+1];ii=Math.abs(ii);p1=VertexList[ii-1];ii=FaceList[i+2];ii=Math.abs(ii);p2=VertexList[ii-1];ii=FaceList[i+3];ii=Math.abs(ii);p3=VertexList[ii-1];vd_U.vd_hd(p0,p1,p2,p3,true,true,true,true);}};this.GetEntityFromPoint=function(x,y,vd_lZ,vd_bq){return null;};this.GetEntitiesFromBox=function(xmin,ymin,xmax,ymax,vd_bq){return new Array();};return this;};function vd_Jt(owner){var vd_U=this;this.ResValue=null;this.actionType=vdConst.ACTION_POINT_WORLD;this.actionCount=0;this.vd_PV=function(){if(vd_U.vd_v!=='select')return;if(!vd_jJ)return;vd_jJ= !vd_sh;};Object.defineProperty(vd_U,'vd_Li',{get:function(){return vd_sh;}});this.IsCanceled=function(){return vd_jJ;};this.IsStarted=function(){return vd_am;};this.vdrawOwner=function(){return vd_D;};this.TouchSupported=function(){return vd_FV||('ontouchstart'in document.documentElement)||('ontouchstart'in window);};this.DefaultActions=vdConst.DEFAULT_MOUSE_ACTION_ALL;this.DispProps=vdConst.ACTION_DISPLAY_DEFAULT;this.PanMouseButton=vdConst.MouseLeftButton;this.RotateMouseButton=vdConst.MouseMiddleButton|vdConst.MouseLeftButton;this.ZoomScaleMouseButton=vdConst.MouseMiddleButton|vdConst.MouseLeftButton;var vd_gH=null;var vd_lk=null;var vd_lh=null;this.TouchCancelTimeOut= -1600;var vd_FV=false;this.vd_wB=function(){vd_FV=true;};this.vd_rj=function(action,status){};this.vd_vF=null;this.vd_jB=0;this.vd_on=null;this.vd_nX=null;this.vd_vN=[255,255,0,255];this.vd_vZ=14;this.OrthoMode=false;this.DrawActionDefault=true;var vd_aF=null;var vd_cS=null;var vd_y=null;var vd_fr=null;var vd_D=owner;var vd_am=false;var vd_mi=false;var vd_jJ=false;var vd_sh=0;var vd_dP=false;var vd_AR=null;this.vd_nl=function(){var vd_DA=0;var doc=vd_D.GetDocument();if(doc)vd_DA=doc.GlobalRenderProperties.AxisSize;return(vd_D.canvas.style.cursor==='none'&&vd_DA>0);};this.DrawDefaultAxis=function(){if(!vd_D.ActiveRender().vd_H.vd_xB())return;var doc=vd_D.GetDocument();if(!doc)return;if(doc.GlobalRenderProperties.AxisSize<=0)return;var pixelsize=vd_D.ActiveRender().pixelsize;if(vd_D.ActiveRender().vd_ak)pixelsize=vd_D.ActiveRender().vd_CR;var vd_zJ=vd_D.ActiveRender().vd_H.vd_mQ(255);var color=doc.GlobalRenderProperties.CursorAxisColor;if(!color)color=vd_D.ActiveRender().vd_iN();color=vd_D.ActiveRender().vd_xl(color);var vd_ql=doc.GlobalRenderProperties.CursorPickColor;if(!vd_ql)vd_ql=vd_D.ActiveRender().vd_iN();vd_ql=vd_D.ActiveRender().vd_xl(vd_ql);var vd_fX=vd_D.ActiveRender().vd_ao(color);var vd_vw=vd_D.ActiveRender().vd_bf(1);var vd_tS=doc.GlobalRenderProperties.AxisSize*pixelsize;var vd_iM=vdgeo.pointPolar(vd_cS,0,vd_tS);var vd_jg=vdgeo.pointPolar(vd_cS,vdgeo.PI,vd_tS);var p_up=vdgeo.pointPolar(vd_cS,vdgeo.HALF_PI,vd_tS);var vd_jn=vdgeo.pointPolar(vd_cS,-vdgeo.HALF_PI,vd_tS);var vd_js=vd_D.PickSize*0.5;var vd_hj=vd_D.ActiveRender().vd_dZ();var vd_dE=vdgeo.vd_do(vd_cS,vd_hj);vd_iM=vdgeo.vd_do(vd_iM,vd_hj);vd_jg=vdgeo.vd_do(vd_jg,vd_hj);p_up=vdgeo.vd_do(p_up,vd_hj);vd_jn=vdgeo.vd_do(vd_jn,vd_hj);vd_iM[Z]=1.0;vd_jg[Z]=1.0;p_up[Z]=1.0;vd_jn[Z]=1.0;vd_dE[X]=vdgeo.vd_u(vd_dE[X]+0.49);vd_dE[Y]=vdgeo.vd_u(vd_dE[Y]+0.49);vd_jg[X]=vdgeo.vd_u(vd_jg[X]+0.49);vd_jg[Y]=vdgeo.vd_u(vd_jg[Y]+0.49);vd_iM[X]=vdgeo.vd_u(vd_iM[X]+0.49);vd_iM[Y]=vdgeo.vd_u(vd_iM[Y]+0.49);p_up[X]=vdgeo.vd_u(p_up[X]+0.49);p_up[Y]=vdgeo.vd_u(p_up[Y]+0.49);vd_jn[X]=vdgeo.vd_u(vd_jn[X]+0.49);vd_jn[Y]=vdgeo.vd_u(vd_jn[Y]+0.49);vd_D.ActiveRender().vd_bh(vdgeo.vd_aR(vd_hj));vd_D.ActiveRender().vd_cW(vd_jg,vd_iM);vd_D.ActiveRender().vd_cW(p_up,vd_jn);vd_D.ActiveRender().vd_ao(vd_ql);vd_D.ActiveRender().vd_cd([[vd_dE[X]-vd_js,vd_dE[Y]-vd_js,1],[vd_dE[X]-vd_js,vd_dE[Y]+vd_js,1],[vd_dE[X]+vd_js,vd_dE[Y]+vd_js,1],[vd_dE[X]+vd_js,vd_dE[Y]-vd_js,1]],true);vd_D.ActiveRender().vd_bC();vd_D.ActiveRender().vd_H.vd_mQ(vd_zJ);vd_D.ActiveRender().vd_ao(vd_fX);vd_D.ActiveRender().vd_bf(vd_vw);};function vd_He(){if(!vd_U.vd_nl())return;if(!vd_cS)return;var ret=false;if(vd_D.vdDrawCursor!=null)ret=vd_D.vdDrawCursor(vd_U);if(!ret)vd_U.DrawDefaultAxis();};this.IsPaused=function(){return vd_dP;};this.Pause=function(vd_GE){if(!vd_dP){vd_AR={DefaultActions:vd_U.DefaultActions};}if(vd_GE!==undefined)vd_U.DefaultActions=vd_GE;vd_dP=true;vd_U.hide();};this.Resume=function(){if(vd_dP&&vd_AR){vd_U.DefaultActions=vd_AR.DefaultActions;}vd_dP=false;vd_U.show();};var vd_oU=null;function vd_Pw(vd_Oy){if(vd_oU==null)vd_oU=vd_D.canvas.style.cursor;vd_D.canvas.style.cursor=vd_Oy;};function vd_tD(){if(vd_oU!=null)vd_D.canvas.style.cursor=vd_oU;vd_oU=null;};this.vd_vE=function(vd_lD){vd_aF=null;vd_U.actionCount=0;if(!vd_lD)return;vd_aF=vdConst.cloneEntity(vd_lD);vd_U.actionCount=1;};function vd_yw(vd_xS,evt){switch(evt.mousebutton){case 1:return(vd_xS&vdConst.MouseLeftButton)!=0;case 2:return(vd_xS&vdConst.MouseMiddleButton)!=0;case 3:return(vd_xS&vdConst.MouseRightButton)!=0;default:return false;}};this.start=function(vd_xe){if(vd_am)return;vd_U.Resume();vd_am=true;vd_jJ=false;vd_sh=0;if(vd_xe===undefined)vd_xe=0;vd_U.actionCount=vd_xe;vd_D.canvas.focus();vd_gH=null;vd_lk=null;vd_lh=null;vd_U.show();vd_y=null;vd_fr=null;vd_D.vd_np(vd_U,'start');};function vd_Fs(){var pcur=vd_cS;if(vd_fr)pcur=vd_fr;if(vd_y)pcur=vdgeo.vd_do(vd_y,vdgeo.vd_aR(vd_D.ActiveRender().vd_bE()));if(vd_D.vdFIlterActionPoint){var vd_CX={Action:vd_U,SelectedPoint:pcur};vd_D.vdFIlterActionPoint(vd_CX);pcur=vd_CX.SelectedPoint;}return pcur;};this.end=function(){vd_U.vd_oQ();vd_U.DrawActionDefault=true;if(vd_am==false)return;vd_tD();vd_U.hide();vd_am=false;vd_U.ResValue=null;if(vd_jJ==false){var pcur=vd_Fs();if(vd_U.actionType==vdConst.ACTION_POINT_WORLD){vd_U.ResValue=vdgeo.newpoint(pcur[X],pcur[Y],pcur[Z]);}else if(vd_U.actionType==vdConst.ACTION_LINE_WORLD){vd_U.ResValue=[vdgeo.newpoint(vd_aF[X],vd_aF[Y],vd_aF[Z]),vdgeo.newpoint(pcur[X],pcur[Y],pcur[Z])];}else if(vd_U.actionType==vdConst.ACTION_RECT_VIEW){var vd_pv=vd_D.ActiveRender().vd_bE();var vd_aZ=vdgeo.matrixtransform(vd_pv,vd_aF);var vd_dE=vdgeo.matrixtransform(vd_pv,pcur);vd_U.ResValue=[vd_aZ,vd_dE];}}vd_gH=null;vd_lk=null;vd_lh=null;vd_D.vd_np(vd_U,'end');};this.cancel=function(status){if(!vd_am){vd_U.hide();return;}if(vd_jJ)return;vd_U.hide();vd_jJ=true;if(status)vd_sh=status;vd_U.end();};this.show=function(){if(!vd_am){if(vd_U.vd_nl())vd_D.ActiveRender().vd_H.vd_sb(true);return;}if(vd_mi)return;if(vd_D.ToolTip.hide())vd_tD();vd_D.ActiveRender().vd_H.vd_sb(true);vd_mi=true;};this.hide=function(){if(!vd_am){if(vd_U.vd_nl()){vd_U.draw(true);vd_D.ActiveRender().vd_H.vd_sb(false);}return;}if(!vd_mi)return;if(vd_D.ToolTip.hide())vd_tD();vd_U.draw(true);vd_mi=false;vd_D.ActiveRender().vd_H.vd_sb(false);};this.mouseover=function(evt){vd_U.show();};this.mouseout=function(evt){vd_U.vd_oQ(evt);if(vd_D.HideActionOnMouseOut)vd_U.hide();};this.resize=function(){vd_U.hide();};function vd_In(evt){var entity=vd_D.GetEntityFromPoint(evt.xPix,evt.yPix);if(entity!=null&&entity.ToolTip){vd_U.hide();vd_Pw("pointer");var timeout=undefined;if(entity._t===vdConst.vdNote_code&&vdConst.NOTE_TOOLTIP_TIMEOUT>0)timeout=vdConst.NOTE_TOOLTIP_TIMEOUT;vd_D.ToolTip.vd_BK([evt.xPix+vd_D.ToolTip.BoundaryOffset[0],evt.yPix+vd_D.ToolTip.BoundaryOffset[1]],entity.ToolTip,undefined,timeout);return true;}else{if(vd_D.ToolTip.hide())vd_tD();}return false;};this.mousemove=function(evt){var vd_wu=true;if(vd_am&&vd_mi&&vd_lB&&vd_lh){var dx=Math.abs(evt.xPix-vd_lh[X]);var dy=Math.abs(evt.yPix-vd_lh[Y]);if(dx<4&&dy<4)vd_wu=false;}if(vd_wu)vd_U.vd_oQ(evt);vd_y=null;vd_fr=null;if(!vd_am||vd_dP){var vd_rk=false;if(evt.prevPos!=null){var vd_Ci=(vd_U.DefaultActions&(vdConst.DEFAULT_SCROLL|vdConst.DEFAULT_ROTATE3D));if(vd_Ci!=0){if((evt.istouched===true)||(evt.istouched!==true&&vd_yw(vd_U.PanMouseButton,evt))){vd_rk=true;if(vd_D.GetActiveLayout()===vd_D.vd_uA()&&vd_Ci===vdConst.DEFAULT_ROTATE3D){vd_D.vd_CF(evt.prevPos,evt.xPix,evt.yPix,vd_D.GetDefaultTimeOutMilliseconds());}else{vd_D.scroll(evt.prevPos,evt.xPix,evt.yPix,vd_D.GetDefaultTimeOutMilliseconds());}}else if(evt.istouched!==true&&vd_yw(vd_U.RotateMouseButton,evt)){vd_rk=true;if((vd_U.DefaultActions&vdConst.DEFAULT_ROTATE3D)==0||vd_D.GetActiveLayout()!==vd_D.vd_uA()){vd_D.scroll(evt.prevPos,evt.xPix,evt.yPix,vd_D.GetDefaultTimeOutMilliseconds());}else{vd_D.vd_CF(evt.prevPos,evt.xPix,evt.yPix,vd_D.GetDefaultTimeOutMilliseconds());}}}if(!vd_rk&&((vd_U.DefaultActions&vdConst.DEFAULT_ZOOMSCALE)==vdConst.DEFAULT_ZOOMSCALE)&&vd_yw(vd_U.ZoomScaleMouseButton,evt)&&vd_gH&&vd_lk){var vd_pc=evt.yPix-vd_lk[Y];if(Math.abs(vd_pc)>2){vd_pc=(vd_pc<0?vd_D.MouseWheelZoomScale:(1/vd_D.MouseWheelZoomScale));vd_rk=true;vd_D.zoomScale(vd_gH[X],vd_gH[Y],vd_pc,vd_D.GetDefaultTimeOutMilliseconds());vd_lk=[evt.xPix,evt.yPix];}}}if(!vd_rk&&vd_D.ToolTip.AutoShow){if(vd_In(evt))return;}}if(!vd_am&& !vd_U.vd_nl())return;if(!vd_mi)vd_U.show();vd_U.draw(true);vd_cS=vd_D.ActiveRender().vd_sK(evt.xPix,evt.yPix);vd_HI();evt.vd_HA(vd_cS);if(vd_am&& !vd_dP)vd_y=vd_D.vd_Ju(evt.xPix,evt.yPix);vd_U.draw(false);if(vd_wu)vd_Fr(evt);};this.dblclick=function(evt){if(!vd_am||vd_dP){if((vd_U.DefaultActions&vdConst.DEFAULT_ZOOMEXTENTS)!=0){vd_D.zoomExtents();vd_D.redraw();}return;}};this.vd_vt=function(mode){var vd_RM=vd_U.OrthoMode;vd_U.OrthoMode=mode;return vd_RM;};function vd_Qm(){if(!vd_U.vd_nl())return;var layout=vd_D.GetActiveLayout();if(!layout)return;if(!layout.SnapMode)return;var vd_jw=vd_cS;var elevation=0.0;vd_jw[Z]=elevation;var fr1,fr2,fr3,vd_em,vd_cZ,vd_ep,vd_fb;var vd_bz=[0,0,0];var p0=[0,0,0];var p1=[0,0,0];vd_em=layout.SnapSpaceX;vd_cZ=layout.SnapSpaceY;if(layout.SnapSpaceX==0.0||layout.SnapSpaceY==0.0){vd_em=layout.GridSpaceX;vd_cZ=layout.GridSpaceY;}if((vd_em/vd_D.ActiveRender().pixelsize)<2.0||(vd_cZ/vd_D.ActiveRender().pixelsize)<2.0)return;fr1=0;vd_ep=Math.sin(fr1);vd_fb=Math.cos(fr1);vd_bz[X]=layout.SnapBase[X];vd_bz[Y]=layout.SnapBase[Y];vd_bz[Z]=vd_jw[Z];p0[X]=(vd_jw[X]-vd_bz[X])*vd_fb+(vd_jw[Y]-vd_bz[Y])*vd_ep;p0[Y]=(vd_bz[X]-vd_jw[X])*vd_ep+(vd_jw[Y]-vd_bz[Y])*vd_fb;p0[Z]=vd_jw[Z];if((p0[X]!=0.0)||(p0[Y]!=0.0)){fr3=p0[X]/vd_em;fr1=vdgeo.vd_u(fr3);fr3=fr3-fr1;p1[X]=fr1*vd_em;fr2=p0[Y]/vd_cZ;fr1=vdgeo.vd_u(fr2);fr2=fr2-fr1;p1[Y]=fr1*vd_cZ;p1[Z]=vd_jw[Z];if(fr2<= -0.5)p0[Y]=p1[Y]-vd_cZ;else if(fr2>=0.5)p0[Y]=p1[Y]+vd_cZ;else p0[Y]=p1[Y];if(fr3<= -0.5)p0[X]=p1[X]-vd_em;else if(fr3>=0.5)p0[X]=p1[X]+vd_em;else p0[X]=p1[X];}vd_cS[X]=p0[X]*vd_fb-p0[Y]*vd_ep+vd_bz[X];vd_cS[Y]=p0[X]*vd_ep+p0[Y]*vd_fb+vd_bz[Y];vd_cS[Z]=elevation;};function vd_HI(){vd_Qm();if(!vd_am)return;if(vd_U.OrthoMode){if(vd_U.actionType==vdConst.ACTION_LINE_WORLD){if(vd_aF){vd_fr=[vd_cS[X],vd_cS[Y],vd_cS[Z]];var dx=Math.abs(vd_cS[X]-vd_aF[X]);var dy=Math.abs(vd_cS[Y]-vd_aF[Y]);if(dy<dx)vd_fr[Y]=vd_aF[Y];else vd_fr[X]=vd_aF[X];vd_fr[Z]=vd_aF[Z];}}}};this.parse=function(vd_MW){if(!vd_am||vd_dP)return;var str=vd_MW.trim();if(str.length==0)return;var pt=null;var items;if(str[0]!='@'&&str.indexOf(",")>=0){items=str.split(",");if(items.length==2){pt=[Number(items[0]),Number(items[1]),0];}else if(items.length==3){pt=[Number(items[0]),Number(items[1]),Number(items[2])];}}else if(vd_aF&&vd_U.actionType!=vdConst.ACTION_POINT_WORLD){if(str.indexOf("<")>=0){items=str.split("<");if(items.length==2){pt=vdgeo.pointPolar(vd_aF,vdgeo.DegreesToRadians(Number(items[1])),Number(items[0]))}}else if(str[0]=='@'){str=str.substr(1);items=str.split(",");if(items.length==2){pt=[vd_aF[X]+Number(items[0]),vd_aF[Y]+Number(items[1]),vd_aF[Z]];}else if(items.length==3){pt=[vd_aF[X]+Number(items[0]),vd_aF[Y]+Number(items[1]),vd_aF[Z]+Number(items[2])];}}}if(!pt)return;vd_y=null;vd_fr=null;vd_cS=pt;vd_Cn();};this.click=function(evt){};this.mouseup=function(evt){vd_U.vd_oQ(evt);vd_gH=null;vd_lk=null;if(!vd_am||vd_dP)return;if(!vd_D.vd_iR([evt.xPix,evt.yPix])){vd_U.cancel();}else{if(vd_D.vd_np(vd_U,'mouseup',evt))return;if(evt.mousebutton<=1){vd_Cn(evt);}}};var vd_lB=0;this.vd_oQ=function(evt){vd_lh=null;if(vd_lB)clearTimeout(vd_lB);vd_lB=0;};function vd_Fr(evt){if(!vd_am||vd_dP)return;if(vd_lB>0)vd_U.vd_oQ(evt);if(evt.mousebutton!=1)return;var timeout=vd_U.TouchCancelTimeOut;if(timeout<0&&vd_U.TouchSupported())timeout=Math.abs(timeout);if(timeout>0){vd_lh=[evt.xPix,evt.yPix];vd_lB=setTimeout(function(evt){if(!vd_D.vd_np(vd_U,'mousetimeout',evt))vd_U.cancel(1);},timeout);}};this.mousedown=function(evt){vd_U.vd_oQ(evt);var dx=0;var dy=0;if(vd_gH){dx=Math.abs(evt.xPix-vd_gH[X]);dy=Math.abs(evt.yPix-vd_gH[Y]);}vd_gH=[evt.xPix,evt.yPix];vd_lk=[evt.xPix,evt.yPix];if(!vd_am&& !vd_dP&&dx<2&&dy<2&&vd_D.GripManager.vd_Es(evt))return;if(!vd_am&& !vd_dP){var timeout=vd_U.TouchCancelTimeOut;if(timeout<0&&vd_U.TouchSupported())timeout=Math.abs(timeout);if(timeout>0){evt.mousebutton=3;vd_lB=setTimeout(vd_U.mousedown,timeout,evt);return;}}if(!vd_am||vd_dP)return;vd_U.show();if(evt.mousebutton>1){vd_U.cancel(1);}else{vd_Fr(evt);vd_U.mousemove(evt);return;}};function vd_Cn(evt){if(vd_U.actionType==vdConst.ACTION_POINT_WORLD){vd_U.end();}else{vd_U.actionCount++;if(vd_U.actionCount==2){vd_U.end();}else{vd_D.vd_np(vd_U,'count');vd_aF=vd_Fs();if(vd_cS[W]!==undefined)vd_aF.push(vd_cS[W]);}}};this.mousewheel=function(e){if((vd_U.DefaultActions&vdConst.DEFAULT_ZOOMSCALE)!=0&&(vd_U.ZoomScaleMouseButton&vdConst.MouseMiddleButton)!=0){vd_D.zoomScale(e.xPix,e.yPix,e.Delta,vd_D.GetDefaultTimeOutMilliseconds());}};this.vd_HO=function(e){vd_D.vd_Ne(e.PrevPos1,e.PrevPos2,e.Pos1,e.Pos2,vd_U.DefaultActions)};this.keydown=function(e){if(!vd_am&& !vd_dP&&e.keyCode==27)vd_D.GripManager.vd_Es(null);if(!vd_am||vd_dP)return;if(e.keyCode==27)vd_U.cancel();};this.draw=function(vd_Mn){if(!vd_am&& !vd_U.vd_nl())return;if(!vd_D.ActiveRender().vd_H.vd_xB())return;if(vd_Mn){vd_D.ActiveRender().vd_H.vd_NK();return;}var vd_Pr=vd_D.ActiveRender().vd_bH;vd_D.ActiveRender().vd_bH=false;var vd_Qc=vd_D.ActiveRender().vd_H.vd_eo;vd_D.ActiveRender().vd_H.vd_eo=false;var vd_oD=vd_D.vd_fO;vd_D.vd_fO=false;vd_D.ActiveRender().vd_eT();var vd_md=vd_U.vd_vF;if(vd_md==null)vd_md=vd_D.ActiveRender().vd_iN();var vd_zJ=vd_D.ActiveRender().vd_H.Alpha;var vd_fX=vd_D.ActiveRender().vd_ao(vd_md);var vd_vw=vd_D.ActiveRender().vd_bf(Math.max(1,vd_U.vd_jB));var vd_pv=vd_D.ActiveRender().vd_bE();vd_He();var pts=[];var vd_hT=vd_U.DrawPoint();if(vd_am&&vd_U.DrawActionDefault&&(vd_U.actionType==vdConst.ACTION_LINE_WORLD||vd_U.actionType==vdConst.ACTION_RECT_VIEW)&&vd_U.actionCount==1){if(vd_U.actionType==vdConst.ACTION_LINE_WORLD){vd_D.ActiveRender().vd_cW(vd_aF,vd_hT);}else{var vd_hj=vd_pv;if(vd_D.ActiveRender().vd_ak)vd_hj=vd_D.ActiveRender().vd_dZ();var vd_dE=vdgeo.vd_do(vd_hT,vd_hj);var vd_aZ=vdgeo.vd_do(vd_aF,vd_hj);vd_D.ActiveRender().vd_bh(vdgeo.vd_aR(vd_hj));pts=[[vd_aZ[X],vd_aZ[Y],0],[vd_dE[X],vd_aZ[Y],0],[vd_dE[X],vd_dE[Y],0],[vd_aZ[X],vd_dE[Y],0]];var vd_yt=(vd_aZ[X]>vd_dE[X]);if((vd_U.DispProps&vdConst.ACTION_DISPLAY_USEFILLCOLOR)!=0&&vd_U.vd_on!=null&&vd_U.vd_nX!=null){if(vd_yt)vd_md=vd_U.vd_nX;else vd_md=vd_U.vd_on;}vd_D.ActiveRender().vd_ao(vd_md);var alpha=vd_D.ActiveRender().vd_H.vd_mQ(255);vd_D.ActiveRender().vd_cd(pts,true);vd_D.ActiveRender().vd_H.vd_mQ(alpha);if((vd_U.DispProps&vdConst.ACTION_DISPLAY_USEFILLCOLOR)!=0&&vd_U.vd_on!=null&&vd_U.vd_nX!=null){vd_D.ActiveRender().vd_er(pts);}vd_D.ActiveRender().vd_bC();}}if(vd_am&&vd_y&&(vd_U.actionType==vdConst.ACTION_LINE_WORLD||vd_U.actionType==vdConst.ACTION_POINT_WORLD)){vd_D.ActiveRender().vd_ao(vd_U.vd_vN);vd_D.ActiveRender().vd_bf(2);var vd_p=vd_D.ActiveRender().GetPixelSize()*vd_U.vd_vZ/2;pts=[];var vd_ag,vd_iV,ang;vd_D.ActiveRender().vd_bh(vdgeo.vd_aR(vd_pv));switch(vd_y[3]){case vdConst.OsnapMode_END:vd_D.ActiveRender().vd_cd([[vd_y[X]-vd_p,vd_y[Y]-vd_p,0],[vd_y[X]-vd_p,vd_y[Y]+vd_p,0],[vd_y[X]+vd_p,vd_y[Y]+vd_p,0],[vd_y[X]+vd_p,vd_y[Y]-vd_p,0]],true);break;case vdConst.OsnapMode_NEA:vd_D.ActiveRender().vd_cd([[vd_y[X]-vd_p,vd_y[Y]-vd_p,0],[vd_y[X]+vd_p,vd_y[Y]+vd_p,0],[vd_y[X]-vd_p,vd_y[Y]+vd_p,0],[vd_y[X]+vd_p,vd_y[Y]-vd_p,0]],true);break;case vdConst.OsnapMode_MID:vd_D.ActiveRender().vd_cd([[vd_y[X]-vd_p,vd_y[Y]-vd_p,0],[vd_y[X],vd_y[Y]+vd_p,0],[vd_y[X]+vd_p,vd_y[Y]-vd_p,0]],true);break;case vdConst.OsnapMode_QUA:vd_D.ActiveRender().vd_cd([[vd_y[X]-vd_p,vd_y[Y],0],[vd_y[X],vd_y[Y]+vd_p,0],[vd_y[X]+vd_p,vd_y[Y],0],[vd_y[X],vd_y[Y]-vd_p,0]],true);break;case vdConst.OsnapMode_CEN:{vd_ag=vdgeo.vd_iZ(vdgeo.CURVERESOLUTION,vd_D.ActiveRender().vd_dF(),vd_p,vdgeo.VD_TWOPI);vd_iV=vdgeo.VD_TWOPI/vd_ag;for(ang=0;ang<=vdgeo.VD_TWOPI;ang+=vd_iV){pts.push(vdgeo.newpoint(vd_y[X]+vd_p*Math.cos(ang),vd_y[Y]+vd_p*Math.sin(ang),0));}vd_D.ActiveRender().vd_cd(pts,true);}break;case vdConst.OsnapMode_INS:vd_D.ActiveRender().vd_cd([[vd_y[X]-vd_p,vd_y[Y],0],[vd_y[X]+vd_p,vd_y[Y],0],[vd_y[X]+vd_p,vd_y[Y]-vd_p,0],[vd_y[X],vd_y[Y]-vd_p,0],[vd_y[X],vd_y[Y]+vd_p,0],[vd_y[X]-vd_p,vd_y[Y]+vd_p,0]],true);break;case vdConst.OsnapMode_NODE:{vd_ag=vdgeo.vd_iZ(vdgeo.CURVERESOLUTION,vd_D.ActiveRender().vd_dF(),vd_p,vdgeo.VD_TWOPI);vd_iV=vdgeo.VD_TWOPI/vd_ag;for(ang=0;ang<=vdgeo.VD_TWOPI;ang+=vd_iV){pts.push(vdgeo.newpoint(vd_y[X]+vd_p*Math.cos(ang),vd_y[Y]+vd_p*Math.sin(ang),0));}vd_D.ActiveRender().vd_cd(pts,true);vd_D.ActiveRender().vd_cW([vd_y[X]-vd_p,vd_y[Y]-vd_p,0],[vd_y[X]+vd_p,vd_y[Y]+vd_p,0]);vd_D.ActiveRender().vd_cW([vd_y[X]-vd_p,vd_y[Y]+vd_p,0],[vd_y[X]+vd_p,vd_y[Y]-vd_p,0]);}break;default:vd_D.ActiveRender().vd_cd([[vd_y[X]-vd_p,vd_y[Y]-vd_p,0],[vd_y[X]-vd_p,vd_y[Y]+vd_p,0],[vd_y[X]+vd_p,vd_y[Y]+vd_p,0],[vd_y[X]+vd_p,vd_y[Y]-vd_p,0]],true);break;}vd_D.ActiveRender().vd_bC();}vd_D.ActiveRender().vd_ao(vd_fX);vd_D.ActiveRender().vd_H.vd_mQ(vd_zJ);vd_D.ActiveRender().vd_bf(vd_vw);if(vd_am)vd_D.vd_np(vd_U,'draw');vd_D.vd_fO=vd_oD;vd_D.ActiveRender().vd_H.Refresh();vd_D.ActiveRender().vd_H.vd_eo=vd_Qc;vd_D.ActiveRender().vd_bH=vd_Pr;vd_D.ActiveRender().vd_eT();};Object.defineProperty(vd_U,'ReferencePoint',{get:function(){if(vd_U.actionType==vdConst.ACTION_POINT_WORLD)return null;return vdConst.cloneEntity(vd_aF);},set:function(newValue){if(vd_U.actionType==vdConst.ACTION_POINT_WORLD)return;vd_U.vd_vE(newValue);}});Object.defineProperty(vd_U,'CurrentPoint',{get:function(){return vdConst.cloneEntity(vd_cS);}});Object.defineProperty(vd_U,'OsnapPoint',{get:function(){return vdConst.cloneEntity(vd_y);}});Object.defineProperty(vd_U,'OrthoPoint',{get:function(){return vdConst.cloneEntity(vd_fr);}});this.SelectedPoint=function(clone){var ret=vd_cS;if(vd_U.ResValue){if(vd_U.ResValue.length==2)ret=vd_U.ResValue[1];else ret=vd_U.ResValue;}if(clone)ret=vdConst.cloneEntity(ret);return ret;};this.DrawPoint=function(){if(vd_fr)return vd_fr;return vd_cS;};Object.defineProperty(vd_U,'render',{get:function(){return vd_D.ActiveRender();}});return this;};var vd_Ls=[0,1,1,1,1,1,1,0,1,0,1,1,1,1,0,1,1,1,0,1,1,0,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,0,1,1,0,1,1,1,0,1,1,1,1,0,1,0,1,1,1,1,1,1,0];function vd_OI(vd_Qd,vd_wQ){var vd_U=this;this.vd_eo=true;this.vd_lP=[1.0,1.0,1.0];var vd_eM=undefined;this.vd_ji=function(){return vd_eM;};this.vd_fi=0;this.zFar=1;this.vd_Ip=function(vd_If,zfar){vd_U.vd_fi=vd_If;vd_U.zFar=zfar;};this.vd_i=vd_Qd;this.Alpha=255;this.vd_at=[0,0,0,255];this.penwidth=0;var vd_ac=[0,0,0,255];this.vd_az=0;this.vd_bG=0;var vd_aI=null;var vd_W=null;var vd_uM=0;var px=0,py=0;this.vd_iH=vdConst.InterpolationMode_Bilinear;function vd_Cm(p){return vdgeo.vd_u(p+0.49);};function vd_Hj(p){return vdgeo.vd_u(p);};var vd_bR=vd_Cm;this.vd_eT=function(){vd_sW=vd_PM;if(vd_U.vd_i.vd_bH||vd_U.vd_i.vd_bY){vd_bR=vd_Cm;if(vd_U.vd_i.vd_bY)vd_sW=vd_Fb;}else{vd_bR=vd_Hj;}};var vd_GV=0;var vd_oq;function vd_Fb(px,py,pz){if(vd_U.vd_i.vd_bY.length===0)return true;for(var i=0;i<vd_U.vd_i.vd_bY.length;i++){vd_oq=vd_U.vd_i.vd_bY[i][2];vd_GV=vd_oq[A20]*px+vd_oq[A21]*py+vd_oq[A22]*pz+vd_oq[A23];if(vd_GV<0)return false;}return true;};function vd_PM(px,py,pz){return true;};var vd_sW=vd_Fb;this.vd_Os=function(img){if(img!=null){if(img._a1==false||(typeof(_evl)!='undefined'&&_evl(vd_U)==false)){var bytescount=4;var left=vd_bR((vd_U.vd_az-img.width)*0.5);var top=vd_bR((vd_U.vd_bG-img.height)*0.5);left=Math.max(left,0);top=Math.max(top,0);var right=left+img.width;var bottom=top+img.height;right=Math.min(right,vd_U.vd_az);bottom=Math.min(bottom,vd_U.vd_bG);var div=101/255;for(var y=top;y<bottom;y++){for(var x=left;x<right;x++){var srcy=y-top;var srcx=(x-left)*bytescount;var pos=(((vd_U.vd_bG-1)-y)*vd_U.vd_az+x)*4;var ir=img.bytes[srcy][srcx];var ig=img.bytes[srcy][srcx+1];var ib=img.bytes[srcy][srcx+2];ir=vdgeo.vd_u(ir*div+vd_W[pos]*(1-div));ig=vdgeo.vd_u(ig*div+vd_W[pos+1]*(1-div));ib=vdgeo.vd_u(ib*div+vd_W[pos+2]*(1-div));vd_W[pos]=ir;vd_W[pos+1]=ig;vd_W[pos+2]=ib;vd_W[pos+3]=255;}}}}};this.vd_qu=function(){return vd_aI;};this.vd_gl=function(data,width,height,vd_RA){vd_aI=data;if(!vd_aI){vd_W=null;vd_eM=null;vd_U.vd_az=0;vd_U.vd_bG=0;vd_uM=0;}else{vd_W=vd_aI.data;vd_U.vd_az=parseInt(width);vd_U.vd_bG=parseInt(height);vd_uM=vd_U.vd_az*vd_U.vd_bG*4;var len=vd_uM/4;vd_eM=[];vd_eM.length=len;for(i=0;i<len;i++){vd_eM[i]=[1,undefined,undefined];}}};function vd_Jk(){var len=vd_eM.length;var i;var item;for(i=0;i<len;i++){item=vd_eM[i];item[0]=1.0;item[1]=undefined;item[2]=undefined;}};this.clear=function(color){vd_ac=color;vd_IG(vd_W,color);if(vd_U.vd_i.vd_bH||vd_U.vd_i.vd_bJ){vd_Jk();}};this.vd_DK=function(img){var i;if(!vd_aI)return;if(vd_U.vd_i.vd_ab())vd_U.vd_i.vd_nd();if(vd_U.vd_i.vdraw&&vd_U.vd_i.vdraw.Notes)vd_U.vd_i.vdraw.Notes.vd_pJ(vd_U.vd_i);vd_U.vd_Os(img);for(i=3;i<vd_uM;i+=4){if(vd_W[i]==0)vd_W[i]=vd_ac[3];else vd_W[i]=255;}vd_U.vd_go(null);};function vd_IG(data,color){if(!data|| !color)return;var left=vd_U.vd_i.clip[0];var right=vd_U.vd_i.clip[2];var top=vd_U.vd_i.clip[1];var bottom=vd_U.vd_i.clip[3];var iy,ix;var k=(top*vd_U.vd_az+left)*4;var off=(vd_U.vd_az-right+left-1)*4;for(iy=top;iy<=bottom;iy++){for(ix=left;ix<=right;ix++){data[k++]=color[0];data[k++]=color[1];data[k++]=color[2];data[k++]=0;}k+=off;}};this.vd_QR=function(){return false;};this.vd_mQ=function(vd_KP){var ret=vd_U.Alpha;vd_U.Alpha=vd_KP;return ret;};this.vd_ao=function(Color){if(Color[3]!==undefined)vd_U.Alpha=Color[3];vd_U.vd_at=Color;};this.vd_bf=function(vd_oM){vd_U.penwidth=vd_oM;};this.vd_Rj=function(x,y,z,w){if(!w||w<2)vd_U.vd_xJ(x,y,z);else{x-=w/2.0;y-=w/2.0;var sx=0,ex=0,i=0,x1=x,y1;for(var h=0;h<w;h++){y1=y+h;if(y1<vd_U.vd_i.clip[1]||y1>vd_U.vd_i.clip[3])continue;sx=Math.max(vd_U.vd_i.clip[0],x1);ex=Math.min(vd_U.vd_i.clip[2],x1+w);sx=vd_bR(sx);ex=vd_bR(ex);y1=vd_bR(y1);for(i=sx;i<ex;i++){vd_ck(i,y1);vd_U.vd_aP(z);}}}};this.vd_Oi=function(x,y,z,w){if(!w||w<2)vd_U.vd_xJ(x,y,z);else{var s=0,e=0,i=0,x1=x-w/2.0,y1=y;s=Math.max(vd_U.vd_i.clip[0],x1);e=Math.min(vd_U.vd_i.clip[2],x1+w);s=vd_bR(s);e=vd_bR(e);y1=vd_bR(y1);for(i=s;i<e;i++){vd_ck(i,y1);vd_U.vd_aP(z);}x1=x,y1=y-w/2.0;s=Math.max(vd_U.vd_i.clip[1],y1);e=Math.min(vd_U.vd_i.clip[3],y1+w);s=vd_bR(s);e=vd_bR(e);x1=vd_bR(x1);for(i=s;i<e;i++){vd_ck(x1,i);vd_U.vd_aP(z);}}};this.vd_xJ=function(x1,y1,z1){vd_ck(vd_bR(x1),vd_bR(y1));vd_U.vd_aP(z1);};this.vd_NM=function(x1,y1,x2,y2){x1=vd_bR(x1);y1=vd_bR(y1);x2=vd_bR(x2);y2=vd_bR(y2);vd_U.vd_rw(x1,y1,x2,y2,1,1);};this.vd_Dt=function(x1,y1,w,z1,z2,u1,v1,w1,u2,v2,w2){var iz=0,iu=0,iv=0,iw=0;var gradient=0,sx=0,ex=0,x=0,z=0,u=0,v=0,tw=0;if(y1<vd_U.vd_i.clip[1]||y1>vd_U.vd_i.clip[3])return;sx=Math.max(vd_U.vd_i.clip[0],x1);ex=Math.min(vd_U.vd_i.clip[2],x1+w);sx=vd_bR(sx);ex=vd_bR(ex);if(vd_U.Alpha!=255&&ex!=vd_U.vd_i.clip[2])ex--;y1=vd_bR(y1);iz=(z2-z1);iu=(u2-u1);iv=(v2-v1);iw=(w2-w1);var scol=vd_U.vd_at;if(vd_U.vd_i.vd_gw){for(x=sx;x<ex;x++){gradient=(x-x1)/w;z=z1+iz*gradient;u=u1+iu*gradient;v=v1+iv*gradient;tw=w1+iw*gradient;vd_U.vd_at=[vdgeo.vd_u(u),vdgeo.vd_u(v),vdgeo.vd_u(tw)];vd_ck(x,y1);vd_U.vd_aP(z);}vd_U.vd_at=scol;}else{for(x=sx;x<ex;x++){gradient=(x-x1)/w;z=z1+iz*gradient;u=u1+iu*gradient;v=v1+iv*gradient;tw=w1+iw*gradient;if(tw!=0.0){u/=tw;v/=tw;}vd_ck(x,y1);vd_U.vd_aP(z,true,u,v);}}};var vd_Fe=false;var vd_ef=[0,0,0,0,0,0,0,0,0,0];this.vd_DV=function(x1,y1,w,z1,z2){var iz=0;var sx=0,ex=0,i=0,gradient=0,z=0;if(y1<vd_U.vd_i.clip[1]||y1>vd_U.vd_i.clip[3])return;sx=Math.max(vd_U.vd_i.clip[0],x1);ex=Math.min(vd_U.vd_i.clip[2],x1+w);sx=vd_bR(sx);ex=vd_bR(ex);y1=vd_bR(y1);iz=(z2-z1);if(vd_U.Alpha!=255&&ex!=vd_U.vd_i.clip[2])ex--;for(i=sx;i<ex;i++){gradient=(i-x1)/w;z=z1+iz*gradient;vd_ck(i,y1);vd_U.vd_aP(z);}};this.vd_vg=function(x1,y1,w){var sx=0,ex=0,i=0;if(y1<vd_U.vd_i.clip[1]||y1>vd_U.vd_i.clip[3])return;sx=Math.max(vd_U.vd_i.clip[0],x1);ex=Math.min(vd_U.vd_i.clip[2],x1+w);sx=vd_bR(sx);ex=vd_bR(ex);y1=vd_bR(y1);if(vd_U.Alpha!=255&&ex!=vd_U.vd_i.clip[2])ex--;for(i=sx;i<ex;i++){vd_ck(i,y1);vd_U.vd_aP(1);}};this.vd_NP=function(x1,y1,x2,y2,z1,z2){vd_Fe=true;vd_ef[0]=x1;vd_ef[1]=y1;vd_ef[2]=z1;vd_ef[3]=x2;vd_ef[4]=y2;vd_ef[5]=z2;x1=vd_bR(x1);y1=vd_bR(y1);x2=vd_bR(x2);y2=vd_bR(y2);vd_U.vd_rw(x1,y1,x2,y2,z1,z2);vd_Fe=false;};var y=0;var vd_T=0,vd_N=0,minx=0,maxx=0;var x1=0,y1=0,z1=0;var x2=0,y2=0,z2=0;var ind1=0,ind2=0;var ints=0;var uvx1=0,uvx2=0,uvy1=0,uvy2=0,uvz1=0,uvz2=0;var p1,p2,uv1,uv2,l1,l2;this.vd_NE=function(pts,uvs,vd_fu){if(!uvs||(!vd_U.vd_i.vd_gw&& !vd_U.vd_i.vd_fl)){vd_U.vd_lA(pts,vd_fu);return;}var gradient=0,u=0,v=0,w=0,x=0,z=0,i=0;var n=pts.length;if(n===0)return;p1=pts[0];vd_T=p1[Y];vd_N=p1[Y];minx=p1[X];maxx=p1[X];for(i=1;i<n;i++){p1=pts[i];if(p1[Y]<vd_T)vd_T=p1[Y];else if(p1[Y]>vd_N)vd_N=p1[Y];if(p1[X]<minx)minx=p1[X];else if(p1[X]>maxx)maxx=p1[X];}if(minx>vd_U.vd_i.clip[2])return;if(maxx<vd_U.vd_i.clip[0])return;if(vd_T>vd_U.vd_i.clip[3]||vd_N<vd_U.vd_i.clip[1])return;vd_T=Math.max(vd_T,vd_U.vd_i.clip[1]);vd_T=Math.min(vd_T,vd_U.vd_i.clip[3]);vd_N=Math.max(vd_N,vd_U.vd_i.clip[1]);vd_N=Math.min(vd_N,vd_U.vd_i.clip[3]);vd_T=Math.round(vd_T);vd_N=Math.round(vd_N);var vd_bT;for(y=vd_T;y<=vd_N;y++){vd_bT=[];ints=0;for(i=0;i<n;i++){if(i===0){ind1=n-1;ind2=0;}else{ind1=i-1;ind2=i;}p1=pts[ind1];p2=pts[ind2];y2=p2[Y];y1=p1[Y];if(y1==y2)continue;uv1=uvs[ind1];uv2=uvs[ind2];if(y1>y2){p2=pts[ind1];p1=pts[ind2];uv2=uvs[ind1];uv1=uvs[ind2];}y2=p2[Y];y1=p1[Y];x2=p2[X];x1=p1[X];z2=p2[Z];z1=p1[Z];uvy2=uv2[Y];uvy1=uv1[Y];uvx2=uv2[X];uvx1=uv1[X];uvz2=uv2[Z];uvz1=uv1[Z];if(((y>=y1)&&(y<y2))||((y===vd_N)&&(y>y1)&&(y<=y2))){gradient=(y-y1)/(y2-y1);u=vdgeo.vd_dp(uvx1,uvx2,gradient);v=vdgeo.vd_dp(uvy1,uvy2,gradient);w=vdgeo.vd_dp(uvz1,uvz2,gradient);z=vdgeo.vd_dp(z1,z2,gradient);x=vdgeo.vd_dp(x1,x2,gradient);ints++;vd_bT.push([x,z,u,v,w]);if(vd_fu&&ints===2)break;}}if(ints===0)continue;if(ints===2){l1=vd_bT[0];l2=vd_bT[1];if(l1[0]>l2[0]){l2=vd_bT[0];l1=vd_bT[1];}vd_U.vd_Dt(l1[0],y,l2[0]-l1[0]+1,l1[1],l2[1],l1[2],l1[3],l1[4],l2[2],l2[3],l2[4]);}else{vd_bT.sort(function(a,b){return a[0]-b[0]});for(var ii=0;ii<ints-1;ii+=2){l1=vd_bT[ii];l2=vd_bT[ii+1];vd_U.vd_Dt(l1[0],y,l2[0]-l1[0]+1,l1[1],l2[1],l1[2],l1[3],l1[4],l2[2],l2[3],l2[4]);}}}};this.vd_lA=function(pts,vd_fu){var gradient=0,x=0,z=0,i=0;var n=pts.length;if(n===0)return;p1=pts[0];vd_T=p1[Y];vd_N=p1[Y];minx=p1[X];maxx=p1[X];for(i=1;i<n;i++){p1=pts[i];if(p1[Y]<vd_T)vd_T=p1[Y];else if(p1[Y]>vd_N)vd_N=p1[Y];if(p1[X]<minx)minx=p1[X];else if(p1[X]>maxx)maxx=p1[X];}if(minx>vd_U.vd_i.clip[2])return;if(maxx<vd_U.vd_i.clip[0])return;if(vd_T>vd_U.vd_i.clip[3]||vd_N<vd_U.vd_i.clip[1])return;vd_T=Math.max(vd_T,vd_U.vd_i.clip[1]);vd_T=Math.min(vd_T,vd_U.vd_i.clip[3]);vd_N=Math.max(vd_N,vd_U.vd_i.clip[1]);vd_N=Math.min(vd_N,vd_U.vd_i.clip[3]);vd_T=Math.round(vd_T);vd_N=Math.round(vd_N);var vd_bT;for(y=vd_T;y<=vd_N;y++){vd_bT=[];ints=0;for(i=0;i<n;i++){if(i===0){ind1=n-1;ind2=0;}else{ind1=i-1;ind2=i;}p1=pts[ind1];p2=pts[ind2];y2=p2[Y];y1=p1[Y];if(y1==y2)continue;if(y1>y2){p2=pts[ind1];p1=pts[ind2];}y2=p2[Y];y1=p1[Y];x2=p2[X];x1=p1[X];z2=p2[Z];z1=p1[Z];if(((y>=y1)&&(y<y2))||((y===vd_N)&&(y>y1)&&(y<=y2))){gradient=(y-y1)/(y2-y1);z=vdgeo.vd_dp(z1,z2,gradient);x=vdgeo.vd_dp(x1,x2,gradient);ints++;vd_bT.push([x,z]);if(vd_fu&&ints===2)break;}}if(ints===0)continue;if(ints===2){l1=vd_bT[0];l2=vd_bT[1];if(l1[0]>l2[0]){l2=vd_bT[0];l1=vd_bT[1];}vd_U.vd_DV(l1[0],y,l2[0]-l1[0]+1,l1[1],l2[1]);}else{vd_bT.sort(function(a,b){return a[0]-b[0]});for(var ii=0;ii<ints-1;ii+=2){l1=vd_bT[ii];l2=vd_bT[ii+1];vd_U.vd_DV(l1[0],y,l2[0]-l1[0]+1,l1[1],l2[1]);}}}};this.vd_eG=function(pts){var gradient=0,i=0;var n=pts.length;if(n===0)return;p1=pts[0];vd_T=p1[Y];vd_N=p1[Y];minx=p1[X];maxx=p1[X];for(i=1;i<n;i++){p1=pts[i];if(p1[Y]<vd_T)vd_T=p1[Y];else if(p1[Y]>vd_N)vd_N=p1[Y];if(p1[X]<minx)minx=p1[X];else if(p1[X]>maxx)maxx=p1[X];}if(minx>vd_U.vd_i.clip[2])return;if(maxx<vd_U.vd_i.clip[0])return;if(vd_T>vd_U.vd_i.clip[3]||vd_N<vd_U.vd_i.clip[1])return;vd_T=Math.max(vd_T,vd_U.vd_i.clip[1]);vd_T=Math.min(vd_T,vd_U.vd_i.clip[3]);vd_N=Math.max(vd_N,vd_U.vd_i.clip[1]);vd_N=Math.min(vd_N,vd_U.vd_i.clip[3]);vd_T=Math.round(vd_T);vd_N=Math.round(vd_N);if(vd_N-vd_T<=1){vd_U.vd_vg(minx,vd_T,maxx-minx+1);return;}for(y=vd_T;y<=vd_N;y++){var vd_bT=[];ints=0;for(i=0;i<n;i++){if(i===0){ind1=n-1;ind2=0;}else{ind1=i-1;ind2=i;}p1=pts[ind1];p2=pts[ind2];y2=p2[Y];y1=p1[Y];if(y1==y2)continue;if(y1>y2){p2=pts[ind1];p1=pts[ind2];}y2=p2[Y];y1=p1[Y];x2=p2[X];x1=p1[X];if(((y>=y1)&&(y<y2))||((y===vd_N)&&(y>y1)&&(y<=y2))){gradient=(y-y1)/(y2-y1);var x=vdgeo.vd_dp(x1,x2,gradient);vd_bT.push(x);ints++;}}if(ints===0)continue;if(ints===2){l1=vd_bT[0];l2=vd_bT[1];if(l1>l2){l2=vd_bT[0];l1=vd_bT[1];}vd_U.vd_vg(l1,y,l2-l1+1);}else{vd_bT.sort(function(a,b){return a-b});for(var ii=0;ii<ints-1;ii+=2){vd_U.vd_vg(vd_bT[ii],y,vd_bT[ii+1]-vd_bT[ii]+1);}}}};this.vd_Oe=function(x1,y1,w,z1,z2,u1,v1,w1,u2,v2,w2){var iz=0,iu=0,iv=0,iw=0;var sx=0,ex=0,i=0,gradient=0,z=0,u=0,v=0,tw=0;var _sx=0,_ex=0,vd_gu=0,vd_hp,dx=0,dy=0;var vd_gY=0,sx_a=0,ex_a=0;sx=Math.max(vd_U.vd_i.clip[0],x1);ex=Math.min(vd_U.vd_i.clip[2],x1+w);_sx=vdgeo.vd_u(sx);_ex=vdgeo.vd_u(ex);if(_sx>=_ex)return;vd_gu=1.0;vd_hp=1.0;dx=(_sx-sx);if(dx<=0)dx=1.0+dx;dy=ex-_ex;if(dy<=0)dy=1.0+dy;vd_gu=Math.max(0.3,dx);vd_hp=Math.max(0.3,dy);sx=_sx;ex=_ex;y1=vdgeo.vd_u(y1);iz=(z2-z1);iu=(u2-u1);iv=(v2-v1);iw=(w2-w1);vd_gY=vd_U.Alpha;sx_a=vdgeo.vd_u(vd_gu*vd_U.Alpha);ex_a=vdgeo.vd_u(vd_hp*vd_U.Alpha);gradient=(sx-x1)/w;z=z1+iz*gradient;u=u1+iu*gradient;v=v1+iv*gradient;tw=w1+iw*gradient;if(tw!=0.0){u/=tw;v/=tw;}vd_ck(sx,y1);vd_U.Alpha=sx_a;vd_U.vd_aP(z,true,u,v);vd_U.Alpha=vd_gY;for(i=sx+1;i<ex-1;i++){gradient=(i-x1)/w;z=z1+iz*gradient;u=u1+iu*gradient;v=v1+iv*gradient;tw=w1+iw*gradient;if(tw!=0.0){u/=tw;v/=tw;}vd_ck(i,y1);vd_U.vd_aP(z,true,u,v);}if(i<ex){gradient=(i-x1)/w;z=z1+iz*gradient;u=u1+iu*gradient;v=v1+iv*gradient;tw=w1+iw*gradient;if(tw!=0.0){u/=tw;v/=tw;}vd_ck(i,y1);vd_U.Alpha=ex_a;vd_U.vd_aP(z,true,u,v);vd_U.Alpha=vd_gY;}};this.vd_MB=function(x1,y1,w,z1,z2){var iz=0;var sx=0,ex=0,i=0,gradient=0,z=0;var _sx=0,_ex=0,vd_gu=0,vd_hp,dx=0,dy=0;var vd_gY=0,sx_a=0,ex_a=0;sx=Math.max(vd_U.vd_i.clip[0],x1);ex=Math.min(vd_U.vd_i.clip[2],x1+w);_sx=vdgeo.vd_u(sx);_ex=vdgeo.vd_u(ex);if(_sx>=_ex)return;vd_gu=1.0;vd_hp=1.0;dx=(_sx-sx);if(dx<=0)dx=1.0+dx;dy=ex-_ex;if(dy<=0)dy=1.0+dy;vd_gu=Math.max(0.3,dx);vd_hp=Math.max(0.3,dy);sx=_sx;ex=_ex;y1=vdgeo.vd_u(y1);iz=(z2-z1);vd_gY=vd_U.Alpha;sx_a=vdgeo.vd_u(vd_gu*vd_U.Alpha);ex_a=vdgeo.vd_u(vd_hp*vd_U.Alpha);gradient=(sx-x1)/w;z=z1+iz*gradient;vd_ck(sx,y1);vd_U.Alpha=sx_a;vd_U.vd_aP(z);vd_U.Alpha=vd_gY;for(i=sx+1;i<ex-1;i++){gradient=(i-x1)/w;z=z1+iz*gradient;vd_ck(i,y1);vd_U.vd_aP(z);}if(i<ex){gradient=(i-x1)/w;z=z1+iz*gradient;vd_ck(i,y1);vd_U.Alpha=ex_a;vd_U.vd_aP(z);vd_U.Alpha=vd_gY;}};this.vd_ME=function(x1,y1,w){var sx=0,ex=0,i=0;var _sx=0,_ex=0,vd_gu=0,vd_hp,dx=0,dy=0;var vd_gY=0,sx_a=0,ex_a=0;sx=Math.max(vd_U.vd_i.clip[0],x1);ex=Math.min(vd_U.vd_i.clip[2],x1+w);_sx=vdgeo.vd_u(sx);_ex=vdgeo.vd_u(ex);if(_sx>=_ex)return;vd_gu=1.0;vd_hp=1.0;dx=(_sx-sx);if(dx<=0)dx=1.0+dx;dy=ex-_ex;if(dy<=0)dy=1.0+dy;vd_gu=Math.max(0.3,dx);vd_hp=Math.max(0.3,dy);sx=_sx;ex=_ex;y1=vdgeo.vd_u(y1);vd_gY=vd_U.Alpha;sx_a=vdgeo.vd_u(vd_gu*vd_U.Alpha);ex_a=vdgeo.vd_u(vd_hp*vd_U.Alpha);vd_ck(sx,y1);vd_U.Alpha=sx_a;vd_U.vd_aP(1);vd_U.Alpha=vd_gY;for(i=sx+1;i<ex-1;i++){vd_ck(i,y1);vd_U.vd_aP(1);}if(i<ex){vd_ck(i,y1);vd_U.Alpha=ex_a;vd_U.vd_aP(1);vd_U.Alpha=vd_gY;}};this.vd_mM=function(vd_aS){var gradient=0,x=0,a=0,i=0;vd_T=vd_N=minx=maxx=0;var vd_gE=[];for(a=0;a<vd_aS.length;a++){for(i=0;i<vd_aS[a].length;i++){p1=vd_aS[a][i];if(i===0&&a===0){vd_T=p1[Y];vd_N=p1[Y];minx=p1[X];maxx=p1[X];continue;}if(p1[Y]<vd_T)vd_T=p1[Y];else if(p1[Y]>vd_N)vd_N=p1[Y];if(p1[X]<minx)minx=p1[X];else if(p1[X]>maxx)maxx=p1[X];}}if(minx>vd_U.vd_i.clip[2])return;if(maxx<vd_U.vd_i.clip[0])return;if(vd_T>vd_U.vd_i.clip[3]||vd_N<vd_U.vd_i.clip[1])return;vd_T=Math.max(vd_T,vd_U.vd_i.clip[1]);vd_T=Math.min(vd_T,vd_U.vd_i.clip[3]);vd_N=Math.max(vd_N,vd_U.vd_i.clip[1]);vd_N=Math.min(vd_N,vd_U.vd_i.clip[3]);var y;var k=0;for(y=vd_T;y<=vd_N;y++){vd_gE.push(y);}ints=0;for(k=0;k<vd_gE.length;k++){y=vd_gE[k];var vd_bT=[];ints=0;for(a=0;a<vd_aS.length;a++){for(i=0;i<vd_aS[a].length-1;i++){ind1=i;ind2=i+1;p1=vd_aS[a][ind1];p2=vd_aS[a][ind2];y1=p1[Y];y2=p2[Y];if(y1==y2)continue;if(y1>y2){p2=vd_aS[a][ind1];p1=vd_aS[a][ind2];}y1=p1[Y];y2=p2[Y];x1=p1[X];x2=p2[X];if(((y>=y1)&&(y<y2))||((y===vd_N)&&(y>y1)&&(y<=y2))){gradient=(y-y1)/(y2-y1);x=vdgeo.vd_dp(x1,x2,gradient);vd_bT.push([x]);ints++;}}}if(ints===0)continue;vd_bT.sort(function(a,b){return a[0]-b[0]});for(var ii=0;ii<ints-1;ii+=2){l1=vd_bT[ii];l2=vd_bT[ii+1];vd_U.vd_ME(l1[0],y,l2[0]-l1[0]+1);}}};this.vd_ua=function(vd_aS){var gradient=0,x=0,z=0,a=0,i=0;vd_T=vd_N=minx=maxx=0;var vd_gE=[];for(a=0;a<vd_aS.length;a++){for(i=0;i<vd_aS[a].length;i++){p1=vd_aS[a][i];if(i===0&&a===0){vd_T=p1[Y];vd_N=p1[Y];minx=p1[X];maxx=p1[X];continue;}if(p1[Y]<vd_T)vd_T=p1[Y];else if(p1[Y]>vd_N)vd_N=p1[Y];if(p1[X]<minx)minx=p1[X];else if(p1[X]>maxx)maxx=p1[X];}}if(minx>vd_U.vd_i.clip[2])return;if(maxx<vd_U.vd_i.clip[0])return;if(vd_T>vd_U.vd_i.clip[3]||vd_N<vd_U.vd_i.clip[1])return;vd_T=Math.max(vd_T,vd_U.vd_i.clip[1]);vd_T=Math.min(vd_T,vd_U.vd_i.clip[3]);vd_N=Math.max(vd_N,vd_U.vd_i.clip[1]);vd_N=Math.min(vd_N,vd_U.vd_i.clip[3]);var y;var k=0;for(y=vd_T;y<=vd_N;y++){vd_gE[k++]=y;}ints=0;for(k=0;k<vd_gE.length;k++){y=vd_gE[k];var vd_bT=[];ints=0;for(a=0;a<vd_aS.length;a++){for(i=0;i<vd_aS[a].length-1;i++){ind1=i;ind2=i+1;p1=vd_aS[a][ind1];p2=vd_aS[a][ind2];y1=p1[Y];y2=p2[Y];if(y1==y2)continue;if(y1>y2){p2=vd_aS[a][ind1];p1=vd_aS[a][ind2];}y1=p1[Y];y2=p2[Y];x1=p1[X];x2=p2[X];z1=p1[Z];z2=p2[Z];if(((y>=y1)&&(y<y2))||((y===vd_N)&&(y>y1)&&(y<=y2))){gradient=(y-y1)/(y2-y1);z=vdgeo.vd_dp(z1,z2,gradient);x=vdgeo.vd_dp(x1,x2,gradient);vd_bT.push([x,z]);ints++;}}}if(ints===0)continue;vd_bT.sort(function(a,b){return a[0]-b[0]});for(var ii=0;ii<ints-1;ii+=2){l1=vd_bT[ii];l2=vd_bT[ii+1];vd_U.vd_MB(l1[0],y,l2[0]-l1[0]+1,l1[1],l2[1]);}}};this.vd_NB=function(vd_aS,uvs,vd_rt){if(!uvs|| !vd_U.vd_i.vd_fl){vd_U.vd_ua(vd_aS);return;}var gradient=0,x=0,z=0,a=0,i=0,u=0,v=0,w=0;vd_T=vd_N=minx=maxx=0;var vd_gE=[];for(a=0;a<vd_aS.length;a++){for(i=0;i<vd_aS[a].length;i++){p1=vd_aS[a][i];if(i===0&&a===0){vd_T=p1[Y];vd_N=p1[Y];minx=p1[X];maxx=p1[X];continue;}if(p1[Y]<vd_T)vd_T=p1[Y];else if(p1[Y]>vd_N)vd_N=p1[Y];if(p1[X]<minx)minx=p1[X];else if(p1[X]>maxx)maxx=p1[X];}}if(minx>vd_U.vd_i.clip[2])return;if(maxx<vd_U.vd_i.clip[0])return;if(vd_T>vd_U.vd_i.clip[3]||vd_N<vd_U.vd_i.clip[1])return;vd_T=Math.max(vd_T,vd_U.vd_i.clip[1]);vd_T=Math.min(vd_T,vd_U.vd_i.clip[3]);vd_N=Math.max(vd_N,vd_U.vd_i.clip[1]);vd_N=Math.min(vd_N,vd_U.vd_i.clip[3]);var y;var k=0;for(y=vd_T;y<=vd_N;y++){vd_gE.push(y);}ints=0;for(k=0;k<vd_gE.length;k++){y=vd_gE[k];var vd_bT=[];ints=0;for(a=0;a<vd_aS.length;a++){for(i=0;i<vd_aS[a].length-1;i++){ind1=i;ind2=i+1;p1=vd_aS[a][ind1];p2=vd_aS[a][ind2];y1=p1[Y];y2=p2[Y];if(y1==y2)continue;uv1=uvs[a][ind1];uv2=uvs[a][ind2];if(y1>y2){p2=vd_aS[a][ind1];p1=vd_aS[a][ind2];uv2=uvs[a][ind1];uv1=uvs[a][ind2];}y1=p1[Y];y2=p2[Y];x1=p1[X];x2=p2[X];z1=p1[Z];z2=p2[Z];uvx1=uv1[X];uvx2=uv2[X];uvy1=uv1[Y];uvy2=uv2[Y];uvz1=uv1[Z];uvz2=uv2[Z];if(((y>=y1)&&(y<y2))||((y===vd_N)&&(y>y1)&&(y<=y2))){gradient=(y-y1)/(y2-y1);u=vdgeo.vd_dp(uvx1*vd_rt,uvx2*vd_rt,gradient);v=vdgeo.vd_dp(uvy1*vd_rt,uvy2*vd_rt,gradient);w=1;z=vdgeo.vd_dp(z1,z2,gradient);x=vdgeo.vd_dp(x1,x2,gradient);vd_bT.push([x,z,u,v,w]);ints++;}}}if(ints===0)continue;vd_bT.sort(function(a,b){return a[0]-b[0]});for(var ii=0;ii<ints-1;ii+=2){l1=vd_bT[ii];l2=vd_bT[ii+1];vd_U.vd_Oe(l1[0],y,l2[0]-l1[0]+1,l1[1],l2[1],l1[2],l1[3],l1[4],l2[2],l2[3],l2[4]);}}};this.vd_pW=function(vd_j,vd_vC,vd_Jx,vd_Bt){if(vd_j==null)return;var vd_pn=vd_j.width;var vd_oG=vd_j.height;var vd_ih=vdgeo.vd_e();vdgeo.vd_aj(vd_ih,vd_Bt,vd_Bt,1);vdgeo.vd_cr(vd_ih,vd_Jx);if(!vdgeo.vd_IB(vd_ih))return;if(vd_ih==null)return;var vd_Pt=vdgeo.vd_aR(vd_ih);var m=vd_ih;var minv=vd_Pt;var vd_iJ=vdgeo.matrixtransform(m,vdgeo.newpoint(0,0,0));var vd_tj=vdgeo.matrixtransform(m,vdgeo.newpoint(vd_pn,0,0));var vd_lM=vdgeo.matrixtransform(m,vdgeo.newpoint(vd_pn,vd_oG,0));var vd_rV=vdgeo.matrixtransform(m,vdgeo.newpoint(0,vd_oG,0));var left=Math.min(vd_iJ[X],vd_tj[X],vd_lM[X],vd_rV[X]);var right=Math.max(vd_iJ[X],vd_tj[X],vd_lM[X],vd_rV[X]);var top=Math.min(vd_iJ[Y],vd_tj[Y],vd_lM[Y],vd_rV[Y]);var bottom=Math.max(vd_iJ[Y],vd_tj[Y],vd_lM[Y],vd_rV[Y]);left=vd_bR(Math.max(left,vd_U.vd_i.clip[0]));right=vd_bR(Math.min(right,vd_U.vd_i.clip[2]));top=vd_bR(Math.max(top,vd_U.vd_i.clip[1]));bottom=vd_bR(Math.min(bottom,vd_U.vd_i.clip[3]));var mA00=minv[A00];var mA01=minv[A01];var mA10=minv[A10];var mA11=minv[A11];var mA03=minv[A03];var mA13=minv[A13];var ptx,pty,_ptx,_pty;var r,g,b;var _px3;for(var iy=top;iy<bottom;iy++){_ptx=mA01*iy+mA03;_pty=mA11*iy+mA13;for(var ix=left;ix<right;ix++){ptx=mA00*ix+_ptx;if(ptx<0)continue;if(ptx>=vd_pn)continue;pty=mA10*ix+_pty;if(pty<0)continue;if(pty>=vd_oG)continue;var rgb=vd_zu(vd_j,ptx,pty);if(!rgb)continue;r=rgb[0];g=rgb[1];b=rgb[2];var ipos=iy*vd_U.vd_az+ix;var pos=ipos*4;vd_U.vd_su(ix,iy,pos,r,g,b,vd_U.Alpha);vd_AZ(ipos);}}};function vd_Sd(){return vdgeo.vd_nc(px,py,vd_U.vd_i.clip[0],vd_U.vd_i.clip[1],vd_U.vd_i.clip[2],vd_U.vd_i.clip[3]);};function vd_ck(x,y){px=x;py=y;};var vd_FB=0;function vd_EP(XDir){vd_FB=XDir;};function AdvanceX(){px+=vd_FB;};function AdvanceY(){py++;};function vd_xN(vd_hk){for(var i=0;i<vd_hk;i++){vd_U.vd_aP();AdvanceX();}AdvanceY();};function vd_vT(vd_hk){for(var i=0;i<vd_hk;i++){vd_U.vd_aP();AdvanceY();}AdvanceX();};this.vd_gt=null;this.vd_At=true;var vd_ec=0;var vd_hX=null;var vd_Ab=null;this.vd_BY=function(vd_Kw,color,matrix){vd_ec=vd_Kw;vd_hX=color;vd_Ab=matrix;};this.vd_go=function(vd_cO){if(!vd_cO|| !vd_cO.bytes)vd_U.vd_gt=null;else vd_U.vd_gt=vd_cO;};var xor=false;this.vd_Rt=function(value){var ret=xor;xor=value;return ret;};var vd_pT=undefined;function vd_GT(){if(vd_pT!==undefined)return vd_pT;return vdgeo.vd_IN(vd_ef[0],vd_ef[1],vd_ef[2],vd_ef[3],vd_ef[4],vd_ef[5],px,py);};function vd_zu(vd_j,_x,_y){var ir,ig,ib,ia;var tx=vd_j.width;var ty=vd_j.height;var x=vdgeo.vd_u(_x);var y=vdgeo.vd_u(_y);var bytescount=4;var _px=x;var _py=y;var _px3=_px*bytescount;var vd_cY=vd_j.bytes[_py];ir=vd_cY[_px3];ig=vd_cY[_px3+1];ib=vd_cY[_px3+2];ia=vd_cY[_px3+3];if(ia===0)return null;if(vd_U.vd_iH===vdConst.InterpolationMode_Bilinear){var ir2,ig2,ib2,ia2,ir3,ig3,ib3,ia3,ir4,ig4,ib4,ia4;var dU,dV,m1,m2,m3,m4;_px=Math.min(x+1,tx-1);_px3=_px*bytescount;ir2=vd_cY[_px3];ig2=vd_cY[_px3+1];ib2=vd_cY[_px3+2];ia2=vd_cY[_px3+3];if(ia2===0)return null;_px=Math.min(x,tx-1);_px3=_px*bytescount;_py=Math.min(y+1,ty-1);vd_cY=vd_j.bytes[_py];ir3=vd_cY[_px3];ig3=vd_cY[_px3+1];ib3=vd_cY[_px3+2];ia3=vd_cY[_px3+3];if(ia3===0)return null;_px=Math.min(x+1,tx-1);_px3=_px*bytescount;ir4=vd_cY[_px3];ig4=vd_cY[_px3+1];ib4=vd_cY[_px3+2];ia4=vd_cY[_px3+3];if(ia4===0)return null;dU=(_x-x);dV=(_y-y);m1=(1-dU)*(1-dV);m2=(dU)*(1-dV);m3=(1-dU)*(dV);m4=(dU)*(dV);ir=vdgeo.vd_u(ir*m1+ir2*m2+ir3*m3+ir4*m4);ig=vdgeo.vd_u(ig*m1+ig2*m2+ig3*m3+ig4*m4);ib=vdgeo.vd_u(ib*m1+ib2*m2+ib3*m3+ib4*m4);ia=vdgeo.vd_u(ia*m1+ia2*m2+ia3*m3+ia4*m4);}if(ia===0)return null;return[ir,ig,ib];};this.vd_MG=function(xmin,xmax,ymin,ymax){if(!vd_U.vd_i.vd_bH)return 1.0;var vd_cJ=Math.min(xmin,xmax);var vd_ct=Math.max(xmin,xmax);vd_cJ=vd_bR(Math.max(vd_cJ,0));vd_ct=vd_bR(Math.min(vd_ct,vd_U.vd_az-1));var vd_cg=Math.min(ymin,ymax);var vd_cn=Math.max(ymin,ymax);vd_cg=vd_bR(Math.max(vd_cg,0));vd_cn=vd_bR(Math.min(vd_cn,vd_U.vd_bG-1));var ret=2.0;for(var y=vd_cg;y<vd_cn;y++){for(var x=vd_cJ;x<vd_ct;x++){var ipos=y*vd_U.vd_az+x;ret=Math.min(vd_eM[ipos][0],ret);}}if(ret>1)ret=0;return ret;};this.vd_ko=function(x,y){x=vdgeo.vd_u(x);y=vdgeo.vd_u(y);if(!vd_U.vd_i.vd_bH||x<0||x>=vd_U.vd_az||y<0||y>=vd_U.vd_bG)return 1.0;var ipos=y*vd_U.vd_az+x;return vd_eM[ipos][0];};var vd_FA=0.000000001;var vd_RB=0.005;var __PT=vdgeo.newpoint(0,0,0);var ipos=0,vd_of=0,cz=0,alpha=0;this.vd_Mb=function(x,y,z,vd_Hq,vd_vy){x=vd_bR(x);y=vd_bR(y);if(x>vd_U.vd_i.clip[2])return false;if(x<vd_U.vd_i.clip[0])return false;if(y>vd_U.vd_i.clip[3]||y<vd_U.vd_i.clip[1])return false;if((vd_U.vd_i.vd_bH||vd_U.vd_i.vd_bY)&& !vd_sW(x,y,z))return false;if(vd_Hq){if(z===undefined|| !vd_U.vd_i.vd_bH|| !vd_U.vd_i.vd_bH)return true;var ipos=y*vd_U.vd_az+x;var vd_Rq=vd_eM[ipos][0];if(!vd_vy)vd_vy=vd_FA;if(Math.abs(z-vd_eM[ipos][0])>vd_vy)return false;}return true;};function vd_xf(zval,vd_vQ,u,v){ipos=py*vd_U.vd_az+px;var pos=ipos*4;vd_of=undefined;cz=1.0;alpha=vd_U.Alpha;if(vd_U.vd_i.vd_bH||vd_U.vd_i.vd_bY){if(zval!==undefined)cz=zval;else cz=vd_GT();if(!vd_sW(px,py,cz))return;}if(vd_U.vd_i.vd_bH){vd_of=vd_eM[ipos][0];if(cz>(vd_of+vd_FA))return;vd_eM[ipos][0]=cz;}if(vd_U.vd_gt&&vd_vQ){if(!vd_U.vd_At&&(u<0||u>1||v<0||v>1))return;var tx=vd_U.vd_gt.width;var ty=vd_U.vd_gt.height;var _x=(tx*u)%tx;var _y=(ty*v)%ty;if(_x<0)_x+=tx;if(_y<0)_y+=ty;var rgb=vd_zu(vd_U.vd_gt,_x,_y);if(!rgb){if(vd_of)vd_eM[ipos][0]=vd_of;return;}vd_U.vd_su(px,py,pos,rgb[0],rgb[1],rgb[2],alpha);}else if(vd_Ab!=null){vdgeo.vd_nA(px,py,cz,vd_Ab,__PT);if(__PT[W]!=0){__PT[X]/=__PT[W];__PT[Y]/=__PT[W];}var dist=0;var vd_iE=vd_U.vd_at;var vd_mz=vd_hX;if(vd_ec===1||vd_ec===3){dist=__PT[X]+0.5;}else{vd_iE=vd_hX;vd_mz=vd_U.vd_at;dist=Math.sqrt(__PT[X]*__PT[X]+__PT[Y]*__PT[Y])*1.4142;}if(vd_ec===3||vd_ec===4||vd_ec===6){var tmp=vd_iE;vd_iE=vd_mz;vd_mz=tmp;}dist=Math.min(Math.max(dist,0),1);var r=vdgeo.vd_u(vd_iE[0]+(vd_mz[0]-vd_iE[0])*dist);var g=vdgeo.vd_u(vd_iE[1]+(vd_mz[1]-vd_iE[1])*dist);var b=vdgeo.vd_u(vd_iE[2]+(vd_mz[2]-vd_iE[2])*dist);vd_U.vd_su(px,py,pos,r,g,b,alpha);}else{vd_U.vd_su(px,py,pos,vd_U.vd_at[0],vd_U.vd_at[1],vd_U.vd_at[2],alpha);}vd_AZ(ipos);};this.vd_su=function(x,y,pos,r,g,b,a){var ir=r;var ig=g;var ib=b;var ia=a;if(vd_kI)ia=255;if(vd_U.vd_i.vd_bH&&vd_U.vd_i.vd_fx){ir=vdgeo.vd_u(ir*vd_U.vd_lP[0]);ig=vdgeo.vd_u(ig*vd_U.vd_lP[1]);ib=vdgeo.vd_u(ib*vd_U.vd_lP[2]);if(ir>255)ir=255;if(ig>255)ig=255;if(ib>255)ib=255;}if(a!=255&& !xor){var div=a/255;ir=vdgeo.vd_u(ir*div+vd_W[pos]*(1-div));ig=vdgeo.vd_u(ig*div+vd_W[pos+1]*(1-div));ib=vdgeo.vd_u(ib*div+vd_W[pos+2]*(1-div));}if(vd_U.vd_i.vd_nb){ir=ig=ib=(ir+ig+ib)/3;}if(xor){vd_W[pos++]^=ir;vd_W[pos++]^=ig;vd_W[pos++]^=ib;vd_W[pos++]=255;}else{if(vd_U.vd_zk&&vd_Gr(x,y)){ir=vd_ac[0];ig=vd_ac[1];ib=vd_ac[2];ia=vd_ac[3];}vd_W[pos++]=ir;vd_W[pos++]=ig;vd_W[pos++]=ib;vd_W[pos++]=ia;}};this.vd_Or=function(x,y,w,h){x=vd_bR(x);y=vd_bR(y);w=vd_bR(w);h=vd_bR(h);var left=Math.max(x,this.vd_i.clip[0]);var right=Math.min(x+w,vd_U.vd_i.clip[2]);var top=Math.max(y,vd_U.vd_i.clip[1]);var bottom=Math.min(y+h,vd_U.vd_i.clip[3]);var r=vd_U.vd_at[0];var g=vd_U.vd_at[1];var b=vd_U.vd_at[2];var a=vd_U.Alpha;var pos=0,i=0;if(top>=vd_U.vd_i.clip[1]&&top<=vd_U.vd_i.clip[3]){pos=(top*vd_U.vd_az+left)*4;for(i=left;i<=right;i++){vd_W[pos++]=r;vd_W[pos++]=g;vd_W[pos++]=b;vd_W[pos++]=a}}if(bottom>=vd_U.vd_i.clip[1]&&bottom<=vd_U.vd_i.clip[3]){pos=(bottom*vd_U.vd_az+left)*4;for(i=left;i<=right;i++){vd_W[pos++]=r;vd_W[pos++]=g;vd_W[pos++]=b;vd_W[pos++]=a}}if(left>=vd_U.vd_i.clip[0]&&left<=vd_U.vd_i.clip[2]){pos=(top*vd_U.vd_az+left)*4;for(i=top;i<=bottom;i++){vd_W[pos++]=r;vd_W[pos++]=g;vd_W[pos++]=b;vd_W[pos++]=a;pos+=(vd_U.vd_az*4)-4;}}if(right>=vd_U.vd_i.clip[0]&&right<=vd_U.vd_i.clip[2]){pos=(top*vd_U.vd_az+right)*4;for(i=top;i<=bottom;i++){vd_W[pos++]=r;vd_W[pos++]=g;vd_W[pos++]=b;vd_W[pos++]=a;pos+=(vd_U.vd_az*4)-4;}}};function vd_AZ(vd_Mi){if(!vd_U.vd_i.vdraw|| !vd_U.vd_eo|| !vd_U.vd_i.vd_bJ)return;if(vd_U.vd_i.vd_dk.length===0)return;var fig=vd_U.vd_i.vd_dk[0];var vd_vo=vd_eM[vd_Mi];if(vd_U.vd_i.vdraw.IgnoreLockLayers===true|| !fig.LayerRef|| !fig.LayerRef.Lock){var arr=vd_vo[1];if(!arr){arr=[];vd_vo[1]=arr;}var len=arr.length;if(len===0||arr[len-1]!==fig)arr[len]=fig;}if(vd_U.vd_i.vd_bb!==undefined){vd_vo[2]=[vd_KA(vd_U.vd_i.vd_dk),vd_U.vd_i.vd_bb];}};function vd_KA(base){var vd_EY=[];var i;var len=base.length;for(i=0;i<len;i++){vd_EY[i]=base[i];}return vd_EY;};this.vd_zk=false;var vd_nu= -1;function vd_PQ(){vd_nu=0;};function vd_Iv(){vd_nu= -1;};function vd_Gr(x,y){if(vd_nu>=0){if((vd_nu%6)>2){vd_nu++;return true;}vd_nu++;}else if(vd_Ls[vd_bR(y%8)*8+vd_bR(x%8)]==0)return true;return false;};var Temp=0,vd_mT=0,vd_uS=0,vd_jt=0,vd_dH=0,vd_dW=0;var vd_hv=0,vd_iL=0,vd_ti=0,vd_hk=0;function vd_BU(vd_uh,vd_pV,XEnd,YEnd){var i=0;if(vd_pV>YEnd){Temp=vd_pV;vd_pV=YEnd;YEnd=Temp;Temp=vd_uh;vd_uh=XEnd;XEnd=Temp;}vd_ck(vd_uh,vd_pV);if((vd_dH=XEnd-vd_uh)<0){vd_EP(-1);vd_dH= -vd_dH;}else{vd_EP(1);}vd_dW=YEnd-vd_pV;vd_PQ();if(vd_dH===0){for(i=0;i<=vd_dW;i++){vd_U.vd_aP();AdvanceY();}}else if(vd_dW===0){for(i=0;i<=vd_dH;i++){vd_U.vd_aP();AdvanceX();}}else if(vd_dH===vd_dW){for(i=0;i<=vd_dH;i++){vd_U.vd_aP();AdvanceX();AdvanceY();}}else if(vd_dH>=vd_dW){vd_hv=vdgeo.vd_u(vd_dH/vd_dW);vd_mT=(vd_dH%vd_dW)*2;vd_uS=vd_dW*2;vd_jt=(vd_dH%vd_dW)-(vd_dW*2);vd_iL=vdgeo.vd_u(vd_hv/2)+1;vd_ti=vd_iL;if((vd_mT===0)&&((vd_hv&0x01)===0)){vd_iL--;}if((vd_hv&0x01)!==0){vd_jt+=vd_dW;}vd_xN(vd_iL);for(i=0;i<(vd_dW-1);i++){vd_hk=vd_hv;if((vd_jt+=vd_mT)>0){vd_hk++;vd_jt-=vd_uS;}vd_xN(vd_hk);}vd_xN(vd_ti);}else{vd_hv=vdgeo.vd_u(vd_dW/vd_dH);vd_mT=(vd_dW%vd_dH)*2;vd_uS=vd_dH*2;vd_jt=(vd_dW%vd_dH)-(vd_dH*2);vd_iL=vdgeo.vd_u(vd_hv/2)+1;vd_ti=vd_iL;if((vd_mT===0)&&((vd_hv&0x01)===0)){vd_iL--;}if((vd_hv&0x01)!==0){vd_jt+=vd_dH;}vd_vT(vd_iL);for(i=0;i<(vd_dH-1);i++){vd_hk=vd_hv;if((vd_jt+=vd_mT)>0){vd_hk++;vd_jt-=vd_uS;}vd_vT(vd_hk);}vd_vT(vd_ti);}vd_Iv();};function vd_Al(cx,cy,w,h){var a=w>>1,b=h>>1,wod=w&1,hod=h&1,x=0,y=b,oy=b,aa2=(a*a)<<1,aa4=aa2<<1,bb2=(b*b)<<1,bb4=bb2<<1,st=(aa2>>1)*(1-(b<<1))+bb2,tt=(bb2>>1)-aa2*((b<<1)-1),xl,dw,dh;if(w!=0)while(y>0){if(st<0){st+=bb2*((x<<1)+3);tt+=bb4*(++x);}else if(tt<0){st+=bb2*((x<<1)+3)-aa4*(y-1);xl=cx-x;dw=(x<<1)+wod;tt+=bb4*(++x)-aa2*(((y--)<<1)-3);dh=oy-y;vd_wW(xl,cy-oy,dw,dh);vd_wW(xl,cy+y+hod,dw,dh);oy=y;}else{tt-=aa2*((y<<1)-3);st-=aa4*(--y);}}vd_wW(cx-a,cy-oy,w,(oy<<1)+hod);};var vd_nk=[vdgeo.newpoint(0,0,0),vdgeo.newpoint(0,0,0),vdgeo.newpoint(0,0,0),vdgeo.newpoint(0,0,0)];function vd_BG(x1,y1,x2,y2,z1,z2){if(vd_U.penwidth<2){vd_BU(x1,y1,x2,y2);return;}else{var ww2=vd_U.penwidth/2.0;var a=Math.atan2(y2-y1,x2-x1);var vd_cI=Math.cos(a+vdgeo.HALF_PI);var sine=Math.sin(a+vdgeo.HALF_PI);vdgeo.vd_jU(vd_nk[0],vd_cI*ww2+x1,sine*ww2+y1,z1);vdgeo.vd_jU(vd_nk[1],vd_cI*ww2+x2,sine*ww2+y2,z2);vdgeo.vd_jU(vd_nk[2],vd_cI* -ww2+x2,sine* -ww2+y2,z2);vdgeo.vd_jU(vd_nk[3],vd_cI* -ww2+x1,sine* -ww2+y1,z1);if((vd_U.vd_i.vd_bH)||vd_U.vd_i.vd_bY)vd_U.vd_lA(vd_nk,true);else vd_U.vd_eG(vd_nk);vd_pT=z1;vd_Al(x1,y1,vd_U.penwidth,vd_U.penwidth);vd_pT=z2;vd_Al(x2,y2,vd_U.penwidth,vd_U.penwidth);vd_pT=undefined;}};function vd_wW(x,y,width,height){if(y>vd_U.vd_i.clip[3])return;if(x>vd_U.vd_i.clip[2])return;if(y<vd_U.vd_i.clip[1]){height+=(y-vd_U.vd_i.clip[1]);y=vd_U.vd_i.clip[1];}if(x<vd_U.vd_i.clip[0]){width+=(x-vd_U.vd_i.clip[0]);x=vd_U.vd_i.clip[0];}if(height<0)return;if(width<0)return;if((x+width)>vd_U.vd_i.clip[2])width-=(x+width-vd_U.vd_i.clip[2]);if((y+height)>vd_U.vd_i.clip[3])height-=(y+height-vd_U.vd_i.clip[3]);for(var h=0;h<height;h++){vd_U.vd_vg(x,y+h,width);}};this.ctx=vd_wQ;var vd_kN=null;function vd_BC(vd_io,vd_GI){var len=vd_GI.data.length;var i;for(i=0;i<len;i++)vd_GI.data[i]=vd_io.data[i];};function vd_zN(vd_Il,vd_io){if(!vd_io)vd_io=vd_aI;var vd_mO=vd_Il;if(!vd_mO||vd_mO.width!=vd_io.width||vd_mO.height!=vd_io.height){vd_mO=vd_U.ctx.createImageData(vd_io.width,vd_io.height);}vd_BC(vd_io,vd_mO);return vd_mO;};this.vd_xB=function(){return vd_kI;};var vd_kI=false;this.vd_sb=function(vd_KH){var ret=vd_kI;if(!vd_U.ctx)return ret;if(vd_KH){if(vd_kI)return ret;vd_kI=true;vd_kN=vd_aI;vd_aI=vd_zN();vd_W=vd_aI.data;vd_U.vd_i.vd_eT();}else{if(!vd_kI)return ret;vd_kI=false;vd_aI=vd_kN;if(!vd_aI)vd_W=null;else vd_W=vd_aI.data;vd_kN=null;vd_U.vd_i.vd_eT();}return ret;};this.vd_NK=function(){if(!vd_U.ctx)return;if(!vd_kI)return;vd_U.ctx.putImageData(vd_kN,0,0);vd_BC(vd_kN,vd_aI);vd_W=vd_aI.data;};this.vd_Dm=function(){if(!vd_U.ctx)return;vd_kN=vd_U.ctx.getImageData(0,0,vd_U.vd_az,vd_U.vd_bG);vd_aI=vd_kN;vd_W=vd_aI.data;};this.ActionDrawEntities=function(entities,vd_wb){if(!vd_U.vd_i.vdraw|| !vd_U.ctx)return;if(!entities||entities.length==0){vd_U.Refresh();}else{var vd_qA=vd_U.vd_i.vd_bH;var vd_py=vd_U.vd_eo;vd_U.vd_i.vd_bH=false;vd_U.vd_eo=false;vd_U.vd_i.vd_eT();var vd_zn=vd_aI;vd_aI=vd_zN();vd_W=vd_aI.data;try{for(var i=0;i<entities.length;i++){vd_U.vd_i.vdraw.DrawEntity(entities[i],vd_U.vd_i);}}catch(ex){}vd_U.ctx.putImageData(vd_aI,0,0);if(!vd_wb){vd_aI=vd_zn;if(!vd_aI)vd_W=null;else vd_W=vd_aI.data;}vd_U.vd_i.vd_bH=vd_qA;vd_U.vd_eo=vd_py;vd_U.vd_i.vd_eT();}};this.vd_NL=function(){if(!vd_U.vd_i.vdraw)return;var vd_qA=vd_U.vd_i.vd_bH;var vd_py=vd_U.vd_eo;vd_U.vd_i.vd_bH=false;vd_U.vd_eo=false;var vd_oD=vd_U.vd_i.vdraw.vd_fO;vd_U.vd_i.vdraw.vd_fO=false;vd_U.vd_i.vd_eT();vd_U.vd_i.vdraw.vd_pJ(vd_U.vd_i);vd_U.vd_i.vd_bH=vd_qA;vd_U.vd_eo=vd_py;vd_U.vd_i.vdraw.vd_fO=vd_oD;vd_U.vd_i.vd_eT();};this.vd_KC=function(){if(!vd_U.vd_i.vdraw)return;var vd_tc=vd_U.vd_i.vdraw.viewcube.draw(vd_U.vd_i);if(vd_tc){vd_U.ctx.putImageData(vd_aI,0,0);vd_U.ctx.drawImage(vd_tc[0],0,0,vd_U.vd_az,vd_U.vd_bG,vd_tc[1][0],vd_tc[1][1],vd_U.vd_az,vd_U.vd_bG);vd_U.vd_Dm();}};var vd_xO;this.Refresh=function(vd_JU){if(!vd_U.ctx)return;vd_U.ctx.putImageData(vd_aI,0,0);if(!vd_JU&&vd_U.vd_i.vdraw&&vd_U.vd_i.vdraw.vd_zc()){var vd_zn=vd_aI;vd_xO=vd_zN(vd_xO);vd_aI=vd_xO;vd_W=vd_aI.data;vd_U.vd_NL();vd_U.ctx.putImageData(vd_aI,0,0);vd_aI=vd_zn;if(!vd_aI)vd_W=null;else vd_W=vd_aI.data;}};function vd_MH(x1,y1,x2,y2,z1,z2){vd_BU(x1,y1,x2,y2);};var vd_lU=[];function vd_HL(zval,vd_vQ,u,v){ipos=py*vd_U.vd_az+px;var pos=ipos*4;var ir,ig,ib,ia;ia=255;if(vd_Gr(px,py)){ir=vd_ac[0];ig=vd_ac[1];ib=vd_ac[2];}else{if(vd_lU.length===0){ir=vd_U.vd_at[0];ig=vd_U.vd_at[1];ib=vd_U.vd_at[2];}else{ir=vd_lU[0];ig=vd_lU[1];ib=vd_lU[2];}}vd_W[pos++]=ir;vd_W[pos++]=ig;vd_W[pos++]=ib;vd_W[pos++]=ia;};function vd_Iq(zval,vd_vQ,u,v){ipos=py*vd_U.vd_az+px;var pos=ipos*4;vd_W[pos++]=vd_U.vd_at[0];vd_W[pos++]=vd_U.vd_at[1];vd_W[pos++]=vd_U.vd_at[2];vd_W[pos++]=255;};this.vd_MP=function(){var ret=vd_U.vd_aP;vd_U.vd_aP=vd_xf;return ret;};this.vd_Od=function(vd_NF){vd_U.vd_aP=vd_NF;};this.vd_rw=vd_BG;this.vd_aP=vd_xf;this.vd_CC=function(vd_LG,vd_LE){if(vd_LG){vd_lU=vd_LE;if(vd_lU)vd_U.vd_aP=vd_HL;else vd_U.vd_aP=vd_Iq;vd_U.vd_rw=vd_MH;}else{vd_U.vd_aP=vd_xf;vd_U.vd_rw=vd_BG;}};function vd_Qn(pts){var vd_T,vd_N,minx,maxx;var p1;minx=vd_T=maxx=vd_N=0;for(var a=0;a<pts.length;a++){p1=pts[a];if(a===0){vd_T=p1[Y];vd_N=p1[Y];minx=p1[X];maxx=p1[X];continue;}if(p1[Y]<vd_T)vd_T=p1[Y];else if(p1[Y]>vd_N)vd_N=p1[Y];if(p1[X]<minx)minx=p1[X];else if(p1[X]>maxx)maxx=p1[X];}return[minx,vd_T,maxx,vd_N];};this.vd_Ni=function(_pts,vd_Nr,vd_bq,vd_b,ret){var pts=_pts;if(pts.length<3)return null;var vd_be=vd_Qn(pts);var top=vd_be[1];var bottom=vd_be[3];if(top>vd_U.vd_i.clip[3])return null;if(bottom<vd_U.vd_i.clip[1])return null;top=vd_bR(Math.max(top,vd_U.vd_i.clip[1]));bottom=vd_bR(Math.min(bottom,vd_U.vd_i.clip[3]));var npts=pts.length;var ints,f,ind1,ind2,i,gradient,l1,l2,j,k,y,ii;var p1,p2,y1,y2;var lines=[];for(y=top;y<=(bottom+0.5);y++){ints=0;var vd_qn=[];f=0;for(i=0;i<=npts;i++){ind2=i;ind1=i-1;if(ind2==f)continue;if(ind2==npts){ind2=f;f=i;}p1=pts[ind1];p2=pts[ind2];y2=p2[Y];y1=p1[Y];if(y1==y2)continue;if(y1>y2){p2=pts[ind1];p1=pts[ind2];}y2=p2[Y];y1=p1[Y];if(((y>=y1)&&(y<y2))||((y==bottom)&&(y>y1)&&(y<=y2))){ints++;gradient=(y-y1)/(y2-y1);vd_qn.push(vd_bR(vdgeo.vd_dp(p1[X],p2[X],gradient)));}}vd_qn.sort(function(a,b){return a-b});lines.push(vd_qn);vd_RP=0;for(ii=0;ii<ints-1;ii+=2){l1=vd_qn[ii];l2=vd_qn[(ii+1)];l1=Math.max(l1,vd_U.vd_i.clip[0]);l2=Math.min(l2,vd_U.vd_i.clip[2]);if(l1<=vd_U.vd_i.clip[2]&&l2>=vd_U.vd_i.clip[0]){for(var m=l1;m<=l2;m++){vd_Nr(m,y,vd_bq,vd_b,ret);}}}}return{left:vd_be[0],top:top,right:vd_be[2],bottom:bottom,lines:lines,pts:pts};};this.vd_NA=function(vd_kG,x,y){if(y<vd_kG.top)return false;if(y>vd_kG.bottom)return false;if(x<vd_kG.left)return false;if(x>vd_kG.right)return false;var line=vd_kG.lines[y-vd_kG.top];for(var i=0;i<line.length-1;i+=2){if(x>=line[i]&&x<=line[i+1])return true;}return false;};return this;};var vd_cf=16;function vd_HK(vd_b,i,vd_aZ,color,alpha,id,vd_br,normal,u,v,w,vd_ke,vd_my){vd_b[i++]=vd_aZ[X];vd_b[i++]=vd_aZ[Y];vd_b[i++]=vd_aZ[Z];if(vd_ke){vd_b[i++]=u/255.0;vd_b[i++]=v/255.0;vd_b[i++]=w/255.0;vd_b[i++]=alpha/255.0;vd_b[i++]=1;vd_b[i++]=1;vd_b[i++]=1;}else{vd_b[i++]=color[0]/255.0;vd_b[i++]=color[1]/255.0;vd_b[i++]=color[2]/255.0;vd_b[i++]=alpha/255.0;vd_b[i++]=u;vd_b[i++]=v;vd_b[i++]=w;}if(!normal){vd_b[i++]=0;vd_b[i++]=0;vd_b[i++]=0;}else{vd_b[i++]=normal[X];vd_b[i++]=normal[Y];vd_b[i++]=normal[Z];}var a,b,v1=0,v2=0;if(id<65535){a=id+1;b=a%256.0;v1=b/255.0;a=(a-b)/256.0;b=a%256.0;v2=b/255.0;}vd_b[i++]=v1;vd_b[i++]=v2;vd_b[i++]=vd_br;return i;};function list(size,vd_mZ){var vd_U=this;this.vd_nT=false;this.vd_wD=[];this.vd_eY=function(vd_qm,type,pt,color,alpha,id,vd_br,normal,u,v,w,vd_ke,vd_my){var hid= !vd_qm?'h_0':'h_'+vd_qm.HandleId.toString();if(!vd_U[hid]){vd_U[hid]=new vd_cO(vd_qm,size,vd_mZ);vd_U.vd_wD.push(vd_U[hid]);}vd_U[hid].vd_eY(type,pt,color,alpha,id,vd_br,normal,u,v,w,vd_ke,vd_my);};this.draw=function(vd_kn,vd_GC){if(!vd_kn)vd_kn=vd_mZ;if(!vd_kn)return;for(var i=0;i<vd_U.vd_wD.length;i++){var tex=vd_U.vd_wD[i];if(vd_GC)vd_GC(null,tex.image);tex.draw(vd_kn);}};return this;};function vd_cO(vd_qm,size,vd_mZ){var vd_U=this;this.image=vd_qm;this.vd_Ll=size;this.vd_kr=[[new vd_rl(size,0)],[new vd_rl(size,1)],[new vd_rl(size,2)],[new vd_rl(size,2)],];this.vd_eY=function(type,pt,color,alpha,id,vd_br,normal,u,v,w,vd_ke,vd_my){var vd_qz=type;var buf;if((vd_br&8))vd_qz=3;buf=vd_U.vd_kr[vd_qz][vd_U.vd_kr[vd_qz].length-1];if(!buf.vd_LQ()){if(vd_mZ){vd_mZ(buf,vd_qz==3);buf.Reset();}else{buf=new vd_rl(size,type);vd_U.vd_kr[vd_qz].push(buf);}}buf.vd_eY(pt,color,alpha,id,vd_br,normal,u,v,w,vd_ke,vd_my);};this.draw=function(vd_kn,reset){if(!vd_kn)vd_kn=vd_mZ;for(var k=0;k<vd_U.vd_kr.length;k++){for(var j=0;j<vd_U.vd_kr[k].length;j++){vd_kn(vd_U.vd_kr[k][j],k===3);if(reset)vd_U.vd_kr[k][j].Reset();}}};return this;};function vd_rl(size,itemtype){var vd_U=this;var i=0;this.vd_Mv=(3-itemtype)*vd_cf;this.vd_cx=function(){return i/vd_cf;};this.primitiveType=itemtype;this.vd_b=new Float32Array(size*vd_U.vd_Mv);this.vd_yv=false;this.vd_LQ=function(){return i<vd_U.vd_b.length;};this.Reset=function(){i=0;};this.vd_eY=function(vd_aZ,color,alpha,id,vd_br,normal,u,v,w,vd_ke,vd_my){if(alpha<255)vd_U.vd_yv=true;i=vd_HK(vd_U.vd_b,i,vd_aZ,color,alpha,id,vd_br,normal,u,v,w,vd_ke,vd_my);};return this;};function vd_LT(vdcanvas){var vd_U=this;var render=null;var gl=null;var vd_hm=null;var vd_oX=false;var vd_bU=null;var vd_qG=vdgeo.vd_e();var vd_hr=vdgeo.vd_e();var vd_fn=vdgeo.vd_e();var vd_Dn=vdgeo.vd_e();var vd_nM=null;var vd_gp=null;var vd_nZ=null;var vd_hb=null;var vd_Df=null;var vd_nJ=null;var vd_fW=null;var vd_iz=null;var vd_tV=null;var vd_vi=null;var vd_yV=null;var vd_xP=null;var vd_qs;var vd_pG;var vd_xW;var vd_qo=new Float32Array(vd_qF(vdgeo.vd_e()));var vd_fv=null;var vd_Ej=null;var vd_pw=null;var vd_Hr=null;var vd_Cr=null;var vd_qy=null;var vd_fa={};var vd_nx=null;var textureprops=null;var vd_pu=null;var vd_kz=null;var section=null;var vd_eA=0;var vd_fC=0;var vd_kf=0;var vd_ac=null;var vd_pb=null;var vd_kX=null;var vd_hC=3;this.vd_al=null;var _p1=[0,0,0,0];var _p2=[0,0,0,0];var _p3=[0,0,0,0];var _p4=[0,0,0,0];var uv0=[0.0,0.0,0.0];vd_Oo='precision mediump float;'+'varying float vfigprops;'+'varying vec3 vTexture;'+'uniform sampler2D uSampler;'+'uniform int textureprops;'+'uniform int vd_pu;'+'uniform float section[25]; '+'uniform vec4 vd_ac;'+'uniform int vd_kz;'+'vec4 color;'+'varying vec4 vColor;'+'varying vec4 vpos;'+'float x,y,z,s,gcol;'+'varying vec3 vLightWeighting;'+'varying float forcetexture;'+'void main(void) {'+'if (vd_kz != 3){'+'if (vd_kz == 1 && vColor.a < 0.999) discard;'+'if (vd_kz == 2 && vColor.a > 0.999) discard;'+'}'+'color = vColor;'+'x = vpos.x  / vpos.w;'+'y = vpos.y / vpos.w;'+'z = vpos.z / vpos.w;'+'for(int i = 0 ; i < 5; i++){'+'if(section[i*5+4] != 0.0)'+'{'+'s = section[i*5+0] * x + section[i*5+1] * y + section[i*5+2] * z + section[i*5+3];'+'if(s < 0.0) discard;'+'}'+'else'+'{'+'break;'+'}'+'}'+'if(textureprops == 1 || forcetexture > 0.0){'+'x = vTexture[0];'+'y = vTexture[1];'+'z = vTexture[2] ;'+'if (z == 0.0) z = 1.0;'+'x = mod(x / z , 1.0);'+'y = mod(y / z , 1.0);'+'color =  texture2D(uSampler, vec2(x,y));'+'if(color.a == 0.0) discard;'+'color.a = vColor.a;'+'}'+'if(vd_pu == 1){'+'gcol = (color[0] + color[1] + color[2]) / 3.0;'+'color = vec4(gcol,gcol,gcol,color[3]);'+'}'+'color = vec4(color.rgb * vLightWeighting, color.a);'+'if(vfigprops == 1.0){'+'x = mod(floor(gl_FragCoord.x), 8.0);'+'y = mod(floor(gl_FragCoord.y), 8.0);'+'if(x == y || x == (7.0 - y)){'+'        color  = vd_ac;'+'}'+'}'+'gl_FragColor = color;'+'}';vd_JN='attribute vec3 aVertexNormal;'+'uniform vec4 vd_pb;'+'uniform mat4 uPMatrix;'+'uniform mat4 uMVMatrix;'+'uniform mat4 uNMatrix;'+'uniform vec3 uAmbientLightColor;'+'uniform vec3 uDirectionalLightColor;'+'uniform vec3 uLightDirection;'+'varying vec3 vLightWeighting;'+'attribute float figprops;'+'varying float vfigprops;'+'attribute vec3 aVertexTexture;'+'varying vec3 vTexture;'+'attribute vec3 ppos;'+'attribute vec4 aVertexColor;'+'varying vec4 vColor;'+'varying vec4 vpos;'+'varying float forcetexture;'+'void main(void) {'+'gl_PointSize = 1.0;'+'vpos = uPMatrix * uMVMatrix * vec4(ppos, 1.0);'+'gl_Position = vpos;'+'vColor = aVertexColor;'+'vTexture = aVertexTexture;'+'vfigprops = figprops;'+'forcetexture = 0.0;'+'if(vfigprops >= 16.0){'+'vfigprops -= 16.0;'+'forcetexture = 1.0;'+'}'+'if(vfigprops >= 8.0) vfigprops -= 8.0;'+'if(vfigprops >= 4.0) {'+'vfigprops -= 4.0;'+'vColor = vd_pb;'+'}'+'if(vfigprops >= 2.0 ){'+'vfigprops -= 2.0;'+'vec4 transformedNormal = uNMatrix * vec4(aVertexNormal,1.0);'+'float directionalLightWeighting = abs(dot(transformedNormal.xyz, uLightDirection ));'+'vLightWeighting = uAmbientLightColor + (uDirectionalLightColor * directionalLightWeighting);'+'}else{'+'vLightWeighting =vec3(1.0,1.0,1.0);'+'}'+'}';vd_LY='precision mediump float;'+'varying vec4 vColor;'+'varying vec4 vpos;'+'uniform float section[25]; '+'float x,y,z,s,a,b,b1,b2,z01;'+'void main(void) {'+'x = vpos.x;'+'y = vpos.y;'+'z = vpos.z;'+'if(vpos.w != 0.0 ){'+'z /= vpos.w;'+'x /= vpos.w;'+'y /= vpos.w;'+'}'+'for(int i = 0 ; i < 5; i++){'+'if(section[i*5+4] != 0.0)'+'{'+'s = section[i*5+0] * x + section[i*5+1] * y + section[i*5+2] * z + section[i*5+3];'+'if(s < 0.0) discard;'+'}'+'else'+'{'+'break;'+'}'+'}'+'z01 = ((1.0 + z) * 0.5);'+'a = floor( 65535.0 * z01  );'+'b = mod(a,256.0);b1=b/255.0;'+'a = (a-b) / 256.0;b = mod(a,256.0);b2=b/255.0;'+'gl_FragColor = vec4(b1,b2,vColor[0],vColor[1]);'+'}';vd_LC='uniform mat4 uPMatrix;'+'uniform mat4 uMVMatrix;'+'attribute vec4 aVertexColor;'+'varying vec4 vColor;'+'varying vec4 vpos;'+'attribute vec3 ppos;'+'void main(void) {'+'gl_PointSize = 1.0;'+'vpos = uPMatrix * uMVMatrix * vec4(ppos, 1.0);'+'gl_Position = vpos;'+'vColor = aVertexColor;'+'}';var vd_w={gl:null,vd_hm:null,vd_bU:null,vd_nM:null,vd_gp:null,vd_nZ:null,vd_hb:null,section:null,vd_jo:null,vd_fW:null,vd_iz:null};this.vd_OM=function(fig,index){if(index===undefined)return;if(!vd_gs())return;vd_kf=(fig&&(fig.selected||fig.HighLight))?1:0;vd_fC=index;};function vd_gs(){return render.vd_bJ;};function vd_Id(){var w=render.vd_H.vd_az;var h=render.vd_H.vd_bG;var vd_ej=vd_DY(w,h,vd_LY,vd_LC,{antialias:false});if(vd_ej[0]!=0){vdcanvas.vd_tG(vdConst.vd_Dk,vd_ej[0],vd_ej[1]);return false;}vd_w.gl=vd_ej[2];vd_w.vd_hm=vd_ej[3];vd_w.vd_bU=vd_ej[4];vd_w.vd_jo=new Uint8Array(w*h*4);vd_w.vd_nM=vd_jI(vd_w.gl,vd_w.vd_bU,'ppos');vd_w.vd_nZ=vd_jI(vd_w.gl,vd_w.vd_bU,'aVertexColor');vd_w.section=vd_w.gl.getUniformLocation(vd_w.vd_bU,"section");vd_w.vd_fW=vd_w.gl.getUniformLocation(vd_w.vd_bU,"uPMatrix");vd_w.vd_iz=vd_w.gl.getUniformLocation(vd_w.vd_bU,"uMVMatrix");return true;};function vd_GL(){if(!vd_gs())return;var w=render.vd_H.vd_az;var h=render.vd_H.vd_bG;if(vd_w.vd_hm.width<w||vd_w.vd_hm.height<h){vd_w.vd_jo=new Uint8Array(w*h*4);vd_w.vd_hm.setAttribute("width",w);vd_w.vd_hm.setAttribute("height",h);}vd_w.gl.enable(vd_w.gl.DEPTH_TEST);vd_w.gl.depthFunc(vd_w.gl.LEQUAL);vd_w.gl.viewport(render.vd_cc,render.vd_eK,render.width,render.height);vd_w.gl.disable(vd_w.gl.BLEND);};function vd_GU(sec){if(!vd_gs())return;vd_w.gl.uniform1fv(vd_w.section,sec);};function vd_Ir(){if(!vd_gs())return;vd_w.gl.clearDepth(1.0);vd_w.gl.clearColor(1.0,1.0,1.0,1.0);vd_w.gl.clear(vd_w.gl.COLOR_BUFFER_BIT|vd_w.gl.DEPTH_BUFFER_BIT);};function vd_HZ(){if(!vd_gs())return;vd_w.gl.flush();var w1=render.vd_H.vd_az;var h1=render.vd_H.vd_bG;vd_w.gl.readPixels(0,0,w1,h1,vd_w.gl.RGBA,vd_w.gl.UNSIGNED_BYTE,vd_w.vd_jo);var vd_Ed=render.vd_H.vd_ji();var k=0,i=0;var length=vd_w.vd_jo.length;for(i=0;i<length;i+=4){vd_Ed[k++][0]=2.0*(((vd_w.vd_jo[i])|(vd_w.vd_jo[i+1]<<8))/65535.0)-1.0;}var layout=vdcanvas.GetActiveLayout();if(layout){var elen=layout.Entities.Items.length;k=0;length=vd_w.vd_jo.length;for(i=0;i<length;i+=4,k++){var index=((vd_w.vd_jo[i+2])|(vd_w.vd_jo[i+3]<<8));if(index>0&&index<=elen)vd_Ed[k][1]=[vdcanvas.GetEntityItem(layout.Entities.Items[index-1])];}}};this.vd_CO=function(vd_AA){var ret=render;render=vd_AA;return ret;};function vd_Nk(){var size=Math.abs(vdcanvas.vd_Eg());if(vd_fv===null||vd_fv.vd_Ll!=size){vd_fv=new vd_cO(null,size,vd_HV);if(vd_gp)gl.deleteBuffer(vd_gp);if(vd_nJ)gl.deleteBuffer(vd_nJ);if(vd_hb)gl.deleteBuffer(vd_hb);if(vd_qy)gl.deleteBuffer(vd_qy);if(vd_pw)gl.deleteBuffer(vd_pw);if(vd_w.vd_gp)vd_w.gl.deleteBuffer(vd_w.vd_gp);if(vd_w.vd_hb)vd_w.gl.deleteBuffer(vd_w.vd_hb);vd_gp=gl.createBuffer();vd_nJ=gl.createBuffer();vd_hb=gl.createBuffer();vd_qy=gl.createBuffer();vd_pw=gl.createBuffer();vd_w.vd_gp=vd_w.gl.createBuffer();vd_w.vd_hb=vd_w.gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,vd_gp);gl.vertexAttribPointer(vd_nM,3,gl.FLOAT,false,vd_cf*4,0);gl.bindBuffer(gl.ARRAY_BUFFER,vd_hb);gl.vertexAttribPointer(vd_nZ,4,gl.FLOAT,false,vd_cf*4,3*4);gl.bindBuffer(gl.ARRAY_BUFFER,vd_qy);gl.vertexAttribPointer(vd_Cr,3,gl.FLOAT,false,vd_cf*4,7*4);gl.bindBuffer(gl.ARRAY_BUFFER,vd_nJ);gl.vertexAttribPointer(vd_Df,3,gl.FLOAT,false,vd_cf*4,10*4);gl.bindBuffer(gl.ARRAY_BUFFER,vd_pw);gl.vertexAttribPointer(vd_Ej,1,gl.FLOAT,false,vd_cf*4,15*4);if(vd_gs()){vd_w.gl.bindBuffer(vd_w.gl.ARRAY_BUFFER,vd_w.vd_gp);vd_w.gl.vertexAttribPointer(vd_w.vd_nM,3,gl.FLOAT,false,vd_cf*4,0);vd_w.gl.bindBuffer(vd_w.gl.ARRAY_BUFFER,vd_w.vd_hb);vd_w.gl.vertexAttribPointer(vd_w.vd_nZ,2,vd_w.gl.FLOAT,false,vd_cf*4,13*4);}}vd_HB();gl.uniform1i(vd_pu,render.vd_nb?1:0);vd_kf=0;vd_fC=0;vd_eA=0;};this.vd_uU=function(){return gl!=null;};function vd_DY(w,h,vd_Mq,vd_Km,arguments){var vd_cm=null;try{vd_cm=document.createElement("CANVAS");vd_cm.setAttribute("width",w);vd_cm.setAttribute("height",h);}catch(e){return[-1,"error creating canvas",null,null];}if(!vd_cm)return[-2,"error creating canvas",null,null];var _gl;try{_gl=vd_cm.getContext('webgl',arguments)||vd_cm.getContext('experimental-webgl',arguments);}catch(e){return[-3,'vd_cy caught in getContext: '+e.toString(),null,null];}if(!_gl){return[-4,'Unable to create Web GL context',null,null];}var vd_oz=_gl.createShader(_gl.FRAGMENT_SHADER);_gl.shaderSource(vd_oz,vd_Mq);_gl.compileShader(vd_oz);if(!_gl.getShaderParameter(vd_oz,_gl.COMPILE_STATUS)){return[-5,'Error during fragment shader compilation:'+_gl.getShaderInfoLog(vd_oz),null,null];}var vd_pp=_gl.createShader(_gl.VERTEX_SHADER);_gl.shaderSource(vd_pp,vd_Km);_gl.compileShader(vd_pp);if(!_gl.getShaderParameter(vd_pp,_gl.COMPILE_STATUS)){return[-6,'Error during vd_g shader compilation:\n'+_gl.getShaderInfoLog(vd_pp),null,null];}var vd_bU=_gl.createProgram();_gl.attachShader(vd_bU,vd_oz);_gl.attachShader(vd_bU,vd_pp);_gl.linkProgram(vd_bU);if(!_gl.getProgramParameter(vd_bU,_gl.LINK_STATUS)){return[-7,'Error during vd_bU linking:'+_gl.getProgramInfoLog(vd_bU),null,null];}_gl.validateProgram(vd_bU);if(!_gl.getProgramParameter(vd_bU,_gl.VALIDATE_STATUS)){return[-7,'Error during vd_bU validation:'+_gl.getProgramInfoLog(vd_bU),null,null];}_gl.useProgram(vd_bU);return[0,'',_gl,vd_cm,vd_bU];};function vd_jI(_gl,vd_Kr,vd_Lm){var attribute=_gl.getAttribLocation(vd_Kr,vd_Lm);if(attribute!== -1)_gl.enableVertexAttribArray(attribute);return attribute;};this.vd_JP=function(vd_Pp){render=vd_Pp;if(!vd_oX){vd_oX=true;if(!vd_Id())return;var w=render.vd_H.vd_az;var h=render.vd_H.vd_bG;var vd_ej=vd_DY(w,h,vd_Oo,vd_JN);if(vd_ej[0]!=0){vdcanvas.vd_tG(vdConst.vd_Dk,vd_ej[0],vd_ej[1]);return;}gl=vd_ej[2];vd_hm=vd_ej[3];vd_bU=vd_ej[4];vd_kX=new Uint8Array(w*h*4);vd_nM=vd_jI(gl,vd_bU,'ppos');vd_nZ=vd_jI(gl,vd_bU,'aVertexColor');vd_Ej=vd_jI(gl,vd_bU,'figprops');vd_Cr=vd_jI(gl,vd_bU,'aVertexTexture');vd_Df=vd_jI(gl,vd_bU,'aVertexNormal');vd_Hr=gl.getUniformLocation(vd_bU,"uSampler");textureprops=gl.getUniformLocation(vd_bU,"textureprops");vd_pu=gl.getUniformLocation(vd_bU,"vd_pu");vd_kz=gl.getUniformLocation(vd_bU,"vd_kz");section=gl.getUniformLocation(vd_bU,"section");vd_fW=gl.getUniformLocation(vd_bU,"uPMatrix");vd_iz=gl.getUniformLocation(vd_bU,"uMVMatrix");vd_tV=gl.getUniformLocation(vd_bU,"uNMatrix");vd_vi=gl.getUniformLocation(vd_bU,"uLightDirection");vd_yV=gl.getUniformLocation(vd_bU,"uDirectionalLightColor");vd_xP=gl.getUniformLocation(vd_bU,"uAmbientLightColor");vd_ac=gl.getUniformLocation(vd_bU,"vd_ac");vd_pb=gl.getUniformLocation(vd_bU,"vd_pb");}if(vd_U.vd_uU())vd_Nk();};this.vd_sM=function(){if(!vd_oX)return;if(!gl)return;for(vd_r in vd_fa){if(!gl.isTexture(vd_fa[vd_r]))continue;gl.deleteTexture(vd_fa[vd_r]);}vd_fa={};vd_nx=null;vd_U.vd_nQ();};function vd_HB(){if(!vd_oX)return;if(!gl)return;gl.activeTexture(gl.TEXTURE0+0);gl.uniform1i(vd_Hr,0);gl.uniform1i(textureprops,0);if(!vd_fa['h_0']){vd_fa['h_0']=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,vd_fa['h_0']);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,1,1,0,gl.RGBA,gl.UNSIGNED_BYTE,new Uint8Array([255,255,255,255]));}else{gl.bindTexture(gl.TEXTURE_2D,vd_fa['h_0']);}vd_nx=null;};function vd_Jo(){if(!vd_oX)return;if(!gl)return;var i;var sec=[];sec.length=25;for(i=0;i<25;i++)sec[i]=0.0;var seci=0;if(render.vd_bY){var vd_Nz=vdgeo.vd_aR(vdgeo.vd_gW(render.vd_Ds(),vd_qG));for(i=0;i<render.vd_bY.length;i++){var vd_sX=render.vd_bY[i];var mat=vdgeo.vd_dD(vd_Nz);vdgeo.vd_x(mat,-vd_sX[0][X],-vd_sX[0][Y],-vd_sX[0][Z]);vdgeo.vd_gB(mat,vd_sX[1]);sec[seci++]=mat[8];sec[seci++]=mat[9];sec[seci++]=mat[10];sec[seci++]=mat[11];sec[seci++]=1.0;if(seci==sec.length)break;}}gl.uniform1fv(section,sec);vd_GU(sec);};this.vd_oi=function(mode){vd_hC=mode;if(mode==2){if(!vd_U.vd_al){vd_fv.draw(null,true);}gl.enable(gl.BLEND);gl.blendEquation(gl.FUNC_ADD);gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA);}gl.uniform1i(vd_kz,mode);};this.vd_Ke=function(){vd_hr=vdgeo.vd_gW(render.vd_bE(),vd_fn);};function vd_qF(mat,vd_oA,vd_IH){if(!vd_IH){return new Array(mat[A00],mat[A10],mat[A20],mat[A30],mat[A01],mat[A11],mat[A21],mat[A31],mat[A02],mat[A12],mat[A22],mat[A32],vd_oA?0.0:mat[A03],vd_oA?0.0:mat[A13],vd_oA?0.0:mat[A23],mat[A33]);}else{return new Array(mat[A00],mat[A01],mat[A02],vd_oA?0.0:mat[A03],mat[A10],mat[A11],mat[A12],vd_oA?0.0:mat[A13],mat[A20],mat[A21],mat[A22],vd_oA?0.0:mat[A23],mat[A30],mat[A31],mat[A32],mat[A33]);}};this.vd_xH=function(){if(!render.vd_bH){gl.disable(gl.DEPTH_TEST);gl.depthMask(0);}else{gl.enable(gl.DEPTH_TEST);gl.depthMask(1);}};this.vd_Jj=function(){vdgeo.vd_gM(vd_qG);vd_fn=vdgeo.vd_aR(render.vd_bE());var w=render.vd_H.vd_az;var h=render.vd_H.vd_bG;if(vd_hm.width<w||vd_hm.height<h){vd_kX=new Uint8Array(w*h*4);vd_hm.setAttribute("width",w);vd_hm.setAttribute("height",h);}vd_U.vd_xH();gl.depthFunc(gl.LEQUAL);gl.viewport(render.vd_cc,render.vd_eK,render.width,render.height);vdgeo.vd_aj(vd_qG,1,-1,1);gl.disable(gl.BLEND);vd_GL();vd_Jo();vd_Dn=vdgeo.vd_gW(render.vd_Ds(),vd_qG);vd_qs=new Float32Array(vd_qF(vdgeo.vd_gW(render.vd_gT,vd_qG)));vd_pG=new Float32Array(vd_qF(render.vd_bE()));vd_xW=new Float32Array(vd_qF(vd_fn,true,true));gl.uniformMatrix4fv(vd_fW,false,vd_qs);gl.uniformMatrix4fv(vd_iz,false,vd_pG);gl.uniformMatrix4fv(vd_tV,false,vd_xW);if(vd_gs()){vd_w.gl.uniformMatrix4fv(vd_w.vd_fW,false,vd_qs);vd_w.gl.uniformMatrix4fv(vd_w.vd_iz,false,vd_pG);}if(render.vd_fx){var vd_wy=[render.vd_dq,render.vd_dq,render.vd_dq];var vd_vI=[render.vd_iv[0],render.vd_iv[1],render.vd_iv[2]];var vd_ng=[render.vd_hw[0],render.vd_hw[1],render.vd_hw[2]];if(!render.vd_pU){vdgeo.vd_lv(render.vd_bE(),vd_ng[X],vd_ng[Y],vd_ng[Z],vd_ng,true);}gl.uniform3f(vd_xP,vd_wy[0],vd_wy[1],vd_wy[2]);gl.uniform3f(vd_yV,vd_vI[0],vd_vI[1],vd_vI[2]);gl.uniform3f(vd_vi,vd_ng[0],vd_ng[1],vd_ng[2]);}else{gl.uniform3f(vd_xP,1,1,1);gl.uniform3f(vd_yV,0,0,0);gl.uniform3f(vd_vi,0,0,1);}return true;};this.vd_Kd=function(){var vd_cq=render.vd_kD();var vd_uO=render.vd_iN();gl.uniform4fv(vd_ac,[vd_cq[0]/255.0,vd_cq[1]/255.0,vd_cq[2]/255.0,1.0]);gl.uniform4fv(vd_pb,[vd_uO[0]/255.0,vd_uO[1]/255.0,vd_uO[2]/255.0,vd_uO[3]/255.0]);gl.clearColor(vd_cq[0]/255.0,vd_cq[1]/255.0,vd_cq[2]/255.0,0.0);gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT);vd_Ir();};this.vd_nd=function(){if(!vd_U.vd_al){vd_fv.draw(null,true);}gl.flush();var i,iy,ix;var vd_tM=render.vd_H.vd_qu();var w1=render.vd_H.vd_az;var h1=render.vd_H.vd_bG;gl.readPixels(0,0,w1,h1,gl.RGBA,gl.UNSIGNED_BYTE,vd_kX);var left=render.clip[0];var top=render.clip[1];var right=Math.min(w1-1,render.clip[2]);var bottom=Math.min(h1-1,render.clip[3]);var w=right-left+1;var h=bottom-top+1;for(iy=top;iy<=bottom;iy++){for(ix=left;ix<=right;ix++){i=(iy*w1+ix)*4;vd_tM.data[i]=vd_kX[i];i++;vd_tM.data[i]=vd_kX[i];i++;vd_tM.data[i]=vd_kX[i];i++;vd_tM.data[i]=vd_kX[i];i++;}}vd_HZ();};this.vd_CU=function(vd_Nw,vd_iT){if(!vd_U.vd_al&&vd_Nw!=vd_iT){vd_fv.draw(null,true);}if(!vd_iT){gl.bindTexture(gl.TEXTURE_2D,vd_fa['h_0']);gl.uniform1i(textureprops,0);}else{var hid='h_'+vd_iT.HandleId.toString();var vd_cO=vd_fa[hid];if(!vd_cO){vd_fa[hid]=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,vd_fa[hid]);var _w=vd_iT.width;var _h=vd_iT.height;var vd_Ey=new Uint8Array(_w*_h*4);var index=0;for(var h=0;h<vd_iT.height;h++){for(var w=0;w<vd_iT.width*4;w++){vd_Ey[index]=vd_iT.bytes[h][w];index++;}index=(h+1)*_w*4;}gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,_w,_h,0,gl.RGBA,gl.UNSIGNED_BYTE,vd_Ey);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);}else{gl.bindTexture(gl.TEXTURE_2D,vd_cO);}gl.uniform1i(textureprops,render.vd_fl?1:0);}vd_nx=vd_iT;};this.vd_tF=function(pts,vd_jA,vd_fQ,vd_tf){if(pts.length==0)return;var rgbm;var pt;var vd_br=vd_kf;if(render.vd_tl(render.vd_H.vd_at))vd_br|=4;var vd_wA=render.vd_H.vd_at;var off=vd_fQ/render.height;for(var i=0;i<pts.length;i++){pt=pts[i];if(vd_jA){rgbm=vd_jA[i];render.vd_H.vd_at=[((rgbm>>16)&0xFF),((rgbm>>8)&0xFF),(rgbm&0xFF)];}vd_U.vd_hT(pt,vd_fQ);}render.vd_H.vd_at=vd_wA;};this.vd_hT=function(p1,vd_fQ){vdgeo.vd_cB(vd_hr,p1,_p1);var vd_br=vd_kf;if(render.vd_tl(render.vd_H.vd_at))vd_br|=4;if(vd_fQ!==undefined)vd_br|=8;if(vd_U.vd_al){vd_U.vd_al.vd_eY(null,2,_p1,render.vd_H.vd_at,render.vd_H.Alpha,vd_fC,vd_br,null,0,0,vd_fQ,false,vd_eA);}else{vd_fv.vd_eY(2,_p1,render.vd_H.vd_at,render.vd_H.Alpha,vd_fC,vd_br,null,0,0,vd_fQ,false,vd_eA);}};this.vd_cW=function(p1,p2){vdgeo.vd_cB(vd_hr,p1,_p1);vdgeo.vd_cB(vd_hr,p2,_p2);var vd_br=vd_kf;if(render.vd_tl(render.vd_H.vd_at))vd_br|=4;if(vd_U.vd_al){vd_U.vd_al.vd_eY(null,1,_p1,render.vd_H.vd_at,render.vd_H.Alpha,vd_fC,vd_br,null,0,0,0,false,vd_eA);vd_U.vd_al.vd_eY(null,1,_p2,render.vd_H.vd_at,render.vd_H.Alpha,vd_fC,vd_br,null,0,0,0,false,vd_eA);}else{vd_fv.vd_eY(1,_p1,render.vd_H.vd_at,render.vd_H.Alpha,vd_fC,vd_br,null,0,0,0,false,vd_eA);vd_fv.vd_eY(1,_p2,render.vd_H.vd_at,render.vd_H.Alpha,vd_fC,vd_br,null,0,0,0,false,vd_eA);}};function vd_mA(p1,p2,p3,vd_aV,uv1,uv2,uv3){if(vd_aV)vd_aV=vdgeo.vd_id(vd_hr,vd_aV[0],vd_aV[1],vd_aV[2],true);var vd_br=render.vd_fx?(vd_kf|2):vd_kf;if(render.vd_tl(render.vd_H.vd_at)&& !render.vd_gw)vd_br|=4;if(vd_nx&&render.vd_vL)vd_br|=16;if(vd_U.vd_al){vd_U.vd_al.vd_eY(vd_nx,0,p1,render.vd_H.vd_at,render.vd_H.Alpha,vd_fC,vd_br,vd_aV,uv1[0],uv1[1],uv1[2],render.vd_gw,vd_eA);vd_U.vd_al.vd_eY(vd_nx,0,p2,render.vd_H.vd_at,render.vd_H.Alpha,vd_fC,vd_br,vd_aV,uv2[0],uv2[1],uv2[2],render.vd_gw,vd_eA);vd_U.vd_al.vd_eY(vd_nx,0,p3,render.vd_H.vd_at,render.vd_H.Alpha,vd_fC,vd_br,vd_aV,uv3[0],uv3[1],uv3[2],render.vd_gw,vd_eA);return;}else{vd_fv.vd_eY(0,p1,render.vd_H.vd_at,render.vd_H.Alpha,vd_fC,vd_br,vd_aV,uv1[0],uv1[1],uv1[2],render.vd_gw,vd_eA);vd_fv.vd_eY(0,p2,render.vd_H.vd_at,render.vd_H.Alpha,vd_fC,vd_br,vd_aV,uv2[0],uv2[1],uv2[2],render.vd_gw,vd_eA);vd_fv.vd_eY(0,p3,render.vd_H.vd_at,render.vd_H.Alpha,vd_fC,vd_br,vd_aV,uv3[0],uv3[1],uv3[2],render.vd_gw,vd_eA);}};this.vd_kw=function(p1,p2,p3,p4,vd_gf,vd_ez,vd_fE,vd_hH,vd_aV,uv1,uv2,uv3,uv4){vdgeo.vd_cB(vd_hr,p1,_p1);vdgeo.vd_cB(vd_hr,p2,_p2);vdgeo.vd_cB(vd_hr,p3,_p3);vd_mA(_p1,_p2,_p3,vd_aV,uv1,uv2,uv3);if(p4){vdgeo.vd_cB(vd_hr,p4,_p4);vd_mA(_p3,_p4,_p1,vd_aV,uv3,uv4,uv1);}};this.vd_er=function(pts,vd_aV,uvs,vd_fu){if(pts.length>255||pts.length<3)return;if(!vd_aV)vd_aV=[0,0,1];var zorg=pts[0][Z];var i=0;var k=0;if(pts.length>3){var vd_vl=gpc.vd_Bj(gpc.vd_FQ([pts]));for(k=0;k<vd_vl.length;k++){var vd_hl=[];vd_hl.length=vd_vl.length;var vd_ii=vd_vl[k];for(i=0;i<vd_ii.length;i++){var pt=vd_ii[i];pt[Z]=zorg;vd_hl[i]=uv0;if(render.vd_gN&&uvs){vd_hl[i]=vdgeo.matrixtransform(render.vd_gN,pt);vd_hl[i][Z]=1.0;}vdgeo.vd_tu(vd_hr,pt[X],pt[Y],pt[Z],pt);}for(i=0;i<vd_ii.length-2;i++){if(i%2==1){vd_mA(vd_ii[i+2],vd_ii[i+1],vd_ii[i],vd_aV,vd_hl[i+2],vd_hl[i+1],vd_hl[i]);}else{vd_mA(vd_ii[i],vd_ii[i+1],vd_ii[i+2],vd_aV,vd_hl[i],vd_hl[i+1],vd_hl[i+2]);}}}}else{if(uvs){vd_mA(pts[0],pts[1],pts[2],vd_aV,uvs[0],uvs[1],uvs[2]);}else{vd_mA(pts[0],pts[1],pts[2],vd_aV,uv0,uv0,uv0);}}};function vd_HV(buf,vd_Ex){var vd_cx=buf.vd_cx();if(vd_cx==0)return;var vd_qL=buf.primitiveType;var vd_b=buf.vd_b;if(!((vd_hC===3)||(vd_hC===1&& !buf.vd_yv)||(vd_hC===2&&buf.vd_yv)))render.vd_qr=true;if(vd_Ex){var vd_tC=4;var vd_fK=new Float32Array(vd_cx*vd_cf*vd_tC);for(var i=0;i<vd_cx;i++){var index=i*vd_cf;var vd_dy=i*vd_cf*vd_tC;for(var j=0;j<vd_tC;j++){for(var k=0;k<vd_cf;k++){vd_fK[vd_dy+(j*vd_cf)+k]=vd_b[index+k];}}var npt=vdgeo.vd_bL(vd_b[index],vd_b[index+1],vd_b[index+2],vd_Dn);var off=vd_b[index+9]/render.height;vdgeo.vd_bn(_p1,npt);vdgeo.vd_bn(_p2,npt);_p1[X]-=off;_p2[X]+=off;vd_fK[vd_dy]=_p1[X];vd_fK[vd_dy+1]=_p1[Y];vd_fK[vd_dy+2]=_p1[Z];vd_dy+=vd_cf;vd_fK[vd_dy]=_p2[X];vd_fK[vd_dy+1]=_p2[Y];vd_fK[vd_dy+2]=_p2[Z];vd_dy+=vd_cf;vdgeo.vd_bn(_p1,npt);vdgeo.vd_bn(_p2,npt);_p1[Y]-=off;_p2[Y]+=off;vd_fK[vd_dy]=_p1[X];vd_fK[vd_dy+1]=_p1[Y];vd_fK[vd_dy+2]=_p1[Z];vd_dy+=vd_cf;vd_fK[vd_dy]=_p2[X];vd_fK[vd_dy+1]=_p2[Y];vd_fK[vd_dy+2]=_p2[Z];}vd_qL=1;vd_cx=vd_cx*vd_tC;vd_b=vd_fK;gl.uniformMatrix4fv(vd_fW,false,vd_qo);gl.uniformMatrix4fv(vd_iz,false,vd_qo);gl.uniformMatrix4fv(vd_tV,false,vd_qo);if(vd_gs()){vd_w.gl.uniformMatrix4fv(vd_w.vd_fW,false,vd_qo);vd_w.gl.uniformMatrix4fv(vd_w.vd_iz,false,vd_qo);}}var vd_kh=gl.DYNAMIC_DRAW;gl.bindBuffer(gl.ARRAY_BUFFER,vd_gp);gl.bufferData(gl.ARRAY_BUFFER,vd_b,vd_kh);gl.bindBuffer(gl.ARRAY_BUFFER,vd_hb);gl.bufferData(gl.ARRAY_BUFFER,vd_b,vd_kh);gl.bindBuffer(gl.ARRAY_BUFFER,vd_qy);gl.bufferData(gl.ARRAY_BUFFER,vd_b,vd_kh);gl.bindBuffer(gl.ARRAY_BUFFER,vd_nJ);gl.bufferData(gl.ARRAY_BUFFER,vd_b,vd_kh);gl.bindBuffer(gl.ARRAY_BUFFER,vd_pw);gl.bufferData(gl.ARRAY_BUFFER,vd_b,vd_kh);if(vd_gs()){vd_w.gl.bindBuffer(vd_w.gl.ARRAY_BUFFER,vd_w.vd_gp);vd_w.gl.bufferData(vd_w.gl.ARRAY_BUFFER,vd_b,vd_kh);vd_w.gl.bindBuffer(vd_w.gl.ARRAY_BUFFER,vd_w.vd_hb);vd_w.gl.bufferData(vd_w.gl.ARRAY_BUFFER,vd_b,vd_kh);}if(vd_qL===0)gl.drawArrays(gl.TRIANGLES,0,vd_cx);else{if(vd_qL===2)gl.drawArrays(gl.vd_MA,0,vd_cx);else gl.drawArrays(gl.LINES,0,vd_cx);}if(vd_gs()){if(vd_qL===0)vd_w.gl.drawArrays(vd_w.gl.TRIANGLES,0,vd_cx);else{if(vd_qL===2)vd_w.gl.drawArrays(vd_w.gl.vd_MA,0,vd_cx);else vd_w.gl.drawArrays(vd_w.gl.LINES,0,vd_cx);}}if(vd_Ex){gl.uniformMatrix4fv(vd_fW,false,vd_qs);gl.uniformMatrix4fv(vd_iz,false,vd_pG);gl.uniformMatrix4fv(vd_tV,false,vd_xW);if(vd_gs()){vd_w.gl.uniformMatrix4fv(vd_w.vd_fW,false,vd_qs);vd_w.gl.uniformMatrix4fv(vd_w.vd_iz,false,vd_pG);}}};this.vd_Dc=function(){return vd_U.vd_al!=null&&vd_U.vd_al.vd_nT;};this.vd_DI=function(){if(!vd_U.vd_al)return;if(vd_U.vd_al.vd_nT)vd_U.vd_tW(render);vd_U.vd_al.vd_nT=false;};this.vd_nQ=function(){if(!vd_U.vd_al)return;if(!vd_U.vd_al.vd_nT)vd_U.vd_al=null;};this.vd_tW=function(vd_AA){if(vd_U.vd_al)vd_U.vd_al.vd_nT=false;if(render!=vd_AA)return false;if(!render.vd_ab())return false;if(!vd_U.vd_al){vd_U.vd_al=new list(Math.abs(vdcanvas.vd_Eg()));vd_U.vd_al.vd_nT=true;return false;}vd_U.vd_al.draw(vd_HV,vd_U.vd_CU);return true;};return this;};function vd_rf(vd_n,vd_LJ,vd_IT,vd_ut,vd_rA,vd_wQ){var vd_U=this;this.vdraw=vd_n;this.vd_ds=function(){return vdConst.vd_pX;};this.vd_cc=vd_LJ;this.vd_eK=vd_IT;this.width=vd_ut;this.height=vd_rA;this.vd_Z=10;this.vd_B=vdgeo.newpoint(0,0,0);this.vd_aN=vdgeo.vd_e();this.vd_dm=vdgeo.vd_e();this.vd_ml=vdgeo.vd_e();this.vd_NZ=vdgeo.vd_e();this.vd_gT=vdgeo.vd_e();this.vd_uH=null;this.pixelsize=1.0;this.vd_CR=1.0;this.GetPixelSize=function(){return vd_U.pixelsize;};this.vd_dF=function(){return vd_U.pixelsize/vd_ED;};this.vd_H=new vd_OI(this,vd_wQ);this.palette=null;this.vd_jW=1.0;this.RenderMode=vdConst.vd_qa;this.vd_bH=true;this.vd_LL=60.0;this.vd_ak=false;this.vd_fl=true;this.vd_bJ=true;this.vd_nb=false;this.vd_fx=true;this.vd_pU=true;this.vd_hw=vdgeo.newpoint(0,0,-1);this.vd_dq=0.25;this.vd_Lf=0.15;this.vd_iv=[1,1,1];this.vd_bY=null;this.vd_nC=function(vd_kk,vd_kg){if(!vd_kk|| !vd_kg)return 1.0;var size=vd_kk;if(size<0)size/= -100.0;var scale=size*vd_U.pixelsize*(dpi/25.4)/vd_kg;return scale;};this.vd_uc=function(vd_kk,mat,vd_kg){if(!vd_kk|| !vd_kg)return;var scale=vd_U.vd_nC(vd_kk,vd_kg);vdgeo.vd_aj(mat,scale,scale,1.0);};this.vd_sZ=function(from){if(!from)return;vd_U.vd_ak=from.vd_ak;vd_U.vd_fl=from.vd_fl;vd_U.vd_bJ=from.vd_bJ;vd_U.vd_dq=from.vd_dq;vd_U.vd_iv=from.vd_iv;vd_U.vd_fx=from.vd_fx;vd_U.vd_pU=from.vd_pU;vdgeo.vd_bn(vd_U.vd_hw,from.vd_hw);vd_U.vd_bY=from.vd_bY;vd_U.RenderMode=from.RenderMode;vd_U.vd_bH=from.vd_bH;vd_U.vd_H.vd_iH=from.vd_H.vd_iH;vd_U.vd_nb=from.vd_nb;};var vd_xA=vdgeo.newpoint(0,0,-1);this.vd_AX=function(x,y,z,vd_KY,vd_hD,r,g,b){vd_U.vd_pU=(vd_KY?true:false);vd_U.vd_fx=true;if(vd_hD<0){vd_U.vd_fx=false;vd_U.vd_dq=0;}if(vd_hD===0)vd_U.vd_dq=0.0;else if(vd_hD===1)vd_U.vd_dq=0.25;else if(vd_hD===2)vd_U.vd_dq=0.50;else if(vd_hD===3)vd_U.vd_dq=0.75;else if(vd_hD===4)vd_U.vd_dq=1.0;else vd_U.vd_dq=0.25;vd_U.vd_dq+=vd_U.vd_Lf;vd_U.vd_hw[X]=x;vd_U.vd_hw[Y]=y;vd_U.vd_hw[Z]=z;vdgeo.vd_dR(vd_U.vd_hw);if(!r&&r!=0)r=255;if(!g&&g!=0)g=255;if(!b&&b!=0)b=255;r=Math.min(Math.max(r,0),255);g=Math.min(Math.max(g,0),255);b=Math.min(Math.max(b,0),255);vd_U.vd_iv=[r/255,g/255,b/255];};function vd_Pa(){vd_U.vd_AX(0,0,-1,true,1,255,255,255);};function vd_PO(vd_fU){if(!vd_fU|| !vd_fU.Default)return;vd_Pa();var vd_fg=null;if(vd_fU.Default&&vd_fU.Default.Enable)vd_fg=vd_fU.Default;if(!vd_fg&&vd_fU){for(var i=0;i<vd_fU.length;i++){if(!vd_fU[i].Enable)continue;vd_fg=vd_fU[i];break;}}if(!vd_fg){vd_U.vd_fx=false;return;}vd_U.vd_AX(vd_fg.Direction[X],vd_fg.Direction[Y],vd_fg.Direction[Z],true,vd_fg.Intensity,vd_fg.color[0],vd_fg.color[1],vd_fg.color[2]);};this.vd_dk=[];this.linetype=null;this.vd_mp=1.0;this.vd_bb=undefined;var vd_mk=null;var ShowHidenEdges=false;var vd_dL=[[vdgeo.vd_e(),vdgeo.vd_e(),vdgeo.vd_e()]];var vd_cq=[0,0,0,255];var vd_dV=[255,255,255,255];function vd_NU(color){return color==undefined||color==null||(color[0]===0&&color[1]===0&&color[2]===0&&color[3]===0);};this.vd_tl=function(color){return color===vd_dV;};this.vd_kD=function(){return vd_cq;};this.vd_iN=function(){return vd_dV;};this.vd_fR=function(index){if(index=== -1)return vd_cq;else if(index===6)return vd_dV;else if(vd_U.palette)return vd_U.palette.Items[index].SystemColor;};this.vd_xl=function(color){var b=vdgdi.vd_ne(vd_cq);var c=vdgdi.vd_ne(color);var d=Math.abs(b-c);if(d<vdgdi.vd_HG)return vd_dV;return color;};this.vd_hK=function(vd_jP,vd_ac){if(!vd_NU(vd_ac)){vd_cq=vd_ac;var vd_wc=vdgdi.WHITE;if(vd_jP)vd_wc=vd_jP.Items[6].SystemColor;var vd_zp=vdgdi.vd_ne(vd_cq);var vd_MD=vdgdi.vd_ne(vdgdi.WHITE);var vd_LK=vdgdi.vd_ne(vdgdi.BLACK);var vd_MC=vdgdi.vd_ne(vd_wc);var vd_Ns=Math.abs(vd_zp-vd_MD);var vd_Ln=Math.abs(vd_zp-vd_LK);var vd_NJ=Math.abs(vd_zp-vd_MC);if(vd_NJ<vdgdi.vd_HG){vd_dV=((vd_Ns>vd_Ln)?vdgdi.WHITE:vdgdi.BLACK);}else{vd_dV=vd_wc;}}else{if(vd_jP){vd_cq=vd_jP.Background;vd_dV=vd_jP.Items[6].SystemColor;}else{vd_cq=vdgdi.BLACK;vd_dV=vdgdi.WHITE;}}vd_U.palette=vd_jP;vd_U.vd_ao(vd_dV);};this.vd_bo={left:0,top:0,right:0,bottom:0};this.vd_xM=function(){return vd_U.vd_Z*vd_U.vd_yK();};this.vd_yK=function(){return(vd_U.width/vd_U.height);};this.vd_pC=function(){if(vd_U.vd_dk.length===0)return null;return vd_U.vd_dk[vd_U.vd_dk.length-1];};this.vd_kv=function(bval){var ret=ShowHidenEdges;if(bval==undefined)bval=false;ShowHidenEdges=bval;return ret;};this.vd_qY=function(fig,index){if(fig==null){vd_U.vd_dk.pop();}else{vd_U.vd_dk.push(fig);}if(vd_U.vd_bJ&&vd_U.vd_ab()){vd_U.vd_aK.vd_OM(fig,index);}};this.vd_zI=function(ltscale){var ret=vd_U.vd_mp;vd_U.vd_mp=ltscale;return ret;};this.vd_AK=function(lt){var ret=vd_U.linetype;if(lt!==undefined){vd_U.linetype=lt;}return ret;};this.vd_bf=function(vd_oM){var ret=vd_U.vd_H.penwidth;if(vd_oM!==undefined)vd_U.vd_H.vd_bf(vd_oM);return ret;};this.vd_qr=false;this.vd_oi=function(mode){if(!vd_U.vd_bH)mode=3;if(vd_U.vd_ab()){vd_U.vd_aK.vd_oi(mode);}vd_hC=mode;vd_U.vd_qr=false;};var vd_hC=3;this.vd_ao=function(color){var ret=vd_U.vd_H.vd_at;if(color!==undefined)vd_U.vd_H.vd_ao(color);return ret;};this.vd_go=function(vd_cO){var ret=vd_U.vd_H.vd_gt;if(ret===vd_cO)return ret;vd_U.vd_H.vd_go(vd_cO);if(vd_U.vd_ab()){vd_U.vd_aK.vd_CU(ret,vd_cO);}return ret;};this.vd_gN=null;this.vd_gb=function(vd_qv){var ret=vd_U.vd_gN;if(vd_qv!==0)vd_U.vd_gN=vd_qv;return ret;};this.vd_vj=function(vd_AJ){var ret=vd_U.vd_H.vd_zk;if(vd_AJ!==undefined)vd_U.vd_H.vd_zk=vd_AJ;return ret;};var vd_Aj=1.0;var vd_ED=1.0;function vd_vU(){vd_Aj=vd_FP(1,0,0);vd_ED=vd_FP(0,1,0);if(vd_U.vd_ab())vd_U.vd_aK.vd_Ke();};this.vd_bh=function(mat){var m=vd_U.vd_bE();vd_dL.push([null,null,null]);vd_U.vd_pQ(mat?vdgeo.vd_gW(mat,m):mat);};this.vd_bC=function(){vd_dL.pop();vd_vU();};this.vd_bE=function(){return vd_dL[vd_dL.length-1][0];};this.vd_Ds=function(){return vd_dL[vd_dL.length-1][2];};this.vd_dZ=function(){return vd_dL[vd_dL.length-1][1];};function vd_PD(){var fig=vd_U.vd_pC();if(fig==null||fig._t!==vdConst.vdText_code)return 1.0;return fig.Height/fig.StyleRef.FontFileVDS.Ascent;};var vd_uu=vdgeo.newpoint(0,0,1);function vd_FJ(){vd_U.vd_H.vd_lP=[1.0,1.0,1.0];};this.vd_Hf=function(normal){if(vd_U.vd_bH&&vd_U.RenderMode===vdConst.vd_qa){if(!normal)vd_uu=vdgeo.vd_ha(vd_U.vd_bE());else vdgeo.vd_lv(vd_U.vd_bE(),normal[X],normal[Y],normal[Z],vd_uu,true);if(!vd_U.vd_ak&&vdgeo.AreEqual(vd_uu[Z],0.0,vdgeo.DefaultVectorEquality))return false;if(vd_U.vd_ak||(vd_U.vd_fx&&vd_xA[Z]<0)){var vd_vm=Math.abs(vdgeo.vd_ht(vd_xA,vd_uu));vd_U.vd_H.vd_lP[0]=vd_U.vd_iv[0]*vd_vm+vd_U.vd_dq;vd_U.vd_H.vd_lP[1]=vd_U.vd_iv[1]*vd_vm+vd_U.vd_dq;vd_U.vd_H.vd_lP[2]=vd_U.vd_iv[2]*vd_vm+vd_U.vd_dq;}}return true;};this.PushToViewMatrix=function(){vd_U.vd_bh(vdgeo.vd_aR(vd_U.vd_bE()));};this.PopMatrix=function(){vd_U.vd_bC();};this.vd_pQ=function(mat){if(!mat)mat=vdgeo.vd_e();vd_dL[vd_dL.length-1][0]=mat;vd_dL[vd_dL.length-1][1]=vdgeo.vd_gW(mat,vd_U.vd_dm);vd_dL[vd_dL.length-1][2]=vdgeo.vd_gW(mat,vd_U.vd_gT);vd_vU();};this.vd_sK=function(x,y,z){if(z===undefined)z=1.0;var vd_ca=vdgeo.vd_bL(x,y,z,vd_U.vd_aN);var vd_fn=vdgeo.vd_aR(vd_U.vd_bE());var vd_dd=vdgeo.matrixtransform(vd_fn,vd_ca);if(!vd_U.vd_ak&&vdgeo.AreEqual(z,1.0,vdgeo.vd_DJ)){var elevation=0.0;var v=vdgeo.vd_ha(vd_fn);if(!vdgeo.AreEqual(v[Z],0.0,vdgeo.DefaultLinearEquality)){var ar1=(elevation-vd_dd[Z])/v[Z];vd_dd[X]+=ar1*v[X];vd_dd[Y]+=ar1*v[Y];vd_dd[Z]=elevation;}}return vd_dd;};this.clip=[vd_U.vd_cc,vd_U.vd_eK,vd_U.vd_cc+vd_U.width-1,vd_U.vd_eK+vd_U.height-1];this.vd_OO=function(){vd_U.clip=[vd_U.vd_cc,vd_U.vd_eK,vd_U.vd_cc+vd_U.width-1,vd_U.vd_eK+vd_U.height-1];vd_U.vd_tA();};this.vd_xC=function(left,top,right,bottom){vd_U.clip=[Math.max(left,vd_U.vd_cc),Math.max(top,vd_U.vd_eK),Math.min(right,vd_U.vd_cc+vd_U.width-1),Math.min(bottom,vd_U.vd_eK+vd_U.height-1)];vd_U.vd_tA();};this.vd_tA=function(){var vd_aD=vdgeo.newpoint(0,0,0);var vd_as=vdgeo.newpoint(0,0,0);if(vd_U.clip==null)vd_U.clip=[vd_U.vd_cc,vd_U.vd_eK,vd_U.vd_cc+vd_U.width-1,vd_U.vd_eK+vd_U.height-1];if(vd_U.vd_ak){var _ul=vdgeo.vd_bL(vd_U.clip[0],vd_U.clip[1],1,vd_U.vd_aN);var _ur=vdgeo.vd_bL(vd_U.clip[2],vd_U.clip[1],1,vd_U.vd_aN);var _lr=vdgeo.vd_bL(vd_U.clip[2],vd_U.clip[3],1,vd_U.vd_aN);var _ll=vdgeo.vd_bL(vd_U.clip[0],vd_U.clip[3],1,vd_U.vd_aN);vd_U.vd_bo.left=_ll[X];vd_U.vd_bo.bottom=_ll[Y];vd_U.vd_bo.right=_ur[X];vd_U.vd_bo.top=_ur[Y];}else{vdgeo.vd_IA(vd_U.vd_aN,vd_U.clip[0],vd_U.clip[3],vd_aD);vdgeo.vd_IA(vd_U.vd_aN,vd_U.clip[2],vd_U.clip[1],vd_as);vd_U.vd_bo.left=vd_aD[X];vd_U.vd_bo.bottom=vd_aD[Y];vd_U.vd_bo.right=vd_as[X];vd_U.vd_bo.top=vd_as[Y];}};this.vd_QS=function(x,y){return vdgeo.vd_nc(x,y,vd_U.vd_bo.left,vd_U.vd_bo.bottom,vd_U.vd_bo.right,vd_U.vd_bo.top);};this.vd_Fl=function(px,py){return vdgeo.vd_nc(px,py,vd_U.clip[0],vd_U.clip[1],vd_U.clip[2],vd_U.clip[3]);};var vd_dn=vdgeo.newpoint(0,0,0);var vd_ch=vdgeo.newpoint(0,0,0);var __P1=vdgeo.newpoint(0,0,0);var __P2=vdgeo.newpoint(0,0,0);var vd_hn=vdgeo.newpoint(0,0,0);var vd_ci=vdgeo.newpoint(0,0,0);this.vd_HJ=function(p1,p2,vd_h,vd_C){if(vd_U.vd_ak){vdgeo.vd_nA(p1[X],p1[Y],p1[Z],vd_U.vd_dm,p1);vdgeo.vd_nA(p2[X],p2[Y],p2[Z],vd_U.vd_dm,p2);var ret=vd_zT(p1,p2,vd_h,vd_C);return ret!==1;}else{return vdgeo.vd_GR(vd_U.vd_bo.left,vd_U.vd_bo.bottom,vd_U.vd_bo.right,vd_U.vd_bo.top,p1,p2,vd_h,vd_C)!==1;}};function vd_Ay(p1,p2,vd_h,vd_C){return vdgeo.vd_GR(vd_U.clip[0],vd_U.clip[1],vd_U.clip[2],vd_U.clip[3],p1,p2,vd_h,vd_C);};function vd_Em(p1,p2,vd_h,vd_C){return vdgeo.vd_Im(vd_U.clip[0],vd_U.clip[1],vd_U.clip[2],vd_U.clip[3],p1,p2,vd_h,vd_C);};function vd_zT(p1,p2,vd_h,vd_C){if(!vdgeo.vd_MO(p1,p2))return 1;return vdgeo.vd_Im(vd_U.clip[0],vd_U.clip[1],vd_U.clip[2],vd_U.clip[3],p1,p2,vd_h,vd_C);};var vd_gA=vd_Em;function vd_xY(pts,uvs,vd_fu){vd_U.vd_H.vd_eG(pts);};function vd_lA(pts,uvs,vd_fu){vd_U.vd_H.vd_NE(pts,uvs,vd_fu);};function vd_Ih(pts,uvs,vd_fu){var ret=vdgeo.vd_NG(pts,uvs);vd_lA(ret[0],ret[1],vd_fu);};function vd_Hv(pts,uvs,vd_oy){vd_U.vd_H.vd_mM(pts);};function vd_ua(pts,uvs,vd_oy){vd_U.vd_H.vd_NB(pts,uvs,vd_oy);};function vd_Bi(x1,y1,x2,y2,z1,z2){vd_U.vd_H.vd_NM(x1,y1,x2,y2);};function vd_BB(x1,y1,x2,y2,z1,z2){vd_U.vd_H.vd_NP(x1,y1,x2,y2,z1,z2);};var vd_jh=vd_BB;function vd_FR(){if(vd_U.vd_ab()&&vd_U.vd_aK.vd_al)return true;if(vd_hC===3)return true;else if(vd_hC===1&&vd_U.vd_H.Alpha===255)return true;else if(vd_hC===2&&vd_U.vd_H.Alpha!==255)return true;vd_U.vd_qr=true;return false;};function vd_wE(){return true;};var vd_eU=vd_FR;this.vd_sM=function(){if(vd_U.vd_aK)vd_U.vd_aK.vd_sM();};this.destroy=function(){vd_U.vd_sM();};Object.defineProperty(vd_U,'vd_aK',{get:function(){if(!vd_U.vdraw)return null;return vd_U.vdraw.vd_aK;}});this.vd_ab=function(){return(vd_n&&vd_n.vd_fO&&vd_U.vd_aK&& !vd_fS&&vd_U.RenderMode==vdConst.vd_qa&&vd_U.vd_aK.vd_uU());};this.vd_nd=function(){if(!vd_U.vd_ab())return false;vd_U.vd_aK.vd_nd();return true;};function vd_kw(p1,p2,p3,p4,vd_gf,vd_ez,vd_fE,vd_hH,vd_aV,uv1,uv2,uv3,uv4){if(!vd_eU())return;if(vd_U.vd_ab()){vd_U.vd_aK.vd_kw(p1,p2,p3,p4,vd_gf,vd_ez,vd_fE,vd_hH,vd_aV,uv1,uv2,uv3,uv4);return;}if(p4){vd_U.vd_er([p1,p2,p3,p4],vd_aV,[uv1,uv2,uv3,uv4],true);}else{vd_U.vd_er([p1,p2,p3],vd_aV,[uv1,uv2,uv3],true);}};function vd_sa(p1,p2,p3,p4,vd_gf,vd_ez,vd_fE,vd_hH,vd_aV,uv1,uv2,uv3,uv4){if(!vd_eU())return;if(vd_mk!==null){vd_U.vd_bb=vd_mk*5;if(vd_gf)vd_cj(p1,p2);vd_U.vd_bb++;if(vd_ez)vd_cj(p2,p3);vd_U.vd_bb++;if(vd_fE)vd_cj(p3,p4?p4:p1);vd_U.vd_bb++;if(vd_hH&&p4)vd_cj(p4,p1);}else{if(vd_gf)vd_cj(p1,p2);if(vd_ez)vd_cj(p2,p3);if(vd_fE)vd_cj(p3,p4?p4:p1);if(vd_hH&&p4)vd_cj(p4,p1);}vd_U.vd_bb=undefined;};var vd_gJ=vd_kw;function vd_Bk(x,y,z,vd_aZ){vdgeo.vd_PL(vd_U.vd_dZ(),x,y,z,vd_aZ);};function vd_Cp(x,y,z,vd_aZ){vdgeo.vd_tu(vd_U.vd_dZ(),x,y,z,vd_aZ);};function vd_Bo(x,y,z,vd_aZ){vdgeo.vd_nA(x,y,z,vd_U.vd_dZ(),vd_aZ);};function vd_kM(vd_g,vd_aZ){vd_li(vd_g[X],vd_g[Y],vd_g[Z],vd_aZ);};function vd_RS(vd_g){var vd_aZ=vdgeo.newpoint(0,0,0);vd_kM(vd_g,vd_aZ);return vd_aZ;};function vd_Rd(pts){var ret=[];ret.length=pts.length;for(var i=0;i<pts.length;i++){ret[i]=vd_RS(pts[i]);}return ret;};var vd_eG=vd_lA;var vd_mM=vd_ua;var vd_li=vd_Cp;this.vd_sv=function(){return vd_fS;};function vd_CL(pts,closed){var sp=pts[0];var ret;for(var i=1;i<pts.length;i++){var ep=pts[i];ret=vd_gA(sp,ep,vd_dn,vd_ch);if(ret!==1)vd_jh(vd_dn[X],vd_dn[Y],vd_ch[X],vd_ch[Y],vd_dn[Z],vd_ch[Z]);sp=ep;}if(closed){ret=vd_gA(sp,pts[0],vd_dn,vd_ch);if(ret===1)return;vd_jh(vd_dn[X],vd_dn[Y],vd_ch[X],vd_ch[Y],vd_dn[Z],vd_ch[Z]);}};function vd_Qw(pts,uvs,vd_fu){vd_CL(pts,true);};function vd_HX(pts,uvs,vd_oy){for(var i=0;i<pts.length;i++){vd_CL(pts[i],true);}};var vd_fS=false;this.vd_rg=function(vd_KU){if(vd_fS)return;vd_fS=true;if(!vd_U.vd_ak){vd_gA=vd_Ay;vd_li=vd_Bk;}vd_mM=vd_HX;vd_jh=vd_Bi;vd_eU=vd_wE;vd_gJ=vd_kw;vd_U.vd_H.vd_CC(true,vd_KU);};this.vd_pP=function(){if(!vd_fS)return;vd_U.vd_H.vd_CC(false);vd_fS=false;vd_U.vd_eT();};this.vd_eT=function(){if(vd_U.vd_bH||vd_U.vd_bY){vd_gA=vd_Em;vd_li=vd_Cp;vd_eG=vd_lA;vd_mM=vd_ua;vd_jh=vd_BB;vd_eU=vd_U.vd_bH?vd_FR:vd_wE;if(vd_U.vd_ak){vd_li=vd_Bo;vd_gA=vd_zT;vd_eG=vd_Ih;}}else{if(vd_U.vd_ak){vd_li=vd_Bo;vd_gA=vd_zT;}else{vd_gA=vd_Ay;vd_li=vd_Bk;}vd_eG=vd_xY;vd_mM=vd_Hv;vd_jh=vd_Bi;vd_eU=vd_wE;}if(vd_U.RenderMode===vdConst.vd_qa)vd_gJ=vd_kw;else vd_gJ=vd_sa;vd_U.vd_H.vd_eT();};function vd_OA(vd_iF){vd_U.vd_bY=null;if(!vd_iF|| !vd_iF.Items)return;var k=0;for(var i=0;i<vd_iF.Items.length;i++){if(!vd_iF.Items[i].Enable)continue;if(k>=vdConst.NUMSECTIONS)break;if(!vd_U.vd_bY)vd_U.vd_bY=[];vd_U.vd_bY.push([vd_iF.Items[i].OriginPoint,vd_iF.Items[i].Direction]);k++;}};this.vd_vr=function(delegate,vd_zg,vd_Jy,vd_Cs,vd_KV){var width=vd_zg.width;var height=vd_zg.height;vd_U.vd_cc=0;vd_U.vd_eK=0;vd_U.width=width;vd_U.height=height;vd_U.vd_xC(0,0,width,height);vd_U.vd_H.vd_gl(vd_zg,width,height);vd_U.vd_hK(vd_Cs.palette,vd_Cs.vd_kD());vd_U.update(1.0,[0,0,0],vdgeo.vd_e(),null,0,0,false,vdConst.RENDERMODE_WIRE_2d,[],[]);delegate({sender:vd_Jy,render:vd_U,display:vd_KV,viewrect:vd_U.vd_bo,pixelsize:vd_U.pixelsize});vd_U.vd_H.vd_gl(null);};this.update=function(vd_kP,vd_mJ,vd_KR,vd_wP,FocalLength,LensAngle,vd_La,vd_oY,vd_iF,vd_fU){if(vd_oY!= -1){vd_U.RenderMode=vdConst.vd_xd;vd_U.vd_bH=false;vd_U.vd_fl=false;if(vd_oY&&vd_oY>vdConst.RENDERMODE_WIRE_2d&&vd_oY<vdConst.vd_PW){vd_U.vd_bH=true;if(vd_oY===vdConst.RENDERMODE_RENDER){vd_U.vd_fl=true;}if(vd_oY>vdConst.RENDERMODE_WIRE_3d)vd_U.RenderMode=vdConst.vd_qa;}}if(vd_U.vd_aK)vd_U.vd_aK.vd_JP(vd_U);if(!vd_kP)vd_kP=10.0;if(!vd_mJ)vd_mJ=vdgeo.newpoint(0,0,0);if(!FocalLength)FocalLength=0.05;if(!LensAngle)LensAngle=60.0;vd_PO(vd_fU);vd_OA(vd_iF);var vd_vd=vdgeo.vd_dD(vd_KR);vd_U.vd_ak=false;vd_U.vd_ak=vd_La;if(vd_U.vd_ak)vd_U.vd_bH=true;vd_U.vd_uH=null;var vd_fi=vd_kP*2.0;var zFar= -vd_kP*2.0;if(vd_wP){vd_U.vd_uH=vd_wP;var box=vdgeo.vd_ux(vd_vd,vd_wP);vd_fi=box[5];zFar=box[2];}var dz=Math.max(1.0,vd_fi-zFar)*0.01;vd_fi+=dz;zFar-=dz;vd_fi*= -1.0;zFar*= -1.0;vd_U.vd_H.vd_Ip(vd_fi,zFar);vd_U.vd_Z=vd_kP;vd_U.pixelsize=vd_U.vd_Z/vd_U.height;vd_U.pixelsize=Math.max(vdgeo.vd_DJ,(vd_U.vd_Z/vd_U.height));vd_U.pixelsize=Math.min(vdgeo.vd_Pz,vd_U.pixelsize);vd_U.vd_Z=vd_U.pixelsize*vd_U.height;vd_U.vd_B=vdgeo.newpoint(vd_mJ[X],vd_mJ[Y],vd_mJ[Z]);vdgeo.vd_gM(vd_U.vd_gT);vdgeo.vd_gM(vd_U.vd_dm);vdgeo.vd_gM(vd_U.vd_aN);vdgeo.vd_gM(vd_U.vd_ml);vdgeo.vd_aj(vd_U.vd_ml,vd_U.width*0.5,vd_U.height* -0.5,1);vdgeo.vd_x(vd_U.vd_ml,(vd_U.width*0.5+vd_U.vd_cc),(vd_U.height*0.5+vd_U.vd_eK),0);vd_U.vd_NZ=vdgeo.vd_aR(vd_U.vd_ml);var vd_jY=vd_U.width/vd_U.height;vd_U.vd_LL=LensAngle;if(vd_U.vd_ak)vdgeo.vd_Mw(vd_U.vd_gT,vd_U.vd_B,vd_U.vd_Z,vd_jY,vd_fi,zFar,FocalLength,LensAngle);else vdgeo.vd_Lg(vd_U.vd_gT,vd_U.vd_B,vd_U.vd_Z,vd_jY,vd_fi,zFar);vdgeo.vd_mB(vd_U.vd_dm,vd_U.vd_gT);vdgeo.vd_cr(vd_U.vd_dm,vd_U.vd_ml);vdgeo.vd_mB(vd_U.vd_aN,vd_U.vd_dm);vdgeo.vd_mh(vd_U.vd_aN);vd_U.vd_tA();if(vd_U.vd_fx){if(!vd_U.vd_pU){vdgeo.vd_lv(vd_vd,vd_U.vd_hw[X],vd_U.vd_hw[Y],vd_U.vd_hw[Z],vd_xA,true);}}vd_U.vd_pQ(vdgeo.vd_dD(vd_vd));if(vd_U.vd_ak){var vd_lF=vd_U.vd_gT;var vd_kV=vdgeo.vd_aR(vd_lF);var p1=vdgeo.vd_bL(0,1,1,vd_kV);var p2=vdgeo.vd_bL(0,-1,1,vd_kV);var vd_ND=vdgeo.Distance2D(p1,p2);vd_U.vd_CR=(vd_ND/vd_U.height);}if(vd_U.vd_bY){for(var i=0;i<vd_U.vd_bY.length;i++){var section=vd_U.vd_bY[i];var mat=vdgeo.vd_aR(vd_U.vd_dZ());vdgeo.vd_x(mat,-section[0][X],-section[0][Y],-section[0][Z]);vdgeo.vd_gB(mat,section[1]);section[2]=mat;}}vd_U.vd_eT();if(vd_U.vd_ab())vd_U.vd_aK.vd_Jj();vd_vU();};this.vd_uB=function(vd_ca){var vd_fn=vdgeo.vd_aR(vd_U.vd_bE());var vd_dd=vdgeo.matrixtransform(vd_fn,vd_ca);var elevation=0.0;var v=vdgeo.vd_ha(vd_fn);if(!vdgeo.AreEqual(v[Z],0.0,vdgeo.DefaultLinearEquality)){var ar1=(elevation-vd_dd[Z])/v[Z];vd_dd[X]+=ar1*v[X];vd_dd[Y]+=ar1*v[Y];vd_dd[Z]=elevation;}return vd_dd;};function vd_Hn(){if(!vd_n)return;var doc=vd_n.GetDocument();if(!doc)return;var layout=vd_n.GetActiveLayout();if(!layout)return;if(!layout.GridMode)return;var vd_qA=vd_U.vd_bH;var vd_py=vd_U.vd_H.vd_eo;var vd_nh=new vd_hx();vd_nh.vd_hc(layout.Limits);var vd_EL=0.22;var vd_em=layout.GridSpaceX;var vd_cZ=layout.GridSpaceY;if(vd_em==0.0)vd_em=layout.SnapSpaceX;if(vd_cZ==0.0)vd_cZ=layout.SnapSpaceY;var fr1=0.0;var vd_ep=Math.sin(fr1);var vd_fb=Math.cos(fr1);fr1=vd_U.vd_Z;var fr2=vd_U.width/vd_U.height;var vd_Nv=vd_U.width;var vd_MJ=vd_U.height;var p6=[0,0,1];var p5=[0,0,0];p5[X]=(p6[Z]/Math.sqrt(p6[X]*p6[X]+p6[Y]*p6[Y]+p6[Z]*p6[Z]));while(Math.abs(p5[X])<Math.sin(vdgeo.vd_Ji)||(Math.abs(fr1/(p5[X]*vd_cZ))>(vd_MJ*vd_EL))||(Math.abs(fr1*fr2/(p5[X]*vd_em))>(vd_Nv*vd_EL))){if(Math.abs(vd_em)>(vd_nh.Width/2.0))break;if(Math.abs(vd_cZ)>(vd_nh.Height/2.0))break;vd_em*=2.0;vd_cZ*=2.0;}var p1=[vd_U.vd_B[X],vd_U.vd_B[Y],vd_U.vd_B[Z]];var p2=[0,0,0];p2[X]=p1[X]+0.5*fr1*fr2;p2[Y]=p1[Y]+0.5*fr1;var p3=vd_U.vd_uB(p2);p2[X]=p1[X]-0.5*fr1*fr2;p2[Y]=p1[Y]-0.5*fr1;var p4=vd_U.vd_uB(p2);p2[X]=p1[X]+0.5*fr1*fr2;p2[Y]=p1[Y]-0.5*fr1;p5=vd_U.vd_uB(p2);p2[X]=p1[X]-0.5*fr1*fr2;p2[Y]=p1[Y]+0.5*fr1;p6=vd_U.vd_uB(p2);var vd_cA=[0,0,0];var vd_cP=[0,0,0];vd_cA[X]=Math.max(p4[X],p3[X]);vd_cA[X]=Math.max(vd_cA[X],p5[X]);vd_cA[X]=Math.max(vd_cA[X],p6[X]);vd_cA[Y]=Math.max(p4[Y],p3[Y]);vd_cA[Y]=Math.max(vd_cA[Y],p5[Y]);vd_cA[Y]=Math.max(vd_cA[Y],p6[Y]);vd_cP[X]=Math.min(p4[X],p3[X]);vd_cP[X]=Math.min(vd_cP[X],p5[X]);vd_cP[X]=Math.min(vd_cP[X],p6[X]);vd_cP[Y]=Math.min(p4[Y],p3[Y]);vd_cP[Y]=Math.min(vd_cP[Y],p5[Y]);vd_cP[Y]=Math.min(vd_cP[Y],p6[Y]);vd_cP[Z]=0.0;vd_cA[Z]=0.0;p1[X]=vd_nh.Left;p1[Y]=vd_nh.Bottom;p1[Z]=0.0;p2[X]=vd_nh.Right;p2[Y]=vd_nh.Top;p2[Z]=0.0;if((p1[X]>=vd_cA[X])||(p1[Y]>=vd_cA[Y])||(p2[X]<=vd_cP[X])||(p2[Y]<=vd_cP[Y]))return;if(p1[Y]>vd_cP[Y])vd_cP[Y]=p1[Y];if(p1[X]>vd_cP[X])vd_cP[X]=p1[X];if(p2[Y]<vd_cA[Y])vd_cA[Y]=p2[Y];if(p2[X]<vd_cA[X])vd_cA[X]=p2[X];var vd_bz=[layout.SnapBase[X],layout.SnapBase[Y],layout.SnapBase[Z]];vd_bz[Z]=0.0;p3[X]=(vd_cP[X]-vd_bz[X])*vd_fb+(vd_cP[Y]-vd_bz[Y])*vd_ep;p3[Y]=(vd_bz[X]-vd_cP[X])*vd_ep+(vd_cP[Y]-vd_bz[Y])*vd_fb;p4[X]=(vd_cA[X]-vd_bz[X])*vd_fb+(vd_cA[Y]-vd_bz[Y])*vd_ep;p4[Y]=(vd_bz[X]-vd_cA[X])*vd_ep+(vd_cA[Y]-vd_bz[Y])*vd_fb;p1[X]=Math.min(p3[X],p4[X]);p1[Y]=Math.min(p3[Y],p4[Y]);p2[X]=Math.max(p3[X],p4[X]);p2[Y]=Math.max(p3[Y],p4[Y]);vdgeo.vd_bn(p5,vd_cP);p5[Y]=vd_cA[Y];p3[X]=(p5[X]-vd_bz[X])*vd_fb+(p5[Y]-vd_bz[Y])*vd_ep;p3[Y]=(vd_bz[X]-p5[X])*vd_ep+(p5[Y]-vd_bz[Y])*vd_fb;p1[X]=Math.min(p1[X],p3[X]);p1[Y]=Math.min(p1[Y],p3[Y]);p2[X]=Math.max(p2[X],p3[X]);p2[Y]=Math.max(p2[Y],p3[Y]);vdgeo.vd_bn(p5,vd_cP);p5[X]=vd_cA[X];p3[X]=(p5[X]-vd_bz[X])*vd_fb+(p5[Y]-vd_bz[Y])*vd_ep;p3[Y]=(vd_bz[X]-p5[X])*vd_ep+(p5[Y]-vd_bz[Y])*vd_fb;p1[X]=Math.min(p1[X],p3[X]);p1[Y]=Math.min(p1[Y],p3[Y]);p2[X]=Math.max(p2[X],p3[X]);p2[Y]=Math.max(p2[Y],p3[Y]);var vd_tU=vd_em;fr1=vdgeo.vd_u(p1[X]/vd_tU);p1[X]=fr1*vd_tU;fr1=vdgeo.vd_u(p2[X]/vd_tU);p2[X]=fr1*vd_tU;fr1=vdgeo.vd_u(p1[Y]/vd_cZ);p1[Y]=fr1*vd_cZ;fr1=vdgeo.vd_u(p2[Y]/vd_cZ);p2[Y]=fr1*vd_cZ;p4[Z]=0.0;vdgeo.vd_bn(p3,p1);vd_U.vd_bH=false;vd_U.vd_H.vd_eo=false;if(vd_U.vd_ab())vd_U.vd_aK.vd_xH();var pattern={};pattern.Name="GRID";pattern.PatternLines={Items:[]};var angx=0.0;var angy=90.0;var vd_zy=vd_em;var vd_zz=vd_cZ;var origin=[0,0,0];var offsetX=vdgeo.pointPolar(origin,vdgeo.DegreesToRadians(angy),vd_zz);var offsetY=vdgeo.pointPolar(origin,vdgeo.DegreesToRadians(angx),vd_zy);var rect=new vd_hx();rect.AddPoint(vd_cP);rect.AddPoint(vd_cA);var vd_kK=true;if(layout.GridStyle==vdConst.GridStyle_Cross){vd_kK=false;var vd_Pm=8;vd_lj=vd_U.pixelsize*vd_Pm;rect.vd_MZ(vd_lj);pattern.PatternLines.Items[0]={Angle:vdgeo.DegreesToRadians(angx),Origin:origin,Offset:offsetX,Dashes:{Items:[vd_lj/2,-(vd_zy-vd_lj),vd_lj/2]}};pattern.PatternLines.Items[1]={Angle:vdgeo.DegreesToRadians(angy),Origin:origin,Offset:offsetY,Dashes:{Items:[vd_lj/2,-(vd_zz-vd_lj),vd_lj/2]}};}else if(layout.GridStyle==vdConst.GridStyle_Dot){vd_kK=false;pattern.PatternLines.Items[0]={Angle:vdgeo.DegreesToRadians(angx),Origin:origin,Offset:offsetX,Dashes:{Items:[0,-(vd_zy),0]}};pattern.PatternLines.Items[1]={Angle:vdgeo.DegreesToRadians(angy),Origin:origin,Offset:offsetY,Dashes:{Items:[0,-(vd_zz),0]}};}else{pattern.PatternLines.Items[0]={Angle:vdgeo.DegreesToRadians(angx),Origin:origin,Offset:offsetX,Dashes:{Items:[]}};pattern.PatternLines.Items[1]={Angle:vdgeo.DegreesToRadians(angy),Origin:origin,Offset:offsetY,Dashes:{Items:[]}};}var pts=[[rect.Left,rect.Bottom,0],[rect.Right,rect.Bottom,0],[rect.Right,rect.Top,0],[rect.Left,rect.Top,0],[rect.Left,rect.Bottom,0]];var rgba=doc.GlobalRenderProperties.GridColor;if(!rgba)rgba=vd_dV;rgba=vd_U.vd_xl(rgba);vd_U.vd_eT();var vd_di=vd_U.vd_ao(rgba);vd_U.vd_eN({vd_ac:undefined,color:undefined,vd_ks:0,vd_cw:0,vd_cR:255,angle:0,scale:1,pattern:pattern,origin:[vd_bz[X],vd_bz[Y],0.0],IsDpi:false,vd_pZ:false,vd_ec:0,vd_hX:undefined,gradientAngle:0});vd_U.vd_gR(pts);vd_U.vd_eN(null);if(vd_kK)vd_U.vd_cd(pts);vd_U.vd_ao(vd_di);vd_U.vd_nd();vd_U.vd_bH=vd_qA;vd_U.vd_H.vd_eo=vd_py;if(vd_U.vd_ab())vd_U.vd_aK.vd_xH();vd_U.vd_eT();};this.clear=function(vd_IZ){vd_U.vd_H.clear(vd_cq);vd_U.vd_dk=[];vd_U.vd_bb=undefined;vd_mk=null;if(vd_U.vd_ab())vd_U.vd_aK.vd_Kd();if(!vd_IZ)vd_Hn();};function vd_cj(vd_hM,vd_hW){if(!vd_eU())return;if(!vd_Bz()){vd_zx(vd_hM,vd_hW,0.0,true);return;}if(vd_U.vd_ab()){vd_U.vd_aK.vd_cW(vd_hM,vd_hW);return;}vd_kM(vd_hM,__P1);vd_kM(vd_hW,__P2);var ret=vd_gA(__P1,__P2,vd_dn,vd_ch);if(ret===1)return;vd_jh(vd_dn[X],vd_dn[Y],vd_ch[X],vd_ch[Y],vd_dn[Z],vd_ch[Z]);};this.vd_cW=function(vd_hM,vd_hW){if(vd_U.vd_bb===undefined)vd_U.vd_bb=0;vd_cj(vd_hM,vd_hW);};this.vd_er=function(pts,vd_aV,uvs,vd_fu){if(!vd_eU())return;if(vd_U.vd_ab()){vd_U.vd_aK.vd_er(pts,vd_aV,uvs,vd_fu);return;}if(!vd_U.vd_Hf(vd_aV))return;var npts=vd_Rd(pts);vd_eG(npts,uvs,vd_fu);vd_FJ();};this.vd_Ez=function(vd_yS,direction,vd_CS){if(!vd_eU())return;var v=vdgeo.newpoint(0,0,0);vdgeo.vd_lv(vd_U.vd_bE(),direction[X],direction[Y],direction[Z],v,true);if(vdgeo.AreEqual(v[X],0.0,vdgeo.DefaultLinearEquality)&&vdgeo.AreEqual(v[Y],0.0,vdgeo.DefaultLinearEquality)){vd_U.vd_hT(vd_yS);return;}else{var pt1,pt2;var pt=vdgeo.matrixtransform(vd_U.vd_bE(),vd_yS);var vd_hP=(vdgeo.Distance2D(pt,vd_U.vd_B)+Math.sqrt(vd_U.vd_Z*vd_U.vd_Z+vd_U.vd_xM()*vd_U.vd_xM()))*2.0;if(!vd_CS){pt1=vdgeo.newpoint(pt[X]+v[X]* -vd_hP,pt[Y]+v[Y]* -vd_hP,pt[Z]+v[Z]* -vd_hP);pt2=vdgeo.newpoint(pt[X]+v[X]*vd_hP,pt[Y]+v[Y]*vd_hP,pt[Z]+v[Z]*vd_hP);}else{pt1=pt;pt2=vdgeo.newpoint(pt[X]+v[X]*vd_hP,pt[Y]+v[Y]*vd_hP,pt[Z]+v[Z]*vd_hP);}if(vd_U.vd_bH){if(!vd_U.vd_HJ(pt1,pt2,vd_dn,vd_ch))return;var vd_fn=vdgeo.vd_aR(vd_U.vd_bE());vdgeo.vd_cB(vd_fn,vd_dn,pt1);vdgeo.vd_cB(vd_fn,vd_ch,pt2);vd_cj(pt1,pt2);}else{vdgeo.vd_cB(vd_U.vd_dm,pt1,__P1);vdgeo.vd_cB(vd_U.vd_dm,pt2,__P2);var ret=vd_gA(__P1,__P2,vd_dn,vd_ch);if(ret===1)return;vd_jh(vd_dn[X],vd_dn[Y],vd_ch[X],vd_ch[Y],vd_dn[Z],vd_ch[Z]);}}};function vd_Hy(pts,closed){var sp=pts[0];for(var i=1;i<pts.length;i++){var ep=pts[i];vd_cj(sp,ep);sp=ep;}if(closed)vd_cj(sp,pts[0]);};this.vd_cd=function(pts,closed){if(!vd_eU())return;if(pts.length<2)return;if(!vd_Bz()){vd_MN(pts,closed,0.0);return;}var sp=pts[0];for(var i=1;i<pts.length;i++){var ep=pts[i];if(sp[INDEX]!==undefined)vd_U.vd_bb=sp[INDEX];if(vd_U.vd_bb===undefined)vd_U.vd_bb=i-1;vd_cj(sp,ep);sp=ep;}if(closed){if(pts[pts.length-1][INDEX]!==undefined)vd_U.vd_bb=pts[pts.length-1][INDEX];if(vd_U.vd_bb===undefined)vd_U.vd_bb=pts.length-1;vd_cj(pts[pts.length-1],pts[0]);}vd_U.vd_bb=undefined;};this.vd_yg=function(p1,p2,p3,p4,vd_gf,vd_ez,vd_fE,vd_hH,vd_aV,uv1,uv2,uv3,uv4){if(vd_U.vd_bb===undefined)vd_U.vd_bb=0;vd_kw(p1,p2,p3,p4,vd_gf,vd_ez,vd_fE,vd_hH,vd_aV,uv1,uv2,uv3,uv4);};this.vd_hd=function(p1,p2,p3,p4,vd_gf,vd_ez,vd_fE,vd_hH,vd_aV,uv1,uv2,uv3,uv4){if(vd_U.vd_bb===undefined)vd_U.vd_bb=0;vd_gJ(p1,p2,p3,p4,vd_gf,vd_ez,vd_fE,vd_hH,vd_aV,uv1,uv2,uv3,uv4);};function vd_uF(x,y,z){var p1=vdgeo.vd_gk(vd_U.vd_bE(),0,0,0);p1=vdgeo.vd_do(p1,vd_U.vd_gT);var p2=vdgeo.vd_gk(vd_U.vd_bE(),x,y,z);p2=vdgeo.vd_do(p2,vd_U.vd_gT);return vdgeo.Distance2D(p1,p2)*vd_U.vd_Z;};this.vd_EG=function(x,y,z){return vd_uF(x,y,z)/vd_U.pixelsize;};function vd_FP(x,y,z){var v=vdgeo.newpoint(0,0,0);vdgeo.vd_lv(vd_U.vd_bE(),x,y,z,v,false);return vdgeo.vd_im(v);};function vd_Ix(shape,offsetX,offsetY,vd_Hk,vd_dO){var jj;var p1=vdgeo.newpoint(0,0,0);var p2=vdgeo.newpoint(0,0,0);if(shape==null){if(vd_dO==null)return;var w=vd_dO.Ascent*0.5;var lw=w*0.25;vd_Hy([vdgeo.newpoint(offsetX+lw,offsetY,0),vdgeo.newpoint(offsetX+w-lw,offsetY,0),vdgeo.newpoint(offsetX+w-lw,offsetY+vd_dO.Ascent,0),vdgeo.newpoint(offsetX+lw,offsetY+vd_dO.Ascent,0)],true);}else{var vd_tL=[];var vd_qc=null;var vd_oy=vd_PD();if(vd_U.vd_gN)vd_qc=[];if(shape.Segments!==undefined){for(var k=0;k<shape.Segments.Items.length;k++){var vd_Lc=(shape.Segments.Items[k].Flag===1);var pts=shape.Segments.Items[k].Points.Items;if(vd_Lc){if(shape.Segments.Items[k].vd_AY==undefined)shape.Segments.Items[k].vd_AY=vdgeo.vd_Oj(8,pts);pts=shape.Segments.Items[k].vd_AY;}if(vd_U.vd_ab()){p1[X]=pts[0][X]+offsetX;p1[Y]=pts[0][Y]+offsetY;p1[Z]=0.0;for(jj=1;jj<pts.length;jj++){vdgeo.vd_bn(p2,pts[jj]);p2[X]=pts[jj][X]+offsetX;p2[Y]=pts[jj][Y]+offsetY;p2[Z]=0.0;vd_U.vd_aK.vd_cW(p1,p2);p1[X]=p2[X];p1[Y]=p2[Y];p1[Z]=p2[Z];}}else{var _pts=[];if(vd_qc)vd_qc.push(pts);for(var j=0;j<pts.length;j++){vd_li(pts[j][X]+offsetX,pts[j][Y]+offsetY,0,__P2);var npt=vdgeo.newpoint(__P2[X],__P2[Y],__P2[Z]);npt[W]=__P2[W];_pts.push(npt);}vd_tL.push(_pts);}}if(vd_U.vd_ab())return;}if(vd_Hk&& !vd_U.vd_ak){vd_mM(vd_tL,vd_qc,vd_oy);}else{for(var kk=0;kk<vd_tL.length;kk++){var pts2=vd_tL[kk];vdgeo.vd_bn(p1,pts2[0]);for(jj=1;jj<pts2.length;jj++){vdgeo.vd_bn(p2,pts2[jj]);var vd_vu=vd_gA(p1,p2,vd_dn,vd_ch);if(vd_vu!==1){vd_jh(vd_dn[X],vd_dn[Y],vd_ch[X],vd_ch[Y],vd_dn[Z],vd_ch[Z]);}vdgeo.vd_bn(p1,pts2[jj]);}}}}};function vd_NX(vd_jm,vd_mP,vd_dO){var p1=[0,0,0];var p2=[vd_jm,0,0];vd_kM(p1,__P1);vd_kM(p2,__P2);var ret=vd_gA(__P1,__P2,vd_dn,vd_ch);return ret!==1;};this.vd_tT=function(vd_bk,vd_jm,vd_mP,vd_dO){if(!vd_bk)return;if(!vd_eU())return;if(!vd_U.vd_Hf(null))return;if(vd_fS){vd_U.vd_cd([[0,0,0],[vd_jm,0,0],[vd_jm,vd_mP,0],[0,vd_mP,0]],true);return;}vd_U.vd_bb=0;if(vd_NX(vd_jm,vd_mP,vd_dO)){var c,pos;var vd_qW=vd_uF(0,vd_mP,0);var vd_nN=vd_qW/(dpi*vd_U.pixelsize);if(vd_U.vd_ab()&&vd_U.vd_aK.vd_Dc&&vd_U.vd_aK.vd_Dc())vd_nN=vd_rn+1;if(vd_nN<vd_rn){var p0=vdgeo.newpoint(0,0,0);var p1=vdgeo.newpoint(vd_jm,0,0);var sw=vd_U.vd_bf(vd_nN*dpi);vd_cj(p0,p1);vd_U.vd_bf(sw);}else{vd_bk=vdConst.vd_Jn(vd_bk);var offsetX=0;var offsetY=0;for(var cc=0;cc<vd_bk.length;cc++){c=cc;pos=vd_bk.charCodeAt(c);if(pos===10||pos===13)continue;var vd_gS=vd_dO.Shapes['h_'+pos.toString()];var shape=null;if(vd_gS!==undefined)shape=vd_dO.Shapes.Items[vd_gS];if(pos!=32){vd_Ix(shape,offsetX,offsetY,vd_dO.FontType,vd_dO);}if(shape!=null){offsetX+=shape.AdvanceX;offsetY+=shape.AdvanceY;}else{offsetX+=vd_dO.Ascent*0.5;}}}}vd_FJ();vd_U.vd_bb=undefined;};this.vd_pW=function(vd_j,vd_vC,vd_zV,vd_sL){if(vd_U.vd_H.vd_iH==vdConst.InterpolationMode_Nearest&& !vd_U.vd_bH&& !vd_fS&& !vd_U.vd_ab()){vd_U.vd_H.vd_pW(vd_j,vd_vC,vd_U.vd_dZ(),vd_sL/vd_j.height);}else{var pts=[vdgeo.newpoint(0,0,0),vdgeo.newpoint(vd_zV,0,0),vdgeo.newpoint(vd_zV,vd_sL,0),vdgeo.newpoint(0,vd_sL,0)];var vd_aV=vdgeo.newpoint(0,0,1);var uvs=[vdgeo.newpoint(0,0,0),vdgeo.newpoint(1,0,0),vdgeo.newpoint(1,1,0),vdgeo.newpoint(0,1,0)];var vd_eC=vd_U.vd_gb(vdgeo.vd_Ib(0,0,vd_zV,vd_sL));vd_U.vd_et(pts,vd_aV,uvs,vd_j,true);vd_U.vd_gb(vd_eC);}};this.vd_hT=function(pt){if(!vd_eU())return;if(vd_U.vd_ab()){vd_U.vd_aK.vd_hT(pt);return;}vd_kM(pt,__P1);if(vdgeo.vd_nc(__P1[X],__P1[Y],vd_U.clip[0],vd_U.clip[1],vd_U.clip[2],vd_U.clip[3]))vd_U.vd_H.vd_xJ(__P1[X],__P1[Y],__P1[Z]);};this.vd_tF=function(pts,vd_jA,vd_fQ,vd_tf){if(!vd_eU())return;if(vd_U.vd_ab()){vd_U.vd_aK.vd_tF(pts,vd_jA,vd_fQ,vd_tf);return;}var rgbm;var pt;var vd_wA=vd_U.vd_H.vd_at;for(var i=0;i<pts.length;i++){vd_U.vd_bb=i;pt=pts[i];vd_kM(pt,__P1);if(vdgeo.vd_nc(__P1[X],__P1[Y],vd_U.clip[0],vd_U.clip[1],vd_U.clip[2],vd_U.clip[3])){if(vd_jA){rgbm=vd_jA[i];vd_U.vd_H.vd_at=[((rgbm>>16)&0xFF),((rgbm>>8)&0xFF),(rgbm&0xFF)];}vd_U.vd_H.vd_Oi(__P1[X],__P1[Y],__P1[Z],vd_fQ);}}vd_U.vd_bb=undefined;vd_U.vd_H.vd_at=vd_wA;};var vd_cM=vdgeo.newpoint(0,0,0);var vd_cC=vdgeo.newpoint(0,0,0);var _tm=vdgeo.vd_e();var vd_Fk=[vdgeo.newpoint(0,0,0),vdgeo.newpoint(0,0,0),vdgeo.newpoint(0,0,0),vdgeo.newpoint(0,0,0)];this.vd_gD=function(pts,thickness,closed){if(!vd_eU())return;if(pts.length<2)return;if(thickness==0.0||thickness==undefined){vd_U.vd_cd(pts,closed);return;}if(vd_U.RenderMode==vdConst.vd_xd){var zdir=vdgeo.vd_ha(vd_U.vd_bE());if(zdir[X]==0.0&&zdir[Y]==0.0&&zdir[Z]==1.0){vd_U.vd_cd(pts,closed);return;}}var offset=0;var normal=vdgeo.newpoint(0,0,0);var ang,vd_QJ,npts;npts=pts;var uvs=null;for(var i=0;i<npts.length-1;i++){vd_cM[X]=npts[i][X];vd_cM[Y]=npts[i][Y];vd_cM[Z]=npts[i][Z]+thickness;vd_cC[X]=npts[i+1][X];vd_cC[Y]=npts[i+1][Y];vd_cC[Z]=npts[i+1][Z]+thickness;ang=vdgeo.GetAngle(npts[i],npts[i+1])+vdgeo.HALF_PI;normal[X]=Math.cos(ang);normal[Y]=Math.sin(ang);normal[Z]=0;var dist=vdgeo.Distance3D(npts[i],npts[i+1]);if(vd_U.vd_gN){uvs=vdgeo.vd_fN(vd_U.vd_gN,[vdgeo.newpoint(-offset,0,0),vdgeo.newpoint(-(offset+dist),0,0),vdgeo.newpoint(-(offset+dist),thickness,0),vdgeo.newpoint(-offset,thickness,0)]);}else{uvs=vd_Fk;}vd_U.vd_bb=npts[i][INDEX];if(vd_U.vd_bb===undefined)vd_U.vd_bb=i;vd_gJ(npts[i],npts[i+1],vd_cC,vd_cM,true,(i===0|| !closed&&i===npts.length-2),true,true,normal,uvs[0],uvs[1],uvs[2],uvs[3]);offset+=dist;}if(closed){var vd_fc=npts.length-1;vd_cM[X]=npts[vd_fc][X];vd_cM[Y]=npts[vd_fc][Y];vd_cM[Z]=npts[vd_fc][Z]+thickness;vd_cC[X]=npts[0][X];vd_cC[Y]=npts[0][Y];vd_cC[Z]=npts[0][Z]+thickness;ang=vdgeo.GetAngle(npts[vd_fc],npts[0])+vdgeo.HALF_PI;normal[X]=Math.cos(ang);normal[Y]=Math.sin(ang);normal[Z]=0;if(vd_U.vd_gN){uvs=vdgeo.vd_fN(vd_U.vd_gN,[vdgeo.newpoint(-offset,0,0),vdgeo.newpoint(-(offset+dist),0,0),vdgeo.newpoint(-(offset+dist),thickness,0),vdgeo.newpoint(-offset,thickness,0)]);}else{uvs=vd_Fk;}vd_U.vd_bb=npts[vd_fc][INDEX];if(vd_U.vd_bb===undefined)vd_U.vd_bb=vd_fc;vd_gJ(npts[vd_fc],npts[0],vd_cC,vd_cM,true,false,true,true,normal,uvs[0],uvs[1],uvs[2],uvs[3]);}vd_U.vd_bb=undefined;};function vd_MV(pts){var vd_T=pts[0][Y];var vd_N=pts[0][Y];for(var i=0;i<pts.length;i++){var tmp=pts[i];if(tmp[Y]<vd_T)vd_T=tmp[Y];if(tmp[Y]>vd_N)vd_N=tmp[Y];}return[vd_T,vd_N];};function vd_PG(pts,dy){var points=[];var _dy=0.0,_dx=0.0,_dya=0.0;var p1,p2,tmp=null;p1=pts[0];for(var i=1;i<pts.length;i++){p2=pts[i];_dya=p2[Y]-p1[Y];if(_dya==0.0||(dy>p1[Y]&&dy>p2[Y])||(dy<p1[Y]&&dy<p2[Y])){p1=p2;continue;}if(vdgeo.AreEqual(dy,p1[Y],vdgeo.DefaultPointEquality)){tmp=vdgeo.newpoint(p1[X],p1[Y],p1[Z]);points.push(tmp);p1=p2;continue;}_dy=dy-p1[Y];_dx=_dy*(p2[X]-p1[X])/_dya;tmp=vdgeo.newpoint(p1[X]+_dx,p1[Y]+_dy,p1[Z]);points.push(tmp);p1=p2;}return points;};function vd_Qb(vd_dG,_p1,_p2,vd_tE,scale){if(vd_dG.Dashes==undefined||(vd_dG.Dashes.Items.length===1&&vd_dG.Dashes.Items[0]<0.0)){vd_cj(_p1,_p2);return;}if(vd_dG.segmentlength==undefined){vd_dG.segmentlength=0;for(var i=0;i<vd_dG.Dashes.Items.length;i++){vd_dG.segmentlength+=Math.abs(vd_dG.Dashes.Items[i]*scale);}}var vd_cF=vd_dG.segmentlength;var vd_aT;var vd_qW=vd_uF(vd_cF,0,0);if(vd_cF===0||vd_qW<vd_U.pixelsize*2.0){vd_cj(_p1,_p2);return;}vdgeo.vd_bn(vd_hn,_p1);vd_aT=vd_tE;if(vd_aT<_p1[X])vd_aT=_p1[X]-((_p1[X]-vd_aT)%vd_cF);if(vd_aT>_p1[X])vd_aT=_p1[X]+((vd_aT-_p1[X])%vd_cF)-vd_cF;while(vd_aT<_p2[X]){for(var ii=0;ii<vd_dG.Dashes.Items.length;ii++){var dash=vd_dG.Dashes.Items[ii]*scale;vd_aT+=Math.abs(dash);if(vd_aT<_p1[X])continue;if(vd_aT>_p2[X])vd_aT=_p2[X];if(dash>0){vdgeo.vd_jU(vd_ci,vd_aT,_p1[Y],_p1[Z]);vd_cj(vd_hn,vd_ci);vdgeo.vd_bn(vd_hn,vd_ci);}else if(dash===0){vdgeo.vd_jU(vd_ci,vd_aT,_p1[Y],_p1[Z]);vd_U.vd_hT(vd_ci);}else{vdgeo.vd_jU(vd_hn,vd_aT,_p1[Y],_p1[Z]);}if(vd_aT>=_p2[X])break;}}};function vd_PA(pts,vd_dG){var vd_rZ=vd_V.IsDpi===false?vd_V.scale:vd_U.pixelsize*vd_Of*dpi*vd_U.vd_jW;var vd_eg=vd_AS(vd_dG,vd_rZ,vd_V.angle,vd_V.IsDpi);var origin=vd_eg[0];var vd_aH=vd_eg[1];var angle=vd_eg[2];if(vdgeo.AreEqual(vd_aH[Y],0.0,vdgeo.DefaultLinearEquality))return;var vd_pl=vdgeo.vd_e();var vd_Dx;var vd_gj=0.0;var l=0;var vd_dx;var points;vdgeo.vd_x(vd_pl,-vd_V.origin[X],-vd_V.origin[Y],-vd_V.origin[Z]);vdgeo.vd_x(vd_pl,-origin[X],-origin[Y],0.0);vdgeo.vd_bw(vd_pl,-angle);vd_dx=vdgeo.vd_fN(vd_pl,pts);vd_dx.push(vd_dx[0]);var vd_ig=vd_MV(vd_dx);if(vd_aH[Y]>0){vd_gj=vd_ig[X]-(vd_ig[X]%vd_aH[Y])-vd_aH[Y];while(vd_gj>vd_ig[X]){vd_gj-=vd_aH[Y];}}else{vd_gj=vd_ig[Y]-(vd_ig[Y]%vd_aH[Y])-vd_aH[Y];while(vd_gj<vd_ig[Y]){vd_gj-=vd_aH[Y];}}var t=vd_gj/vd_aH[Y];if(t<0.0)t-=0.5;else t+=0.5;l=vdgeo.vd_u(t);vd_Dx=vdgeo.vd_aR(vd_pl);vd_U.vd_bh(vd_Dx);while((vd_aH[Y]>0)?(vd_gj<=vd_ig[Y]):(vd_gj>=vd_ig[X])){points=vd_PG(vd_dx,vd_gj);if((points.length%2)===1)points.pop();points.sort(function(a,b){return a[X]-b[X]});for(var pos=0;pos<points.length-1;pos+=2){vd_Qb(vd_dG,points[pos],points[pos+1],vd_aH[X]*l,vd_rZ);}vd_gj+=vd_aH[Y];l++;}vd_U.vd_bC();};function vd_Ql(pts,PatternLines){var vd_Pd=vd_U.linetype;vd_U.linetype=null;for(var i=0;i<PatternLines.Items.length;i++){vd_PA(pts,PatternLines.Items[i]);}vd_U.linetype=vd_Pd;};var vd_V={vd_ac:undefined,color:undefined,vd_ks:0,vd_cw:0,vd_cR:255,angle:0,scale:1,pattern:null,origin:vdgeo.newpoint(0,0,0),IsDpi:false,vd_pZ:false,vd_ec:0,vd_hX:undefined,gradientAngle:0};function vd_Aa(pts){if(pts==null){vd_U.vd_H.vd_BY(0,undefined,null);return;}if(vd_V==null||vd_V==undefined||vd_V.vd_ec===0)return;var gcol=vd_V.vd_hX;if(gcol==undefined)gcol=vd_cq;var vd_be=vdgeo.vd_me(pts);var w=vd_be[3]-vd_be[0];var h=vd_be[4]-vd_be[1];var s=(w+h)/2.0;var matrix=vdgeo.vd_aR(vd_U.vd_dZ());if(vd_V.vd_ec===1||vd_V.vd_ec===3)s=w;vdgeo.vd_x(matrix,-(vd_be[0]+vd_be[3])/2,-(vd_be[1]+vd_be[4])/2,vd_be[2]);vdgeo.vd_bw(matrix,-vd_V.gradientAngle);vdgeo.vd_aj(matrix,1/s,1/s,1);vd_U.vd_H.vd_BY(vd_V.vd_ec,gcol,matrix);};this.vd_eN=function(vd_bX){vd_V=vd_bX;if(vd_V)vd_U.vd_bb= -1;else vd_U.vd_bb=undefined;};var vd_Of=0.0833;var vd_OT=0.0197;function vd_AS(vd_dG,vd_nm,vd_Gy,vd_JY){var m=vdgeo.vd_e();vdgeo.vd_aj(m,vd_nm,vd_nm,1);vdgeo.vd_bw(m,vd_Gy);var origin=vdgeo.matrixtransform(m,vd_dG.Origin);var vd_aH=vdgeo.newpoint(vd_dG.Offset[X],vd_dG.Offset[Y],vd_dG.Offset[Z]);if(vd_JY===true){vd_aH[X]=vd_aH[X]==0.0?0:Math.abs(vd_aH[X])/vd_aH[X];vd_aH[Y]=vd_aH[Y]==0.0?0:Math.abs(vd_aH[Y])/vd_aH[Y];}vd_aH=vdgeo.matrixtransform(m,vd_aH);var angle=vd_dG.Angle+vd_Gy;var vd_FN=vdgeo.vd_e();vdgeo.vd_bw(vd_FN,-angle);vd_aH=vdgeo.matrixtransform(vd_FN,vd_aH);return[origin,vd_aH,angle];};this.vd_gR=function(pts,vd_aV,uvs){if(vd_fS){vd_U.vd_er(pts);return;}var vd_fX=undefined;if(vd_V!=null&&vd_V!==undefined&&vd_V.pattern!=null){var vd_xF=false;if(vd_V.IsDpi===false){if(vd_V.vd_pZ===true){vd_xF=true;}else{var vd_rZ=vd_V.scale;for(var i=0;i<vd_V.pattern.PatternLines.Items.length;i++){var vd_dG=vd_V.pattern.PatternLines.Items[i];var vd_eg=vd_AS(vd_dG,vd_rZ,vd_V.angle,vd_V.IsDpi);var vd_qW=vd_uF(0,vd_eg[1][Y],0);var vd_nN=vd_qW/(dpi*vd_U.pixelsize);if(vd_nN<vd_OT){vd_xF=true;break;}}}}if(vd_V.vd_cw==2)vd_fX=vd_U.vd_ao(vd_U.vd_iN());else if(vd_V.vd_cw==3)vd_fX=vd_U.vd_ao(vd_U.vd_kD());else if(vd_V.vd_cw==1)vd_fX=vd_U.vd_ao();else vd_fX=vd_U.vd_ao(vd_V.color);if(!vd_xF){if(vd_V.vd_ac!==undefined){if(vd_V.vd_ks==2)vd_ry=vd_U.vd_ao(vd_U.vd_iN());else if(vd_V.vd_ks==3)vd_ry=vd_U.vd_ao(vd_U.vd_kD());else if(vd_V.vd_ks==1)vd_ry=vd_U.vd_ao();else vd_ry=vd_U.vd_ao(vd_V.vd_ac);vd_U.vd_er(pts);vd_U.vd_ao(vd_ry);}vd_Ql(pts,vd_V.pattern.PatternLines);vd_U.vd_ao(vd_fX);return;}}var alpha=vd_U.vd_H.vd_mQ(Math.min(vd_V.vd_cR,vd_U.vd_H.Alpha));vd_Aa(pts);vd_U.vd_et(pts,vd_aV,uvs,vd_U.vd_H.vd_gt);vd_Aa(null);vd_U.vd_H.vd_mQ(alpha);vd_U.vd_ao(vd_fX);};this.vd_vL=false;this.vd_et=function(pts,vd_aV,uvs,vd_cO,vd_Lo){if(!vd_eU())return;if(vd_fS){if(!vd_cO|| !vd_cO.isNoteIcon){vd_U.vd_er(pts,vd_aV,uvs);return;}}var vd_Qa=vd_U.vd_fl;vd_U.vd_fl=true;var vd_Qx=vd_eG;var vd_QN=vd_U.vd_H.vd_MP();var vd_HC=vd_U.vd_go(vd_cO);if(vd_U.vd_H.vd_gt&&vd_eG==vd_xY)vd_eG=vd_lA;vd_U.vd_H.vd_At= !vd_Lo;vd_U.vd_vL=true;vd_U.vd_er(pts,vd_aV,uvs);vd_U.vd_vL=false;vd_U.vd_H.vd_At=true;vd_U.vd_H.vd_Od(vd_QN);vd_eG=vd_Qx;vd_U.vd_go(vd_HC);vd_U.vd_fl=vd_Qa;};this.vd_gw=false;this.vd_EI=function(FaceList,VertexList,vd_Gf,uvs,vd_dN,DrawEdges){var i,ii=0,i0,i1,i2,i3;var vd_co=0;var p0,p1,p2,p3;var col= -1,vd_hQ= -1;var vd_dY,vd_bu;var length=FaceList.length;var vd_Dv=vd_U.vd_ao(undefined);var vd_cO=vd_U.vd_H.vd_gt;vd_U.vd_gw=vd_dN!=null;var vd_Rw=vd_gJ;var vd_Sj=vd_eG;if(vd_U.vd_gw){vd_gJ=vd_kw;if(vd_eG==vd_xY)vd_eG=vd_lA;}for(i=0;i<length;i=i+5){vd_dY=i/5;vd_bu=4*vd_dY;vd_co=0;ii=FaceList[i];if(ii<0)vd_co+=1;ii=Math.abs(ii);i0=ii;p0=VertexList[ii-1];ii=FaceList[i+1];if(ii<0)vd_co+=2;ii=Math.abs(ii);i1=ii;p1=VertexList[ii-1];ii=FaceList[i+2];if(ii<0)vd_co+=4;ii=Math.abs(ii);i2=ii;p2=VertexList[ii-1];ii=FaceList[i+3];if(ii<0)vd_co+=8;ii=Math.abs(ii);i3=ii;p3=VertexList[ii-1];if(!DrawEdges||vd_gJ!=vd_sa)col=FaceList[i+4];if(ShowHidenEdges)vd_co=0;if(vd_hQ!=col){vd_hQ=col;if(vd_hQ=== -1){vd_U.vd_ao(vd_Dv);vd_U.vd_go(vd_cO);}else{var pcol=vd_U.palette.Items[vd_hQ];vd_U.vd_ao(pcol.SystemColor);vd_U.vd_go(pcol.MaterialImageRef);}}vd_mk=vd_dY;if((i3===i2||i3===i0))p3=null;vd_gJ(p0,p1,p2,p3,((vd_co&1)===0),((vd_co&2)===0),((vd_co&4)===0),((vd_co&8)===0),vd_Gf[vd_dY],uvs[vd_bu],uvs[vd_bu+1],uvs[vd_bu+2],uvs[vd_bu+3]);}vd_U.vd_gw=false;vd_gJ=vd_Rw;vd_eG=vd_Sj;vd_mk=null;vd_U.vd_ao(vd_Dv);vd_U.vd_go(vd_cO);if(DrawEdges&&vd_gJ!=vd_sa){var vd_AE=vd_U.vd_bf();vd_U.vd_bf(Math.max(vd_AE,2));for(i=0;i<length;i=i+5){vd_dY=i/5;vd_bu=4*vd_dY;vd_co=0;ii=FaceList[i];if(ii<0)vd_co+=1;ii=Math.abs(ii);i0=ii;p0=VertexList[ii-1];ii=FaceList[i+1];if(ii<0)vd_co+=2;ii=Math.abs(ii);i1=ii;p1=VertexList[ii-1];ii=FaceList[i+2];if(ii<0)vd_co+=4;ii=Math.abs(ii);i2=ii;p2=VertexList[ii-1];ii=FaceList[i+3];if(ii<0)vd_co+=8;ii=Math.abs(ii);i3=ii;p3=VertexList[ii-1];if(ShowHidenEdges)vd_co=0;vd_mk=vd_dY;if((i3===i2||i3===i0))p3=null;vd_sa(p0,p1,p2,p3,((vd_co&1)===0),((vd_co&2)===0),((vd_co&4)===0),((vd_co&8)===0),vd_Gf[vd_dY],uvs[vd_bu],uvs[vd_bu+1],uvs[vd_bu+2],uvs[vd_bu+3]);}vd_U.vd_bf(vd_AE);}};function vd_RD(){var vd_is=document.createElement("div");vd_is.style.height="25.4mm";vd_is.style.width="25.4mm";vd_is.style.visibility="hidden";document.body.appendChild(vd_is);var xres=vd_is.offsetWidth;var yres=vd_is.offsetHeight;vd_is.parentNode.removeChild(vd_is);return yres;};var dpi=96.0;var vd_DQ=0.2;var vd_Qk=0.0625;var vd_rn=0.033;var vd_sn=false;function vd_zs(sp,ep){var vd_Mx=vd_sn;vd_sn=true;vd_cj(sp,ep);vd_sn=vd_Mx;};function vd_Bz(){if(vd_fS)return true;return(vd_U.linetype==null||vd_sn==true||vd_U.linetype.Segments==undefined||vd_U.linetype.Segments.Items.length===0||(vd_U.linetype.IsDPIScale!==true&&vd_yH()*vd_U.vd_mp<(vd_U.pixelsize*dpi*vd_Qk*vd_U.vd_jW)));};function vd_yH(){if(vd_U.linetype.OverAllLength!==undefined)return vd_U.linetype.OverAllLength;vd_U.linetype.OverAllLength=0.0;for(var i=0;i<vd_U.linetype.Segments.Items.length;i++){vd_U.linetype.OverAllLength+=Math.abs(vd_U.linetype.Segments.Items[i].DashLen);}return vd_U.linetype.OverAllLength;};function vd_Ok(){if(vd_U.linetype.vd_kQ!==undefined)return vd_U.linetype.vd_kQ;if(vd_U.linetype==null||vd_U.linetype.Segments.Items.length==0){vd_U.linetype.vd_kQ=false;return vd_U.linetype.vd_kQ;}for(var i=0;i<vd_U.linetype.Segments.Items.length;i++){var vd_Y=vd_U.linetype.Segments.Items[i];if(vd_Y.Flag!=0||vd_Y.DashLen>0.0){vd_U.linetype.vd_kQ=false;return vd_U.linetype.vd_kQ;}}vd_U.linetype.vd_kQ=true;return vd_U.linetype.vd_kQ;};function vd_zx(p1,p2,vd_tE,vd_xk){vdgeo.vd_cB(vd_U.vd_bE(),p1,__P1);vdgeo.vd_cB(vd_U.vd_bE(),p2,__P2);if(vdgeo.AreEqual(vdgeo.Distance2D(__P1,__P2),0.0,vdgeo.DefaultLinearEquality)|| !vd_U.vd_HJ(__P1,__P2,vd_dn,vd_ch))return 0.0;var invisible=vd_Ok();var vd_yA=0.0;var scale=vd_U.vd_mp;if(vd_U.linetype.IsDPIScale===true)scale=vd_U.pixelsize*dpi*vd_DQ*vd_U.vd_jW;scale/=(vd_Aj*vd_U.vd_jW);var vd_GQ=vd_U.pixelsize/vd_Aj;var vd_cF=vd_yH()*scale;var length=vdgeo.Distance3D(p1,p2);vdgeo.vd_bn(vd_hn,p1);vdgeo.vd_bn(vd_ci,p1);var vd_aT=0.0;var dash=0.0;vd_aT-=vd_tE;var angle=vdgeo.GetAngle(p1,p2);var vdir=vdgeo.VectorDirection(p1,p2);if(!invisible&&vd_xk&&vd_aT==0&&vd_U.linetype.DrawMethod!=vdConst.LineTypeDrawMethod_Start){var vd_qX=length/vd_cF;var vd_wY=(Math.abs(vd_U.linetype.Segments.Items[0].DashLen)*scale+Math.abs(vd_qX-Math.floor(vd_qX))*vd_cF)/2.0;var dx=vd_wY-Math.abs(vd_U.linetype.Segments.Items[0].DashLen)*scale;vd_aT=dx;vd_yA=((length-vd_aT)%vd_cF);}else{vd_yA=((length+vd_tE)%vd_cF);}var vd_Ch=vd_aT;var start=0;while(vd_aT<length){if(!invisible&&vd_U.linetype.DrawMethod!=vdConst.LineTypeDrawMethod_Start&&vd_xk&&(length-vd_aT)<vd_cF){vd_aT=length;vdgeo.vd_rc(vd_ci,p1,vdir,vd_aT);vd_zs(vd_hn,vd_ci);vdgeo.vd_bn(vd_hn,vd_ci);break;}for(var i=0;i<vd_U.linetype.Segments.Items.length;i++){var vd_Y=vd_U.linetype.Segments.Items[i];dash=vd_Y.DashLen*scale;vd_aT+=Math.abs(dash);if(vd_aT<0.0)continue;if(vd_aT<start)continue;vd_Ch=vd_aT;if(vd_aT>length)vd_aT=length;if(vd_Y.vd_pd&&vd_Y.vd_cX){var vd_ib=vdgeo.vd_e();var vd_tp=vd_Y.ShapeScale;vd_tp*=(1.0/(vd_Y.ShapeStyleRef.FontFileVDS.Ascent));vdgeo.vd_x(vd_ib,-vd_Y.vd_cX[0],0,0);vdgeo.vd_aj(vd_ib,vd_tp,vd_tp,1.0);vdgeo.vd_bw(vd_ib,vd_Y.ShapeRotation);vdgeo.vd_x(vd_ib,vd_Y.ShapeOffsetX,vd_Y.ShapeOffsetY,0.0);vdgeo.vd_LI(vd_ib,vdgeo.newpoint(0,0,1),vdir);vdgeo.vd_aj(vd_ib,scale,scale,1.0);vdgeo.vd_rc(vd_ci,p1,vdir,vd_aT);vdgeo.vd_x(vd_ib,vd_ci[X],vd_ci[Y],vd_ci[Z]);var d2=vd_Ch+vd_Y.ShapeOffsetX*scale+(vd_xk?((vd_Y.vd_cX[1]-vd_Y.vd_cX[0])*vd_tp):0.0);if(d2<=length){vd_U.vd_bh(vd_ib);var vd_QY=vd_rn;vd_rn=0;vd_U.vd_tT(vd_Y.vd_pd,vd_Y.vd_cX[1],vd_Y.ShapeStyleRef.FontFileVDS.Ascent,vd_Y.ShapeStyleRef.FontFileVDS);vd_rn=vd_QY;vd_U.vd_bC();}}if(dash>0){vdgeo.vd_rc(vd_ci,p1,vdir,vd_aT);vd_zs(vd_hn,vd_ci);vdgeo.vd_bn(vd_hn,vd_ci);}else if(dash==0){vdgeo.vd_rc(vd_ci,p1,vdir,(vd_aT+vd_GQ*2.0));vd_zs(vd_hn,vd_ci);}else{vdgeo.vd_rc(vd_hn,p1,vdir,vd_aT);}if(vdgeo.AreEqual(vd_aT,length,vdgeo.DefaultLinearEquality)||vd_aT>length){vd_aT=length;break;}}}return vd_yA;};function vd_MN(points,closed,vd_yJ){var vd_qp=0.0;if(vd_U.linetype.DrawMethod!=vdConst.LineTypeDrawMethod_Start){var scale=vd_U.vd_mp;if(vd_U.linetype.IsDPIScale===true)scale=vd_U.pixelsize*dpi*vd_DQ*vd_U.vd_jW;var vd_cF=vd_yH()*scale;var length=points.length;var vd_qX=length/vd_cF;var vd_wY=(Math.abs(vd_U.linetype.Segments.Items[0].DashLen)*scale+Math.abs(vd_qX-Math.floor(vd_qX))*vd_cF)/2.0;var dx=vd_wY-Math.abs(vd_U.linetype.Segments.Items[0].DashLen)*scale;vd_qp= -1.0*dx;}var _sp=vdgeo.newpoint(0,0,0);var _ep=vdgeo.newpoint(0,0,0);vdgeo.vd_bn(_sp,points[0]);_sp[Z]+=vd_yJ;for(var i=1;i<points.length;i++){vdgeo.vd_bn(_ep,points[i]);_ep[Z]+=vd_yJ;vd_U.vd_bb=points[i-1][INDEX];if(vd_U.vd_bb===undefined)vd_U.vd_bb=i-1;vd_qp=vd_zx(_sp,_ep,vd_qp,(i===points.length-1));vdgeo.vd_bn(_sp,_ep);}if(closed){vdgeo.vd_bn(_ep,points[0]);_ep[Z]+=vd_yJ;vd_U.vd_bb=points[points.length-1][INDEX];if(vd_U.vd_bb===undefined)vd_U.vd_bb=points.length-1;vd_qp=vd_zx(_sp,_ep,vd_qp,(i===points.length-1));vdgeo.vd_bn(_sp,_ep);}vd_U.vd_bb=undefined;};this.GetEntityFromPoint=function(x,y,vd_lZ,vd_bq){var vd_b=vd_U.vd_H.vd_ji();if(!vd_U.vd_bJ)return null;x=vdgeo.vd_u(x);y=vdgeo.vd_u(y);if(x<0||x>=vd_U.width)return null;if(y<0||y>=vd_U.height)return null;var vd_hG=Math.max(vdgeo.vd_u(vd_lZ*0.5),1);var px,py;for(var ix= -vd_hG;ix<=vd_hG;ix++){for(var iy= -vd_hG;iy<=vd_hG;iy++){px=x+ix;py=y+iy;if(px<0||px>=vd_U.width||py<0||py>=vd_U.height)continue;var ipos=py*vd_U.width+px;var ret=vd_b[ipos][1];if(!ret)continue;for(var j=ret.length-1;j>=0;j--){var fig=ret[j];if(vd_bq===false&&fig.LayerRef&&fig.LayerRef.Lock)continue;return fig;}}}return null;};function vd_jK(ix,iy,vd_bq,vd_b,ret){ix=vdgeo.vd_u(ix+0.49);iy=vdgeo.vd_u(iy+0.49);var ipos=iy*vd_U.width+ix;var ret1=vd_b[ipos][1];if(!ret1)return;for(var j=ret1.length-1;j>=0;j--){var fig=ret1[j];if(ret.figs['h_'+fig.HandleId])continue;if(vd_bq===false&&fig.LayerRef&&fig.LayerRef.Lock)continue;ret.length+=1;ret.figs['h_'+fig.HandleId]=fig;}};function vd_HR(x1,y1,x2,y2,vd_bq,vd_b,ret){var dx=(x2-x1);var dy=(y2-y1);var temp,k,yt,xs,xt,ys;if(Math.abs(dx)>Math.abs(dy)){if(dx<0){temp=x1;x1=x2;x2=temp;temp=y1;y1=y2;y2=temp;dy*= -1.0;dx*= -1.0;}if(vdgeo.AreEqual(dx,0.0,0.5)){vd_jK(x1,y1,vd_bq,vd_b,ret);vd_jK(x2,y2,vd_bq,vd_b,ret);return;}k=dy/dx;yt=y1;for(xs=x1;xs<=x2;xs++){vd_jK(xs,yt,vd_bq,vd_b,ret);yt+=k;}}else{if(dy<0){temp=x1;x1=x2;x2=temp;temp=y1;y1=y2;y2=temp;dy*= -1.0;dx*= -1.0;}if(vdgeo.AreEqual(dy,0.0,0.5)){vd_jK(x1,y1,vd_bq,vd_b,ret);vd_jK(x2,y2,vd_bq,vd_b,ret);return;}k=dx/dy;xt=x1;for(ys=y1;ys<=y2;ys++){vd_jK(xt,ys,vd_bq,vd_b,ret);xt+=k;}}};this.GetEntitiesFence=function(vd_jv,vd_bq){var vd_b=vd_U.vd_H.vd_ji();if(!vd_U.vd_bJ)return[];var sp=vd_jv[0];var vd_zU=vdgeo.newpoint(0,0,0);var vd_Am=vdgeo.newpoint(0,0,0);var ret={length:0,figs:{}};for(var i=1;i<vd_jv.length;i++){var ep=vd_jv[i];var vd_vu=vd_Ay(sp,ep,vd_zU,vd_Am);if(vd_vu===1)return;vd_HR(vd_zU[X],vd_zU[Y],vd_Am[X],vd_Am[Y],vd_bq,vd_b,ret);sp=ep;}if(ret.length===0)return[];var vd_jc=[];for(var hid in ret.figs){if(hid.substr(0,2)=='h_')vd_jc.push(ret.figs[hid]);}return vd_jc;};this.GetEntitiesFromBox=function(xmin,ymin,xmax,ymax,vd_bq){var vd_b=vd_U.vd_H.vd_ji();if(!vd_U.vd_bJ)return[];var tmp;if(xmin>xmax){tmp=xmin;xmin=xmax;xmax=tmp;}if(ymin>ymax){tmp=ymin;ymin=ymax;ymax=tmp;}xmin=vdgeo.vd_u(Math.min(Math.max(xmin,0),vd_U.width-1));xmax=vdgeo.vd_u(Math.min(Math.max(xmax,0),vd_U.width-1));ymin=vdgeo.vd_u(Math.min(Math.max(ymin,0),vd_U.height-1));ymax=vdgeo.vd_u(Math.min(Math.max(ymax,0),vd_U.height-1));var ret={length:0,figs:{}};for(var ix=xmin;ix<=xmax;ix++){for(var iy=ymin;iy<=ymax;iy++){vd_jK(ix,iy,vd_bq,vd_b,ret);}}if(ret.length===0)return[];var vd_jc=[];for(var hid in ret.figs){if(hid.substr(0,2)=='h_')vd_jc.push(ret.figs[hid]);}return vd_jc;};this.GetEntitiesInWindowBox=function(xmin,ymin,xmax,ymax,vd_bq){var tmp;if(xmin>xmax){tmp=xmin;xmin=xmax;xmax=tmp;}if(ymin>ymax){tmp=ymin;ymin=ymax;ymax=tmp;}xmin=vdgeo.vd_u(Math.min(Math.max(xmin,0),vd_U.width-1));xmax=vdgeo.vd_u(Math.min(Math.max(xmax,0),vd_U.width-1));ymin=vdgeo.vd_u(Math.min(Math.max(ymin,0),vd_U.height-1));ymax=vdgeo.vd_u(Math.min(Math.max(ymax,0),vd_U.height-1));var vd_eb=vd_U.GetEntitiesFromBox(xmin,ymin,xmax,ymax,vd_bq);if(vd_eb.length===0)return vd_eb;var vd_b=vd_U.vd_H.vd_ji();for(var iy=0;iy<vd_U.height;iy++){for(var ix=0;ix<vd_U.width;ix++){if(vdgeo.vd_nc(ix,iy,xmin,ymin,xmax,ymax))continue;var ipos=iy*vd_U.width+ix;var ret1=vd_b[ipos][1];if(!ret1)continue;for(var j=0;j<ret1.length;j++){for(var k=0;k<vd_eb.length;k++){if(vd_eb[k]==ret1[j]){vd_eb.splice(k,1);k--;}}}}}return vd_eb;};this.GetEntitiesFromPolygon=function(pts,vd_bq){if(!vd_U.vd_bJ)return null;var vd_b=vd_U.vd_H.vd_ji();var ret={length:0,figs:{}};var vd_Jm=vd_U.vd_H.vd_Ni(pts,vd_jK,vd_bq,vd_b,ret);if(ret.length===0)return null;var vd_jc=[];for(var hid in ret.figs){if(hid.substr(0,2)=='h_')vd_jc.push(ret.figs[hid]);}return{entities:vd_jc,vd_kG:vd_Jm};};this.GetEntitiesInWindowPolygon=function(pts,vd_bq){var vd_eb=vd_U.GetEntitiesFromPolygon(pts,vd_bq);if(!vd_eb||vd_eb.entities.length==0)return null;var vd_b=vd_U.vd_H.vd_ji();for(var iy=0;iy<vd_U.height;iy++){for(var ix=0;ix<vd_U.width;ix++){if(vd_U.vd_H.vd_NA(vd_eb.vd_kG,ix,iy))continue;var ipos=iy*vd_U.width+ix;var ret1=vd_b[ipos][1];if(!ret1)continue;for(var j=0;j<ret1.length;j++){for(var k=0;k<vd_eb.entities.length;k++){if(vd_eb.entities[k]==ret1[j]){vd_eb.entities.splice(k,1);k--;}}}}}return vd_eb.entities;};return this;};function vd_Sl(){var vd_U=this;var document=null;this.SelectDocument=function(vd_t){document=vd_t;if(!document.Groups)document.Groups={IgnoreGroups:false,Items:[]};var groups=document.Groups;if(groups.IgnoreGroups===undefined)groups.IgnoreGroups=false;if(groups.Items.length==0)return;for(var i=0;i<groups.Items.length;i++){var group=groups.Items[i];var h='h_'+group.HandleId.toString();for(var i2=0;i2<group.Items.length;i2++){var vd_yG=group.Items[i2];var vd_kB=document[vd_yG];if(!vd_kB)continue;if(!vd_kB._groups)vd_kB._groups={};vd_kB._groups[h]=1;}}};this.vd_up=function(fig,vd_aA,vd_yR){if(!fig)return;if(fig.selected==true)return;if(fig.vd_nV)return;fig.vd_nV=true;vd_aA.push(fig);if(!vd_U.IgnoreGroups&&fig._groups){for(var vd_AC in fig._groups){var group=document.Groups.Items[document.Groups[vd_AC]];if(!group||group==vd_yR)continue;if(group.Selectable===false)continue;for(var i2=0;i2<group.Items.length;i2++){var fig2=document[group.Items[i2]];vd_U.vd_up(fig2,vd_aA,group);}}}};this.vd_vh=function(vd_to,vd_aA,vd_Gm,vd_yR){if(!vd_to)return;var index=vd_aA.indexOf(vd_to);if(vd_Gm){if(index<0)return;vd_aA.splice(index,1);}else{if(index>=0)return;vd_aA.push(vd_to);}var fig=document[vd_to];if(!fig||vd_U.IgnoreGroups|| !fig._groups)return;for(var vd_AC in fig._groups){var group=document.Groups.Items[document.Groups[vd_AC]];if(!group||group==vd_yR)continue;if(group.Selectable===false)continue;for(var i2=0;i2<group.Items.length;i2++){vd_U.vd_vh(group.Items[i2],vd_aA,vd_Gm,group);}}};Object.defineProperty(vd_U,'IgnoreGroups',{get:function(){return document.Groups.IgnoreGroups;},set:function(newValue){document.Groups.IgnoreGroups=newValue;}});function Find(name){name=name.toLowerCase();for(var i=0;i<document.Groups.Items.length;i++){var group=document.Groups.Items[i];var vd_gL=group.Name.toLowerCase();if(vd_gL==name)return group;}return null;};function vd_Po(group,item){var h='h_'+item.HandleId.toString();return group.Items.indexOf(h);};this.ClearGroup=function(vd_fZ){var group=Find(vd_fZ);if(!group)return;var g_h='h_'+group.HandleId.toString();for(var i=0;i<group.Items.length;i++){var fig=document[group.Items[i]];if(!fig)continue;if(!fig._groups[g_h])continue;delete fig._groups[g_h];}group.Items=[];};this.AddItem=function(vd_fZ,item){if(!item|| !item.HandleId)return false;var group=Find(vd_fZ);var g_h;if(!group){group={_t:vdConst.vdGroup_code,HandleId:vdConst.vd_EQ(document),Name:vd_fZ,Items:[]};document.Groups.Items.push(group);g_h='h_'+group.HandleId.toString();document.Groups[g_h]=document.Groups.Items.length-1;}else{g_h='h_'+group.HandleId.toString();}if(item._groups&&item._groups[g_h])return true;if(!item._groups)item._groups={};item._groups[g_h]=1;group.Items.push('h_'+item.HandleId.toString());return true;};this.RemoveItem=function(vd_fZ,item){if(!item|| !item.HandleId)return false;var group=Find(vd_fZ);if(!group)return false;var g_h='h_'+group.HandleId.toString();if(!item._groups|| !item._groups[g_h])return false;delete item._groups[g_h];var index=vd_Po(group,item);if(index<0)return false;group.Items.splice(index,1);return true;};this.EnableGroup=function(vd_fZ,enable){var group=Find(vd_fZ);if(!group)return;group.Selectable=enable;};this.GetEntities=function(vd_fZ){var group=Find(vd_fZ);if(!group)return null;var ret=[];for(var i2=0;i2<group.Items.length;i2++){var vd_yG=group.Items[i2];var vd_kB=document[vd_yG];if(!vd_kB)continue;ret.push(vd_kB);}return ret;};return this;};vdConst.vd_xa=1;vdConst.vd_nv=2;vdConst.vd_sw=3;vdConst.vd_rY=4;vdConst.vd_oI=5;vdConst.vd_Lq=6;vdConst.vd_Ry=0;vdConst.vd_rF=1;vdConst.vd_wq=2;vdConst.vd_nD=4;vdConst.vd_pe=8;vdConst.vd_Lv=12;vdConst.vd_xm=0;vdConst.vd_EM=1;vdConst.vd_EJ=2;vdConst.vd_Bb=3;vdConst.vd_EB=4;vdConst.vd_Mk=0;vdConst.vd_vs=1;vdConst.vd_yc=2;vdConst.vd_RJ=3;vdConst.vd_LP=1;vdConst.vd_Ma=0;vdConst.vd_ud=String.fromCharCode(176);vdConst.vd_Rc='d';function vd_MI(vd_nB,vd_pj,vd_qS){var vd_U=this;if(vd_nB==undefined)this.type=vdConst.vd_nv;else this.type=vd_nB;if(vd_pj==undefined)this.precision=4;else this.precision=vd_pj;if(vd_qS==undefined)this.vd_bv=vdConst.vd_rF;else this.vd_bv=vd_qS;this.vd_MF=function(length){var ret="";var vd_uz=1.0/Math.pow(10,vd_U.precision);if(vd_U.type==vdConst.vd_oI||vd_U.type==vdConst.vd_sw)vd_uz=1.0/Math.pow(2,vd_U.precision);if(vdgeo.AreEqual(length,0,vd_uz*0.5))length=0.0;var vd_LV=(length<0);length=Math.abs(length);switch(vd_U.type){case vdConst.vd_xa:var prec=vd_U.precision;if(vdgeo.AreEqual(length,vdgeo.vd_u(length),vd_uz))prec=0;ret=length.toExponential(prec);if((vd_U.vd_bv&vdConst.vd_nD)!=0){while(ret.charAt(0)=='0')ret=ret.substr(0,1);}if((vd_U.vd_bv&vdConst.vd_pe)!=0){var vd_eI=ret.indexOf(".");if(vd_eI>=0){while(ret.charAt(ret.length-1)=='0')ret=ret.substr(0,ret.length-1);if(ret.charAt(ret.length-1)=='.')ret=ret.substr(0,ret.length-1);}}break;case vdConst.vd_nv:ret=length.toFixed(vd_U.precision);if((vd_U.vd_bv&vdConst.vd_nD)!=0){while(ret.charAt(0)=='0')ret=ret.substr(0,1);}if((vd_U.vd_bv&vdConst.vd_pe)!=0){var vd_eI=ret.indexOf(".");if(vd_eI>=0){while(ret.charAt(ret.length-1)=='0')ret=ret.substr(0,ret.length-1);if(ret.charAt(ret.length-1)=='.')ret=ret.substr(0,ret.length-1);}}break;case vdConst.vd_sw:{var feet=vdgeo.vd_u((length/12.0)+0.000001);var vd_dh=length-(feet*12.0);if(vdgeo.AreEqual(vd_dh,0,vdgeo.DefaultLinearEquality))vd_dh=0.0;if(vdgeo.AreEqual(vd_dh,0.0,vd_uz)){ret=feet.toString()+"'";}else{var vd_yM=feet.toString()+"'";if(feet==0)vd_yM="";ret=vd_dh.toFixed(vd_U.precision);if((vd_U.vd_bv&vdConst.vd_nD)!=0){while(ret.charAt(0)=='0')ret=ret.substr(0,1);}if((vd_U.vd_bv&vdConst.vd_pe)!=0){var vd_eI=ret.indexOf(".");if(vd_eI>=0){while(ret.charAt(ret.length-1)=='0')ret=ret.substr(0,ret.length-1);if(ret.charAt(ret.length-1)=='.')ret=ret.substr(0,ret.length-1);}}ret+="\"";ret=(vd_yM!=""?(vd_yM+"-"):"")+ret;}}break;case vdConst.vd_rY:{var vd_fq=vdgeo.vd_u(Math.pow(2,vd_U.precision));var feet=vdgeo.vd_u((length/12.0)+0.000001);var vd_dh=vdgeo.vd_u(length-(feet*12.0));if(vd_dh==12){vd_dh=0;feet++;}var vd_eE=vdgeo.vd_u((length-vd_dh-(feet*12.0))*vd_fq+(0.5/vd_fq)+0.4999);if(vd_eE==vd_fq){vd_eE=0;vd_dh++;if(vd_dh==12){vd_dh=0;feet++;}}while(vd_eE>=2&&(vd_eE%2.0)==0.0&&vd_fq>=2&&(vd_fq%2.0)==0.0){vd_eE/=2;vd_fq/=2;}var vd_xR=feet.toString()+"'";var vd_pg=vd_dh.toString()+" ";var vd_ow=vd_eE.toString()+"/"+vd_fq.toString();if(vd_eE==0)vd_ow="";if(feet==0)vd_xR="";if((vd_U.vd_bv&vdConst.vd_wq)!=0&&vd_dh==0){vd_pg="";}ret=vd_xR;var vd_zF=vd_pg+vd_ow;if(vd_xR!=""&&vd_zF!="")ret+="-";ret+=vd_zF;if(ret=="")ret="0";if(vd_pg!="")ret+="\"";}break;case vdConst.vd_oI:{var vd_fq=vdgeo.vd_u(Math.pow(2,vd_U.precision));var vd_dh=vdgeo.vd_u(length);var vd_eE=vdgeo.vd_u((length-vd_dh)*vd_fq+(0.5/vd_fq)+0.4999);if(vd_eE==vd_fq){vd_dh++;vd_eE=0;}while(vd_eE>=2&&(vd_eE%2.0)==0.0&&vd_fq>=2&&(vd_fq%2.0)==0.0){vd_eE/=2;vd_fq/=2;}var vd_pg=vd_dh.toString()+" ";var vd_ow=vd_eE.toString()+"/"+vd_fq.toString();if(vd_eE==0)vd_ow="";if((vd_U.vd_bv&vdConst.vd_wq)!=0&&vd_dh==0){vd_pg="";}ret=vd_pg+vd_ow;if(ret=="")ret="0";ret+="\"";}break;case vdConst.vd_Lq:ret=length.toString();if((vd_U.vd_bv&vdConst.vd_nD)!=0){while(ret.charAt(0)=='0')ret=ret.substr(0,1);}if((vd_U.vd_bv&vdConst.vd_pe)!=0){var vd_eI=ret.indexOf(".");if(vd_eI>=0){while(ret.charAt(ret.length-1)=='0')ret=ret.substr(0,ret.length-1);if(ret.charAt(ret.length-1)=='.')ret=ret.substr(0,ret.length-1);}}break;default:ret=length.toString();if((vd_U.vd_bv&vdConst.vd_nD)!=0){while(ret.charAt(0)=='0')ret=ret.substr(0,1);}if((vd_U.vd_bv&vdConst.vd_pe)!=0){var vd_eI=ret.indexOf(".");if(vd_eI>=0){while(ret.charAt(ret.length-1)=='0')ret=ret.substr(0,ret.length-1);if(ret.charAt(ret.length-1)=='.')ret=ret.substr(0,ret.length-1);}}break;}if(ret=="")ret="0";ret=((vd_LV)?"-":"")+ret;if(ret.charAt(ret.length-1)=='.')ret=ret.substr(0,ret.length-1);return ret;};return this;};function vd_QF(vd_nB,vd_pj,vd_qS){var vd_U=this;this.AngleBase=0;this.Direction=vdConst.vd_Ma;if(vd_nB==undefined)this.type=vdConst.vd_xm;else this.type=vd_nB;if(vd_pj==undefined)this.precision=4;else this.precision=vd_pj;if(vd_qS==undefined)this.vd_bv=vdConst.vd_Mk;else this.vd_bv=vd_qS;function vd_JQ(angle){var ret=angle-vd_U.AngleBase;if(vd_U.Direction==vdConst.vd_LP)ret=vdgeo.VD_TWOPI-ret;return vdgeo.FixAngle(ret);};this.vd_RH=function(value){switch(vd_U.type){case vdConst.vd_xm:case vdConst.vd_EM:return vdgeo.DegreesToRadians(value);case vdConst.vd_Bb:return value;case vdConst.vd_EJ:case vdConst.vd_EB:return value*vdgeo.PI/200.0;default:return value;}};this.vd_Qz=function(vd_IK){var length=vd_JQ(vd_IK);var ret="";length=vdgeo.RadiansToDegrees(length);length+=vdgeo.DefaultAngularEquality;if(length>360.0)length=length-360.0;if(length<0.0)length+=360.0;switch(vd_U.type){case vdConst.vd_xm:ret=length.toFixed(vd_U.precision);if((vd_U.vd_bv&vdConst.vd_vs)!=0){while(ret.charAt(0)=='0')ret=ret.substr(0,1);}if((vd_U.vd_bv&vdConst.vd_yc)!=0){var vd_eI=ret.indexOf(".");if(vd_eI>=0){while(ret.charAt(ret.length-1)=='0')ret=ret.substr(0,ret.length-1);if(ret.charAt(ret.length-1)=='.')ret=ret.substr(0,ret.length-1);}}ret=ret+vdConst.vd_ud;break;case vdConst.vd_EM:{var vd_lp=vdgeo.vd_u(length);var vd_hS=vdgeo.vd_u((length-vd_lp)*60.0);var vd_nU=vdgeo.vd_u(0.5+((length-(vd_lp*1.0+vd_hS/60.0))*3600.0));if(vd_U.precision<2){vd_hS+=vdgeo.vd_u(vd_nU/31);vd_nU=0;}if(precision<1){vd_lp+=vdgeo.vd_u(vd_hS/31);vd_hS=0;}if(vd_nU>=60){vd_hS+=1;vd_nU=0;}if(vd_hS>=60){vd_lp+=1;vd_hS=0;}ret=vd_lp.toString()+vdConst.vd_ud+vd_hS.toString()+"'"+vd_nU.toString()+"\"";if(vd_U.precision<3)ret=vd_lp.toString()+vdConst.vd_ud+vd_hS.toString()+"'";if(vd_U.precision==0)ret=vd_lp.toString()+vdConst.vd_ud;}break;case vdConst.vd_EB:case vdConst.vd_EJ:length=length*200.0/180.0;ret=length.toFixed(vd_U.precision);if((vd_U.vd_bv&vdConst.vd_vs)!=0){while(ret.charAt(0)=='0')ret=ret.substr(0,1);}if((vd_U.vd_bv&vdConst.vd_yc)!=0){var vd_eI=ret.indexOf(".");if(vd_eI>=0){while(ret.charAt(ret.length-1)=='0')ret=ret.substr(0,ret.length-1);if(ret.charAt(ret.length-1)=='.')ret=ret.substr(0,ret.length-1);}}ret=ret+"g";break;case vd_QK.vd_Bb:length=vdgeo.DegreesToRadians(length);ret=length.toFixed(vd_U.precision);if((vd_U.vd_bv&vdConst.vd_vs)!=0){while(ret.charAt(0)=='0')ret=ret.substr(0,1);}if((vd_U.vd_bv&vdConst.vd_yc)!=0){var vd_eI=ret.indexOf(".");if(vd_eI>=0){while(ret.charAt(ret.length-1)=='0')ret=ret.substr(0,ret.length-1);if(ret.charAt(ret.length-1)=='.')ret=ret.substr(0,ret.length-1);}}ret=ret+"r";break;default:break;}return ret;};return this;};vdConst.vd_ps=0;vdConst.vd_kj=1;vdConst.vd_pq=1;vdConst.vd_Gk=0;vdConst.vd_rN=0;vdConst.vd_xw=1;function vddimmanager(){var vd_U=this;var DefPoint1;var DefPoint2;var LinePosition;var PostString;var vd_iQ=vdConst.vd_kj;var vd_jS='tick';var vd_mC="";var vd_il=0.2;var vd_df=new vd_MI(vdConst.vd_nv,4,vdConst.vd_rF);var vd_kH=vdConst.colorFromString('byblock');var vd_lQ=vdConst.colorFromString('byblock');var vd_mE=vdConst.colorFromString('byblock');var vd_ro="";var vd_jQ=vdConst.vd_rN;var vd_mv=vdConst.vd_pq;var ScaleFactor=1.0;var LinearScaleFactor=1.0;var HorizontalRotation=0.0;var rotation=0;var vd_sO=0;var vd_rz=0;var vd_sP=0;var vd_rW=0;function vd_wZ(){if(vd_sO==0)return vd_il;return vd_sO;};function ExtLineDist1(){if(vd_rz==0)return vd_il;return vd_rz;};function ExtLineDist2(){if(vd_sP==0)return vd_il*0.0625;return vd_sP;};function TextDist(){if(vd_rW==0)return vd_il*0.09;return vd_rW;};Object.defineProperty(vd_U,'HORROT',{get:function(){return String(HorizontalRotation);},set:function(newValue){HorizontalRotation=Number(newValue);}});Object.defineProperty(vd_U,'ROTATION',{get:function(){return String(vdgeo.RadiansToDegrees(rotation));},set:function(newValue){rotation=Number(vdgeo.DegreesToRadians(newValue));}});Object.defineProperty(vd_U,'BSIZE',{get:function(){return String(vd_wZ());},set:function(newValue){vd_sO=Number(newValue);}});Object.defineProperty(vd_U,'XLD1',{get:function(){return String(ExtLineDist1());},set:function(newValue){vd_rz=Number(newValue);}});Object.defineProperty(vd_U,'XLD2',{get:function(){return String(ExtLineDist2());},set:function(newValue){vd_sP=Number(newValue);}});Object.defineProperty(vd_U,'TXTDIST',{get:function(){return String(TextDist());},set:function(newValue){vd_rW=Number(newValue);}});Object.defineProperty(vd_U,'LSCALE',{get:function(){return String(LinearScaleFactor);},set:function(newValue){LinearScaleFactor=Number(newValue);}});Object.defineProperty(vd_U,'TYPE',{get:function(){switch(vd_iQ){case vdConst.vd_kj:return 'ALIGN';case vdConst.vd_ps:if(vdgeo.AreEqual(rotation,0.0,vdgeo.DefaultAngularEquality))return 'HOR';else if(vdgeo.AreEqual(rotation,vdgeo.HALF_PI,vdgeo.DefaultAngularEquality))return 'VER';else return 'ROTATED';default:return 'ALIGN';}},set:function(newValue){newValue=newValue.toUpperCase();if(newValue=='ALIGN')vd_iQ=vdConst.vd_kj;else if(newValue=='VER'){vd_iQ=vdConst.vd_ps;rotation=vdgeo.HALF_PI;}else if(newValue=='HOR'){vd_iQ=vdConst.vd_ps;rotation=0;}else vd_iQ=vdConst.vd_kj;}});Object.defineProperty(vd_U,'TSTYLE',{get:function(){return vd_mC;},set:function(newValue){vd_mC=newValue;}});Object.defineProperty(vd_U,'BLK',{get:function(){return vd_jS;},set:function(newValue){vd_jS=newValue;}});Object.defineProperty(vd_U,'TEXTH',{get:function(){return String(vd_il);},set:function(newValue){vd_il=Number(newValue);}});Object.defineProperty(vd_U,'LUNITS',{get:function(){switch(vd_df.type){case vdConst.vd_xa:return 'SC';case vdConst.vd_nv:return 'DEC';case vdConst.vd_sw:return 'ENG';case vdConst.vd_rY:return 'ARC';case vdConst.vd_oI:return 'FRAC';default:return 'DEC';}},set:function(newValue){newValue=newValue.toUpperCase();if(newValue=='SC')vd_df.type=vdConst.vd_xa;else if(newValue=='DEC')vd_df.type=vdConst.vd_nv;else if(newValue=='ENG')vd_df.type=vdConst.vd_sw;else if(newValue=='ARC')vd_df.type=vdConst.vd_rY;else if(newValue=='FRAC')vd_df.type=vdConst.vd_oI;else vd_df.type=vdConst.vd_nv;}});Object.defineProperty(vd_U,'PREC',{get:function(){return String(vd_df.precision);},set:function(newValue){vd_df.precision=Number(newValue);}});Object.defineProperty(vd_U,'SZEROS',{get:function(){return vd_df.vd_bv==vdConst.vd_rF?'0':'1';},set:function(newValue){vd_df.vd_bv=Number(newValue)!=0?(vdConst.vd_Lv|vdConst.vd_wq):vdConst.vd_rF;}});Object.defineProperty(vd_U,'LINECOLOR',{get:function(){return vdConst.colorToString(vd_kH);},set:function(newValue){vd_kH=vdConst.colorFromString(newValue);}});Object.defineProperty(vd_U,'EXTCOLOR',{get:function(){return vdConst.colorToString(vd_lQ);},set:function(newValue){vd_lQ=vdConst.colorFromString(newValue);}});Object.defineProperty(vd_U,'TEXTCOLOR',{get:function(){return vdConst.colorToString(vd_mE);},set:function(newValue){vd_mE=vdConst.colorFromString(newValue);}});Object.defineProperty(vd_U,'DIMTEXT',{get:function(){return vd_ro;},set:function(newValue){vd_ro=newValue;}});Object.defineProperty(vd_U,'TEXTHORROT',{get:function(){switch(vd_jQ){case vdConst.vd_rN:return 'ALIGN';case vdConst.vd_xw:return 'HORIZONTAL';default:return 'ALIGN';}},set:function(newValue){newValue=newValue.toUpperCase();if(newValue=='ALIGN')vd_jQ=vdConst.vd_rN;else if(newValue=='HORIZONTAL')vd_jQ=vdConst.vd_xw;else vd_jQ=vdConst.vd_rN;}});Object.defineProperty(vd_U,'TEXTVERJUST',{get:function(){switch(vd_mv){case vdConst.vd_pq:return 'ABOVE';case vdConst.vd_Gk:return 'CENTER';default:return 'ABOVE';}},set:function(newValue){newValue=newValue.toUpperCase();if(newValue=='ABOVE')vd_mv=vdConst.vd_pq;else if(newValue=='CENTER')vd_mv=vdConst.vd_Gk;else vd_mv=vdConst.vd_pq;}});function vd_Ps(vdcanvas,vd_t){var entities=[];var blockref=vdcanvas.AddBlockSymbol(vd_jS,[0,0,0],1.0,0.0,false,{});if(blockref){entities.push(blockref);}else if(vd_jS.toLowerCase()=="arrow"){var hp=vd_t.ActiveHatchProperties;vdcanvas.SetActiveHatchProperties(vdcanvas.createNewHatchProperties('solid'));entities.push(vdcanvas.AddPolyline([[0,0],[-2.0,-0.4],[-2.0,0.4],[0,0]],false,{}));vdcanvas.SetActiveHatchProperties(hp);}else if(vd_jS.toLowerCase()=="tick"){entities.push(vdcanvas.AddLine([-1,0,0],[1,0,0],false,{}));entities.push(vdcanvas.AddLine([-1,-1,0],[1,1,0],false,{}));}else{}return entities;};function vd_Pg(){var p1=vdgeo.newpoint(0,0,0);var p2=vdgeo.newpoint(0,0,0);var p3=vdgeo.newpoint(0,0,0);var p4=vdgeo.newpoint(0,0,0);var tmpP=vdgeo.newpoint(0,0,0);var length=0.0;switch(vd_iQ){case vdConst.vd_kj:length=vdgeo.Distance3D(DefPoint1,DefPoint2);break;case vdConst.vd_ps:p4=vdgeo.pointPolar(DefPoint1,rotation+vdgeo.HALF_PI,1.0);p3=vdgeo.pointPolar(LinePosition,rotation,1.0);if(vdgeo.vd_gU(DefPoint1,p4,LinePosition,p3,vdgeo.DefaultVectorEquality,p3)!=1)break;tmpP=vdgeo.pointPolar(DefPoint2,rotation+vdgeo.HALF_PI,1.0);p4=vdgeo.pointPolar(LinePosition,rotation,1.0);if(vdgeo.vd_gU(LinePosition,p4,DefPoint2,tmpP,vdgeo.DefaultVectorEquality,p4)==0){vdgeo.vd_bn(p4,p3);}length=vdgeo.Distance2D(p3,p4);break;default:break;}return length;};function vd_Cg(vd_IV){var str=vd_IV;if(str==""||str=="<>"){var length=vd_Pg();length*=LinearScaleFactor;var vd_BW="";var vd_zm="";var post=PostString;var pos=post.indexOf("<>");if(pos== -1){vd_zm=post;}else{vd_BW=post.substr(0,pos);vd_zm=post.substr(pos+2);}str=vd_df.vd_MF(length);str=vd_BW+str+vd_zm;}else{var vd_yY='';var vd_yY=vd_Cg(vd_yY);while(str.indexOf('<>')> -1){str=str.replace('<>',vd_yY);}}return str;};function vd_DH(vdcanvas,vd_t){var p11,p22,lp1,p1,p2;switch(vd_iQ){case vdConst.vd_kj:return vd_DG(vdcanvas,vd_t,DefPoint1,DefPoint2,DefPoint1,DefPoint2,LinePosition);case vdConst.vd_ps:p11=vdgeo.newpoint();p22=vdgeo.newpoint();lp1=vdgeo.pointPolar(LinePosition,rotation,1.0);p1=vdgeo.pointPolar(DefPoint1,rotation+vdgeo.HALF_PI,1.0);p2=vdgeo.pointPolar(DefPoint2,rotation+vdgeo.HALF_PI,1.0);vdgeo.vd_bn(p11,DefPoint1);vdgeo.vd_bn(p22,DefPoint2);vdgeo.vd_gU(LinePosition,lp1,DefPoint1,p1,vdgeo.DefaultVectorEquality,p11);vdgeo.vd_gU(LinePosition,lp1,DefPoint2,p2,vdgeo.DefaultVectorEquality,p22);return vd_DG(vdcanvas,vd_t,p11,p22,DefPoint1,DefPoint2,LinePosition);default:return null;}return null;};function vd_DG(vdcanvas,vd_t,vd_ns,vd_tg,vd_Ki,vd_Ja,vd_zo){var line=null;var mat=vdgeo.vd_e();var angle=vdgeo.GetAngle(vd_ns,vd_tg);vdgeo.vd_x(mat,-vd_ns[X],-vd_ns[Y],-vd_ns[Z]);vdgeo.vd_bw(mat,-angle);var p1=vdgeo.matrixtransform(mat,vd_ns);var p2=vdgeo.matrixtransform(mat,vd_tg);var lpos=vdgeo.matrixtransform(mat,vd_zo);var vd_sE=vdgeo.matrixtransform(mat,vd_Ki);var vd_sj=vdgeo.matrixtransform(mat,vd_Ja);var offset=lpos[Y]-p1[Y];var p11=vdgeo.newpoint(p1[X],p1[Y],p1[Z]);p11[Y]+=offset;var p22=vdgeo.newpoint(p2[X],p2[Y],p2[Z]);p22[Y]+=offset;var vd_we=1.0;var vd_yB=1.0;if(lpos[Y]-vd_sE[Y]<0.0)vd_we= -1.0;if(lpos[Y]-vd_sj[Y]<0.0)vd_yB= -1.0;var vd_xo=vdgeo.newpoint(vd_sE[X],vd_sE[Y]+ExtLineDist2()*vd_we*ScaleFactor,vd_sE[Z]);var vd_yU=vdgeo.newpoint(p11[X],p11[Y]+ExtLineDist1()*vd_we*ScaleFactor,p11[Z]);var vd_xV=vdgeo.newpoint(vd_sj[X],vd_sj[Y]+ExtLineDist2()*vd_yB*ScaleFactor,vd_sj[Z]);var vd_xt=vdgeo.newpoint(p22[X],p22[Y]+ExtLineDist1()*vd_yB*ScaleFactor,p22[Z]);var vd_re=0.0;var vd_Bf=vdgeo.FixAngle(angle-(2*vdgeo.PI-HorizontalRotation));vd_re=(vd_Bf>vdgeo.HALF_PI&&vd_Bf<=(3.000001*vdgeo.HALF_PI))?vd_re=vdgeo.PI:0.0;if(vd_jQ==vdConst.vd_xw)vd_re= -(angle+HorizontalRotation);var tp=vdgeo.MidPoint(p11,p22);if(vd_mv==vdConst.vd_pq)tp=vdgeo.pointPolar(tp,vd_re+vdgeo.HALF_PI,TextDist()*ScaleFactor);vdgeo.vd_mh(mat);p11=vdgeo.matrixtransform(mat,p11);p22=vdgeo.matrixtransform(mat,p22);tp=vdgeo.matrixtransform(mat,tp);vd_xo=vdgeo.matrixtransform(mat,vd_xo);vd_yU=vdgeo.matrixtransform(mat,vd_yU);vd_xV=vdgeo.matrixtransform(mat,vd_xV);vd_xt=vdgeo.matrixtransform(mat,vd_xt);var vd_mu=vdConst.VdConstVerJust_VdTextVerCen;if(vd_mv==vdConst.vd_pq)vd_mu=vdConst.VdConstVerJust_VdTextVerBottom;var vd_hE=[];var vd_xU=vdcanvas.GetActivePenColor();if(vd_kH)vdcanvas.SetActivePenColor(vd_kH);var vd_hZ=vdcanvas.AddLine(p11,p22,false,{});vd_hE.push(vd_hZ);var block=vd_Ps(vdcanvas,vd_t);if(block.length>0){var scale=vd_wZ()*ScaleFactor;mat=vdgeo.vd_e();vdgeo.vd_aj(mat,scale,scale,scale);vdgeo.vd_bw(mat,vdgeo.GetAngle(p22,p11));vdgeo.vd_x(mat,p11[X],p11[Y],p11[Z]);for(var i=0;i<block.length;i++){var ent=vdConst.cloneEntity(block[i]);vd_q.vd_hg(mat,ent,vdcanvas);vd_hE.push(ent);}mat=vdgeo.vd_e();vdgeo.vd_aj(mat,scale,scale,scale);vdgeo.vd_bw(mat,vdgeo.GetAngle(p11,p22));vdgeo.vd_x(mat,p22[X],p22[Y],p22[Z]);for(var i=0;i<block.length;i++){var ent=vdConst.cloneEntity(block[i]);vd_q.vd_hg(mat,ent,vdcanvas);vd_hE.push(ent);}}vdcanvas.SetActivePenColor(vd_xU);if(vd_lQ)vdcanvas.SetActivePenColor(vd_lQ);var vd_Mr=vdcanvas.AddLine(vd_xo,vd_yU,false,{});var vd_Lb=vdcanvas.AddLine(vd_xV,vd_xt,false,{});vd_hE.push(vd_Mr);vd_hE.push(vd_Lb);vdcanvas.SetActivePenColor(vd_xU);if(vd_mE)vdcanvas.SetActivePenColor(vd_mE);var vd_HY=vd_t.ActiveTextStyle;var vd_ou=vdcanvas.FindTextStyle(vd_mC);if(vd_ou)vdcanvas.SetActiveTextStyle(vd_ou);var text=vdcanvas.AddText(vd_Cg(vd_ro),vd_il*ScaleFactor,tp,vdConst.VdConstHorJust_VdTextHorCenter,vd_mu,vd_re+angle,false,{});vd_t.ActiveTextStyle=vd_HY;vd_hE.push(text);vdcanvas.SetActivePenColor(vd_xU);var ints=vd_Nm(vdcanvas,vd_hZ,text,vd_hE);if(ints.length>0){p11=vd_hZ.StartPoint;p22=vd_hZ.EndPoint;angle=vdgeo.GetAngle(p11,p22);vd_hZ.EndPoint=vdgeo.pointPolar(vd_hZ.StartPoint,angle,ints[0]-TextDist()*ScaleFactor);if(vd_kH)vdcanvas.SetActivePenColor(vd_kH);vd_hZ=vdcanvas.AddLine(vdgeo.pointPolar(vd_hZ.StartPoint,angle,ints[ints.length-1]+TextDist()*ScaleFactor),p22,false,{});vd_hE.push(vd_hZ);}return vd_hE;};function vd_Nm(vdcanvas,line,vd_ev,vd_hE){vdcanvas.GetEntityBBox(vd_ev);var p1=vdgeo.matrixtransform(vd_ev.EcsMatrix,[vd_ev.tb[0],vd_ev.tb[2],0]);var p2=vdgeo.matrixtransform(vd_ev.EcsMatrix,[vd_ev.tb[0],vd_ev.tb[3],0]);var p3=vdgeo.matrixtransform(vd_ev.EcsMatrix,[vd_ev.tb[1],vd_ev.tb[3],0]);var p4=vdgeo.matrixtransform(vd_ev.EcsMatrix,[vd_ev.tb[1],vd_ev.tb[2],0]);var i=vdgeo.newpoint(0,0,0);var ints=[];if(vdgeo.vd_gU(line.StartPoint,line.EndPoint,p1,p2,vdgeo.DefaultVectorEquality,i)==1&&vdgeo.vd_hR(i,line.StartPoint,line.EndPoint)&&vdgeo.vd_hR(i,p1,p2))ints.push(vdgeo.Distance3D(line.StartPoint,i));if(vdgeo.vd_gU(line.StartPoint,line.EndPoint,p2,p3,vdgeo.DefaultVectorEquality,i)==1&&vdgeo.vd_hR(i,line.StartPoint,line.EndPoint)&&vdgeo.vd_hR(i,p2,p3))ints.push(vdgeo.Distance3D(line.StartPoint,i));if(vdgeo.vd_gU(line.StartPoint,line.EndPoint,p3,p4,vdgeo.DefaultVectorEquality,i)==1&&vdgeo.vd_hR(i,line.StartPoint,line.EndPoint)&&vdgeo.vd_hR(i,p3,p4))ints.push(vdgeo.Distance3D(line.StartPoint,i));if(vdgeo.vd_gU(line.StartPoint,line.EndPoint,p4,p1,vdgeo.DefaultVectorEquality,i)==1&&vdgeo.vd_hR(i,line.StartPoint,line.EndPoint)&&vdgeo.vd_hR(i,p4,p1))ints.push(vdgeo.Distance3D(line.StartPoint,i));if(ints.length==0)return ints;ints.sort(function(a,b){return a-b});return ints;};this.Create=function(vdcanvas,vd_ns,vd_tg,vd_zo,vd_Jc,entities){var vd_t=vdcanvas.GetDocument();DefPoint1=vd_ns;DefPoint2=vd_tg;LinePosition=vd_zo;if(!LinePosition)LinePosition=DefPoint1;PostString=vd_Jc;if(!PostString)PostString="";var ents=vd_DH(vdcanvas,vd_t);if(!ents||ents.length==0)return null;var vd_M={_t:vdConst.vdDimension_code,Explode:{Items:[]}};vdcanvas.vd_dv(vd_M,vd_t,entities&& !entities.Items);vd_M.VDSDIMFLAG=16;vd_M.Explode.Items=ents;vd_M.dimType=vd_iQ;vd_M.FractionalType=2;vd_M.ExtLineVisible=true;vd_M.LineIsInvisible=false;vd_M.DimTol=false;vd_M.DimTextAlignToView=false;vd_M.DimTextAlignToViewSize=0;vd_M.EnableExtLineFixedLength=false;vd_M.UsingDefaultTextPosition=true;vd_M.ArrowBlock2=undefined;vd_M.Oblique=0;vd_M.DefPoint1=DefPoint1;vd_M.DefPoint2=DefPoint2;vd_M.LinePosition=LinePosition;vd_M.ScaleFactor=ScaleFactor;vd_M.PostString=PostString;vd_M.dimText=vd_ro;vd_M.TextHorRotation=vd_jQ;vd_M.TextColor=vd_mE;vd_M.ExtLineColor=vd_lQ;vd_M.DecimalPrecision=vd_df.precision;vd_M.LinearScaleFactor=LinearScaleFactor;vd_M.DimLunit=vd_df.type;vd_M.DimZin=vd_df.vd_bv;vd_M.DimLineColor=vd_kH;vd_M.TextHeight=vd_il;vd_M.HorizontalRotation=HorizontalRotation;vd_M.Rotation=rotation;vd_M.ArrowSize=vd_wZ();vd_M.ExtLineDist1=ExtLineDist1();vd_M.ExtLineDist2=ExtLineDist2();vd_M.TextDist=TextDist();var block=vdcanvas.FindBlock(vd_jS);if(block)vd_M.ArrowBlock='h_'+block.HandleId.toString();var vd_ol=vdcanvas.FindTextStyle(vd_mC);if(vd_ol)vd_M.TextStyle='h_'+vd_ol.HandleId.toString();if(entities)vdcanvas.vd_by(entities,vd_M);else vdcanvas.vd_by(vdcanvas.GetActiveLayout().Entities,vd_M);return vd_M;};function vd_MY(dim){return(dim.VDSDIMFLAG&&(dim.dimType==vdConst.vd_ps||dim.dimType==vdConst.vd_kj)&&((dim.DimLunit!=vdConst.vd_oI&&dim.DimLunit!=vdConst.vd_rY)||dim.FractionalType==2)&&dim.ExtLineVisible&& !dim.LineIsInvisible&& !dim.DimTol&& !dim.DimTextAlignToView&& !dim.DimTextAlignToViewSize&& !dim.EnableExtLineFixedLength&&dim.UsingDefaultTextPosition&&((dim.ArrowBlock2==dim.ArrowBlock)|| !dim.ArrowBlock2)&& !dim.Oblique);};this.vd_HN=function(dim,vdcanvas){if(!dim.VDSDIMFLAG|| !(dim.VDSDIMFLAG&64))return false;if((dim.VDSDIMFLAG&64))dim.VDSDIMFLAG^=64;if(!vd_MY(dim))return false;var vd_t=vdcanvas.GetDocument();vd_iQ=dim.dimType;DefPoint1=dim.DefPoint1;DefPoint2=dim.DefPoint2;LinePosition=dim.LinePosition;ScaleFactor=dim.ScaleFactor;PostString=dim.PostString;vd_ro=dim.dimText;vd_jQ=dim.TextHorRotation;vd_mE=dim.TextColor;vd_lQ=dim.ExtLineColor;vd_df.precision=dim.DecimalPrecision;LinearScaleFactor=dim.LinearScaleFactor;vd_df.type=dim.DimLunit;vd_df.vd_bv=dim.DimZin;vd_kH=dim.DimLineColor;vd_il=dim.TextHeight;HorizontalRotation=dim.HorizontalRotation;rotation=dim.Rotation;vd_sO=dim.ArrowSize;vd_rz=dim.ExtLineDist1;vd_sP=dim.ExtLineDist2;vd_rW=dim.TextDist;var block=vdcanvas.GetDictItem(vd_t.Blocks,dim.ArrowBlock);vd_jS="";if(block)vd_jS=block.Name;var vd_ol=vdcanvas.GetDictItem(vd_t.TextStyles,dim.TextStyle);vd_mC="";if(vd_ol)vd_mC=vd_ol.Name;var ents=vd_DH(vdcanvas,vd_t);if(ents)dim.Explode.Items=ents;return true;};this.vd_FO=function(mat,dim,vdcanvas){if(dim.DefPoint1)dim.DefPoint1=vdgeo.matrixtransform(mat,dim.DefPoint1);if(dim.DefPoint2)dim.DefPoint2=vdgeo.matrixtransform(mat,dim.DefPoint2);if(dim.DefPoint3)dim.DefPoint3=vdgeo.matrixtransform(mat,dim.DefPoint3);if(dim.DefPoint4)dim.DefPoint4=vdgeo.matrixtransform(mat,dim.DefPoint4);if(dim.TextPosition)dim.TextPosition=vdgeo.matrixtransform(mat,dim.TextPosition);if(!dim.ExtrusionVector)dim.ExtrusionVector=[0,0,1];dim.ExtrusionVector=vdgeo.vd_id(mat,dim.ExtrusionVector[0],dim.ExtrusionVector[1],dim.ExtrusionVector[2],true);if(dim.LinePosition)dim.LinePosition=vdgeo.matrixtransform(mat,dim.LinePosition);if(dim.ScaleFactor)dim.ScaleFactor=dim.ScaleFactor*vd_q.vd_qO(mat);else dim.ScaleFactor=1.0;if(!dim.Rotation)dim.Rotation=0.0;var vd_eV=vdgeo.vd_ok(mat);if(vdgeo.vd_lN(mat))dim.Rotation=vd_eV-dim.Rotation;else dim.Rotation=vd_eV+dim.Rotation;dim.Rotation=vdgeo.FixAngle(dim.Rotation);dim.VDSDIMFLAG|=32;dim.VDSDIMFLAG|=64;if(vd_U.vd_HN(dim,vdcanvas)){vd_q.vd_fw(mat,dim,vdcanvas);}else{vd_q.vd_Iz(mat,dim,vdcanvas);}};return this;};function vdraw(){var vd_U=this;var vd_qw=1200;var vd_mV=5;var vd_tb=150;var vd_GP=250;var vd_c=null;var vd_dA=new vd_PC();var vd_Fg=0;var vd_DF=1.2;var vd_ei=0;var vd_aw=null;var vd_uQ=null;var ctx=null;var vd_fB=null;var vd_iW=null;var Action=new vd_Jt(vd_U);var vd_bg=null;var vd_te=null;var vd_aL=true;var vd_xx=false;var vd_Gv=(/Firefox/i.test(navigator.userAgent))?"DOMMouseScroll":"mousewheel";var vd_ts=new vd_OH(vd_U);var vd_ay=new vd_Lp(vd_U);var vd_td=false;var vd_vX=false;var vd_yz=false;var vd_eS=[];var vd_ea=true;var vd_so=0;var vd_AI=0;var vd_ob=null;var vd_cU=null;var vd_wl=true;var vd_KE=new vd_PJ(vd_U);var vd_FE=false;this.vd_es=new vd_Rb(vd_U);this.vd_fO=true;this.vd_aK=new vd_LT(vd_U);var vd_nR=100;this.canvas=null;this.PickSize=8;this.IgnoreLockLayers=false;this.scriptCommand=new vd_Bd(this);this.ApplyDrawEdges=true;this.DrawOverallEntities=[];this.MessagesDictionary={SELECT_ENTITIES:'Select entities',SPECIFY_REFERENCE_POINT:'Specify reference point',SPECIFY_START_POINT:'Specify start point',SPECIFY_SECOND_POINT:'Specify second point',SPECIFY_END_POINT:'Specify end point',SPECIFY_NEXT_POINT:'Specify next point',SPECIFY_CENTER_POINT:'Specify center point',SPECIFY_RADIUS:'Specify radius',SPECIFY_FIRST_CORNER:'Specify first corner',SPECIFY_OTHER_CORNER:'Specify other corner',SPECIFY_INSERTION_POINT:'Specify insertion point',SPECIFY_SCALE:'Specify scale',SPECIFY_ROTATION:'Specify rotation',vd_HT:'First Axis End Point',vd_Hw:'Second Axis Distance:',PROGRESS_DOWNLOAD:'Download drawing...',PROGRESS_READ_DRAWING:'Read drawing...'};Object.defineProperty(vd_U,'HideActionOnMouseOut',{get:function(){return vd_FE;},set:function(newValue){vd_FE=newValue;}});Object.defineProperty(vd_U,'ActionScaleMode',{get:function(){return vd_Fg;},set:function(newValue){vd_Fg=newValue;}});Object.defineProperty(vd_U,'MouseWheelZoomScale',{get:function(){return vd_DF;},set:function(newValue){vd_DF=newValue;}});Object.defineProperty(vd_U,'GroupsManager',{get:function(){if(vd_bg==null)return null;return vd_bg.vd_Et;}});Object.defineProperty(vd_U,'Notes',{get:function(){var vd_t=vd_U.GetDocument();if(!vd_t)return null;return vd_t.vd_FW;}});Object.defineProperty(vd_U,'GripManager',{get:function(){return vd_KE;}});Object.defineProperty(vd_U,'MaxImageSize',{get:function(){return vdConst.MaxImageSize;},set:function(newValue){vdConst.MaxImageSize=newValue;}});this.SetImageInterpolationMode=function(mode){vd_c.vd_H.vd_iH=mode;};this.GetImageInterpolationMode=function(){return vd_c.vd_H.vd_iH;};this.SetEnableSelection=function(bval){vd_c.vd_bJ=bval;};this.GetEnableSelection=function(){return vd_c.vd_bJ;};this.SetGrayScale=function(vd_Lw){vd_c.vd_nb=vd_Lw;};this.GetGrayScale=function(){return vd_c.vd_nb;};this.GetDefaultTimeOutMilliseconds=function(){return vd_qw;};this.SetDefaultTimeOutMilliseconds=function(timeout){vd_qw=timeout;};this.Fig_codeToString=function(code){switch(code){case vdConst.vdLine_code:return "vdLine";case vdConst.vdPolyline_code:return "vdPolyline";case vdConst.vdText_code:return "vdText";case vdConst.vdRect_code:return "vdRect";case vdConst.vdCircle_code:return "vdCircle";case vdConst.vdEllipse_code:return "vdEllipse";case vdConst.vdArc_code:return "vdArc";case vdConst.vdImage_code:return "vdImage";case vdConst.vdInsert_code:return "vdInsert";case vdConst.vd3DFace_code:return "vd3DFace";case vdConst.vdPolyface_code:return "vdPolyface";case vdConst.vdAttrib_code:return "vdAttrib";case vdConst.vdAttribDef_code:return "vdAttribDef";case vdConst.vdInfinityLine_code:return "vdInfinityLine";case vdConst.vdPoint_code:return "vdPoint";case vdConst.vdPointCloud_code:return "vdPointCloud";case vdConst.vdViewport_code:return "vdViewport";case vdConst.vdPolyhatch_code:return "vdPolyhatch";case vdConst.vdDimension_code:return "vdDimension";case vdConst.vdMText_code:return "vdMText";case vdConst.vdMultiline_code:return "vdMultiline";case vdConst.vdGroundSurface_code:return "vdGroundSurface";case vdConst.vdLeader_code:return "vdLeader";case vdConst.vd_Rz:return "vd_JO";default:{return "vdUnknown";}}};function vd_AH(fig,render){if(fig.ps===undefined||fig.ps.vd_Fu===true)return undefined;if(fig.ps.pw===0.0)return render.vd_bf(0);if(fig.ps.vd_qk===false){var v=vdgeo.newpoint(0,0,0);vdgeo.vd_lv(render.vd_bE(),0,fig.ps.pw,0,v,false);var len=vdgeo.vd_im(v);return render.vd_bf(len/(render.GetPixelSize()*render.vd_jW));}else return render.vd_bf((fig.ps.pw/100.0)*96/vdgeo.INCH_MM);};function vd_QD(fig,render){if(fig.ps!==undefined){if(fig.ps.vd_cw===0)return render.vd_ao(fig.ps.color);else if(fig.ps.vd_cw===2)return render.vd_ao(render.vd_iN());else if(fig.ps.vd_cw===3)return render.vd_ao(render.vd_kD());}return undefined;};function vd_QA(fig,render){if(!fig.ps||fig.ps.vd_cw===1)return 0;else return render.vd_gb(fig.ps.MaterialMatrix);};function vd_RY(fig,render){if(!fig.ps||fig.ps.vd_cw===1)return 0;else return render.vd_go(fig.ps.MaterialImage);};function vd_RG(fig,render){if(!fig.ps||fig.ps.vd_wN)return undefined;return render.vd_AK(fig.ps.lt);};function vd_Rf(fig,render){if(fig.ps)return render.vd_zI(fig.ps.ltscale);return 1.0;};this.UpdateLayout=function(layout,vd_Hm){if(!layout)layout=vd_U.GetActiveLayout();if(!layout)return;layout.BoundingBox=undefined;if(vd_U.vd_uA()===layout&&vd_U.vd_aK.vd_nQ)vd_U.vd_aK.vd_nQ();if(!layout.Entities|| !vd_Hm)return;for(var k=0;k<layout.Entities.Items.length;k++){vd_U.UpdateFig(vd_U.GetEntityItem(layout.Entities.Items[k]));}};this.UpdateFig=function(vd_av,vd_NS){var k=0;if(!vd_NS&&vd_av.LayerRef===undefined)return;vd_av.selected=undefined;vd_av.ps=undefined;vd_av.LayerRef=undefined;vd_av.LineTypeRef=undefined;vd_av.EcsMatrix=undefined;if(vd_av._t!==vdConst.vdViewport_code)vd_av.BoundingBox=undefined;vd_Q.update(vd_av);if(vd_av.SamplePoints!=undefined)vd_av.SamplePoints=undefined;if(vd_av.vd_ga!=undefined)vd_av.vd_ga=undefined;if(vd_av.vd_gd!=undefined)vd_av.vd_gd=undefined;if(vd_av.StyleRef!=undefined)vd_av.StyleRef=undefined;if(vd_av.vd_E!=undefined)vd_av.vd_E=undefined;if(vd_av.tb!=undefined){vd_av.tb=undefined;vd_av.DiplayString=undefined;vd_av.testlines=undefined;vd_av.uwidths=undefined;vd_av.owidths=undefined;}if(vd_av.pointSegments!=undefined)vd_av.pointSegments=undefined;if(vd_av.BlockRef!=undefined)vd_av.BlockRef=undefined;vd_av.Normals=undefined;vd_av.UVS=undefined;if(vd_av.ImageClipPts)vd_av.ImageClipPts=undefined;if(vd_av.ImageClipUVS)vd_av.ImageClipUVS=undefined;if(vd_av._t==vdConst.vdPolyhatch_code){if(vd_av.Curves){for(k=0;k<vd_av.Curves.Items.length;k++){vd_av.Curves.Items[k].UVS=undefined;}}}if(vd_av._t==vdConst.vdDimension_code)vd_av.VDSDIMFLAG|=64;if(vd_av.Attributes&&vd_av.Attributes.Items){for(k=0;k<vd_av.Attributes.Items.length;k++)vd_U.UpdateFig(vd_av.Attributes.Items[k]);}if(vd_av.Explode&&vd_av.Explode.Items){for(k=0;k<vd_av.Explode.Items.length;k++)vd_U.UpdateFig(vd_av.Explode.Items[k]);}};this.GetEntityItem=function(item){if(vd_bg==null)return null;return vd_bg.vd_KS(item);};this.GetEntityLength=function(entity){var vd_ba;var da;if(entity._t==vdConst.vdPolyline_code){var closed=entity.Flag===1;if(!entity.SPlineFlag||entity.SPlineFlag==vdConst.SplineFlagSTANDARD)vd_ba=entity.VertexList.Items;else if(entity.SamplePoints)vd_ba=entity.SamplePoints;else{if(entity.SPlineFlag==vdConst.SplineFlagFITTING)vd_ba=vdgeo.vd_un(vdgeo.CURVERESOLUTION,render.vd_dF(),entity.VertexList.Items,entity.Flag===1,entity.StartTangent,entity.EndTangent);else if(entity.SPlineFlag==vdConst.SplineFlagCONTROLPOINTS)vd_ba=vdgeo.vdgeo.vd_uP(vdgeo.CURVERESOLUTION,render.vd_dF(),entity.VertexList.Items,entity.Weights,entity.Knots,entity.Flag===1);else if(entity.SPlineFlag==vdConst.SplineFlagQUADRATIC)vd_ba=vdgeo.vd_xz(vdgeo.CURVERESOLUTION,render.vd_dF(),entity.VertexList.Items,entity.Flag===1);}return vdgeo.vd_DS(vd_ba,closed);}else if(entity._t==vdConst.vdLine_code){return vdgeo.Distance3D(entity.StartPoint,entity.EndPoint);}else if(entity._t==vdConst.vdRect_code){return Math.abs(2.0*entity.Width)+Math.abs(2.0*entity.Height);}else if(entity._t==vdConst.vdCircle_code){return Math.abs(vdgeo.PI*2.0*entity.Radius);}else if(entity._t==vdConst.vdArc_code){return Math.abs(vdgeo.FixAngle(entity.EndAngle-entity.StartAngle)*entity.Radius);}else if(entity._t==vdConst.vdEllipse_code){da=vdgeo.FixAngle(entity.EndAngle-entity.StartAngle);if(vdgeo.AreEqual(da,0,vdgeo.DefaultAngularEquality)||vdgeo.AreEqual(da,vdgeo.VD_TWOPI,vdgeo.DefaultAngularEquality)){var k=Math.Sqrt(1-Math.pow((entity.MinorLength/entity.MajorLength),2));k=Math.pow(k,2);var sum=0;var term=0;var above=0;var below=0;sum=1;term=1;above=1;below=2;for(var i=1;i<=100;i++){term*=above/below;sum-=Math.pow(k,i)*Math.pow(term,2)/above;above+=2;below+=2;}sum*=0.5*vdgeo.PI;return a*sum;}else{vd_ba=entity.SamplePoints;if(!vd_ba){if(entity.StartAngle==undefined)entity.StartAngle=0.0;if(entity.EndAngle==undefined)entity.EndAngle=0.0;da=vdgeo.FixAngle(entity.EndAngle)-vdgeo.FixAngle(entity.StartAngle);var vd_eX=vdgeo.vd_va(vdgeo.CURVERESOLUTION,render.vd_dF(),entity.MajorLength,da);vd_ba=vdgeo.vd_tR(vd_eX,entity.MajorLength,entity.MinorLength,entity.StartAngle,entity.EndAngle);}return vdgeo.vd_DS(vd_ba,false);}}else return 0.0;};this.MeasureCurve=function(entity,length){var vd_ba;var vd_gz;var da;if(entity._t==vdConst.vdPolyline_code){var closed=entity.Flag===1;if(!entity.SPlineFlag||entity.SPlineFlag==vdConst.SplineFlagSTANDARD)vd_ba=entity.VertexList.Items;else if(entity.SamplePoints)vd_ba=entity.SamplePoints;else{if(entity.SPlineFlag==vdConst.SplineFlagFITTING)vd_ba=vdgeo.vd_un(vdgeo.CURVERESOLUTION,render.vd_dF(),entity.VertexList.Items,entity.Flag===1,entity.StartTangent,entity.EndTangent);else if(entity.SPlineFlag==vdConst.SplineFlagCONTROLPOINTS)vd_ba=vdgeo.vdgeo.vd_uP(vdgeo.CURVERESOLUTION,render.vd_dF(),entity.VertexList.Items,entity.Weights,entity.Knots,entity.Flag===1);else if(entity.SPlineFlag==vdConst.SplineFlagQUADRATIC)vd_ba=vdgeo.vd_xz(vdgeo.CURVERESOLUTION,render.vd_dF(),entity.VertexList.Items,entity.Flag===1);}return vdgeo.vd_mL(vd_ba,length,closed);}else if(entity._t==vdConst.vdLine_code){return vdgeo.vd_mL([entity.StartPoint,entity.EndPoint],length,false);}else if(entity._t==vdConst.vdRect_code){var vd_EW=vdgeo.pointPolar(entity.InsertionPoint,entity.Rotation,entity.Width);return vdgeo.vd_mL([entity.InsertionPoint,vd_EW,vdgeo.pointPolar(vd_EW,entity.Rotation+vdgeo.HALF_PI,entity.Height),vdgeo.pointPolar(entity.InsertionPoint,entity.Rotation+vdgeo.HALF_PI,entity.Height)],length,true);}else if(entity._t==vdConst.vdCircle_code){vd_gz=vdgeo.Arc2Bulge(entity.Radius,vdgeo.PI);return vdgeo.vd_mL([vdgeo.pointPolar(entity.Center,0.0,entity.Radius).concat(vd_gz),vdgeo.pointPolar(entity.Center,vdgeo.PI,entity.Radius).concat(vd_gz)],length,true);}else if(entity._t==vdConst.vdArc_code){vd_gz=vdgeo.Arc2Bulge(entity.Radius,vdgeo.FixAngle(entity.EndAngle-entity.StartAngle));return vdgeo.vd_mL([vdgeo.pointPolar(entity.Center,entity.StartAngle,entity.Radius).concat(vd_gz),vdgeo.pointPolar(entity.Center,entity.EndAngle,entity.Radius).concat(vd_gz)],length,false);}else if(entity._t==vdConst.vdEllipse_code){da=vdgeo.FixAngle(entity.EndAngle-entity.StartAngle);vd_ba=entity.SamplePoints;if(!vd_ba){if(entity.StartAngle==undefined)entity.StartAngle=0.0;if(entity.EndAngle==undefined)entity.EndAngle=0.0;da=vdgeo.FixAngle(entity.EndAngle)-vdgeo.FixAngle(entity.StartAngle);var vd_eX=vdgeo.vd_va(vdgeo.CURVERESOLUTION,render.GetPixelSize(),entity.MajorLength,da);vd_ba=vdgeo.vd_tR(vd_eX,entity.MajorLength,entity.MinorLength,entity.StartAngle,entity.EndAngle);}if(!entity.EcsMatrix){var vd_de=vdgeo.newpoint(0,0,1);var vd_A=vdgeo.newpoint(0,0,0);if(entity.ExtrusionVector!=undefined)vd_de=vdgeo.newpoint(entity.ExtrusionVector[X],entity.ExtrusionVector[Y],entity.ExtrusionVector[Z]);if(entity.Center!=undefined)vd_A=vdgeo.newpoint(entity.Center[X],entity.Center[Y],entity.Center[Z]);entity.EcsMatrix=vdgeo.vd_e();if(entity.MajorAngle!=undefined)vdgeo.vd_bw(entity.EcsMatrix,entity.MajorAngle);vdgeo.vd_dl(entity.EcsMatrix,vd_de);vdgeo.vd_x(entity.EcsMatrix,vd_A[X],vd_A[Y],vd_A[Z]);}var ret=vdgeo.vd_mL(vd_ba,length,false);return vdgeo.vd_fN(entity.EcsMatrix,ret);}else return[];};this.GetEntityArea=function(entity){var render=vd_c;var vd_ba;var da;if(entity._t==vdConst.vdPolyline_code){if(!entity.SPlineFlag||entity.SPlineFlag==vdConst.SplineFlagSTANDARD)return Math.abs(vdgeo.vd_IM(entity.VertexList.Items));if(entity.SamplePoints)vd_ba=entity.SamplePoints;else{if(entity.SPlineFlag==vdConst.SplineFlagFITTING)vd_ba=vdgeo.vd_un(vdgeo.CURVERESOLUTION,render.vd_dF(),entity.VertexList.Items,entity.Flag===1,entity.StartTangent,entity.EndTangent);else if(entity.SPlineFlag==vdConst.SplineFlagCONTROLPOINTS)vd_ba=vdgeo.vdgeo.vd_uP(vdgeo.CURVERESOLUTION,render.vd_dF(),entity.VertexList.Items,entity.Weights,entity.Knots,entity.Flag===1);else if(entity.SPlineFlag==vdConst.SplineFlagQUADRATIC)vd_ba=vdgeo.vd_xz(vdgeo.CURVERESOLUTION,render.vd_dF(),entity.VertexList.Items,entity.Flag===1);}}else if(entity._t==vdConst.vdRect_code){return Math.abs(entity.Width*entity.Height);}else if(entity._t==vdConst.vdCircle_code){return Math.abs(vdgeo.PI*entity.Radius*entity.Radius);}else if(entity._t==vdConst.vdEllipse_code){if(entity.StartAngle==undefined)entity.StartAngle=0.0;if(entity.EndAngle==undefined)entity.EndAngle=0.0;da=vdgeo.FixAngle(entity.EndAngle-entity.StartAngle);if(vdgeo.AreEqual(da,0,vdgeo.DefaultAngularEquality)||vdgeo.AreEqual(da,vdgeo.VD_TWOPI,vdgeo.DefaultAngularEquality)){return entity.MajorLength*entity.MinorLength*vdgeo.PI;}else{vd_ba=entity.SamplePoints;if(!vd_ba){var vd_eX=vdgeo.vd_va(vdgeo.CURVERESOLUTION,render.vd_dF(),entity.MajorLength,da);vd_ba=vdgeo.vd_tR(vd_eX,entity.MajorLength,entity.MinorLength,entity.StartAngle,entity.EndAngle);}}}else if(entity._t==vdConst.vdArc_code){return Math.abs((vdgeo.FixAngle(entity.EndAngle-entity.StartAngle)/2.0)*entity.Radius*entity.Radius);}else return-1;return Math.abs(vdgeo.GetPointsArea(vd_ba));};this.FilterEntities=function(vd_Lz,vd_wV){var i;var ret=[];var vd_t=vd_U.GetDocument();var args={vdraw:vd_U,document:vd_t,owner:undefined,entity:undefined,customdata:vd_Lz,cancel:false};if(!vd_wV)return ret;var lay0=vd_U.FindLayer("0");var vd_Is=undefined;if(lay0)vd_Is='h_'+lay0.HandleId.toString();function vd_xs(owner){var i;var ent;if(!owner)return;if(owner.Deleted)return;if(!owner.Entities)return;if(!owner.Entities.Items)return;args.owner=owner;args.entity=undefined;args.cancel=false;vd_wV(args);if(args.cancel)return;for(i=0;i<owner.Entities.Items.length;i++){ent=vd_U.GetDictItem(owner.Entities,owner.Entities.Items[i]);if(!ent)continue;if(ent.Deleted)continue;args.entity=ent;args.cancel=false;if(!ent.Layer)ent.Layer=vd_Is;vd_wV(args);if(!args.cancel)ret.push(ent);}};vd_xs(vd_t.Model);if(vd_t.LayOuts){for(i=0;i<vd_t.LayOuts.Items.length;i++)vd_xs(vd_t.LayOuts.Items[i]);}if(vd_t.Blocks){for(i=0;i<vd_t.Blocks.Items.length;i++)vd_xs(vd_U.GetDictItem(vd_t.Blocks,vd_t.Blocks.Items[i]));}return ret;};this.GetDictItem=function(vd_aA,vd_cV){if(vd_bg==null)return null;return vd_bg.vd_hs(vd_aA,vd_cV);};this.ChangeOrder=function(entity,vd_GO,vd_aA){if(!entity|| !entity.HandleId)return false;if(!vd_aA)vd_aA=vd_U.GetActiveLayout().Entities;if(!vd_aA|| !vd_aA.Items||vd_aA.Items.length==0)return false;var vd_cV='h_'+entity.HandleId.toString();var pos=vd_aA.Items.indexOf(vd_cV);if(pos<0)return false;vd_aA.Items.splice(pos,1);if(vd_GO)vd_aA.Items.splice(0,0,vd_cV);else vd_aA.Items.push(vd_cV);return true;};function vd_Ko(fig,vd_t,render){if(fig.ps!==undefined)return fig.ps;if(!fig.PenColor)fig.PenColor={ColorFlag:192};if(fig.LayerRef==undefined){fig.LayerRef=vd_U.GetDictItem(vd_t.Layers,fig.Layer);if(!fig.LayerRef)fig.LayerRef=vd_U.FindLayer("0");}if(fig.LineTypeRef==undefined){fig.LineTypeRef=vd_U.GetDictItem(vd_t.LineTypes,fig.LineType);if(!fig.LineTypeRef)fig.LineTypeRef=vd_U.FindLineType("BYLAYER");}if(render.vd_ds()!=vdConst.vd_pX)return null;fig.ps={};fig.ps.vd_qk=false;fig.ps.pw=0;fig.ps.vd_Fu=false;fig.ps.lt=null;fig.ps.vd_wN=false;fig.ps.ltscale=1;fig.ps.color=[255,255,255,255];fig.ps.MaterialImage=null;fig.ps.MaterialMatrix=null;fig.ps.vd_cw=0;fig.ps.vd_V=undefined;var afig=render.vd_pC();var lay=fig.LayerRef;var lt=fig.LineTypeRef;var alay=null;if(afig!=null){alay=vd_U.GetDictItem(vd_t.Layers,afig.Layer);if(!alay)alay=vd_U.FindLayer("0");}if(fig.LineTypeScale==undefined)fig.LineTypeScale=1.0;if(fig.PenWidth>0.0){fig.ps.vd_qk=false;fig.ps.pw=fig.PenWidth;}else{var lw=fig.LineWeight;if(lw==undefined)lw=vdConst.LW_BYLAYER;if(vd_t.LineWeightDisplay==false||lw===0){fig.ps.vd_qk=false;fig.ps.pw=0.0;}else{if(lw===vdConst.LW_BYLAYER&&lay!=null){if(lay.Name==='0'&&afig!=null&&alay!=null){if(!vd_t.BlockStdLayerOper|| !(vd_t.BlockStdLayerOper&vdConst.BlockStdLayerOper_BlockLineWeight))lw=alay.LineWeight;else lw=vdConst.LW_BYBLOCK;}else{lw=lay.LineWeight;}}if(lw==undefined)lw=vdConst.LW_BYLAYER;if(lw==vdConst.LW_DOCUMENTDEFAULT)lw=vd_t.LineWeight;if(lw!=vdConst.LW_BYBLOCK){if(lw<=0){fig.ps.vd_qk=false;fig.ps.pw=0.0;}else{fig.ps.vd_qk=true;fig.ps.pw=lw;}}else{fig.ps.vd_Fu=true;}}}if(lt){if(lay&&lt.Name=='BYLAYER'){var vd_mt=null;if(afig!=null&&afig._t===vdConst.vdInsert_code&&lay.Name==='0'){if((!vd_t.BlockStdLayerOper|| !(vd_t.BlockStdLayerOper&vdConst.BlockStdLayerOper_BlockLineType))&&alay)vd_mt=vd_U.GetDictItem(vd_t.LineTypes,alay.LineType);}else{vd_mt=vd_U.GetDictItem(vd_t.LineTypes,lay.LineType);}if(vd_mt)fig.ps.lt=vd_mt;if(!vd_mt||vd_mt.Name=='BYLAYER'||vd_mt.Name=='BYBLOCK')fig.ps.vd_wN=true;fig.ps.ltscale=fig.LineTypeScale*vd_t.LineTypeScale;}else if(lt.Name!='BYBLOCK'){fig.ps.lt=lt;fig.ps.ltscale=fig.LineTypeScale*vd_t.LineTypeScale;}else{fig.ps.vd_wN=true;}}if(fig.PenColor.SystemColor!=undefined){fig.ps.color=fig.PenColor.SystemColor;fig.ps.MaterialImage=vd_U.GetDictItem(vd_t.Images,fig.PenColor.MaterialImage);if(fig.ps.MaterialImage!=null)fig.ps.MaterialMatrix=fig.PenColor.MaterialMatrix;}else if(fig.PenColor.ColorFlag===vdConst.COLOR_BYLAYER){if(afig!=null&&afig._t===vdConst.vdInsert_code&&lay!=null&&lay.Name==='0'){if(!vd_t.BlockStdLayerOper|| !(vd_t.BlockStdLayerOper&vdConst.BlockStdLayerOper_BlockColor))lay=alay;else{fig.ps.vd_cw=1;}}if(fig.ps.vd_cw!=1){if(lay&&lay.PenColor.ColorIndex!=undefined){if(lay.PenColor.ColorIndex==6)fig.ps.vd_cw=2;else fig.ps.color=render.vd_fR(lay.PenColor.ColorIndex);fig.ps.MaterialImage=render.palette.Items[lay.PenColor.ColorIndex].MaterialImageRef;if(fig.ps.MaterialImage!=null)fig.ps.MaterialMatrix=render.palette.Items[lay.PenColor.ColorIndex].MaterialMatrix;}else if(lay&&lay.PenColor.SystemColor!=undefined){fig.ps.color=lay.PenColor.SystemColor;fig.ps.MaterialImage=vd_U.GetDictItem(vd_t.Images,lay.PenColor.MaterialImage);if(fig.ps.MaterialImage!=null)fig.ps.MaterialMatrix=lay.PenColor.MaterialMatrix;}}}else if(fig.PenColor.ColorIndex!=undefined){if(fig.PenColor.ColorIndex==6)fig.ps.vd_cw=2;else fig.ps.color=render.vd_fR(fig.PenColor.ColorIndex);fig.ps.MaterialImage=render.palette.Items[fig.PenColor.ColorIndex].MaterialImageRef;if(fig.ps.MaterialImage!=null)fig.ps.MaterialMatrix=render.palette.Items[fig.PenColor.ColorIndex].MaterialMatrix;}else if(fig.PenColor.ColorFlag===196)fig.ps.vd_cw=3;else if(fig.PenColor.ColorFlag===197)fig.ps.vd_cw=2;else{fig.ps.vd_cw=1;}if(fig.TransparencyMethod===vdConst.TransparencyMethod_ByLayer&&lay!=null){var vd_rT=undefined;if(lay.PenColor.ColorIndex!=undefined){vd_rT=render.vd_fR(lay.PenColor.ColorIndex);}else if(lay.PenColor.SystemColor!=undefined){vd_rT=lay.PenColor.SystemColor;}if(vd_rT!=undefined)fig.ps.color[3]=vd_rT[3];}else if(fig.TransparencyMethod===vdConst.TransparencyMethod_ByBlock)fig.ps.color[3]=undefined;if(fig.HatchProperties!=undefined){fig.ps.vd_V={vd_ac:undefined,color:undefined,vd_ks:0,vd_cw:0,vd_cR:255,angle:0,scale:1,pattern:null,origin:vdgeo.newpoint(0,0,0),IsDpi:false,vd_pZ:false,vd_ec:0,vd_hX:undefined,gradientAngle:0};if(fig.HatchProperties.HatchPatternRef!=undefined)fig.ps.vd_V.pattern=fig.HatchProperties.HatchPatternRef;else if(fig.HatchProperties.HatchPattern!=undefined)fig.ps.vd_V.pattern=vd_U.GetDictItem(vd_t.HatchPatterns,fig.HatchProperties.HatchPattern);if(fig.ps.vd_V.pattern!=null){if(fig.ps.vd_V.pattern==null||fig.ps.vd_V.pattern.PatternLines==undefined||fig.ps.vd_V.pattern.PatternLines.Items.length==0||(fig.HatchProperties.IsDpi!=undefined&&fig.HatchProperties.IsDpi!=true&&fig.ps.vd_V.pattern.PatternLines.Items.length==1&&fig.ps.vd_V.pattern.PatternLines.Items[0].Dashes!=undefined&&fig.ps.vd_V.pattern.PatternLines.Items[0].Dashes.Items.length==0))fig.ps.vd_V.pattern=null;if(fig.ps.vd_V.pattern!=null&&fig.HatchProperties.IsDpi!=undefined&&fig.HatchProperties.IsDpi!=true&&fig.ps.vd_V.pattern.PatternLines.Items[0].Dashes!=undefined&&fig.ps.vd_V.pattern.PatternLines.Items[0].Dashes.Items.length==1&&fig.ps.vd_V.pattern.PatternLines.Items[0].Dashes.Items[0]<0.0)fig.ps.vd_V.vd_pZ=true;if(fig.HatchProperties.IsDpi!=undefined)fig.ps.vd_V.IsDpi=fig.HatchProperties.IsDpi;if(fig.HatchProperties.HatchAngle!=undefined)fig.ps.vd_V.angle=fig.HatchProperties.HatchAngle;if(fig.HatchProperties.HatchScale!=undefined)fig.ps.vd_V.scale=fig.HatchProperties.HatchScale;if(fig.HatchProperties.HatchOrigin!=undefined)fig.ps.vd_V.origin=fig.HatchProperties.HatchOrigin;fig.ps.vd_V.vd_ac=undefined;if(fig.HatchProperties.FillBkColor!=undefined){if(fig.HatchProperties.FillBkColor.SystemColor!=undefined)fig.ps.vd_V.vd_ac=fig.HatchProperties.FillBkColor.SystemColor;else if(fig.HatchProperties.FillBkColor.ColorIndex!=undefined){fig.ps.vd_V.vd_ac=render.vd_fR(fig.HatchProperties.FillBkColor.ColorIndex);if(fig.HatchProperties.FillBkColor.ColorIndex==6)fig.ps.vd_V.vd_ks=2;}else if(fig.HatchProperties.FillBkColor.ColorFlag==196)fig.ps.vd_V.vd_ks=3;else if(fig.HatchProperties.FillBkColor.ColorFlag==197)fig.ps.vd_V.vd_ks=2;}}if(fig.HatchProperties.FillColor!=undefined){if(fig.HatchProperties.FillColor.ColorIndex!=undefined){fig.ps.vd_V.color=render.vd_fR(fig.HatchProperties.FillColor.ColorIndex);if(fig.HatchProperties.FillColor.ColorIndex==6)fig.ps.vd_V.vd_cw=2;}else if(fig.HatchProperties.FillColor.SystemColor!=undefined){fig.ps.vd_V.color=fig.HatchProperties.FillColor.SystemColor;var vd_HU=vd_U.GetDictItem(vd_t.Images,fig.HatchProperties.FillColor.MaterialImage);if(vd_HU!=null){fig.ps.MaterialImage=vd_HU;if(fig.ps.MaterialImage!=null)fig.ps.MaterialMatrix=fig.HatchProperties.FillColor.MaterialMatrix;}}else if(fig.HatchProperties.FillColor.ColorFlag==196)fig.ps.vd_V.vd_cw=3;else if(fig.HatchProperties.FillColor.ColorFlag==197)fig.ps.vd_V.vd_cw=2;}if(fig.HatchProperties.Solid2dTransparency!=undefined)fig.ps.vd_V.vd_cR=fig.HatchProperties.Solid2dTransparency;if(fig.HatchProperties.gradientTypeProp!=undefined)fig.ps.vd_V.vd_ec=fig.HatchProperties.gradientTypeProp;if(fig.HatchProperties.gradientColor2!=undefined)fig.ps.vd_V.vd_hX=fig.HatchProperties.gradientColor2;if(fig.HatchProperties.gradientAngle!=undefined)fig.ps.vd_V.gradientAngle=fig.HatchProperties.gradientAngle;if(fig.ps.vd_V.vd_pZ)fig.ps.vd_V.vd_cR=0;}};function vd_gR(render,pts,thickness,vd_r,vd_t){if(vd_t&&vd_t.ShowHatches===false)return;if(pts.length>2&& !vd_r.UVS){var vd_eC=render.vd_gb(0);if(vd_eC!=null){vd_r.UVS=[];vd_r.UVS.length=pts.length;for(var i=0;i<pts.length;i++){vd_r.UVS[i]=vdgeo.newpoint(0,0,0);vdgeo.vd_cB(vd_eC,pts[i],vd_r.UVS[i]);vd_r.UVS[i][Z]=1.0;}}render.vd_gb(vd_eC);}render.vd_gR(pts,null,vd_r.UVS);if(thickness&&thickness!=0.0){var vd_kF=vdgeo.vd_e();vdgeo.vd_x(vd_kF,0,0,thickness);render.vd_bh(vd_kF);render.vd_gR(pts,null,vd_r.UVS);render.vd_bC();}};this.vd_uA=function(){var vd_t=vd_J();if(vd_t==null)return;return vd_t.Model;};function vd_Ii(vd_r,render,vd_t){if(vd_U.GetActiveLayout()===vd_t.Model)return;if(vd_r.VPBOX)vd_r.BoundingBox=vd_r.VPBOX;if(vd_r.BoundingBox==undefined)return;vd_r.VPBOX=vd_r.BoundingBox;if(render.vd_ds()==vdConst.vd_fo){render.vd_gQ.vd_hc(vd_r.BoundingBox);return;}var bmin=vdgeo.newpoint(vd_r.BoundingBox[0],vd_r.BoundingBox[1],vd_r.BoundingBox[2]);var bmax=vdgeo.newpoint(vd_r.BoundingBox[3],vd_r.BoundingBox[4],vd_r.BoundingBox[5]);var zdir=vdgeo.vd_ha(render.vd_bE());var xdir=vdgeo.vd_jH(render.vd_bE());if(!render.vd_ak&&vdgeo.AreEqual(zdir[X],0,vdgeo.DefaultVectorEquality)&&vdgeo.AreEqual(zdir[Y],0,vdgeo.DefaultVectorEquality)&&vdgeo.AreEqual(zdir[Z],1,vdgeo.DefaultVectorEquality)&&vdgeo.AreEqual(xdir[X],1,vdgeo.DefaultVectorEquality)&&vdgeo.AreEqual(xdir[Y],0,vdgeo.DefaultVectorEquality)&&vdgeo.AreEqual(xdir[Z],0,vdgeo.DefaultVectorEquality)){bmin=vdgeo.matrixtransform(render.vd_bE(),bmin);bmax=vdgeo.matrixtransform(render.vd_bE(),bmax);var vd_vK=vdgeo.matrixtransform(render.vd_dm,bmin);var vd_vV=vdgeo.matrixtransform(render.vd_dm,bmax);var center=vdgeo.MidPoint(bmin,bmax);var bh=bmax[Y]-bmin[Y];if(bmin[X]<render.vd_bo.left)bmin[X]=render.vd_bo.left;if(bmax[X]>render.vd_bo.right)bmax[X]=render.vd_bo.right;if(bmin[Y]<render.vd_bo.bottom)bmin[Y]=render.vd_bo.bottom;if(bmax[Y]>render.vd_bo.top)bmax[Y]=render.vd_bo.top;var mpt=vdgeo.MidPoint(bmin,bmax);var bh2=bmax[Y]-bmin[Y];var vd_Z=(vd_r.ViewSize*bh2)/bh;var scale=vd_Z/bh2;var dx=(center[X]-mpt[X]);var dy=(center[Y]-mpt[Y]);var vd_wR=vdgeo.matrixtransform(render.vd_dm,vdgeo.newpoint(bmin[X],bmax[Y],0));var vd_B=vdgeo.newpoint(vd_r.ViewCenter[X]-dx*scale,vd_r.ViewCenter[Y]-dy*scale);var width=vdgeo.vd_u((bmax[X]-bmin[X])/render.GetPixelSize());var height=vdgeo.vd_u(bh2/render.GetPixelSize());if(vd_r.PerspectiveMod==1){vd_B=vd_r.ViewCenter;vd_wR=vdgeo.newpoint(vd_vK[X],vd_vV[Y],0);width=vd_vV[X]-vd_vK[X];height=vd_vK[Y]-vd_vV[Y];}var vd_Bc=vdgeo.vd_u(width);var vd_BN=vdgeo.vd_u(height);if(vd_Bc<=1)return;if(vd_BN<=1)return;vd_t.vd_ya=vd_r;var vd_dr=new vd_rf(vd_U,vdgeo.vd_u(vd_wR[X]),vdgeo.vd_u(vd_wR[Y]),vd_Bc,vd_BN,null);if(vd_r.PerspectiveMod==1)vd_dr.vd_xC(Math.max(0,vd_dr.vd_cc),Math.max(0,vd_dr.vd_eK),Math.min(render.clip[2],vd_dr.vd_cc+vd_dr.width-1),Math.min(render.clip[3],vd_dr.vd_eK+vd_dr.height-1));if(render.vd_ab())render.vd_nd();vd_dr.vd_H.vd_gl(render.vd_H.vd_qu(),render.vd_H.vd_az,render.vd_H.vd_bG,true);vd_dr.vd_sZ(render);vd_dr.vd_bJ=false;vd_dr.update(vd_Z,vd_B,vd_r.World2ViewMatrix,vd_oc(vd_t.Model),vd_r.FocalLength,vd_r.LensAngle,vd_r.PerspectiveMod==1,vd_r.RenderMode,vd_t.Model.Sections,vd_t.Lights);vd_dr.vd_hK(render.palette,render.vd_kD());vd_dr.clear(true);var vd_pO=vd_dr.vd_kv(vd_r.ShowHidenEdges);vd_ug(vd_t.Model.Entities,true,vd_dr,vd_t);if(vd_dr.vd_ab())vd_dr.vd_nd();vd_dr.vd_kv(vd_pO);vd_dr.vd_H.vd_gl(null);vd_dr=null;vd_U.vd_aK.vd_CO(render);vd_t.vd_ya=null;}var vd_ye=vd_U.GetDictItem(vd_t.Layers,vd_r.Layer);if(vd_ye==null||vd_ye.Frozen==undefined||vd_ye.Frozen==false)render.vd_cd([bmin,vdgeo.newpoint(bmin[X],bmax[Y],0),bmax,vdgeo.newpoint(bmax[X],bmin[Y],0)],true);};function vd_Jr(vd_r,render,vd_t){if((vd_r.Thickness!=undefined&&vd_r.Thickness!=0.0)||(vd_r.ps&&vd_r.ps.MaterialMatrix!=null)){if(vd_r.ExtrusionVector!=undefined&&vd_r.EcsMatrix==undefined){var vd_de=vdgeo.newpoint(vd_r.ExtrusionVector[X],vd_r.ExtrusionVector[Y],vd_r.ExtrusionVector[Z]);vd_r.EcsMatrix=vdgeo.vd_e();vdgeo.vd_dl(vd_r.EcsMatrix,vd_de);}if(vd_r.ps&&vd_r.ps.MaterialMatrix!=null&&vd_r.EcsMatrix==undefined)vd_r.EcsMatrix=vdgeo.vd_e();if(vd_r.SamplePoints==undefined){if(vd_r.EcsMatrix!=undefined)vd_r.SamplePoints=vdgeo.vd_fN(vdgeo.vd_aR(vd_r.EcsMatrix),[vd_r.StartPoint,vd_r.EndPoint]);else vd_r.SamplePoints=[vd_r.StartPoint,vd_r.EndPoint];}}if(vd_r.SamplePoints!=undefined){if(vd_r.EcsMatrix!=undefined)render.vd_bh(vd_r.EcsMatrix);render.vd_gD(vd_r.SamplePoints,vd_r.Thickness,false);if(vd_r.EcsMatrix!=undefined)render.vd_bC();}else{render.vd_cW(vd_r.StartPoint,vd_r.EndPoint);}};function vd_Ij(vd_r,render,vd_t){if(vd_r.VertexList==undefined)return;if(vd_r.ExtrusionVector!=undefined&&vd_r.EcsMatrix==undefined){var vd_de=vdgeo.newpoint(vd_r.ExtrusionVector[X],vd_r.ExtrusionVector[Y],vd_r.ExtrusionVector[Z]);vd_r.EcsMatrix=vdgeo.vd_e();vdgeo.vd_dl(vd_r.EcsMatrix,vd_de);}var i;if(vd_r.ps&&vd_r.ps.MaterialMatrix!=null&&vd_r.EcsMatrix==undefined)vd_r.EcsMatrix=vdgeo.vd_e();if(vd_r.SamplePoints==undefined){var vd_jZ=vd_r.VertexList.Items;var vd_dU=vd_r.Weights;var vd_bp=vd_r.Knots;if(vd_r.Weights==undefined)vd_dU==null;else vd_dU=vd_r.Weights.Items;if(vd_r.Knots==undefined)vd_bp==null;else vd_bp=vd_r.Knots.Items;if(vd_r.EcsMatrix!=undefined)vd_jZ=vdgeo.vd_st(vdgeo.vd_aR(vd_r.EcsMatrix),vd_r.VertexList.Items);else{vd_jZ=[];for(i=0;i<vd_r.VertexList.Items.length;i++)vd_jZ.push(vd_r.VertexList.Items[i]);}if(vd_r.SPlineFlag==vdConst.SplineFlagCONTROLPOINTS){vd_r.SamplePoints=vdgeo.vd_uP(vdgeo.CURVERESOLUTION,render.vd_dF(),vd_jZ,vd_dU,vd_bp,vd_r.Flag===1);}else if(vd_r.SPlineFlag==vdConst.SplineFlagQUADRATIC){vd_r.SamplePoints=vdgeo.vd_Jl(vdgeo.CURVERESOLUTION,render.vd_dF(),vd_jZ,vd_dU,vd_bp,vd_r.Flag===1);}else if(vd_r.SPlineFlag==vdConst.SplineFlagFITTING){vd_r.SamplePoints=vdgeo.vd_un(vdgeo.CURVERESOLUTION,render.vd_dF(),vd_jZ,vd_r.Flag===1,vd_r.StartTangent,vd_r.EndTangent);}else{vd_r.SamplePoints=vdgeo.vd_Oq(vd_jZ,vdgeo.CURVERESOLUTION,render.vd_dF(),vd_r.Flag===1);vd_r.vd_gd=0.0;var vd_Er=false;vd_r.vd_ga=undefined;if(vd_r.VertexList.Items.length>1&&vd_r.Widths&&vd_r.Widths.Items.length==vd_r.VertexList.Items.length*2){for(i=0;i<vd_r.VertexList.Items.length;i++){if(vd_r.VertexList.Items[i][B]){vd_Er=true;break;}}if(!vd_Er){vd_r.vd_gd=vd_r.Widths.Items[0];for(i=0;i<vd_r.Widths.Items.length;i++){if(!vdgeo.AreEqual(vd_r.Widths.Items[i],vd_r.vd_gd,0.0001)){vd_r.vd_gd=0.0;break;}}}if(vd_r.vd_gd!=0.0){vd_r.SamplePoints=vdgeo.vd_Ov(vd_r.SamplePoints,vdgeo.DefaultPointEquality);vd_r.vd_ga=vdgeo.vd_Kf(vd_r.SamplePoints,vd_r.Flag===1,vd_r.vd_gd);}}}}if(vd_r.EcsMatrix!=undefined)render.vd_bh(vd_r.EcsMatrix);var vd_sm;if(vd_r.ps&&vd_r.ps.vd_V!=undefined){render.vd_eN(vd_r.ps.vd_V);vd_sm=render.vd_bf(vd_r.vd_ga?0.0:undefined);vd_gR(render,vd_r.SamplePoints,vd_r.Thickness,vd_r,vd_t);render.vd_bf(vd_sm);render.vd_eN(null);}if(vd_r.HatchProperties==undefined||vd_r.HatchProperties.DrawBoundary===undefined||vd_r.HatchProperties.DrawBoundary||(vd_r.Thickness&&vd_r.Thickness!=0)||render.vd_ds()==vdConst.vd_fo){if(vd_r.vd_ga&&vd_r.ps&&(!vd_r.ps.lt|| !vd_r.ps.lt.Segments|| !vd_r.ps.lt.Segments.Items||vd_r.ps.lt.Segments.Items.length===0)){var p,v,p1,p2,n1,n2,u_p1,u_p2,u_n1,u_n2,vd_Fh,vd_Gg,d;var vd_gC=[0,0,0];var vd_nI=[0,0,1];var vd_og=0,vd_oh=0,angle,vd_tY,vd_tw;vd_sm=render.vd_bf(0.0);var vd_CT=vd_r.SamplePoints.length-1;var vd_aa=vd_r.Flag===1;var vd_jj=vd_r.PLineDrawFlag;if(!vd_jj){if(vd_t!=null)vd_jj=vd_t.PLineDrawFlag;if(!vd_jj)vd_jj=vdConst.PLineDrawFlags_SolidWidths;};if(render.vd_EG){var vd_Kn=render.vd_EG(0,vd_r.vd_gd,0);if(vd_Kn<3)vd_jj|=vdConst.PLineDrawFlags_WireWidths;}if(vd_aa&&vd_r.SamplePoints.length==3){vd_aa=false;vd_CT-=1;}for(i=0;i<vd_CT;i++){render.vd_bb=i;p=vd_r.SamplePoints[i];v=vd_r.vd_ga[i];p1=[p[X]+v[X],p[Y]+v[Y],p[Z]+v[Z]];p2=[p[X]-v[X],p[Y]-v[Y],p[Z]-v[Z]];p=vd_r.SamplePoints[i+1];v=vd_r.vd_ga[i+1];n1=[p[X]+v[X],p[Y]+v[Y],p[Z]+v[Z]];n2=[p[X]-v[X],p[Y]-v[Y],p[Z]-v[Z]];if(vd_jj&vdConst.PLineDrawFlags_SolidWidths)render.vd_yg(p1,n1,n2,p2,true,true,true,true,vd_nI,vd_gC,vd_gC,vd_gC,vd_gC);if(vd_jj&vdConst.PLineDrawFlags_WireWidths)render.vd_cd([p1,n1,n2,p2],true);if(vd_r.Thickness&&vd_r.Thickness!=0){u_p1=[p1[X],p1[Y],p1[Z]+vd_r.Thickness];u_p2=[p2[X],p2[Y],p2[Z]+vd_r.Thickness];u_n1=[n1[X],n1[Y],n1[Z]+vd_r.Thickness];u_n2=[n2[X],n2[Y],n2[Z]+vd_r.Thickness];angle=vdgeo.GetAngle(p1,n1);vd_tY=vdgeo.Distance3D(p1,n1);vd_tw=vdgeo.Distance3D(p2,n2);vd_Fh=[vd_og,0,0],vd_Hc=[(vd_og+vd_tY),0,0],vd_Hz=[vd_og,vd_r.Thickness,0],vd_GY=[(vd_og+vd_tY),vd_r.Thickness,0];vd_Gg=[vd_oh,0,0],vd_GZ=[(vd_oh+vd_tw),0,0],vd_Hi=[vd_oh,vd_r.Thickness,0],vd_GK=[(vd_oh+vd_tw),vd_r.Thickness,0];if(vd_jj&vdConst.PLineDrawFlags_SolidWidths)render.vd_yg(u_p1,u_n1,u_n2,u_p2,true,true,true,true,vd_nI,vd_gC,vd_gC,vd_gC,vd_gC);var visibility=(vd_jj&vdConst.PLineDrawFlags_WireWidths)!=0;render.vd_hd(u_p1,u_n1,n1,p1,visibility,true,visibility,visibility,vdgeo.pointPolar(vd_gC,angle+vdgeo.HALF_PI,1.0),vd_Hz,vd_GY,vd_Hc,vd_Fh);render.vd_hd(u_p2,u_n2,n2,p2,visibility,true,visibility,visibility,vdgeo.pointPolar(vd_gC,angle+vdgeo.HALF_PI,1.0),vd_Hi,vd_GK,vd_GZ,vd_Gg);if(i==0){d=vdgeo.Distance3D(p1,p2);render.vd_hd(u_p1,u_p2,p2,p1,visibility,true,visibility,true,vdgeo.pointPolar(vd_gC,angle,1.0),[0,vd_r.Thickness,0],[d,vd_r.Thickness,0],[d,0,0],[0,0,0]);}if(visibility||i==vd_r.SamplePoints.length-2){d=vdgeo.Distance3D(n1,n2);render.vd_hd(u_n1,u_n2,n2,n1,visibility,visibility,visibility,visibility,vdgeo.pointPolar(vd_gC,angle,1.0),[0,vd_r.Thickness,0],[d,vd_r.Thickness,0],[d,0,0],[0,0,0]);}vd_og+=vd_tY;vd_oh+=vd_tw;}}render.vd_bb=undefined;render.vd_bf(vd_sm);}else{if(vd_r.ps&&vd_r.vd_gd){vd_r.ps.pw=Math.abs(vd_r.vd_gd);vd_AH(vd_r,render);}render.vd_gD(vd_r.SamplePoints,vd_r.Thickness,false);}}if(vd_r.EcsMatrix!=undefined)render.vd_bC();};function vd_vp(text){if(text.vd_E)return text.vd_E;text.vd_E={Height:text.Height,WidthFactor:text.WidthFactor,Flag:text.Flag,Bold:text.Bold,ObliqueAngle:text.ObliqueAngle,TextLine:text.TextLine,BackGroundMask:text.BackGroundMask,BackGroundMaskColor:text.BackGroundMaskColor,BackGroundMaskOffset:text.BackGroundMaskOffset,BackgroundMaskBorder:text.BackgroundMaskBorder,BackGroundMaskBorderColor:text.BackGroundMaskBorderColor,BackGroundMaskBorderPenWidth:text.BackGroundMaskBorderPenWidth};if(!text.vd_E.Height)text.vd_E.Height=text.StyleRef.Height;if(!text.vd_E.Height)text.vd_E.Height=1.0;if(!text.vd_E.WidthFactor)text.vd_E.WidthFactor=text.StyleRef.WidthFactor;if(!text.vd_E.WidthFactor)text.vd_E.WidthFactor=1.0;if(!text.vd_E.Flag)text.vd_E.Flag=vdConst.VdConstTextstyle_LEFTTORIGHT;if(!text.StyleRef.Flag)text.StyleRef.Flag=vdConst.VdConstTextstyle_LEFTTORIGHT;text.vd_E.Flag|=text.StyleRef.Flag;if(text.vd_E.Bold===undefined)text.vd_E.Bold=text.StyleRef.Bold;if(text.vd_E.Bold===undefined)text.vd_E.Bold=false;if(text.vd_E.ObliqueAngle===undefined){if(text.StyleRef.IsItalic!==undefined){text.vd_E.ObliqueAngle=text.StyleRef.IsItalic?21.0:0.0;}else{text.vd_E.ObliqueAngle=text.StyleRef.ObliqueAngle;}}if(text.vd_E.ObliqueAngle===undefined)text.vd_E.ObliqueAngle=0.0;if(text.vd_E.TextLine===undefined){text.vd_E.TextLine=vdConst.TextLineFlags_None;if(text.StyleRef.IsOverLine)text.vd_E.TextLine|=vdConst.TextLineFlags_OverLine;if(text.StyleRef.IsUnderLine)text.vd_E.TextLine|=vdConst.TextLineFlags_UnderLine;if(text.StyleRef.IsStrikeOut)text.vd_E.TextLine|=vdConst.TextLineFlags_CenterLine;}if(text.vd_E.BackGroundMask===undefined)text.vd_E.BackGroundMask=text.StyleRef.BackGroundMask;if(text.vd_E.BackGroundMaskColor===undefined)text.vd_E.BackGroundMaskColor=text.StyleRef.BackGroundMaskColor;if(text.vd_E.BackGroundMaskOffset===undefined)text.vd_E.BackGroundMaskOffset=text.StyleRef.BackGroundMaskOffset;if(text.vd_E.BackgroundMaskBorder===undefined)text.vd_E.BackgroundMaskBorder=text.StyleRef.BackgroundMaskBorder;if(text.vd_E.BackGroundMaskBorderColor===undefined)text.vd_E.BackGroundMaskBorderColor=text.StyleRef.BackGroundMaskBorderColor;if(text.vd_E.BackGroundMaskBorderPenWidth===undefined)text.vd_E.BackGroundMaskBorderPenWidth=text.StyleRef.BackGroundMaskBorderPenWidth;return text.vd_E;};function vd_PU(vd_r,render,vd_t){var vd_bd=vd_r.TextString;vd_bd=vd_bd.replace(/\r\n/gi,"\n");vd_bd=vd_bd.replace(/\n/gi,"\n");vd_bd=vd_bd.replace(/\\P/gi,"\n");vd_bd=vd_bd.replace(/\t/gi,"    ");vd_bd=vd_bd.replace(/\\r/gi,"");var vd_E=vd_vp(vd_r);if(vd_E.Height===0.0)vd_E.Height=1.0;if(vd_E.WidthFactor==undefined)vd_E.WidthFactor=1.0;var vd_zf=vd_E.Height/vd_r.StyleRef.FontFileVDS.Ascent;if(vd_r.AlignToViewSize)vd_zf*=render.vd_nC(vd_r.AlignToViewSize,vd_E.Height);vd_zf*=vd_E.WidthFactor;if(!vd_r.BoxWidth)vd_r.BoxWidth=0.0;var maxWidth=vd_r.BoxWidth/vd_zf;var vd_nt='';vd_r.tb=[0,0,0,0];var vd_uv=[];var uwidths=[];var owidths=[];var vd_el=0;var vd_Ar=0;var vd_sH=false;var ulen,olen,u,o;var vd_ov=vd_bd.split("\n");for(var l=0;l<vd_ov.length;l++){var vd_gI=[];var vd_hu=[];var vd_nE;if(!vd_r.BoxWidth)vd_nE=[vd_ov[l]];else vd_nE=vd_ov[l].split(" ");for(var k=0;k<vd_nE.length;k++){var word=vd_nE[k];if(k!=vd_nE.length-1)word+=" ";var width=0;var rsb=0;var vd_pY=[];var vd_pE=[];for(var c=0;c<word.length;c++){if(word.substr(c,3).match(/%%u/i)){vd_pY.push(width);c+=3;}else if(word.substr(c,3).match(/%%o/i)){vd_pE.push(width);c+=3;}var pos=word.charCodeAt(c);var vd_gS=vd_r.StyleRef.FontFileVDS.Shapes['h_'+pos.toString()];var shape=null;if(vd_gS!=undefined)shape=vd_r.StyleRef.FontFileVDS.Shapes.Items[vd_gS];if(shape!=null){if(!vd_sH)vd_Ar=shape.bb[0];vd_sH=true;width+=(shape.AdvanceX);rsb=shape.AdvanceX-shape.bb[2];}else{width+=vd_r.StyleRef.FontFileVDS.Ascent*0.5;rsb=0;}}width-=rsb;if(vd_el==0||(vd_el+width)<=maxWidth){for(u=0;u<vd_pY.length;u++)vd_gI.push(vd_pY[u]+vd_el);for(o=0;o<vd_pE.length;o++)vd_hu.push(vd_pE[o]+vd_el);vd_el+=width;vd_nt=vd_nt.concat(word);}else{ulen=vd_gI.length%2;olen=vd_hu.length%2;if(ulen==1)vd_gI.push(vd_el);if(olen==1)vd_hu.push(vd_el);uwidths.push(vd_gI);vd_gI=[];owidths.push(vd_hu);vd_hu=[];if(ulen==1)vd_gI.push(0);if(olen==1)vd_hu.push(0);for(u=0;u<vd_pY.length;u++)vd_gI.push(vd_pY[u]);for(o=0;o<vd_pE.length;o++)vd_hu.push(vd_pE[o]);vd_uv.push([vd_nt,vd_el]);vd_r.tb[1]=Math.max(vd_r.tb[1],vd_el);vd_r.tb[0]=Math.min(vd_r.tb[0],vd_Ar);vd_sH=false;vd_el=width;vd_nt=word;}}ulen=vd_gI.length%2;olen=vd_hu.length%2;if(ulen==1)vd_gI.push(vd_el);if(olen==1)vd_hu.push(vd_el);uwidths.push(vd_gI);vd_gI=[];owidths.push(vd_hu);vd_hu=[];vd_uv.push([vd_nt,vd_el]);vd_r.tb[1]=Math.max(vd_r.tb[1],vd_el);vd_r.tb[0]=Math.min(vd_r.tb[0],vd_Ar);vd_sH=false;vd_el=0;vd_nt='';}vd_r.tb[3]=(vd_uv.length-1)* -(vd_r.StyleRef.FontFileVDS.Ascent*5/3)-vd_r.StyleRef.FontFileVDS.Ascent-vd_r.StyleRef.FontFileVDS.Descent;return[vd_uv,uwidths,owidths];};function vd_Hp(vd_r,render,vd_t){if(vd_r.TextString==undefined||vd_r.TextString.length==0)return;if(vd_r.StyleRef==undefined){vd_r.StyleRef=vd_U.GetDictItem(vd_t.TextStyles,vd_r.Style);}if(vd_r.StyleRef==null)return;if(vd_r.StyleRef.FontFileVDS==null)return;if(vd_r.StyleRef.FontFileVDS.Shapes==null||vd_r.StyleRef.FontFileVDS.Shapes==undefined)return;var vd_E=vd_vp(vd_r);if(vd_r.tb==undefined){var vd_yb=vd_PU(vd_r,render,vd_t,vd_r.BoxWidth);vd_r.testlines=vd_yb[0];vd_r.uwidths=vd_yb[1];vd_r.owidths=vd_yb[2];}if(vd_r.EcsMatrix==undefined||vd_r.AlignToViewSize){if(vd_E.Height===0.0)vd_E.Height=1.0;if(vd_r.Rotation==undefined)vd_r.Rotation=0.0;if(vd_r.ExtrusionVector==undefined)vd_r.ExtrusionVector=vdgeo.newpoint(0,0,1);if(vd_E.WidthFactor==undefined)vd_E.WidthFactor=1.0;var vd_oT=vd_E.Flag;if(vd_r.Thickness==undefined)vd_r.Thickness=0.0;if(vd_E.Bold==undefined)vd_E.Bold=false;if(vd_E.ObliqueAngle==undefined)vd_E.ObliqueAngle=0.0;if(vd_E.TextLine==undefined)vd_E.TextLine=vdConst.TextLineFlags_None;var vd_lb=vd_r.tb[0];var vd_kU=0;var dy=0.0;var dx=0.0;switch(vd_r.VerJustify){case vdConst.VdConstVerJust_VdTextVerBottom:dy= -vd_r.tb[3];break;case vdConst.VdConstVerJust_VdTextVerCen:dy= -((vd_r.tb[2]+vd_r.tb[3])/2.0)-(vd_r.StyleRef.FontFileVDS.Descent/2.0);break;case vdConst.VdConstVerJust_VdTextVerTop:dy= -vd_r.tb[2];break;default:dy= -vd_r.tb[3]-vd_r.StyleRef.FontFileVDS.Descent;break;}switch(vd_r.HorJustify){case vdConst.VdConstHorJust_VdTextHorCenter:dx= -vd_lb-vd_r.tb[1]/2.0;break;case vdConst.VdConstHorJust_VdTextHorRight:dx= -vd_lb-vd_r.tb[1];break;default:dx= -vd_lb;break;}var scale=vd_E.Height/vd_r.StyleRef.FontFileVDS.Ascent;if(vd_r.AlignToViewSize)scale*=render.vd_nC(vd_r.AlignToViewSize,vd_E.Height);var ddx=0.0;if(vd_E.ObliqueAngle!==90.0&&vd_E.ObliqueAngle!==0.0&&vd_E.ObliqueAngle!==180.0&&vd_E.ObliqueAngle!==270.0)ddx=((vd_kU+vd_r.StyleRef.FontFileVDS.Ascent)-dy)*Math.tan(vdgeo.DegreesToRadians(vd_E.ObliqueAngle));dx+=ddx;var vd_um=((vd_oT&vdConst.VdConstTextstyle_BACKWARD)==vdConst.VdConstTextstyle_BACKWARD? -1.0:1.0);var vd_vf=((vd_oT&vdConst.VdConstTextstyle_UPSIDEDOWN)==vdConst.VdConstTextstyle_UPSIDEDOWN? -1.0:1.0);vd_r.EcsMatrix=vdgeo.vd_e();vdgeo.vd_aj(vd_r.EcsMatrix,scale,scale,1.0);vdgeo.vd_x(vd_r.EcsMatrix,dx*scale,dy*scale,0.0);vdgeo.vd_HF(vd_r.EcsMatrix,vdgeo.DegreesToRadians(vd_E.ObliqueAngle),0.0);vdgeo.vd_aj(vd_r.EcsMatrix,vd_um*vd_E.WidthFactor,vd_vf,1.0);vdgeo.vd_bw(vd_r.EcsMatrix,vd_r.Rotation);vdgeo.vd_dl(vd_r.EcsMatrix,vd_r.ExtrusionVector);vdgeo.vd_x(vd_r.EcsMatrix,vd_r.InsertionPoint[X],vd_r.InsertionPoint[Y],vd_r.InsertionPoint[Z]);}render.vd_bh(vd_r.EcsMatrix);var color;var vd_di;var vd_ar=0;if(vd_E.BackGroundMask&&vd_E.BackGroundMaskColor&&(vd_E.BackGroundMaskColor.SystemColor||vd_E.BackGroundMaskColor.ColorIndex!=undefined)){color=vd_E.BackGroundMaskColor.SystemColor;if(!color)color=render.vd_fR(vd_E.BackGroundMaskColor.ColorIndex);vd_di=render.vd_ao(color);if(vd_E.BackGroundMaskOffset)vd_ar=vd_E.BackGroundMaskOffset*vd_r.StyleRef.FontFileVDS.Ascent/vd_E.Height;render.vd_er([[-vd_ar+vd_r.tb[0],vd_r.tb[2]+vd_ar,0],[vd_r.tb[1]+vd_ar,vd_r.tb[2]+vd_ar,0],[vd_r.tb[1]+vd_ar,vd_r.tb[3]-vd_ar,0],[-vd_ar+vd_r.tb[0],vd_r.tb[3]-vd_ar,0]],null,null,true);render.vd_ao(vd_di);}if(vd_E.BackgroundMaskBorder){color=render.vd_ao();if(vd_E.BackGroundMaskBorderColor&&(vd_E.BackGroundMaskBorderColor.SystemColor||vd_E.BackGroundMaskBorderColor.ColorIndex!=undefined)){color=vd_E.BackGroundMaskBorderColor.SystemColor;if(!color)color=render.vd_fR(vd_E.BackGroundMaskBorderColor.ColorIndex);}var penwidth=render.vd_bf();if(vd_E.BackGroundMaskBorderPenWidth){penwidth=(vd_E.BackGroundMaskBorderPenWidth/100.0)*96/vdgeo.INCH_MM;}vd_di=render.vd_ao(color);var vd_wp=render.vd_bf(penwidth);render.vd_cd([[-vd_ar+vd_r.tb[0],vd_r.tb[2]+vd_ar,0],[vd_r.tb[1]+vd_ar,vd_r.tb[2]+vd_ar,0],[vd_r.tb[1]+vd_ar,vd_r.tb[3]-vd_ar,0],[-vd_ar+vd_r.tb[0],vd_r.tb[3]-vd_ar,0]],true);render.vd_bf(vd_wp);render.vd_ao(vd_di);}var vd_zK= -vd_r.StyleRef.FontFileVDS.Ascent;var upts=[null,null];var opts=[null,null];var pos= -1;for(var tl=0;tl<vd_r.testlines.length;tl++){var vd_bd=vd_r.testlines[tl][0];var vd_jB=vd_r.testlines[tl][1];vd_bd=vd_bd.replace(/%%u/gi,"");vd_bd=vd_bd.replace(/%%o/gi,"");var mat=vdgeo.vd_e();var vd_xu=0.0;switch(vd_r.HorJustify){case vdConst.VdConstHorJust_VdTextHorCenter:vd_xu=(vd_r.tb[1]-vd_jB)/2.0;break;case vdConst.VdConstHorJust_VdTextHorRight:vd_xu=(vd_r.tb[1]-vd_jB);break;default:break;}vdgeo.vd_x(mat,vd_xu,vd_zK,0);render.vd_bh(mat);render.vd_tT(vd_bd,vd_jB,vd_r.StyleRef.FontFileVDS.Ascent,vd_r.StyleRef.FontFileVDS);if((vd_E.TextLine&vdConst.TextLineFlags_UnderLine)!=0){render.vd_cW(vdgeo.newpoint(0,-vd_r.StyleRef.FontFileVDS.Descent,0),vdgeo.newpoint(vd_jB,-vd_r.StyleRef.FontFileVDS.Descent,0));}else{var vd_jG=vd_r.uwidths[tl];for(var u=0;u<vd_jG.length;u++){pos=(u%2);upts[pos]=vd_jG[u];if(pos==1)render.vd_cW(vdgeo.newpoint(upts[0],-vd_r.StyleRef.FontFileVDS.Descent,0),vdgeo.newpoint(upts[1],-vd_r.StyleRef.FontFileVDS.Descent,0));}}if((vd_E.TextLine&vdConst.TextLineFlags_OverLine)!=0){render.vd_cW(vdgeo.newpoint(0,vd_r.StyleRef.FontFileVDS.Ascent*1.25,0),vdgeo.newpoint(vd_jB,vd_r.StyleRef.FontFileVDS.Ascent*1.25,0));}else{var vd_jX=vd_r.owidths[tl];for(var o=0;o<vd_jX.length;o++){pos=(o%2);upts[pos]=vd_jX[o];if(pos==1)render.vd_cW(vdgeo.newpoint(upts[0],vd_r.StyleRef.FontFileVDS.Ascent*1.25,0),vdgeo.newpoint(upts[1],vd_r.StyleRef.FontFileVDS.Ascent*1.25,0));}}render.vd_bC();vd_zK-=(vd_r.StyleRef.FontFileVDS.Ascent*5/3);}render.vd_bC();};function vd_uZ(vd_r,render,vd_t){if(vd_r.TextString==undefined||vd_r.TextString.length==0)return;if(vd_r.BoxWidth!=undefined||vd_r.TextString.search(/\\n/i)>0||vd_r.TextString.search(/\n/i)>0||vd_r.TextString.search(/\\N/i)>0||vd_r.TextString.search(/\\P/i)>0){vd_Hp(vd_r,render,vd_t);return;}var i=0;if(vd_r.StyleRef==undefined){vd_r.StyleRef=vd_U.GetDictItem(vd_t.TextStyles,vd_r.Style);}if(vd_r.StyleRef==null)return;if(vd_r.StyleRef.FontFileVDS==null)return;if(vd_r.StyleRef.FontFileVDS.Shapes==null||vd_r.StyleRef.FontFileVDS.Shapes==undefined)return;var vd_E=vd_vp(vd_r);if(vd_r.tb==undefined){var vd_bd=vd_r.TextString;vd_bd=vd_bd.replace(/%%u/gi,"");vd_bd=vd_bd.replace(/%%o/gi,"");vd_bd=vd_bd.replace(/\t/gi,"    ");vd_bd=vd_bd.replace("\\t","    ");vd_r.DiplayString=vd_bd;var rsb=0;vd_r.tb=[0,0,0,0];var vd_wL=0;var vd_ix=[];for(var c=0;c<vd_r.DiplayString.length;c++){var pos=vd_r.DiplayString.charCodeAt(c);if(pos==10||pos==13){vd_wL++;continue;}if(pos==32)vd_wL++;var vd_gS=vd_r.StyleRef.FontFileVDS.Shapes['h_'+pos.toString()];var shape=null;if(vd_gS!=undefined)shape=vd_r.StyleRef.FontFileVDS.Shapes.Items[vd_gS];if(c==0&&shape!=null)vd_r.tb[0]=shape.bb[0];if(shape!=null){vd_r.tb[1]+=(shape.AdvanceX);rsb=shape.AdvanceX-shape.bb[2];vd_r.tb[2]=Math.min(vd_r.tb[2],shape.bb[1]);vd_r.tb[3]=Math.max(vd_r.tb[3],shape.bb[3]);}else{vd_r.tb[1]+=vd_r.StyleRef.FontFileVDS.Ascent*0.5;rsb=0;}vd_ix.push(vd_r.tb[1]-rsb);}vd_r.tb[1]-=rsb;if(vd_wL==vd_r.DiplayString.length)vd_r.DiplayString=null;var uwidths=null;var owidths=null;var vd_bk=vd_r.TextString;vd_bk=vd_bk.replace(/%%U/g,"%%u");vd_bk=vd_bk.replace(/%%O/g,"%%o");if(vd_E.TextLine){if((vd_E.TextLine&vdConst.TextLineFlags_UnderLine)!=0){vd_bk=vd_bk.replace(/%%u/gi,"");vd_bk='%%u'+vd_bk;}if((vd_E.TextLine&vdConst.TextLineFlags_OverLine)!=0){vd_bk=vd_bk.replace(/%%o/gi,"");vd_bk='%%o'+vd_bk;}}var str="";var sl=0;var vd_jG=vd_bk.split("%%u");if(vd_jG.length>1){uwidths=[];str=vd_jG[0].replace(/%%o/gi,"");if(str.length==0)sl=0;else sl=vd_ix[str.length-1];uwidths.push(vd_r.tb[0]+sl);for(i=1;i<vd_jG.length;i++){str+=vd_jG[i].replace(/%%o/gi,"");if(str.length==0)sl=0;else sl=vd_ix[str.length-1];uwidths.push(vd_r.tb[0]+sl);}if((uwidths.length%2)==0)uwidths.push(vd_r.tb[0]+vd_r.tb[1]);}var vd_jX=vd_bk.split("%%o");if(vd_jX.length>1){owidths=[];str=vd_jX[0].replace(/%%u/gi,"");if(str.length==0)sl=0;else sl=vd_ix[str.length-1];owidths.push(vd_r.tb[0]+sl);for(i=1;i<vd_jX.length;i++){str+=vd_jX[i].replace(/%%u/gi,"");if(str.length==0)sl=0;else sl=vd_ix[str.length-1];owidths.push(vd_r.tb[0]+sl);}if((owidths.length%2)==0)owidths.push(vd_r.tb[0]+vd_r.tb[1]);}vd_r.uwidths=uwidths;vd_r.owidths=owidths;}if(vd_r.EcsMatrix==undefined||vd_r.AlignToViewSize){if(vd_E.Height===0.0)vd_E.Height=1.0;if(vd_r.Rotation==undefined)vd_r.Rotation=0.0;if(vd_r.ExtrusionVector==undefined)vd_r.ExtrusionVector=vdgeo.newpoint(0,0,1);if(vd_E.WidthFactor==undefined)vd_E.WidthFactor=1.0;var vd_oT=vd_E.Flag;if(vd_r.Thickness==undefined)vd_r.Thickness=0.0;if(vd_E.Bold==undefined)vd_E.Bold=false;if(vd_E.ObliqueAngle==undefined)vd_E.ObliqueAngle=0.0;if(vd_E.TextLine==undefined)vd_E.TextLine=vdConst.TextLineFlags_None;var vd_lb=vd_r.tb[0];var vd_kU= -vd_r.StyleRef.FontFileVDS.Ascent;var dy=0.0;var dx=0.0;switch(vd_r.VerJustify){case vdConst.VdConstVerJust_VdTextVerBottom:dy=vd_kU+vd_r.StyleRef.FontFileVDS.Descent+vd_r.StyleRef.FontFileVDS.Ascent;break;case vdConst.VdConstVerJust_VdTextVerCen:dy=vd_kU+vd_r.StyleRef.FontFileVDS.Ascent/2.0;break;case vdConst.VdConstVerJust_VdTextVerTop:dy=vd_kU;break;default:dy=vd_kU+vd_r.StyleRef.FontFileVDS.Ascent;break;}switch(vd_r.HorJustify){case vdConst.VdConstHorJust_VdTextHorCenter:dx= -vd_lb-vd_r.tb[1]/2.0;break;case vdConst.VdConstHorJust_VdTextHorRight:dx= -vd_lb-vd_r.tb[1];break;default:dx= -vd_lb;break;}var scale=vd_E.Height/vd_r.StyleRef.FontFileVDS.Ascent;if(vd_r.AlignToViewSize)scale*=render.vd_nC(vd_r.AlignToViewSize,vd_E.Height);var ddx=0.0;if(vd_E.ObliqueAngle!==90.0&&vd_E.ObliqueAngle!==0.0&&vd_E.ObliqueAngle!==180.0&&vd_E.ObliqueAngle!==270.0)ddx=((vd_kU+vd_r.StyleRef.FontFileVDS.Ascent)-dy)*Math.tan(vdgeo.DegreesToRadians(vd_E.ObliqueAngle));dx+=ddx;var vd_um=((vd_oT&vdConst.VdConstTextstyle_BACKWARD)==vdConst.VdConstTextstyle_BACKWARD? -1.0:1.0);var vd_vf=((vd_oT&vdConst.VdConstTextstyle_UPSIDEDOWN)==vdConst.VdConstTextstyle_UPSIDEDOWN? -1.0:1.0);vd_r.EcsMatrix=vdgeo.vd_e();vdgeo.vd_aj(vd_r.EcsMatrix,scale,scale,1.0);vdgeo.vd_x(vd_r.EcsMatrix,dx*scale,dy*scale,0.0);vdgeo.vd_HF(vd_r.EcsMatrix,vdgeo.DegreesToRadians(vd_E.ObliqueAngle),0.0);vdgeo.vd_aj(vd_r.EcsMatrix,vd_um*vd_E.WidthFactor,vd_vf,1.0);vdgeo.vd_bw(vd_r.EcsMatrix,vd_r.Rotation);vdgeo.vd_dl(vd_r.EcsMatrix,vd_r.ExtrusionVector);vdgeo.vd_x(vd_r.EcsMatrix,vd_r.InsertionPoint[X],vd_r.InsertionPoint[Y],vd_r.InsertionPoint[Z]);}render.vd_bh(vd_r.EcsMatrix);var color;var vd_di;if(vd_E.BackGroundMask&&vd_E.BackGroundMaskColor&&(vd_E.BackGroundMaskColor.SystemColor||vd_E.BackGroundMaskColor.ColorIndex!=undefined)){color=vd_E.BackGroundMaskColor.SystemColor;if(!color)color=render.vd_fR(vd_E.BackGroundMaskColor.ColorIndex);vd_di=render.vd_ao(color);var vd_ar=0;if(vd_E.BackGroundMaskOffset)vd_ar=vd_E.BackGroundMaskOffset*vd_r.StyleRef.FontFileVDS.Ascent/vd_E.Height;render.vd_er([[-vd_ar,vd_r.tb[2]-vd_ar,0],[vd_r.tb[1]+vd_ar,vd_r.tb[2]-vd_ar,0],[vd_r.tb[1]+vd_ar,vd_r.tb[3]+vd_ar,0],[-vd_ar,vd_r.tb[3]+vd_ar,0]],null,null,true);render.vd_ao(vd_di);}if(vd_E.BackgroundMaskBorder){color=render.vd_ao();if(vd_E.BackGroundMaskBorderColor&&(vd_E.BackGroundMaskBorderColor.SystemColor||vd_E.BackGroundMaskBorderColor.ColorIndex!=undefined)){color=vd_E.BackGroundMaskBorderColor.SystemColor;if(!color)color=render.vd_fR(vd_E.BackGroundMaskBorderColor.ColorIndex);}var penwidth=render.vd_bf();if(vd_E.BackGroundMaskBorderPenWidth){penwidth=(vd_E.BackGroundMaskBorderPenWidth/100.0)*96/vdgeo.INCH_MM;}vd_di=render.vd_ao(color);var vd_wp=render.vd_bf(penwidth);render.vd_cd([[-vd_ar,vd_r.tb[2]-vd_ar,0],[vd_r.tb[1]+vd_ar,vd_r.tb[2]-vd_ar,0],[vd_r.tb[1]+vd_ar,vd_r.tb[3]+vd_ar,0],[-vd_ar,vd_r.tb[3]+vd_ar,0]],true);render.vd_bf(vd_wp);render.vd_ao(vd_di);}render.vd_tT(vd_r.DiplayString,vd_r.tb[1],vd_r.StyleRef.FontFileVDS.Ascent,vd_r.StyleRef.FontFileVDS);var topy=vd_r.StyleRef.FontFileVDS.Ascent*1.25;var vd_Gj= -vd_r.StyleRef.FontFileVDS.Descent;if(vd_r.uwidths){for(i=1;i<vd_r.uwidths.length;i+=2){if(vdgeo.AreEqual(vd_r.uwidths[i-1],vd_r.uwidths[i],vdgeo.DefaultLinearEquality))continue;render.vd_cW(vdgeo.newpoint(vd_r.uwidths[i-1],vd_Gj,0),vdgeo.newpoint(vd_r.uwidths[i],vd_Gj,0));}}if(vd_r.owidths){for(i=1;i<vd_r.owidths.length;i+=2){if(vdgeo.AreEqual(vd_r.owidths[i-1],vd_r.owidths[i],vdgeo.DefaultLinearEquality))continue;render.vd_cW(vdgeo.newpoint(vd_r.owidths[i-1],topy,0),vdgeo.newpoint(vd_r.owidths[i],topy,0));}}if((vd_E.TextLine&vdConst.TextLineFlags_CenterLine)!=0){render.vd_cW(vdgeo.newpoint(0,vd_r.StyleRef.FontFileVDS.Ascent*0.5,0),vdgeo.newpoint(vd_r.tb[1],vd_r.StyleRef.FontFileVDS.Ascent*0.5,0));}render.vd_bC();};function vd_IC(vd_r,render,vd_t){if(vd_r.EcsMatrix==undefined){var rotation=0.0;var vd_de=vdgeo.newpoint(0,0,1);var vd_A=vdgeo.newpoint(0,0,0);if(vd_r.Rotation!=undefined)rotation=vd_r.Rotation;if(vd_r.ExtrusionVector!=undefined)vd_de=vdgeo.newpoint(vd_r.ExtrusionVector[X],vd_r.ExtrusionVector[Y],vd_r.ExtrusionVector[Z]);if(vd_r.InsertionPoint!=undefined)vd_A=vdgeo.newpoint(vd_r.InsertionPoint[X],vd_r.InsertionPoint[Y],vd_r.InsertionPoint[Z]);vd_r.EcsMatrix=vdgeo.vd_e();vdgeo.vd_bw(vd_r.EcsMatrix,rotation);vdgeo.vd_dl(vd_r.EcsMatrix,vd_de);vdgeo.vd_x(vd_r.EcsMatrix,vd_A[X],vd_A[Y],vd_A[Z]);}if(vd_r.SamplePoints==undefined){vd_r.SamplePoints=[vdgeo.newpoint(0,0,0),vdgeo.newpoint(vd_r.Width,0,0),vdgeo.newpoint(vd_r.Width,vd_r.Height,0),vdgeo.newpoint(0,vd_r.Height,0)];vd_r.SamplePoints.reverse();}render.vd_bh(vd_r.EcsMatrix);if(vd_r.ps&&vd_r.ps.vd_V!=undefined){render.vd_eN(vd_r.ps.vd_V);vd_gR(render,vd_r.SamplePoints,vd_r.Thickness,vd_r,vd_t);render.vd_eN(null);}if(vd_r.HatchProperties==undefined||vd_r.HatchProperties.DrawBoundary===undefined||vd_r.HatchProperties.DrawBoundary||(vd_r.Thickness&&vd_r.Thickness!=0)||render.vd_ds()==vdConst.vd_fo)render.vd_gD(vd_r.SamplePoints,vd_r.Thickness,true);render.vd_bC();};function vd_HQ(vd_r,render,vd_t){if(vd_r.EcsMatrix==undefined){var rotation=0.0;var vd_de=vdgeo.newpoint(0,0,1);var vd_A=vdgeo.newpoint(0,0,0);if(vd_r.Rotation!=undefined)rotation=vd_r.Rotation;if(vd_r.ExtrusionVector!=undefined)vd_de=vdgeo.newpoint(vd_r.ExtrusionVector[X],vd_r.ExtrusionVector[Y],vd_r.ExtrusionVector[Z]);if(vd_r.InsertionPoint!=undefined)vd_A=vdgeo.newpoint(vd_r.InsertionPoint[X],vd_r.InsertionPoint[Y],vd_r.InsertionPoint[Z]);vd_r.EcsMatrix=vdgeo.vd_e();vdgeo.vd_bw(vd_r.EcsMatrix,rotation);vdgeo.vd_dl(vd_r.EcsMatrix,vd_de);vdgeo.vd_x(vd_r.EcsMatrix,vd_A[X],vd_A[Y],vd_A[Z]);}render.vd_bh(vd_r.EcsMatrix);var k;var vd_S=vd_U.GetDictItem(vd_t.Images,vd_r.ImageDefinition);if(vd_S!=null&&vd_S.bytes!=undefined){if(!vd_r.Height||vd_r.KeepAspect!==false)vd_r.Height=vd_r.Width*vd_S.height/vd_S.width;vd_r.ImageScale=vd_r.Width;if((vd_r.Display&4)!=0&&vd_r.ClipBoundary&&vd_r.ClipBoundary.Items.length>2){var vd_eC=render.vd_gb(vdgeo.vd_Ib(0,0,vd_r.Width,vd_r.Height));if(!vd_r.ImageClipPts|| !vd_r.ImageClipUVS){var vd_AO=vdgeo.vd_e();var vd_Go=vdgeo.vd_e();var vd_IO=vd_r.Height/(vd_S.OriginalHeight?vd_S.OriginalHeight:vd_S.height);var vd_Jp=vd_r.Width/(vd_S.OriginalWidth?vd_S.OriginalWidth:vd_S.width);vdgeo.vd_aj(vd_AO,vd_Jp,-vd_IO,1.0);vdgeo.vd_x(vd_AO,0.0,vd_r.Height,0);vdgeo.vd_aj(vd_Go,1/vd_r.Width,1/vd_r.Height,1.0);var pts=vdgeo.vd_fN(vd_AO,vd_r.ClipBoundary.Items);if(vd_S.OriginalHeight){var vd_GA=vdgeo.vd_e();vdgeo.vd_aj(vd_GA,vd_S.width/vd_S.OriginalWidth,vd_S.height/vd_S.OriginalHeight,1.0);vd_r.ClipBoundary.Items=vdgeo.vd_fN(vd_GA,vd_r.ClipBoundary.Items);vd_S.OriginalHeight=undefined;vd_S.OriginalWidth=undefined;}var vd_BL=[vdgeo.newpoint(0,0,0),vdgeo.newpoint(vd_r.Width,0,0),vdgeo.newpoint(vd_r.Width,vd_r.Height,0),vdgeo.newpoint(0,vd_r.Height,0),vdgeo.newpoint(0,0,0)];vd_r.ImageClipPts=gpc.clip_oper([pts,vd_BL],[gpc.OPER_INT,gpc.OPER_INT]);if(!vd_r.ImageClipPts||vd_r.ImageClipPts.length==0)vd_r.ImageClipPts=[vd_BL];vd_r.ImageClipUVS=[];for(k=0;k<vd_r.ImageClipPts.length;k++){vd_r.ImageClipUVS.push(vdgeo.vd_fN(vd_Go,vd_r.ImageClipPts[k]));}}for(k=0;k<vd_r.ImageClipPts.length;k++){render.vd_et(vd_r.ImageClipPts[k],vdgeo.newpoint(0,0,1),vd_r.ImageClipUVS[k],vd_S,true);}if(vd_r.Thickness){var vd_kF=vdgeo.vd_e();vdgeo.vd_x(vd_kF,0,0,vd_r.Thickness);render.vd_bh(vd_kF);for(k=0;k<vd_r.ImageClipPts.length;k++){render.vd_et(vd_r.ImageClipPts[k],vdgeo.newpoint(0,0,1),vd_r.ImageClipUVS[k],vd_S,true);}render.vd_bC();}render.vd_gb(vd_eC);}else{render.vd_pW(vd_S,(vd_r.Display&8)==8,vd_r.Width,vd_r.Height);if(vd_r.Thickness){var vd_kF=vdgeo.vd_e();vdgeo.vd_x(vd_kF,0,0,vd_r.Thickness);render.vd_bh(vd_kF);render.vd_pW(vd_S,(vd_r.Display&8)==8,vd_r.Width,vd_r.Height);render.vd_bC();}}}if((vd_r.Display&16)==0||vd_r.Display==0){if(vd_r.ImageClipPts){for(k=0;k<vd_r.ImageClipPts.length;k++){render.vd_gD(vd_r.ImageClipPts[k],vd_r.Thickness,true);}}else render.vd_gD([vdgeo.newpoint(0,0,0),vdgeo.newpoint(vd_r.Width,0,0),vdgeo.newpoint(vd_r.Width,vd_r.Height,0),vdgeo.newpoint(0,vd_r.Height,0)],vd_r.Thickness,true);}render.vd_bC();};function vd_Hb(vd_r,render,vd_t){if(vd_r.EcsMatrix==undefined||vd_r.AlignToViewSize){var vd_de=vdgeo.newpoint(0,0,1);var vd_A=vdgeo.newpoint(0,0,0);if(vd_r.ExtrusionVector!=undefined)vd_de=vdgeo.newpoint(vd_r.ExtrusionVector[X],vd_r.ExtrusionVector[Y],vd_r.ExtrusionVector[Z]);if(vd_r.Center!=undefined)vd_A=vdgeo.newpoint(vd_r.Center[X],vd_r.Center[Y],vd_r.Center[Z]);vd_r.EcsMatrix=vdgeo.vd_e();if(vd_r.AlignToViewSize){render.vd_uc(vd_r.AlignToViewSize,vd_r.EcsMatrix,vd_r.Radius*2.0);}vdgeo.vd_dl(vd_r.EcsMatrix,vd_de);vdgeo.vd_x(vd_r.EcsMatrix,vd_A[X],vd_A[Y],vd_A[Z]);}if(vd_r.SamplePoints==undefined||vd_r.AlignToViewSize){var vd_eX=vdgeo.vd_iZ(vdgeo.CURVERESOLUTION,render.vd_dF(),vd_r.Radius,vdgeo.VD_TWOPI);vd_r.SamplePoints=vdgeo.vd_uw(vd_eX,vd_r.Radius,0.0,vdgeo.VD_TWOPI,0);vd_r.SamplePoints.push(vdgeo.pointPolar(vdgeo.newpoint(0,0,0),0.0,vd_r.Radius));vd_r.SamplePoints.reverse();}render.vd_bh(vd_r.EcsMatrix);if(vd_r.ps&&vd_r.ps.vd_V!=undefined){render.vd_eN(vd_r.ps.vd_V);vd_gR(render,vd_r.SamplePoints,vd_r.Thickness,vd_r,vd_t);render.vd_eN(null);}if(vd_r.HatchProperties==undefined||vd_r.HatchProperties.DrawBoundary===undefined||vd_r.HatchProperties.DrawBoundary||(vd_r.Thickness&&vd_r.Thickness!=0)||render.vd_ds()==vdConst.vd_fo)render.vd_gD(vd_r.SamplePoints,vd_r.Thickness,false);render.vd_bC();};function vd_Iw(vd_r,render,vd_t){if(vd_r.EcsMatrix==undefined){var vd_de=vdgeo.newpoint(0,0,1);var vd_A=vdgeo.newpoint(0,0,0);if(vd_r.ExtrusionVector!=undefined)vd_de=vdgeo.newpoint(vd_r.ExtrusionVector[X],vd_r.ExtrusionVector[Y],vd_r.ExtrusionVector[Z]);if(vd_r.Center!=undefined)vd_A=vdgeo.newpoint(vd_r.Center[X],vd_r.Center[Y],vd_r.Center[Z]);vd_r.EcsMatrix=vdgeo.vd_e();vdgeo.vd_dl(vd_r.EcsMatrix,vd_de);vdgeo.vd_x(vd_r.EcsMatrix,vd_A[X],vd_A[Y],vd_A[Z]);}if(vd_r.SamplePoints==undefined){if(vd_r.StartAngle==undefined)vd_r.StartAngle=0.0;if(vd_r.EndAngle==undefined)vd_r.EndAngle=0.0;var da=vdgeo.FixAngle(vd_r.EndAngle)-vdgeo.FixAngle(vd_r.StartAngle);var vd_eX=vdgeo.vd_iZ(vdgeo.CURVERESOLUTION,render.vd_dF(),vd_r.Radius,da);vd_r.SamplePoints=vdgeo.vd_uw(vd_eX,vd_r.Radius,vd_r.StartAngle,vd_r.EndAngle,0);vd_r.SamplePoints.push(vdgeo.pointPolar(vdgeo.newpoint(0,0,0),vd_r.EndAngle,vd_r.Radius));vd_r.SamplePoints.reverse();}render.vd_bh(vd_r.EcsMatrix);var vd_dx=vd_r.SamplePoints;var closed=false;if(vd_r.ps&&vd_r.ps.vd_V!=undefined){vd_dx=vd_dx.concat([vdgeo.newpoint(0,0,0)]);closed=true;render.vd_eN(vd_r.ps.vd_V);vd_gR(render,vd_dx,vd_r.Thickness,vd_r,vd_t);render.vd_eN(null);}if(vd_r.HatchProperties==undefined||vd_r.HatchProperties.DrawBoundary===undefined||vd_r.HatchProperties.DrawBoundary||(vd_r.Thickness&&vd_r.Thickness!=0)||render.vd_ds()==vdConst.vd_fo)render.vd_gD(vd_dx,vd_r.Thickness,closed);render.vd_bC();};function vd_GS(vd_r,render,vd_t){if(vd_r.EcsMatrix==undefined){var vd_de=vdgeo.newpoint(0,0,1);var vd_A=vdgeo.newpoint(0,0,0);if(vd_r.ExtrusionVector!=undefined)vd_de=vdgeo.newpoint(vd_r.ExtrusionVector[X],vd_r.ExtrusionVector[Y],vd_r.ExtrusionVector[Z]);if(vd_r.Center!=undefined)vd_A=vdgeo.newpoint(vd_r.Center[X],vd_r.Center[Y],vd_r.Center[Z]);vd_r.EcsMatrix=vdgeo.vd_e();if(vd_r.MajorAngle!=undefined)vdgeo.vd_bw(vd_r.EcsMatrix,vd_r.MajorAngle);vdgeo.vd_dl(vd_r.EcsMatrix,vd_de);vdgeo.vd_x(vd_r.EcsMatrix,vd_A[X],vd_A[Y],vd_A[Z]);}if(vd_r.SamplePoints==undefined){if(vd_r.StartAngle==undefined)vd_r.StartAngle=0.0;if(vd_r.EndAngle==undefined)vd_r.EndAngle=0.0;var da=vdgeo.FixAngle(vd_r.EndAngle)-vdgeo.FixAngle(vd_r.StartAngle);var vd_eX=vdgeo.vd_va(vdgeo.CURVERESOLUTION,render.vd_dF(),vd_r.MajorLength,da);vd_r.SamplePoints=vdgeo.vd_tR(vd_eX,vd_r.MajorLength,vd_r.MinorLength,vd_r.StartAngle,vd_r.EndAngle);vd_r.SamplePoints.reverse();}render.vd_bh(vd_r.EcsMatrix);var vd_dx=vd_r.SamplePoints;var closed=false;if(vd_r.ps&&vd_r.ps.vd_V!=undefined){if(!vdgeo.vd_Ea(vd_dx)){vd_dx=vd_dx.concat([vdgeo.newpoint(0,0,0)]);closed=true;}render.vd_eN(vd_r.ps.vd_V);vd_gR(render,vd_dx,vd_r.Thickness,vd_r,vd_t);render.vd_eN(null);}if(vd_r.HatchProperties==undefined||vd_r.HatchProperties.DrawBoundary===undefined||vd_r.HatchProperties.DrawBoundary||(vd_r.Thickness&&vd_r.Thickness!=0)||render.vd_ds()==vdConst.vd_fo)render.vd_gD(vd_dx,vd_r.Thickness,closed);render.vd_bC();};function vd_Ia(vd_r,render,vd_t){var k=0;if(vd_r.ExtrusionVector!=undefined&&vd_r.EcsMatrix==undefined){var vd_de=vdgeo.newpoint(vd_r.ExtrusionVector[X],vd_r.ExtrusionVector[Y],vd_r.ExtrusionVector[Z]);vd_r.EcsMatrix=vdgeo.vd_e();vdgeo.vd_dl(vd_r.EcsMatrix,vd_de);}if(vd_r.ps&&vd_r.ps.MaterialMatrix!=null&&vd_r.EcsMatrix==undefined)vd_r.EcsMatrix=vdgeo.vd_e();if(vd_r.EcsMatrix!=undefined)render.vd_bh(vd_r.EcsMatrix);if(vd_r.ps&&vd_r.ps.vd_V!=undefined){if((!vd_r.Curves||vd_r.Curves.Items.length==0)&&vd_r.OutLines){if(!vd_r.Opers||vd_r.Opers.Items.length!=vd_r.OutLines.Items.length){vd_r.Opers={Items:[]};for(var i=0;i<vd_r.OutLines.Items.length;i++)vd_r.Opers.Items.push(gpc.OPER_XOR);}var vd_Cz=[];for(var i=0;i<vd_r.OutLines.Items.length;i++){vd_Cz.push(vd_r.OutLines.Items[i].Items);}var vd_DC=gpc.clip_oper(vd_Cz,vd_r.Opers.Items);vd_r.Curves={Items:[]};for(var i=0;i<vd_DC.length;i++){vd_r.Curves.Items.push({Items:vd_DC[i]});}}if(vd_r.Curves!=undefined){render.vd_eN(vd_r.ps.vd_V);for(k=0;k<vd_r.Curves.Items.length;k++){vd_gR(render,vd_r.Curves.Items[k].Items,vd_r.Thickness,vd_r.Curves.Items[k],vd_t);}render.vd_eN(null);}}if(vd_r.HatchProperties==undefined||vd_r.HatchProperties.DrawBoundary===undefined||vd_r.HatchProperties.DrawBoundary||(vd_r.Thickness&&vd_r.Thickness!=0)||render.vd_ds()==vdConst.vd_fo){if(vd_r.OutLines!=undefined){for(k=0;k<vd_r.OutLines.Items.length;k++){render.vd_gD(vd_r.OutLines.Items[k].Items,vd_r.Thickness,true);}}}if(vd_r.EcsMatrix!=undefined)render.vd_bC();};function vd_sl(vd_uC,vd_dN){var k= -1;for(var i=0;i<vd_dN.length;i++){if(vd_uC<vd_dN[i].Key)break;k=i;}if(k== -1)return vd_dN[0].Value;if(k==vd_dN.length-1)return vd_dN[vd_dN.length-1].Value;var vd_hD=(vd_uC-vd_dN[k].Key)/(vd_dN[k+1].Key-vd_dN[k].Key);var c1=vd_dN[k].Value;var c2=vd_dN[k+1].Value;return[c1[0]+(c2[0]-c1[0])*vd_hD,c1[1]+(c2[1]-c1[1])*vd_hD,c1[2]+(c2[2]-c1[2])*vd_hD];};function vd_DL(p0,p1,p2,p3,tmat,normal,uv0,uv1,uv2,uv3,vd_dN){var vd_IR=vdgeo.vd_KL(p0,p1,p2,p3,normal);if(vd_dN){var col=vd_sl(p0[Z],vd_dN);uv0[0]=col[0];uv0[1]=col[1];uv0[2]=col[2];col=vd_sl(p1[Z],vd_dN);uv1[0]=col[0];uv1[1]=col[1];uv1[2]=col[2];col=vd_sl(p2[Z],vd_dN);uv2[0]=col[0];uv2[1]=col[1];uv2[2]=col[2];col=vd_sl(p3[Z],vd_dN);uv3[0]=col[0];uv3[1]=col[1];uv3[2]=col[2];}else if(vd_IR&&tmat){var vd_lR=vdgeo.vd_e();var _uv0=vdgeo.newpoint(0,0,0);var _uv1=vdgeo.newpoint(0,0,0);var _uv2=vdgeo.newpoint(0,0,0);var _uv3=vdgeo.newpoint(0,0,0);vdgeo.vd_dl(vd_lR,normal);var useZ=tmat[A22]!=1||(tmat[A30]!=0&&tmat[A31]!=0&&tmat.A33!=1);vdgeo.vd_mh(vd_lR);vdgeo.vd_cB(vd_lR,p0,_uv0);vdgeo.vd_cB(vd_lR,p1,_uv1);vdgeo.vd_cB(vd_lR,p2,_uv2);vdgeo.vd_cB(vd_lR,p3,_uv3);if(!useZ){_uv0[Z]=_uv1[Z]=_uv2[Z]=_uv3[Z]=0;}vdgeo.vd_cB(tmat,_uv0,uv0);vdgeo.vd_cB(tmat,_uv1,uv1);vdgeo.vd_cB(tmat,_uv2,uv2);vdgeo.vd_cB(tmat,_uv3,uv3);if(!useZ){if(!vdgeo.AreEqual(uv0[Z],0,vdgeo.DefaultVectorEquality)){uv0[X]/=uv0[Z];uv0[Y]/=uv0[Z];}if(!vdgeo.AreEqual(uv1[Z],0,vdgeo.DefaultVectorEquality)){uv1[X]/=uv1[Z];uv1[Y]/=uv1[Z];}if(!vdgeo.AreEqual(uv2[Z],0,vdgeo.DefaultVectorEquality)){uv2[X]/=uv2[Z];uv2[Y]/=uv2[Z];}if(!vdgeo.AreEqual(uv3[Z],0,vdgeo.DefaultVectorEquality)){uv3[X]/=uv3[Z];uv3[Y]/=uv3[Z];}}}};function vd_JW(vd_r,render,vd_t){if(vd_r.FaceList===undefined||vd_r.VertexList===undefined)return;var vd_dN=null;if(vd_r.GradientColors&&vd_r.GradientColors.Items&&vd_r.GradientColors.Items.length>1)vd_dN=vd_r.GradientColors.Items;if(render.vd_ds()==vdConst.vd_pX&&(!vd_r.Normals|| !vd_r.UVS)){var vd_zR=vd_r.FaceList.Items.length/5;vd_r.Normals=[];vd_r.Normals.length=vd_zR;vd_r.UVS=[];vd_r.UVS.length=vd_zR*4;var ii=0;var p0,p1,p2,p3;var vd_dY,vd_bu;var col= -1,vd_hQ= -1;var vd_eC=render.vd_gb(0);var tmat=vd_eC;for(var i=0;i<vd_r.FaceList.Items.length;i=i+5){vd_dY=i/5;vd_bu=4*vd_dY;ii=Math.abs(vd_r.FaceList.Items[i]);p0=vd_r.VertexList.Items[ii-1];ii=Math.abs(vd_r.FaceList.Items[i+1]);p1=vd_r.VertexList.Items[ii-1];ii=Math.abs(vd_r.FaceList.Items[i+2]);p2=vd_r.VertexList.Items[ii-1];ii=Math.abs(vd_r.FaceList.Items[i+3]);p3=vd_r.VertexList.Items[ii-1];col=vd_r.FaceList.Items[i+4];if(vd_r.TexCoords){var vd_jr=vd_bu*2;vd_r.UVS[vd_bu]=vdgeo.newpoint(vd_r.TexCoords.Items[vd_jr++],vd_r.TexCoords.Items[vd_jr++],1.0);vd_r.UVS[vd_bu+1]=vdgeo.newpoint(vd_r.TexCoords.Items[vd_jr++],vd_r.TexCoords.Items[vd_jr++],1.0);vd_r.UVS[vd_bu+2]=vdgeo.newpoint(vd_r.TexCoords.Items[vd_jr++],vd_r.TexCoords.Items[vd_jr++],1.0);vd_r.UVS[vd_bu+3]=vdgeo.newpoint(vd_r.TexCoords.Items[vd_jr++],vd_r.TexCoords.Items[vd_jr++],1.0);tmat=null;}else{if(vd_hQ!=col){vd_hQ=col;if(vd_hQ== -1){tmat=vd_eC;}else{var pcol=vd_t.Palette.Items[vd_hQ];tmat=pcol.MaterialMatrix;}}vd_r.UVS[vd_bu]=vdgeo.newpoint(0,0,0);vd_r.UVS[vd_bu+1]=vdgeo.newpoint(0,0,0);vd_r.UVS[vd_bu+2]=vdgeo.newpoint(0,0,0);vd_r.UVS[vd_bu+3]=vdgeo.newpoint(0,0,0);}vd_r.Normals[vd_dY]=vdgeo.newpoint(0,0,1);vd_DL(p0,p1,p2,p3,tmat,vd_r.Normals[vd_dY],vd_r.UVS[vd_bu],vd_r.UVS[vd_bu+1],vd_r.UVS[vd_bu+2],vd_r.UVS[vd_bu+3],vd_dN);}render.vd_gb(vd_eC);}var vd_Dg=vd_r.DrawEdges;if(!vd_U.ApplyDrawEdges)vd_Dg=false;render.vd_EI(vd_r.FaceList.Items,vd_r.VertexList.Items,vd_r.Normals,vd_r.UVS,vd_dN,vd_Dg);};function vd_IF(vd_r,render,vd_t){var vd_lJ=vd_r.EdgeVisibility;if(vd_lJ==undefined)vd_lJ=0;var p0=vd_r.VertexList.Items[0],p1=vd_r.VertexList.Items[1],p2=vd_r.VertexList.Items[2],p3=vd_r.VertexList.Items[3];if(render.vd_ds()==vdConst.vd_pX&&(!vd_r.Normals|| !vd_r.UVS)){vd_r.Normals=[];vd_r.Normals.length=1;vd_r.UVS=[];vd_r.UVS.length=4;var vd_eC=render.vd_gb(0);vd_r.UVS[0]=vdgeo.newpoint(0,0,0);vd_r.UVS[1]=vdgeo.newpoint(0,0,0);vd_r.UVS[2]=vdgeo.newpoint(0,0,0);vd_r.UVS[3]=vdgeo.newpoint(0,0,0);vd_r.Normals[0]=vdgeo.newpoint(0,0,1);vd_DL(p0,p1,p2,p3,vd_eC,vd_r.Normals[0],vd_r.UVS[0],vd_r.UVS[1],vd_r.UVS[2],vd_r.UVS[3]);render.vd_gb(vd_eC);}if(render.vd_ds()!=vdConst.vd_pX)render.vd_hd(p0,p1,p2,p3);else render.vd_hd(p0,p1,p2,p3,((vd_lJ&1)==0),((vd_lJ&2)==0),((vd_lJ&4)==0),((vd_lJ&8)==0),vd_r.Normals[0],vd_r.UVS[0],vd_r.UVS[1],vd_r.UVS[2],vd_r.UVS[3]);};function vd_JV(vd_r,render,vd_t){render.vd_Ez(vd_r.BasePoint,vd_r.Direction,vd_r.InfinityType==vdConst.InfinityTypes_Ray)};function vd_IJ(vd_r,render,vd_t){if(vd_r.ECSMatrix==undefined)vd_r.ECSMatrix=vdgeo.vd_e();vd_r.EcsMatrix=vd_r.ECSMatrix;render.vd_bh(vd_r.ECSMatrix);render.vd_tF(vd_r.points.Items,vd_r.Colors?vd_r.Colors.Items:null,vd_r.PointSize,vd_r.vd_tf);render.vd_bC();};function vd_KB(vd_r,render,vd_t){if(vd_r.EcsMatrix==undefined||vd_r.AlignToViewSize){var vd_mY=vd_t.PointStyleSize;if(vd_mY<0.0)vd_mY=render.vd_Z*Math.abs(vd_mY)/100.0;if(vd_r.ExtrusionVector==undefined)vd_r.ExtrusionVector=vdgeo.newpoint(0,0,1);vd_r.EcsMatrix=vdgeo.vd_e();vdgeo.vd_aj(vd_r.EcsMatrix,vd_mY,vd_mY,1.0);if(vd_r.AlignToViewSize){render.vd_uc(vd_r.AlignToViewSize,vd_r.EcsMatrix,vd_mY*2.0);}vdgeo.vd_dl(vd_r.EcsMatrix,vd_r.ExtrusionVector);vdgeo.vd_x(vd_r.EcsMatrix,vd_r.InsertionPoint[X],vd_r.InsertionPoint[Y],vd_r.InsertionPoint[Z]);}if(vd_r.pointSegments==undefined||vd_r.AlignToViewSize){vd_r.pointSegments=[];var pts;var mode=vd_t.PointStyleMode;if(mode!==1){if((mode&32)===32){var vd_eX=vdgeo.vd_iZ(vdgeo.CURVERESOLUTION,render.vd_dF(),vd_r.Radius,vdgeo.VD_TWOPI);pts=vdgeo.vd_uw(vd_eX,0.5,0.0,vdgeo.VD_TWOPI,0);pts.push(vdgeo.pointPolar(vdgeo.newpoint(0,0,0),0.0,0.5));vd_r.pointSegments.push(pts);mode-=32;}if((mode&64)===64){pts=[vdgeo.newpoint(-0.5,-0.5,0.0),vdgeo.newpoint(0.5,-0.5,0.0),vdgeo.newpoint(0.5,0.5,0.0),vdgeo.newpoint(-0.5,0.5,0.0),vdgeo.newpoint(-0.5,-0.5,0.0)];vd_r.pointSegments.push(pts);mode-=64;}if(mode===0){pts=[vdgeo.newpoint(0,0,0),vdgeo.newpoint(0,0,0)];vd_r.pointSegments.push(pts);}if(mode===2){pts=[vdgeo.newpoint(-1.0,0.0,0.0),vdgeo.newpoint(1.0,0.0,0.0)];vd_r.pointSegments.push(pts);pts=[vdgeo.newpoint(0.0,-1.0,0.0),vdgeo.newpoint(0.0,1.0,0.0)];vd_r.pointSegments.push(pts);}if(mode===3){pts=[vdgeo.newpoint(-1.0,-1.0,0.0),vdgeo.newpoint(1.0,1.0,0.0)];vd_r.pointSegments.push(pts);pts=[vdgeo.newpoint(-1.0,1.0,0.0),vdgeo.newpoint(1.0,-1.0,0.0)];vd_r.pointSegments.push(pts);}if(mode===4){pts=[vdgeo.newpoint(0.0,0.0,0.0),vdgeo.newpoint(0.0,1.0,0.0)];vd_r.pointSegments.push(pts);}}}render.vd_bh(vd_r.EcsMatrix);for(var ipl=0;ipl<vd_r.pointSegments.length;ipl++){render.vd_cd(vd_r.pointSegments[ipl],false);}render.vd_bC();};function vd_Jv(vd_r,render,vd_t){if(!vd_r.AlignToViewSize&&vd_r.BlockRef&& !vd_r.BlockRef.vd_qJ&& !vd_r.BlockRef.ExternalReferencePath&&vd_r.EcsMatrix&&vd_r.Columns===1&&vd_r.Rows===1&&(!vd_r.Attributes|| !vd_r.Attributes.Items|| !vd_r.Attributes.Items.length)){render.vd_bh(vd_r.EcsMatrix);vd_r.BlockRef.vd_qJ=true;vd_kq(vd_r.BlockRef.Entities,true,render,vd_t);vd_r.BlockRef.vd_qJ=false;render.vd_bC();return;}var idoc;var c,r,offset,omat;if(vd_r.BlockRef==undefined){vd_r.BlockRef=vd_U.GetDictItem(vd_t.Blocks,vd_r.Block);}if(!vd_r.BlockRef)return;if(vd_r.BlockRef.vd_qJ)return;if(vd_r.BlockRef.ExternalReferencePath&& !vd_r.BlockRef.ExternalReference){if(vd_bg.vd_En())return;var vd_eQ=vd_U.GetXREFS();for(idoc=0;idoc<vd_eQ.length;idoc++){if(vd_eQ[idoc].documentdata&&vd_eQ[idoc].documentdata.vd_En()){return;}}var vd_EA=false;var vd_wK=vd_r.BlockRef.Name.toLowerCase();for(idoc=0;idoc<vd_eQ.length;idoc++){if(vd_eQ[idoc].KeyFile==vd_wK){vd_EA=true;}}if(!vd_EA)vd_eQ.push(new vd_Hx(vd_U,vd_wK,vd_r.BlockRef.ExternalReferencePath,vd_r.BlockRef));for(idoc=0;idoc<vd_eQ.length;idoc++){if(vd_eQ[idoc].KeyFile==vd_wK){if(vd_eQ[idoc].documentdata.vdDocument){vd_r.BlockRef.ExternalReference=vd_eQ[idoc].documentdata;if(vd_r.BlockRef.ExternalReference.vdDocument.BasePoint)vd_r.BlockRef.Origin=vd_r.BlockRef.ExternalReference.vdDocument.BasePoint.concat([]);}break;}}if(!vd_r.BlockRef.ExternalReference)return;}if(vd_r.EcsMatrix==undefined||vd_r.AlignToViewSize){if(vd_r.Columns==undefined)vd_r.Columns=1;if(vd_r.Rows==undefined)vd_r.Rows=1;if(vd_r.ColumnDist==undefined)vd_r.ColumnDist=0.0;if(vd_r.RowDist==undefined)vd_r.RowDist=0.0;vd_r.EcsMatrix=vdgeo.vd_e();if(vd_r.BlockRef.Origin==undefined)vd_r.BlockRef.Origin=vdgeo.newpoint(0,0,0);if(vd_r.Xscale==undefined)vd_r.Xscale=1;if(vd_r.Yscale==undefined)vd_r.Yscale=1;if(vd_r.Zscale==undefined)vd_r.Zscale=1;if(vd_r.Rotation==undefined)vd_r.Rotation=0;if(vd_r.ExtrusionVector==undefined)vd_r.ExtrusionVector=vdgeo.newpoint(0,0,1);if(vd_r.InsertionPoint==undefined)vd_r.InsertionPoint=vdgeo.newpoint(0,0,0);vdgeo.vd_x(vd_r.EcsMatrix,-vd_r.BlockRef.Origin[X],-vd_r.BlockRef.Origin[Y],-vd_r.BlockRef.Origin[Z]);vdgeo.vd_aj(vd_r.EcsMatrix,vd_r.Xscale,vd_r.Yscale,vd_r.Zscale);if(vd_r.AlignToViewSize&&vd_r.BoundingBox!=undefined){render.vd_uc(vd_r.AlignToViewSize,vd_r.EcsMatrix,vd_r.BoundingBox[4]-vd_r.BoundingBox[1]);}vdgeo.vd_bw(vd_r.EcsMatrix,vd_r.Rotation);vdgeo.vd_dl(vd_r.EcsMatrix,vd_r.ExtrusionVector);vdgeo.vd_x(vd_r.EcsMatrix,vd_r.InsertionPoint[X],vd_r.InsertionPoint[Y],vd_r.InsertionPoint[Z]);}var isArray=vd_r.Columns>1||vd_r.Rows>1;render.vd_bh(vd_r.EcsMatrix);vd_r.BlockRef.vd_qJ=true;for(c=0;c<vd_r.Columns;c++){for(r=0;r<vd_r.Rows;r++){if(isArray){offset=vdgeo.newpoint(c*vd_r.ColumnDist/vd_r.Xscale,r*vd_r.RowDist/vd_r.Yscale,0.0);omat=vdgeo.vd_e();vdgeo.vd_x(omat,offset[X],offset[Y],offset[Z]);render.vd_bh(omat);}if(vd_r.BlockRef.ExternalReferencePath&&vd_r.BlockRef.ExternalReference){var vd_OQ=vd_bg;vd_bg=vd_r.BlockRef.ExternalReference;vd_kq(vd_bg.vdDocument.Model.Entities,true,render,vd_bg.vdDocument);vd_bg=vd_OQ;if(vd_bg.vdDocument.Palette&&vd_bg.vdDocument.Palette._lc&&vd_bg.vdDocument.Palette._lc._a1!=false&&vd_r.BlockRef.ExternalReference.vdDocument&&vd_r.BlockRef.ExternalReference.vdDocument.Palette&&vd_r.BlockRef.ExternalReference.vdDocument.Palette._lc&&vd_r.BlockRef.ExternalReference.vdDocument.Palette._lc._a1==false)vd_bg.vdDocument.Palette._lc._a1=false;}else{vd_kq(vd_r.BlockRef.Entities,true,render,vd_t);}if(isArray)render.vd_bC();}}vd_r.BlockRef.vd_qJ=false;render.vd_bC();if(vd_r.Attributes&&vd_r.Attributes.Items&&vd_r.Attributes.Items.length>0){for(c=0;c<vd_r.Columns;c++){for(r=0;r<vd_r.Rows;r++){if(isArray){offset=vdgeo.pointPolar(vdgeo.newpoint(0,0,0),vd_r.Rotation,c*vd_r.ColumnDist);offset=vdgeo.pointPolar(offset,vd_r.Rotation+vdgeo.HALF_PI,r*vd_r.RowDist);omat=vdgeo.vd_e();vdgeo.vd_x(omat,offset[X],offset[Y],offset[Z]);render.vd_bh(omat);}vd_kq(vd_r.Attributes,false,render,vd_t);if(isArray)render.vd_bC();}}}};this.ActionDrawEntities=function(entities,vd_wb){vd_c.vd_H.ActionDrawEntities(entities,vd_wb);};this.ToolTip=new function(){this.AutoShow=true;var vd_bN=this;var vd_sz=null;var vdcanvas=vd_U;this.vd_vk=1500;Object.defineProperty(vd_bN,'TimeOut',{get:function(){return vd_bN.vd_vk;},set:function(newValue){vd_bN.vd_vk=newValue;}});this.vd_wv=[255,255,255];Object.defineProperty(vd_bN,'FillColor1',{get:function(){return vd_bN.vd_wv;},set:function(newValue){vd_bN.vd_wv=newValue;}});this.vd_vD=[211,211,211];Object.defineProperty(vd_bN,'FillColor2',{get:function(){return vd_bN.vd_vD;},set:function(newValue){vd_bN.vd_vD=newValue;}});this.vd_vY=[72,72,72];Object.defineProperty(vd_bN,'BoundaryColor',{get:function(){return vd_bN.vd_vY;},set:function(newValue){vd_bN.vd_vY=newValue;}});this.vd_oe=[0,0,0];Object.defineProperty(vd_bN,'FontColor',{get:function(){return vd_bN.vd_oe;},set:function(newValue){vd_bN.vd_oe=newValue;}});this.vd_wf='sans-serif';Object.defineProperty(vd_bN,'FontName',{get:function(){return vd_bN.vd_wf;},set:function(newValue){vd_bN.vd_wf=newValue;}});this.vd_ww=16;Object.defineProperty(vd_bN,'FontHeight',{get:function(){return vd_bN.vd_ww;},set:function(newValue){vd_bN.vd_ww=newValue;}});this.vd_Hu=[0,0];Object.defineProperty(vd_bN,'BoundaryOffset',{get:function(){return vd_bN.vd_Hu;},set:function(newValue){vd_bN.vd_Hu=newValue;}});function vd_NV(point,width,height){var vd_la=new Array(point[0],point[1]);var xmin=vd_la[0];var xmax=vd_la[0]+width;var ymin=vd_la[1];var ymax=vd_la[1]+height;var vd_RZ=vdcanvas.canvas.height;var vd_Lt=vdcanvas.canvas.width;if(xmax>vd_Lt)vd_la[0]=point[0]-width;if(ymin<0)vd_la[1]=0;return vd_la;};this.show=function(p,str,size,timeout){var vd_ft=vdcanvas.ViewToPixel(p);vd_bN.vd_BK(vd_ft,str,size,timeout);};function vd_Qp(txt,ctxt){var ret={fc:vd_bN.vd_oe,text:txt,width:0};try{if(txt.length>2&&txt.indexOf("\\{")==0){var i2=txt.indexOf("}");if(i2>0){ret=eval('ret='+txt.substr(1,i2));ret.text=txt.substr(i2+1);ret.width=ctxt.measureText(ret.text).width;if(!ret.fc)ret.fc=vd_bN.vd_oe;}}}catch(ex){}if(!ret.width)ret.width=ctxt.measureText(ret.text).width;return ret;};function vd_ov(str,ctxt){var lines=str.split("\\n");var ret=[];var vd_vH=0;for(i=0;i<lines.length;i++){var item=vd_Qp(lines[i],ctxt);ret.push(item);vd_vH=Math.max(vd_vH,item.width);}return[ret,vd_vH];};this.vd_BK=function(vd_cG,str,size,timeout){if(!str||str=="")return;var ctxt=vdcanvas.vd_ik();if(!ctxt)return;var vd_ft=[vd_cG[0],vd_cG[1],0];if(size===undefined)size=vd_bN.vd_ww;vd_bN.hide();ctxt.font=size+"px "+vd_bN.vd_wf;var vd_Ba=vd_ov(str,ctxt);var lines=vd_Ba[0];var vd_zD=vd_Ba[1];var vd_BZ=size+4;var vd_nY=vd_BZ*lines.length;vd_ft[1]-=vd_nY;vd_ft=vd_NV(vd_ft,vd_zD+4,vd_nY+4);var vd_AT=ctxt.createLinearGradient(vd_ft[0],vd_ft[1],vd_ft[0],vd_ft[1]+size);vd_AT.addColorStop(0,vdgdi.vd_iU(vd_bN.vd_wv));vd_AT.addColorStop(1,vdgdi.vd_iU(vd_bN.vd_vD));ctxt.fillStyle=vd_AT;var vd_kt=vd_ft.slice();vd_ft[0]+=3;vd_ft[1]+=2;var vd_xc=vd_zD+6;vd_kt[0]+=1;vd_kt[1]+=1;ctxt.fillRect(vd_kt[0],vd_kt[1],vd_xc,vd_nY);ctxt.strokeStyle=vdgdi.vd_iU(vd_bN.vd_vY);var lw=ctxt.lineWidth;ctxt.lineWidth=1;vd_xc+=2;vd_nY+=2;vd_kt[0]-=1;vd_kt[1]-=1;ctxt.strokeRect(vd_kt[0],vd_kt[1],vd_xc,vd_nY);ctxt.lineWidth=lw;ctxt.fillStyle=vdgdi.vd_iU(vd_bN.vd_oe);ctxt.textBaseline='top';for(i=0;i<lines.length;i++){ctxt.fillStyle=vdgdi.vd_iU(lines[i].fc);ctxt.fillText(lines[i].text,vd_ft[0],vd_ft[1]+i*vd_BZ);}if(timeout===undefined)timeout=vd_bN.vd_vk;if(timeout)vd_sz=setTimeout(vd_bN.hide,timeout);};this.hide=function(){if(vd_sz){clearTimeout(vd_sz);vd_sz=null;vd_c.vd_H.Refresh();return true;}return false;}};this.DrawEntity=function(entity,render){if(!render)render=vd_U.ActiveRender();vd_bM(entity,render,vd_J());};function vd_bM(vd_r,render,vd_t,index,vd_lW){if(!vd_r)return;if(vd_r.Deleted===true)return;if(vd_r.visibility===1)return;var vd_eZ=render.vd_pC();vd_Ko(vd_r,vd_t,render);if(vd_r._t!==vdConst.vdViewport_code){if(vd_U.vd_Eq(vd_r.LayerRef,vd_eZ,vd_t))return;}if(render.vd_ds()==vdConst.vd_fo){if(vd_eZ==null&&vd_r.BoundingBox!=undefined){render.vd_gQ.vd_hc(vd_r.BoundingBox);return;}}else{if(vd_r._t!==vdConst.vdViewport_code&&vd_r._t!==vdConst.vdInsert_code){if(vd_eZ&&vd_eZ._t==vdConst.vdInsert_code&&vd_eZ.LayerRef){if(vd_r.LayerRef.Name=="0"){if(vd_eZ.LayerRef.On===false)return;}else if(vd_r.LayerRef.On===false)return;}else{if(vd_r.LayerRef.On===false)return;}}}var pw,col,vd_cO,vd_qv,lt,ltscale,highlight;render.vd_qY(vd_r,vd_lW?index:undefined);col=vd_QD(vd_r,render);if(!render.vd_sv()){pw=vd_AH(vd_r,render);vd_cO=vd_RY(vd_r,render);vd_qv=vd_QA(vd_r,render);lt=vd_RG(vd_r,render);ltscale=vd_Rf(vd_r,render);highlight=render.vd_vj(vd_r.HighLight);}if(vd_r.Explode!==undefined){if(vd_r._t===vdConst.vdDimension_code)vd_q.vd_DD.vd_HN(vd_r,vd_U);vd_kq(vd_r.Explode,false,render,vd_t);}else if(vd_r._t===vdConst.vdLine_code){vd_Jr(vd_r,render,vd_t);}else if(vd_r._t===vdConst.vdInsert_code){if(vd_r.AlignToViewSize&&vd_eZ==null&& !vd_r.BoundingBox&&render.vd_ds()!=vdConst.vd_fo){vd_dA.clear();vd_bM(vd_r,vd_dA,vd_t);vd_r.BoundingBox=vd_dA.vd_gQ.vd_fD();}vd_Jv(vd_r,render,vd_t);}else if(vd_r._t===vdConst.vdPolyface_code){vd_JW(vd_r,render,vd_t);}else if(vd_r._t===vdConst.vd3DFace_code){vd_IF(vd_r,render,vd_t);}else if(vd_r._t===vdConst.vdText_code){vd_uZ(vd_r,render,vd_t);}else if(vd_r._t===vdConst.vdAttribDef_code&&vd_r.InVisibleMode!==true){if(vd_eZ!=null){if(vd_r.IsConstant==true){var str=vd_r.TextString;vd_r.TextString=vd_r.ValueString;vd_uZ(vd_r,render,vd_t);vd_r.TextString=str;}}else{vd_uZ(vd_r,render,vd_t);}}else if(vd_r._t===vdConst.vdAttrib_code){if(vd_r.IsConstant!=true&&vd_U.vd_vO(vd_r))vd_uZ(vd_r,render,vd_t);}else if(vd_r._t===vdConst.vdPolyline_code){vd_Ij(vd_r,render,vd_t);}else if(vd_r._t===vdConst.vdRect_code){vd_IC(vd_r,render,vd_t);}else if(vd_r._t===vdConst.vdImage_code){vd_HQ(vd_r,render,vd_t);}else if(vd_r._t===vdConst.vdCircle_code){vd_Hb(vd_r,render,vd_t);}else if(vd_r._t===vdConst.vdArc_code){vd_Iw(vd_r,render,vd_t);}else if(vd_r._t===vdConst.vdEllipse_code){vd_GS(vd_r,render,vd_t);}else if(vd_r._t===vdConst.vdPolyhatch_code){vd_Ia(vd_r,render,vd_t);}else if(vd_r._t===vdConst.vdInfinityLine_code){vd_JV(vd_r,render,vd_t);}else if(vd_r._t===vdConst.vdPoint_code){vd_KB(vd_r,render,vd_t);}else if(vd_r._t===vdConst.vdViewport_code){vd_Ii(vd_r,render,vd_t);}else if(vd_r._t===vdConst.vdNote_code){vd_r.vd_MR(render);}else if(vd_r._t===vdConst.vdPointCloud_code){vd_IJ(vd_r,render,vd_t);}render.vd_qY(null);if(!render.vd_sv()){render.vd_vj(highlight);render.vd_AK(lt);render.vd_zI(ltscale);render.vd_bf(pw);}render.vd_ao(col);if(vd_r.selected&& !render.vd_sv()&&render.vd_ds()!=vdConst.vd_fo){render.vd_rg(vdConst.ActionHighLightColor);vd_bM(vd_r,render,vd_t);render.vd_pP();}if(vd_eZ==null&& !vd_r.BoundingBox&&render.vd_ds()!=vdConst.vd_fo){vd_dA.clear();vd_bM(vd_r,vd_dA,vd_t);vd_r.BoundingBox=vd_dA.vd_gQ.vd_fD();}};function vd_ug(vd_eD,vd_jq,render,vd_t){var vd_wg=render.vd_ds()!=vdConst.vd_fo&&((vd_nR>0)&&vd_eD===vd_U.vd_uA().Entities&&vd_U.vd_aK.vd_tW);render.vd_oi(1);if(!vd_wg|| !vd_U.vd_aK.vd_tW(render))vd_kq(vd_eD,vd_jq,render,vd_t,true);if(vd_wg&&vd_U.vd_aK.vd_DI)vd_U.vd_aK.vd_DI();if(render.vd_qr){render.vd_oi(2);if(!vd_wg|| !vd_U.vd_aK.vd_tW(render))vd_kq(vd_eD,vd_jq,render,vd_t,true);}render.vd_oi(3);};function vd_kq(vd_eD,vd_jq,render,vd_t,vd_lW){if(vd_eD==undefined||vd_eD.Items==undefined||vd_eD.Items.length==undefined)return;var k=0;for(k=0;k<vd_eD.Items.length;k++){vd_GM(vd_eD,vd_jq,render,vd_t,k,vd_lW);}};function vd_GM(vd_eD,vd_jq,render,vd_t,i,vd_lW){vd_jq=vd_jq||(typeof vd_eD.Items[i]=='string');if(vd_jq)vd_bM(vd_U.GetEntityItem(vd_eD.Items[i]),render,vd_t,i,vd_lW);else{vd_bM(vd_eD.Items[i],render,vd_t,i,vd_lW);}};function vd_OC(vd_l,vd_O,vd_k,vd_bq){if(!vd_l)return;for(var i=vd_l[0].length-1;i>=0;i--){var pos=i;var vd_r=vd_l[0][pos];if(!vd_r)continue;if(vd_r.LayerRef&&vd_r.LayerRef.Lock&&vd_bq==false&& !vd_r.LayerRef.ForceOsnaps)continue;if(vd_r._t===vdConst.vdLine_code){vd_Pe(pos,vd_l,vd_O,vd_k);}else if(vd_r._t===vdConst.vdInsert_code){vd_Ae(pos,vd_l,vd_O,vd_k);}else if(vd_r._t===vdConst.vdPolyface_code){vd_PY(pos,vd_l,vd_O,vd_k);}else if(vd_r._t===vdConst.vd3DFace_code){vd_Nu(pos,vd_l,vd_O,vd_k);}else if(vd_r._t===vdConst.vdText_code){vd_Ae(pos,vd_l,vd_O,vd_k);}else if(vd_r._t===vdConst.vdAttrib_code){vd_Ae(pos,vd_l,vd_O,vd_k);}else if(vd_r._t===vdConst.vdPolyline_code){vd_PK(pos,vd_l,vd_O,vd_k);}else if(vd_r._t===vdConst.vdRect_code){vd_CB(pos,vd_l,vd_O,vd_k);}else if(vd_r._t===vdConst.vdImage_code){vd_CB(pos,vd_l,vd_O,vd_k);}else if(vd_r._t===vdConst.vdCircle_code){vd_NT(pos,vd_l,vd_O,vd_k);}else if(vd_r._t===vdConst.vdArc_code){vd_PH(pos,vd_l,vd_O,vd_k);}else if(vd_r._t===vdConst.vdEllipse_code){vd_NO(pos,vd_l,vd_O,vd_k);}else if(vd_r._t===vdConst.vdPoint_code){vd_Pn(pos,vd_l,vd_O,vd_k);}else if(vd_r._t===vdConst.vdPointCloud_code){vd_PP(pos,vd_l,vd_O,vd_k);}if(vd_k.length>vdConst.OsnapMaxItems)break;}};function vd_bI(pos,vd_l,pt){var ret=vdgeo.newpoint(pt[X],pt[Y],pt[Z]);for(var i=pos;i>=0;i--){if(!vd_l[0][i].EcsMatrix)continue;vdgeo.vd_tu(vd_l[0][i].EcsMatrix,ret[X],ret[Y],ret[Z],ret);}vdgeo.vd_tu(vd_c.vd_bE(),ret[X],ret[Y],ret[Z],ret);return ret;};function vd_Pe(pos,vd_l,vd_O,vd_k){var vd_r=vd_l[0][pos];var pt;if((vd_O&vdConst.OsnapMode_END)){pt=vd_bI(pos,vd_l,vd_r.StartPoint);vd_k.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_END]);pt=vd_bI(pos,vd_l,vd_r.EndPoint);vd_k.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_END]);}if((vd_O&vdConst.OsnapMode_MID)){pt=vd_bI(pos,vd_l,vdgeo.MidPoint(vd_r.StartPoint,vd_r.EndPoint));vd_k.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_MID]);}};function vd_PK(pos,vd_l,vd_O,vd_k){var vd_r=vd_l[0][pos];if(vd_r.SPlineFlag&&vd_r.SPlineFlag!==vdConst.SplineFlagSTANDARD)return;var pt;var vd_fJ=vd_l[1];if(vd_fJ!==undefined){if(vd_fJ<0){var vd_cx=vd_r.VertexList.Items.length;if((vd_O&vdConst.OsnapMode_CEN)&&vd_cx>0){var vd_ls=[0,0,0];for(var i=0;i<vd_cx;i++){vd_ls[X]+=vd_r.VertexList.Items[i][X];vd_ls[Y]+=vd_r.VertexList.Items[i][Y];vd_ls[Z]+=vd_r.VertexList.Items[i][Z];}vd_ls[X]/=vd_cx;vd_ls[Y]/=vd_cx;vd_ls[Z]/=vd_cx;pt=vd_bI(pos,vd_l,vd_ls);vd_k.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_CEN]);}}else{var sp=vd_r.VertexList.Items[vd_fJ];if(!sp)return;var ep;if(vd_fJ>=vd_r.VertexList.Items.length-1)ep=vd_r.VertexList.Items[0];else ep=vd_r.VertexList.Items[vd_fJ+1];if((vd_O&vdConst.OsnapMode_END)){pt=vd_bI(pos,vd_l,sp);vd_k.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_END]);pt=vd_bI(pos,vd_l,ep);vd_k.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_END]);}if((vd_O&vdConst.OsnapMode_MID)){var success=vdgeo.Bulge2Arc(sp,ep);if(!success){pt=vd_bI(pos,vd_l,vdgeo.MidPoint(sp,ep));vd_k.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_MID]);}else{var Center=success[0];var radius=success[1];var vd_eu=success[2];var vd_ee=success[3];pt=vd_bI(pos,vd_l,vdgeo.pointPolar(Center,vd_eu+vdgeo.FixAngle(vd_ee-vd_eu)*0.5,radius));vd_k.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_MID]);}}}}};function vd_PY(pos,vd_l,vd_O,vd_k){var vd_r=vd_l[0][pos];var pt;var vd_fJ=vd_l[1];if(vd_fJ===undefined)return;var pos4=vd_fJ%5;var sp=vd_r.VertexList.Items[Math.abs(vd_r.FaceList.Items[vd_fJ])-1];var ep;if(pos4==3)ep=vd_r.VertexList.Items[Math.abs(vd_r.FaceList.Items[vd_fJ-3])-1];else ep=vd_r.VertexList.Items[Math.abs(vd_r.FaceList.Items[vd_fJ+1])-1];if((vd_O&vdConst.OsnapMode_END)){pt=vd_bI(pos,vd_l,sp);vd_k.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_END]);pt=vd_bI(pos,vd_l,ep);vd_k.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_END]);}if((vd_O&vdConst.OsnapMode_MID)){pt=vd_bI(pos,vd_l,vdgeo.MidPoint(sp,ep));vd_k.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_MID]);}};function vd_Nu(pos,vd_l,vd_O,vd_k){var vd_r=vd_l[0][pos];var pt;var p0=vd_r.VertexList.Items[0],p1=vd_r.VertexList.Items[1],p2=vd_r.VertexList.Items[2],p3=vd_r.VertexList.Items[3];if((vd_O&vdConst.OsnapMode_END)){pt=vd_bI(pos,vd_l,p0);vd_k.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_END]);pt=vd_bI(pos,vd_l,p1);vd_k.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_END]);pt=vd_bI(pos,vd_l,p2);vd_k.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_END]);pt=vd_bI(pos,vd_l,p3);vd_k.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_END]);}if((vd_O&vdConst.OsnapMode_MID)){pt=vd_bI(pos,vd_l,vdgeo.MidPoint(p0,p1));vd_k.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_MID]);pt=vd_bI(pos,vd_l,vdgeo.MidPoint(p1,p2));vd_k.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_MID]);pt=vd_bI(pos,vd_l,vdgeo.MidPoint(p2,p3));vd_k.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_MID]);pt=vd_bI(pos,vd_l,vdgeo.MidPoint(p3,p0));vd_k.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_MID]);}};function vd_CB(pos,vd_l,vd_O,vd_k){var vd_r=vd_l[0][pos];var pt;var p0=vdgeo.newpoint(0,0,0),p1=vdgeo.newpoint(vd_r.Width,0,0),p2=vdgeo.newpoint(vd_r.Width,vd_r.Height,0),p3=vdgeo.newpoint(0,vd_r.Height,0);if((vd_O&vdConst.OsnapMode_END)){pt=vd_bI(pos,vd_l,p0);vd_k.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_END]);pt=vd_bI(pos,vd_l,p1);vd_k.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_END]);pt=vd_bI(pos,vd_l,p2);vd_k.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_END]);pt=vd_bI(pos,vd_l,p3);vd_k.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_END]);}if((vd_O&vdConst.OsnapMode_MID)){pt=vd_bI(pos,vd_l,vdgeo.MidPoint(p0,p1));vd_k.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_MID]);pt=vd_bI(pos,vd_l,vdgeo.MidPoint(p1,p2));vd_k.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_MID]);pt=vd_bI(pos,vd_l,vdgeo.MidPoint(p2,p3));vd_k.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_MID]);pt=vd_bI(pos,vd_l,vdgeo.MidPoint(p3,p0));vd_k.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_MID]);}if((vd_O&vdConst.OsnapMode_CEN)){if(vd_l[1]<0){pt=vd_bI(pos,vd_l,vdgeo.MidPoint(p0,p2));vd_k.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_CEN]);}}if((vd_O&vdConst.OsnapMode_INS)){pt=vd_bI(pos,vd_l,p0);vd_k.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_INS]);}};function vd_NT(pos,vd_l,vd_O,vd_k){var vd_r=vd_l[0][pos];var pt;if((vd_O&vdConst.OsnapMode_CEN)){pt=vd_bI(pos,vd_l,vdgeo.newpoint(0,0,0));vd_k.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_CEN]);}if((vd_O&vdConst.OsnapMode_QUA)){pt=vd_bI(pos,vd_l,vdgeo.newpoint(vd_r.Radius,0,0));vd_k.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_QUA]);pt=vd_bI(pos,vd_l,vdgeo.newpoint(0,vd_r.Radius,0));vd_k.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_QUA]);pt=vd_bI(pos,vd_l,vdgeo.newpoint(-vd_r.Radius,0,0));vd_k.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_QUA]);pt=vd_bI(pos,vd_l,vdgeo.newpoint(0,-vd_r.Radius,0));vd_k.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_QUA]);}};function vd_PH(pos,vd_l,vd_O,vd_k){var vd_r=vd_l[0][pos];var pt;var Center=vdgeo.newpoint(0,0,0);if((vd_O&vdConst.OsnapMode_CEN)){pt=vd_bI(pos,vd_l,Center);vd_k.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_CEN]);}if((vd_O&vdConst.OsnapMode_END)){pt=vd_bI(pos,vd_l,vdgeo.pointPolar(Center,vd_r.StartAngle,vd_r.Radius));vd_k.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_END]);pt=vd_bI(pos,vd_l,vdgeo.pointPolar(Center,vd_r.EndAngle,vd_r.Radius));vd_k.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_END]);}if((vd_O&vdConst.OsnapMode_MID)){pt=vd_bI(pos,vd_l,vdgeo.pointPolar(Center,vd_r.StartAngle+vdgeo.FixAngle(vd_r.EndAngle-vd_r.StartAngle)*0.5,vd_r.Radius));vd_k.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_MID]);}};function vd_NO(pos,vd_l,vd_O,vd_k){var vd_r=vd_l[0][pos];var pt;if((vd_O&vdConst.OsnapMode_CEN)){pt=vd_bI(pos,vd_l,vdgeo.newpoint(0,0,0));vd_k.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_CEN]);}if((vd_O&vdConst.OsnapMode_END)){pt=vd_bI(pos,vd_l,vdgeo.vd_tt(vd_r.StartAngle,vd_r.MajorLength,vd_r.MinorLength));vd_k.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_END]);pt=vd_bI(pos,vd_l,vdgeo.vd_tt(vd_r.EndAngle,vd_r.MajorLength,vd_r.MinorLength));vd_k.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_END]);}if((vd_O&vdConst.OsnapMode_MID)){pt=vd_bI(pos,vd_l,vdgeo.vd_tt(vd_r.StartAngle+vdgeo.FixAngle(vd_r.EndAngle-vd_r.StartAngle)*0.5,vd_r.MajorLength,vd_r.MinorLength));vd_k.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_MID]);}};function vd_PP(pos,vd_l,vd_O,vd_k){var vd_fJ=vd_l[1];if(vd_fJ!==undefined&&(vd_O&vdConst.OsnapMode_NODE)){var vd_r=vd_l[0][pos];var sp=vd_r.points.Items[vd_fJ];var pt=vd_bI(pos,vd_l,sp);vd_k.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_NODE]);}};function vd_Pn(pos,vd_l,vd_O,vd_k){var pt;if((vd_O&vdConst.OsnapMode_NODE)){pt=vd_bI(pos,vd_l,vdgeo.newpoint(0,0,0));vd_k.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_NODE]);}};function vd_Ae(pos,vd_l,vd_O,vd_k){var pt;if((vd_O&vdConst.OsnapMode_INS)){pt=vd_bI(pos,vd_l,vdgeo.newpoint(0,0,0));vd_k.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_INS]);}};this.SetOsnapMode=function(mode){var vd_t=vd_J();if(vd_t==null)return;vd_t.vd_he=mode;};this.GetOsnapMode=function(){var vd_t=vd_J();if(vd_t==null)return vdConst.OsnapMode_NONE;if(!vd_t.vd_he)return vdConst.OsnapMode_NONE;var ret=vd_t.vd_he;return ret;};this.vd_RX=function(){var vd_t=vd_J();if(vd_t==null)return true;return(vd_t.vd_he&&(vd_t.vd_he&vdConst.OsnapMode_DISABLE));};this.EnableOsnapMode=function(bval){var vd_t=vd_J();if(vd_t==null)return;if(!vd_t.vd_he)vd_t.vd_he=vdConst.OsnapMode_NONE;if((vd_t.vd_he&vdConst.OsnapMode_DISABLE))vd_t.vd_he^=vdConst.OsnapMode_DISABLE;if(!bval)vd_t.vd_he|=vdConst.OsnapMode_DISABLE;};this.vd_Ju=function(x,y,vd_lZ,vd_bq){var vd_O=vd_U.GetOsnapMode();if(vd_O==vdConst.OsnapMode_NONE)return null;if(vd_O&vdConst.OsnapMode_DISABLE)return null;if(!vd_c.vd_bJ)return null;x=vdgeo.vd_u(x);y=vdgeo.vd_u(y);if(x<0||x>=vd_c.width)return null;if(y<0||y>=vd_c.height)return null;var vd_Br=vdgeo.vd_bL(x,y,0,vd_c.vd_aN);if(!vd_lZ)vd_lZ=vd_U.PickSize;if(!vd_bq)vd_bq=vd_U.IgnoreLockLayers;var vd_hG=Math.max(vdgeo.vd_u(vd_lZ*0.5),1);var vd_jd=[];var vd_k=[];var vd_bZ=null;if((vd_O&vdConst.OsnapMode_NEA))vd_bZ=[0,0,0,0];var px,py;for(var p=0;p<vd_hG;p++){for(var ix= -p;ix<=p;ix++){px=x+ix;py=y-p;vd_sf(px,py,vd_O,vd_k,vd_jd,vd_bZ,vd_bq);py=y+p;vd_sf(px,py,vd_O,vd_k,vd_jd,vd_bZ,vd_bq);}for(var iy= -p+1;iy<p;iy++){px=x-p;py=y+iy;vd_sf(px,py,vd_O,vd_k,vd_jd,vd_bZ,vd_bq);px=x+p;py=y+iy;vd_sf(px,py,vd_O,vd_k,vd_jd,vd_bZ,vd_bq);}}vd_jd.length=0;if(vd_k.length>0){vd_k.sort(function(a,b){return vdgeo.Distance2D(a,vd_Br)-vdgeo.Distance2D(b,vd_Br);});if(vd_bZ&&vd_bZ[3]===vdConst.OsnapMode_NEA){var vd_cG=vdgeo.vd_bL(vd_k[0][X],vd_k[0][Y],vd_k[0][Z],vd_c.vd_dm);if(vd_cG[X]<x-vd_hG||vd_cG[X]>x+vd_hG||vd_cG[Y]<y-vd_hG||vd_cG[Y]>y+vd_hG){return vd_bZ;}}return vd_k[0];}if(vd_bZ&&vd_bZ[3]===vdConst.OsnapMode_NEA)return vd_bZ;return null;};function vd_sf(px,py,vd_O,vd_k,vd_jd,vd_bZ,vd_bq){var c=0;if(px<0||px>=vd_c.width||py<0||py>=vd_c.height)return;var ipos=py*vd_c.width+px;var vd_b=vd_c.vd_H.vd_ji();if(vd_bZ&&vd_bZ[3]==0&&vd_b[ipos][1]&&vd_b[ipos][1].length>0){var z=vd_c.vd_H.vd_ko(px,py);var pt=vdgeo.vd_bL(px,py,z,vd_c.vd_aN);vd_bZ[X]=pt[X];vd_bZ[Y]=pt[Y];vd_bZ[Z]=pt[Z];vd_bZ[3]=vdConst.OsnapMode_NEA;}var ret=vd_b[ipos][2];if(!ret)return;if(vd_Kh(vd_jd,ret))return;vd_jd.push(ret);vd_OC(ret,vd_O,vd_k,vd_bq);};function vd_Kh(arr,obj){for(var i=0;i<arr.length;i++){if(arr[i][0].length===obj[0].length&&arr[i][1]===obj[1]&&arr[i][0][arr[i][0].length-1]==obj[0][obj[0].length-1])return true;}return false;};function vd_oc(layout){if(layout==null)return null;if(layout.BoundingBox)return layout.BoundingBox;vd_dA.clear();vd_ug(layout.Entities,true,vd_dA,vd_J());layout.BoundingBox=vd_dA.vd_gQ.vd_fD();return layout.BoundingBox;};this.GetExtents=function(){return vd_oc(vd_U.GetActiveLayout());};this.EnableRedraw=function(vd_AD){var ret=vd_wl;vd_wl=vd_AD;return ret;};this.vd_zc=function(){return(vd_U.DrawOverallEntities&&vd_U.DrawOverallEntities.length>0)||vd_U.GripManager.vd_zc();};this.vd_pJ=function(render){try{vd_U.GripManager.vd_pJ(render);if(vd_U.DrawOverallEntities&&vd_U.DrawOverallEntities.length>0){for(var i=0;i<vd_U.DrawOverallEntities.length;i++){vd_U.DrawEntity(vd_U.DrawOverallEntities[i],render);}}}catch(ex){}};var vd_zb=new vd_rf(null,0,0,1,1);this.redraw=function(vd_sR,vd_Qh){if(!vd_wl)return;if(vd_aw!=null)clearTimeout(vd_aw);vd_aw=null;var t1_0,t1_1;t1_0=new Date().getTime();var vd_t=vd_J();var layout=vd_U.GetActiveLayout();var vd_Ky=vd_c.vd_H.vd_xB();vd_iP(layout,vd_sR);vd_c.vd_H.vd_eo=true;if(vd_t!=null){vd_c.vd_hK(vd_t.Palette,layout.BkColorEx);}vd_c.clear();if(vd_t!=null&& !vd_Qh){var vd_pO=vd_c.vd_kv(layout.ShowHidenEdges);vd_ug(layout.Entities,true,vd_c,vd_t);vd_c.vd_kv(vd_pO);}if(vd_U.AfterDrawInView){vd_zb.vd_vr(vd_U.AfterDrawInView,vd_c.vd_H.vd_qu(),vd_U,vd_c,0);}vd_U.Refresh();vd_c.vd_H.vd_KC();if(vd_Ky)Action.show();Action.draw();vd_uQ=null;t1_1=new Date().getTime();vd_ei=t1_1-t1_0;vd_CK();if(vd_U.AfterRedraw!=null)vd_U.AfterRedraw(vd_U);};this.GetXREFS=function(){if(!vd_tZ())return[];if(!vd_tZ().vd_jR)vd_tZ().vd_jR=[];return vd_tZ().vd_jR;};function vd_Hx(vd_BD,vd_Dw,vd_DP,blockref){var vd_U=this;this.target=vd_BD;this.Block=blockref;this.KeyFile=vd_Dw;this.OriginalSingleFileName=vd_Dw;this.OriginalPath=vd_DP;this.UrlPath=vd_DP;this.documentdata=new vd_wk(vd_BD);this.Cancel=false;this.load=function(){if(vd_U.Block.vd_nr&&vd_U.documentdata&&vd_U.documentdata.vdDocument&&vd_U.documentdata.vd_hL!==""){var vd_wo=vd_U.Block.vd_nr;vd_U.Block.vd_nr=undefined;vd_Af.vd_ET(vd_U);vd_wo(vd_U);return true;}if(vd_U.documentdata&& !vd_U.documentdata.vdDocument&&vd_U.documentdata.vd_hL==""){if(vd_U.target.vdLoadXref)vd_U.target.vdLoadXref(vd_U);if(vd_U.Block.vd_iD)vd_U.Block.ExternalReferencePath='';if(!vd_U.Cancel){var vd_EF=function(){vd_Af.vd_ET(vd_U);if(vd_U.Block.vd_nr){var vd_wo=vd_U.Block.vd_nr;vd_U.Block.vd_nr=undefined;vd_wo(vd_U);}else{vd_U.target.UpdateLayout();setTimeout(vd_U.target.redraw,0);if(vd_U.target.vdXrefLoaded)vd_U.target.vdXrefLoaded(vd_U);}};if(vd_U.Block.vd_ld){var vd_ld=vd_U.Block.vd_ld;vd_U.Block.vd_ld=undefined;setTimeout(vd_U.documentdata.LoadDocument(vd_U.UrlPath,false,vd_EF,vd_ld),0);}else{setTimeout(vd_U.target.vd_wC(vd_U.documentdata,vd_U.UrlPath,false,vd_EF),0);}return true;}}return false;};return this;};function vd_CK(){var vd_eQ=vd_U.GetXREFS();for(var idoc=0;idoc<vd_eQ.length;idoc++){if(vd_eQ[idoc].load())return;}};function vd_Dr(){vd_U.canvas.title="";};function vd_Pb(vd_sQ,vd_uG){var maxx=Math.max(vd_uG[X],vd_sQ[X]);var minx=Math.min(vd_uG[X],vd_sQ[X]);var vd_N=Math.max(vd_uG[Y],vd_sQ[Y]);var vd_T=Math.min(vd_uG[Y],vd_sQ[Y]);var w=maxx-minx;var h=vd_N-vd_T;var l1=vd_c.width/w;var l2=vd_c.height/h;var l=Math.min(l1,l2);return(vd_c.height/l);};this.zoomwindow=function(np1,np2,vd_Lj){var layout=vd_U.GetActiveLayout();if(layout==null)return;var p1=vdgeo.newpoint(np1[X],np1[Y],np1[Z]);var p2=vdgeo.newpoint(np2[X],np2[Y],np2[Z]);var vd_bD=vdgeo.vd_dD(layout.World2ViewMatrix);if(!vd_Lj){if(vd_c.vd_ak&&vd_c.vd_bH){var _p1=vdgeo.vd_bL(p1[X],p1[Y],p1[Z],vd_c.vd_dm);var _p2=vdgeo.vd_bL(p2[X],p2[Y],p2[Z],vd_c.vd_dm);if(vd_c.vd_Fl(_p1[X],_p1[Y])&&vd_c.vd_Fl(_p2[X],_p2[Y])){var z=vd_c.vd_H.vd_MG(_p1[X],_p2[X],_p1[Y],_p2[Y]);p1=vdgeo.vd_bL(_p1[X],_p1[Y],z,vd_c.vd_aN);p2=vdgeo.vd_bL(_p2[X],_p2[Y],z,vd_c.vd_aN);vd_bD=vdgeo.vd_dD(vd_c.vd_bE());}}}var vd_B=vdgeo.MidPoint(p1,p2);var vd_iX,vd_rm,vd_mo,vd_pI,vd_qM;var vd_qD=Math.abs(p2[X]-p1[X]);var vd_oE=Math.abs(p2[Y]-p1[Y]);var vd_km=0;var vd_jY=vd_U.canvas.width/vd_U.canvas.height;if(!layout.FocalLength)layout.FocalLength=0.05;if(!layout.LensAngle)layout.LensAngle=60.0;if(vd_qD/vd_oE<vd_jY){vd_iX=vdgeo.DegreesToRadians(layout.LensAngle)/2;vd_rm=vd_oE/2;vd_km=vd_rm/Math.tan(vd_iX);}else{vd_mo=2.0*layout.FocalLength*Math.tan(vdgeo.DegreesToRadians(layout.LensAngle/2.0));vd_pI=vdgeo.RadiansToDegrees(Math.atan(vd_mo*vd_jY*0.5/layout.FocalLength))*2.0;vd_iX=vdgeo.DegreesToRadians(vd_pI)/2;vd_qM=vd_qD/2;vd_km=vd_qM/Math.tan(vd_iX);}vd_B[Z]=Math.max(p1[Z],p2[Z])+vd_km;var vd_Z=vd_Pb(p1,p2);var vd_bm=new vd_nP(vd_U,vd_B[X],vd_B[Y],vd_B[Z],vd_Z,vd_bD);if(vd_U.vdUpdateView!=null)vd_U.vdUpdateView(vd_bm);if(!vd_bm.Cancel){layout.ViewSize=vd_bm.ViewSize;layout.ViewCenter=vdgeo.newpoint(vd_bm.ViewCenterX,vd_bm.ViewCenterY,vd_bm.ViewCenterZ);layout.World2ViewMatrix=vd_bm.vd_vc;vd_iP(layout);}};this.zoomExtents=function(){var layout=vd_U.GetActiveLayout();if(layout==null)return;var vd_gP=vd_oc(layout);if(layout.GridMode){var vd_mI=new vd_hx();vd_mI.vd_hc(vd_gP);vd_mI.vd_hc(layout.Limits);vd_gP=vd_mI.vd_fD();}if(vd_gP==null)return;var box=vdgeo.vd_ux(layout.World2ViewMatrix,vd_gP);var bmin=vdgeo.newpoint(box[0],box[1],box[2]);var bmax=vdgeo.newpoint(box[3],box[4],box[5]);vd_U.zoomwindow(bmin,bmax,true);};this.SetStdView=function(vd_gq){var layout=vd_U.GetActiveLayout();if(layout==null)return;var vd_ed=vdgeo.newpoint(0.0,0.0,1.0);if(vd_gq===vdConst.StdView_TOP){vd_ed=vdgeo.newpoint(0.0,0.0,1.0);}else if(vd_gq===vdConst.StdView_BOTTOM){vd_ed=vdgeo.newpoint(0.0,0.0,-1.0);}else if(vd_gq===vdConst.StdView_FRONT){vd_ed=vdgeo.newpoint(0.0,-1.0,0.0);}else if(vd_gq===vdConst.StdView_BACK){vd_ed=vdgeo.newpoint(0.0,1.0,0.0);}else if(vd_gq===vdConst.StdView_LEFT){vd_ed=vdgeo.newpoint(-1.0,0.0,0.0);}else if(vd_gq===vdConst.StdView_RIGHT){vd_ed=vdgeo.newpoint(1.0,0.0,0.0);}else if(vd_gq===vdConst.StdView_ISO_NE){vd_ed=vdgeo.newpoint(1.0,1.0,1.0);}else if(vd_gq===vdConst.StdView_ISO_NW){vd_ed=vdgeo.newpoint(-1.0,1.0,1.0);}else if(vd_gq===vdConst.StdView_ISO_SE){vd_ed=vdgeo.newpoint(1.0,-1.0,1.0);}else if(vd_gq===vdConst.StdView_ISO_SW){vd_ed=vdgeo.newpoint(-1.0,-1.0,1.0);}var mat=vdgeo.vd_e();vdgeo.vd_gB(mat,vd_ed);layout.World2ViewMatrix=mat;vd_U.zoomExtents();};this.LookAt=function(vd_rq,vd_Ic,vd_HM){var mat=vdgeo.vd_e();vdgeo.vd_bw(mat,vd_HM);var vd_ed=vdgeo.VectorDirection(vd_Ic,vd_rq);vdgeo.vd_dl(mat,vd_ed);vdgeo.vd_x(mat,vd_rq[X],vd_rq[Y],vd_rq[Z]);vdgeo.vd_mh(mat);var layout=vd_U.GetActiveLayout();layout.ViewCenter=vdgeo.newpoint(0,0,0);layout.World2ViewMatrix=mat;vd_iP(layout);if(vd_aw!=null)clearTimeout(vd_aw);vd_aw=setTimeout(vd_U.redraw,0);};function vd_vG(v,normalize){var layout=vd_U.GetActiveLayout();if(!layout)return null;var vd_bD=layout.World2ViewMatrix;var v2w=vdgeo.vd_aR(vd_bD);var newV=vdgeo.vd_id(v2w,v[0],v[1],v[2],normalize);return newV;};this.MoveView=function(dx,dy,dz){if(dx===0&&dy===0&&dz===0)return;var origin=vd_U.ViewToWorld(vdgeo.newpoint(0,0,0));var dir,vd_ph,toPt;dir=vd_vG(vdgeo.newpoint(0,0,-1),true);v=vd_vG(vdgeo.newpoint(dx,dy,dz),false);if(!dir|| !v)return;vd_ph=vdgeo.newpoint(origin[X]+v[X],origin[Y]+v[Y],origin[Z]+v[Z]);toPt=vdgeo.newpoint(vd_ph[X]+dir[X],vd_ph[Y]+dir[Y],vd_ph[Z]+dir[Z]);vd_U.LookAt(vd_ph,toPt,0);};this.RotateView=function(vd_Ka,vd_JT){var pt=vdgeo.newpoint(0,0,0);var vd_mr=vd_vG([0,0,-1],true);var vd_ID=vdgeo.GetAngle(pt,vd_mr);var vd_Hs=Math.sqrt(vd_mr[X]*vd_mr[X]+vd_mr[Y]*vd_mr[Y]);var vd_Ie=vdgeo.GetAngle(pt,[vd_Hs,vd_mr[Z],0]);var dir=vdgeo.pointPolar(pt,vd_Ka+vd_ID,1);var vd_hN=vd_JT+vd_Ie;if(vd_hN>vdgeo.PI)vd_hN=vd_hN-vdgeo.VD_TWOPI;vd_hN=Math.min(vd_hN,vdgeo.HALF_PI*0.95);vd_hN=Math.max(vd_hN,-vdgeo.HALF_PI*0.95);dir[Z]=Math.tan(vd_hN);vdgeo.vd_dR(dir);var origin=vd_U.ViewToWorld(pt);var dest=vdgeo.newpoint(origin[X]+dir[X],origin[Y]+dir[Y],origin[Z]+dir[Z]);vd_U.LookAt(origin,dest,0);};this.SetViewAngles=function(vd_KK,tilt,vd_gK,origin){var layout=vd_U.GetActiveLayout();if(!layout.ViewCenter)layout.ViewCenter=vdgeo.newpoint(0,0,0);var vd_xD=vdgeo.vd_aR(layout.World2ViewMatrix);if(!origin)origin=vdgeo.matrixtransform(vd_xD,layout.ViewCenter);origin=vdgeo.matrixtransform(layout.World2ViewMatrix,origin);var mat=vdgeo.vd_e();vdgeo.vd_gM(mat);vdgeo.vd_Lh(mat,tilt);vdgeo.vd_bw(mat,vdgeo.PI+vd_KK);vdgeo.vd_aj(mat,-1,-1,-1);var dir=vdgeo.vd_id(mat,1,0,0,true);vdgeo.vd_gM(mat);vdgeo.vd_gB(mat,dir);vdgeo.vd_bw(mat,vdgeo.VD_TWOPI-vd_gK);layout.ViewCenter=origin;layout.World2ViewMatrix=mat;vd_iP(layout);if(vd_aw!=null)clearTimeout(vd_aw);vd_aw=setTimeout(vd_U.redraw,0);};this.SetBlockSize=function(value){vd_nR=value;if(vd_nR<0&&vd_U.vd_aK.vd_nQ)vd_U.vd_aK.vd_nQ();};this.vd_Eg=function(){var ret=Math.max(20,Math.abs(vd_nR));if(vd_nR<0)ret*= -1;return ret;};this.SetRenderMode=function(mode){var layout=vd_U.GetActiveLayout();if(!layout)return;var vd_t=vd_J();if(vd_t.Model==layout){vd_U.EnableWebGL(mode==vdConst.RENDERMODE_SHADE_GL||mode==vdConst.RENDERMODE_RENDER_GL);}if(mode==vdConst.RENDERMODE_SHADE_GL)layout.RenderMode=vdConst.RENDERMODE_SHADE;else if(mode==vdConst.RENDERMODE_RENDER_GL)layout.RenderMode=vdConst.RENDERMODE_RENDER;else layout.RenderMode=mode;if(vd_aw!=null)clearTimeout(vd_aw);vd_aw=setTimeout(vd_U.redraw,0);};this.EnableWebGL=function(value){vd_U.vd_fO=value;};this.WebGLisActive=function(value){return vd_c.vd_ab();};this.GetViewBox=function(){if(vd_J()==null)return null;return{left:vd_c.vd_bo.left,bottom:vd_c.vd_bo.bottom,right:vd_c.vd_bo.right,top:vd_c.vd_bo.top};};this.GetPixelSize=function(){if(vd_J()==null)return 0.0;return vd_c.GetPixelSize();};this.vd_CF=function(from,tox,toy,vd_eR){var layout=vd_U.GetActiveLayout();if(layout==null)return;var vd_ot=from[X];var vd_pi=from[Y];var vd_mK=from[Z];var x=tox-vd_ot;var y=toy-vd_pi;if(x==0&&y==0)return;var vd_B=vdgeo.newpoint(layout.ViewCenter[X],layout.ViewCenter[Y],layout.ViewCenter[Z]);var vd_Z=layout.ViewSize;var vd_qP=vdgeo.vd_dD(layout.World2ViewMatrix);var org=vdgeo.vd_bL(vd_ot,vd_pi,vd_mK,vd_c.vd_aN);if(vd_c.vd_ak){if(vd_mK>=1&&vd_c.vd_uH){var box=vdgeo.vd_ux(vd_qP,vd_c.vd_uH);org=vdgeo.vd_Lx(box);}}if(vd_cU){if(!vd_cU.vd_wi){vd_cU.vd_wi=[vd_qP,org];}else{org=vd_cU.vd_wi[1];vd_qP=vd_cU.vd_wi[0];}}var vd_BT=1;var dz=vd_BT*vdgeo.VD_TWOPI*0.5*x/vd_c.width;var dx=vd_BT*vdgeo.PI*0.5*y/vd_c.height;var v=vdgeo.vd_id(vd_qP,0,0,1,true);var vd_bD;vd_bD=vdgeo.vd_e();vdgeo.vd_cr(vd_bD,vd_qP);vdgeo.vd_x(vd_bD,-org[X],-org[Y],-org[Z]);vdgeo.vd_Mj(vd_bD,v,dz);vdgeo.vd_KF(vd_bD,dx);vdgeo.vd_x(vd_bD,org[X],org[Y],org[Z]);var vd_bm=new vd_nP(vd_U,vd_B[X],vd_B[Y],vd_B[Z],vd_Z,vd_bD);if(vd_U.vdUpdateView!=null)vd_U.vdUpdateView(vd_bm);if(!vd_bm.Cancel){layout.ViewSize=vd_bm.ViewSize;layout.ViewCenter=vdgeo.newpoint(vd_bm.ViewCenterX,vd_bm.ViewCenterY,vd_bm.ViewCenterZ);layout.World2ViewMatrix=vd_bm.vd_vc;vd_iP(layout);if(vd_eR!=undefined&&vd_eR>=0){if(vd_eR===0)vd_U.redraw();else vd_sG(vd_mV,vd_Ag);}}};this.scroll=function(from,tox,toy,vd_eR){var layout=vd_U.GetActiveLayout();if(layout==null)return;var vd_ot=from[X];var vd_pi=from[Y];var vd_mK=from[Z];var x=tox-vd_ot;var y=toy-vd_pi;if(x==0&&y==0)return;vd_CP(vd_mK);var vd_bD=vdgeo.vd_dD(layout.World2ViewMatrix);var vd_Z=layout.ViewSize;var vd_B=vdgeo.newpoint(layout.ViewCenter[X],layout.ViewCenter[Y],layout.ViewCenter[Z]);if(vd_c.vd_ak&&vd_c.vd_bH){var z=vd_mK;var fv=vdgeo.vd_bL(vd_ot,vd_pi,z,vd_c.vd_aN);var tv=vdgeo.vd_bL(tox,toy,z,vd_c.vd_aN);var dx=tv[X]-fv[X];var dy=tv[Y]-fv[Y];vd_B[X]-=dx;vd_B[Y]-=dy;}else{vd_B[X]-=vd_c.GetPixelSize()*x;vd_B[Y]+=vd_c.GetPixelSize()*y;}var vd_bm=new vd_nP(vd_U,vd_B[X],vd_B[Y],vd_B[Z],vd_Z,vd_bD);if(vd_U.vdUpdateView!=null)vd_U.vdUpdateView(vd_bm);if(!vd_bm.Cancel){layout.ViewSize=vd_bm.ViewSize;layout.ViewCenter=vdgeo.newpoint(vd_bm.ViewCenterX,vd_bm.ViewCenterY,vd_bm.ViewCenterZ);layout.World2ViewMatrix=vd_bm.vd_vc;vd_iP(layout);if(vd_eR!=undefined&&vd_eR>=0){if(vd_eR===0)vd_U.redraw();else vd_CH(vd_eR);}vd_cU=[vdgeo.vd_u(tox),vdgeo.vd_u(toy),vd_mK];}};function vd_AW(x,y,z,scale){if(scale==0||scale==1)return null;var layout=vd_U.GetActiveLayout();if(layout==null)return null;var vd_Z=vd_c.vd_Z;var vd_B=vdgeo.newpoint(layout.ViewCenter[X],layout.ViewCenter[Y],layout.ViewCenter[Z]);if(vd_c.vd_ak&&vd_c.vd_bH){var vd_fi=vd_c.vd_H.vd_fi;var zFar=vd_c.vd_H.zFar;var fv=vdgeo.vd_bL(x,y,z,vd_c.vd_aN);var vd_Pj=Math.abs(vd_fi-zFar)*0.08;var vd_Gp=(1-scale)*vd_Pj;var pp=vdgeo.vd_bL(fv[X],fv[Y],fv[Z]+vd_Gp,vd_c.vd_dm);var tv=vdgeo.vd_bL(pp[X],pp[Y],z,vd_c.vd_aN);var dx=tv[X]-fv[X];var dy=tv[Y]-fv[Y];vd_B[X]+=dx;vd_B[Y]+=dy;vd_B[Z]-=vd_Gp;}else{vd_Z*=scale;var vd_Gh=vdgeo.matrixtransform(vd_c.vd_aN,vdgeo.newpoint(x,y,0));var pixelsize=vd_Z/vd_c.height;vd_B=vdgeo.newpoint(vd_Gh[X]+(vd_c.width/2.0-x)*pixelsize,vd_Gh[Y]+(y-vd_c.height/2.0)*pixelsize,vd_B[Z]);}return[vd_B,vd_Z];};this.zoomScale=function(x,y,Delta,vd_eR){var z=vd_c.vd_H.vd_ko(x,y);var vd_eg=vd_AW(x,y,z,Delta);if(!vd_eg)return;var layout=vd_U.GetActiveLayout();vd_CP(z);var vd_bD=vdgeo.vd_dD(layout.World2ViewMatrix);var vd_B=vd_eg[0];var vd_Z=vd_eg[1];var vd_bm=new vd_nP(vd_U,vd_B[X],vd_B[Y],vd_B[Z],vd_Z,vd_bD);if(vd_U.vdUpdateView!=null)vd_U.vdUpdateView(vd_bm);if(!vd_bm.Cancel){layout.ViewSize=vd_bm.ViewSize;layout.ViewCenter=vdgeo.newpoint(vd_bm.ViewCenterX,vd_bm.ViewCenterY,vd_bm.ViewCenterZ);layout.World2ViewMatrix=vd_bm.vd_vc;vd_iP(layout);if(vd_eR==undefined||vd_eR<0)return;else if(vd_eR===0)vd_U.redraw();else vd_CH(vd_eR);}};this.vd_Ne=function(vd_jO,vd_kx,pos1,pos2,vd_xi){if((vd_xi&(vdConst.DEFAULT_ZOOMSCALE|vdConst.DEFAULT_ROTATE3D))==0)return;var vd_yh=vd_jO[X]-vd_kx[X];var vd_xy=vd_jO[Y]-vd_kx[Y];var dx=pos1[X]-pos2[X];var dy=pos1[Y]-pos2[Y];var vd_yW=(vd_jO[X]+vd_kx[X])/2;var vd_AL=(vd_jO[Y]+vd_kx[Y])/2;var vd_KI=Math.sqrt(vd_yh*vd_yh+vd_xy*vd_xy);var vd_KQ=Math.sqrt(dx*dx+dy*dy);var scale=vd_KI/vd_KQ;var vd_xL=Math.atan2(vd_xy,vd_yh);var vd_yj=Math.atan2(dy,dx);vd_xL=vdgeo.FixAngle(vd_xL);vd_yj=vdgeo.FixAngle(vd_yj);var rot=vdgeo.FixAngle(vd_yj-vd_xL);var layout=vd_U.GetActiveLayout();var vd_bD=vdgeo.vd_dD(layout.World2ViewMatrix);var vd_Z=layout.ViewSize;var vd_B=vdgeo.newpoint(layout.ViewCenter[X],layout.ViewCenter[Y],layout.ViewCenter[Z]);var z=vd_c.vd_H.vd_ko(vd_yW,vd_AL);if((vd_xi&vdConst.DEFAULT_ROTATE3D)&&rot>3*vdgeo.PI/180){var vd_ni=vdgeo.vd_bL(vd_yW,vd_AL,z,vd_c.vd_aN);vdgeo.vd_x(vd_bD,-vd_ni[X],-vd_ni[Y],-vd_ni[Z]);vdgeo.vd_bw(vd_bD,-rot);vdgeo.vd_x(vd_bD,vd_ni[X],vd_ni[Y],vd_ni[Z]);}if((vd_xi&vdConst.DEFAULT_ZOOMSCALE)&& !vdgeo.AreEqual(scale,1.0,0.001)){var vd_eg=vd_AW(vd_yW,vd_AL,z,scale);if(vd_eg){vd_B=vd_eg[0];vd_Z=vd_eg[1];}}var vd_bm=new vd_nP(vd_U,vd_B[X],vd_B[Y],vd_B[Z],vd_Z,vd_bD);if(vd_U.vdUpdateView!=null)vd_U.vdUpdateView(vd_bm);if(!vd_bm.Cancel){layout.World2ViewMatrix=vd_bD;layout.ViewSize=vd_Z;layout.ViewCenter=vd_B;vd_iP(layout);vd_sG(vd_mV,vd_Ag);}};function vd_Ag(){if(vd_aw!=null)clearTimeout(vd_aw);vd_aw=null;var vd_t=vd_J();if(!vd_t)return;var layout=vd_U.GetActiveLayout();if(!layout)return;var vd_nq;var vd_le=vd_c.vd_bJ;if(vd_c.vd_ab()){if(vd_ei>vd_tb){vd_c.vd_bJ=false;}vd_U.redraw(true);vd_nq=vd_c.vd_bJ!=vd_le;vd_c.vd_bJ=vd_le;if(vd_nq)setTimeout(vd_U.redraw,Math.max(vd_qw,vd_ei));return;}var vd_Bx=vd_c.vd_fl;var vd_Oz=vd_c.vd_fx;var vd_BQ=vd_c.RenderMode;var vd_Cq=vd_c.vd_bH;var vd_Py=vd_U.GetImageInterpolationMode();if(vd_ei>vd_tb){vd_U.SetImageInterpolationMode(vdConst.InterpolationMode_Nearest);vd_c.vd_bJ=false;if(!vd_c.vd_ab()){if(vd_ei>vd_tb){vd_c.vd_fl=false;if(vd_ei>vd_GP){vd_c.RenderMode=vdConst.vd_xd;}}}}vd_U.redraw(true);vd_nq=vd_c.vd_bJ!=vd_le||vd_c.vd_fl!=vd_Bx||vd_c.RenderMode!=vd_BQ||vd_c.vd_bH!=vd_Cq;vd_U.SetImageInterpolationMode(vd_Py);vd_c.vd_bJ=vd_le;vd_c.vd_fl=vd_Bx;vd_c.vd_fx=vd_Oz;vd_c.RenderMode=vd_BQ;vd_c.vd_bH=vd_Cq;if(vd_nq)setTimeout(vd_U.redraw,Math.max(vd_qw,vd_ei));};function vd_sG(vd_nG,vd_OR){if(vd_ei>0&&vd_ei<vd_nG)vd_nG=vd_ei;if(vd_aw!=null)clearTimeout(vd_aw);vd_aw=setTimeout(vd_OR,vd_nG);};function vd_CP(vd_uC){if(vd_uQ==null){vd_OY();vd_uQ=[vdgeo.vd_dD(vd_c.vd_aN),vd_uC];}};function vd_CH(vd_nG){var layout=vd_U.GetActiveLayout();if(layout==null)return;vd_iP(layout);if(vd_c.vd_ab()||(vd_c.vd_ak&&vd_c.vd_bH)){vd_sG(vd_mV,vd_Ag);}else{var vd_LA=vdgeo.vd_gW(vd_uQ[0],vd_c.vd_dm);vd_Px(vd_LA);vd_Dr();var vd_Rv=vd_mV;vd_mV=500;vd_sG(vd_nG,vd_RK);vd_mV=vd_Rv;}};function vd_RK(){if(vd_aw!=null)clearTimeout(vd_aw);vd_aw=null;var vd_le=vd_c.vd_bJ;if(vd_ei>vd_tb){vd_c.vd_bJ=false;}vd_U.redraw(true);var vd_nq=vd_c.vd_bJ!=vd_le;vd_c.vd_bJ=vd_le;if(vd_nq)vd_aw=setTimeout(vd_U.redraw,Math.max(vd_qw,vd_ei));};this.UndoHistory=function(){var vd_t=vd_J();if(vd_t==null)return null;return vd_t.UndoHistory;};this.GetDocument=function(){return vd_J();};this.SetDocument=function(document){if(!document||vd_bg==null)return false;vd_bg.vdDocument=document;vd_ws();return true;};this.GetActiveLayout=function(){var vd_t=vd_J();if(vd_t==null)return null;if(!vd_t.ActiveLayOutRef){if(vd_t.LayOuts==undefined||vd_t.LayOuts[vd_t.ActiveLayOut]==undefined)vd_t.ActiveLayOutRef=vd_t.Model;else vd_t.ActiveLayOutRef=vd_t.LayOuts.Items[vd_t.LayOuts[vd_t.ActiveLayOut]];}return vd_t.ActiveLayOutRef;};this.SetActiveLayout=function(layout){var vd_t=vd_J();if(vd_t==null)return;if(!layout)layout=vd_t.Model;vd_t.ActiveLayOutRef=layout;vd_t.ActiveLayOut='h_'+layout.HandleId.toString();if(vd_aw!=null)clearTimeout(vd_aw);vd_aw=setTimeout(vd_U.redraw,0);};this.NumLayouts=function(){var vd_t=vd_J();if(vd_t==null)return 0;if(vd_t.LayOuts==undefined)return 0;return vd_t.LayOuts.Items.length;};this.GetActiveLayoutId=function(){var vd_t=vd_J();if(vd_t==null)return-1;if(vd_t.LayOuts==undefined)return-1;var vd_Av=vd_t.LayOuts[vd_J().ActiveLayOut];if(vd_Av==undefined)vd_Av= -1;return vd_Av;};this.SetActiveLayoutId=function(id){var vd_t=vd_J();if(vd_t==null)return;id=Math.max(-1,id);if(id>=vd_U.NumLayouts())id= -1;var layout=null;if(id== -1)layout=vd_t.Model;else layout=vd_t.LayOuts.Items[id];vd_U.SetActiveLayout(layout);};this.FindLayout=function(name){var vd_t=vd_J();if(vd_t==null)return null;name=name.toLowerCase();if(name=="model"|| !vd_t.LayOuts)return-1;for(var i=0;i<vd_t.LayOuts.Items.length;i++){var layout=vd_t.LayOuts.Items[i];var vd_gL=layout.Name.toLowerCase();if(vd_gL==name)return i;}return-1;};this.GetLayouts=function(){var vd_t=vd_J();if(vd_t==null)return null;var ret=[vd_t.Model];if(vd_t.LayOuts){for(var i=0;i<vd_t.LayOuts.Items.length;i++){var layout=vd_t.LayOuts.Items[i];ret.push(layout);}}return ret;};this.GetBlocks=function(){var vd_t=vd_J();if(vd_t==null)return null;var ret=[];for(var i=0;i<vd_t.Blocks.Items.length;i++){var block=vd_U.GetDictItem(vd_t.Blocks,vd_t.Blocks.Items[i]);ret.push(block);}return ret;};this.GetImages=function(){var vd_t=vd_J();if(vd_t==null)return null;var ret=[];for(var i=0;i<vd_t.Images.Items.length;i++){var vd_j=vd_U.GetDictItem(vd_t.Images,vd_t.Images.Items[i]);ret.push(vd_j);}return ret;};this.GetLayers=function(){var vd_t=vd_J();if(vd_t==null)return null;var ret=[];for(var i=0;i<vd_t.Layers.Items.length;i++){var layer=vd_U.GetDictItem(vd_t.Layers,vd_t.Layers.Items[i]);ret.push(layer);}return ret;};this.FindLayer=function(name){var vd_t=vd_J();if(vd_t==null)return null;name=name.toLowerCase();for(var i=0;i<vd_t.Layers.Items.length;i++){var layer=vd_U.GetDictItem(vd_t.Layers,vd_t.Layers.Items[i]);var vd_gL=layer.Name.toLowerCase();if(vd_gL==name)return layer;}return null;};this.FindLineType=function(name){var vd_t=vd_J();if(vd_t==null)return null;name=name.toLowerCase();for(var i=0;i<vd_t.LineTypes.Items.length;i++){var vd_FY=vd_U.GetDictItem(vd_t.LineTypes,vd_t.LineTypes.Items[i]);var vd_gL=vd_FY.Name.toLowerCase();if(vd_gL==name)return vd_FY;}return null;};this.GetLineTypes=function(){var vd_t=vd_J();if(vd_t==null)return null;var ret=[];for(var i=0;i<vd_t.LineTypes.Items.length;i++){var linetype=vd_U.GetDictItem(vd_t.LineTypes,vd_t.LineTypes.Items[i]);ret.push(linetype);}return ret;};this.FindTextStyle=function(name){var vd_t=vd_J();if(vd_t==null)return null;name=name.toLowerCase();for(var i=0;i<vd_t.TextStyles.Items.length;i++){var vd_ou=vd_U.GetDictItem(vd_t.TextStyles,vd_t.TextStyles.Items[i]);var vd_gL=vd_ou.Name.toLowerCase();if(vd_gL==name)return vd_ou;}return null;};this.GetTextStyles=function(){var vd_t=vd_J();if(vd_t==null)return null;var ret=[];for(var i=0;i<vd_t.TextStyles.Items.length;i++){var textstyle=vd_U.GetDictItem(vd_t.TextStyles,vd_t.TextStyles.Items[i]);ret.push(textstyle);}return ret;};this.SetActiveLayer=function(layer){var vd_t=vd_J();if(vd_t==null)return;if(layer==null)layer=vd_U.GetDictItem(vd_t.Layers,vd_t.Layers.Items[0]);vd_t.ActiveLayer='h_'+layer.HandleId.toString();};this.SetActiveLineType=function(lt){var vd_t=vd_J();if(vd_t==null)return;if(lt==null)lt=vd_U.GetDictItem(vd_t.LineTypes,vd_t.LineTypes.Items[0]);vd_t.ActiveLineType='h_'+lt.HandleId.toString();};this.SetActiveTextStyle=function(style){var vd_t=vd_J();if(vd_t==null)return;if(style==null)style=vd_U.GetDictItem(vd_t.TextStyles,vd_t.TextStyles.Items[0]);vd_t.ActiveTextStyle='h_'+style.HandleId.toString();};this.SetActivePenWidth=function(pw){var vd_t=vd_J();if(vd_t==null)return;vd_t.ActivePenWidth=pw;};this.SetActiveLineWeight=function(lw){var vd_t=vd_J();if(vd_t==null)return;vd_t.ActiveLineWeight=lw;};this.SetActivePenColor=function(col){var vd_t=vd_J();if(vd_t==null)return;vd_t.ActivePenColor=col;};this.GetActivePenColor=function(){var vd_t=vd_J();if(vd_t==null)return null;return vd_t.ActivePenColor;};this.GetActiveHatchProperties=function(){var vd_t=vd_J();if(vd_t==null)return null;var vd_V=vd_t.ActiveHatchProperties;if(!vd_V){vd_V=vd_U.createNewHatchProperties();vd_t.ActiveHatchProperties=vd_V;}return vd_t.ActiveHatchProperties;};this.GetActiveThickness=function(){var vd_t=vd_J();if(vd_t==null)return 0.0;if(!vd_t.vd_rs)return 0.0;return vd_t.vd_rs;};this.SetActiveThickness=function(thickness){var vd_t=vd_J();if(vd_t==null)return;vd_t.vd_rs=thickness;};this.SetActiveHatchProperties=function(vd_JG){var vd_t=vd_J();if(vd_t==null)return;vd_t.ActiveHatchProperties=vd_JG;};this.vd_NN=function(name){var vd_t=vd_J();if(vd_t==null)return null;if(!name)return null;name=name.toLowerCase();for(var i=0;i<vd_t.HatchPatterns.Items.length;i++){var hpat=vd_U.GetDictItem(vd_t.HatchPatterns,vd_t.HatchPatterns.Items[i]);var vd_Om=hpat.Name.toLowerCase();if(vd_Om==name)return hpat;}return null;};this.GetHatchPatterns=function(){var vd_t=vd_J();if(vd_t==null)return null;var ret=[];for(var i=0;i<vd_t.HatchPatterns.Items.length;i++){var vd_IY=vd_U.GetDictItem(vd_t.HatchPatterns,vd_t.HatchPatterns.Items[i]);ret.push(vd_IY);}return ret;};this.createNewHatchProperties=function(vd_iS,FillBkColor,FillColor,vd_jD,vd_iy){if(!vd_iS&& !FillBkColor&& !FillColor||vd_iS=="")return null;var vd_se=vd_U.vd_NN(vd_iS);if(!vd_se)return null;var vd_BX='h_0';var Dpi=false;if(vd_se){vd_BX='h_'+vd_se.HandleId;Dpi=vd_U.vd_IX(vd_se.Name)}var vd_ac;if(FillBkColor)vd_ac=FillBkColor;else vd_ac={};var color;if(FillColor)color=FillColor;else color={};if(!vd_iy)vd_iy=0.0;if(!vd_jD)vd_jD=1.0;return{HatchPattern:vd_BX,IsDpi:Dpi,DrawBoundary:false,FillBkColor:vd_ac,FillColor:color,HatchAngle:vd_iy,HatchScale:vd_jD,gradientTypeProp:0,gradientColor2:undefined,gradientAngle:0,HatchOrigin:[0,0,0]};};this.vd_IX=function(vd_kW){return(vd_kW.toUpperCase().indexOf("U10")>=0||vd_kW.toUpperCase().indexOf("U20")>=0||vd_kW.toUpperCase().indexOf("U10_45")>=0||vd_kW.toUpperCase().indexOf("U10_135")>=0||vd_kW.toUpperCase().indexOf("U10_90")>=0||vd_kW.toUpperCase().indexOf("U10_45_135")>=0);};this.vd_nO=function(vd_bX){if(!vd_bX)return null;var ret={};ret.HatchPattern=vd_bX.HatchPattern;ret.IsDpi=vd_bX.IsDpi;ret.DrawBoundary=vd_bX.DrawBoundary;ret.FillBkColor=vdConst.vd_sJ(vd_bX.FillBkColor);ret.FillColor=vdConst.vd_sJ(vd_bX.FillColor);ret.HatchAngle=vd_bX.HatchAngle;ret.HatchScale=vd_bX.HatchScale;ret.gradientTypeProp=vd_bX.gradientTypeProp;if(vd_bX.gradientColor2)ret.gradientColor2=vd_bX.gradientColor2.concat([]);ret.gradientAngle=vd_bX.gradientAngle;if(vd_bX.HatchOrigin)ret.HatchOrigin=vd_bX.HatchOrigin.concat([]);if(vd_bX.Solid2dTransparency!==undefined)ret.Solid2dTransparency=vd_bX.Solid2dTransparency;return ret;};this.FindBlock=function(name){var vd_t=vd_J();if(vd_t==null)return null;name=name.toLowerCase();for(var i=0;i<vd_t.Blocks.Items.length;i++){var block=vd_U.GetDictItem(vd_t.Blocks,vd_t.Blocks.Items[i]);var vd_gL=block.Name.toLowerCase();if(vd_gL==name)return block;}return null;};this.GetEntityPosition=function(entity,vd_aA){if(!entity|| !entity.HandleId)return-1;var vd_t=vd_J();if(!vd_t)return-1;var layout=vd_U.GetActiveLayout();if(!layout)return-1;if(!vd_aA)vd_aA=layout.Entities;var hid='h_'+entity.HandleId.toString();var p=vd_aA.Items.indexOf(hid);return p;};this.SetEntityPosition=function(entity,pos,vd_aA){if(!entity|| !entity.HandleId)return-1;var vd_t=vd_J();if(!vd_t)return-1;var layout=vd_U.GetActiveLayout();if(!layout)return-1;if(!vd_aA)vd_aA=layout.Entities;var hid='h_'+entity.HandleId.toString();var p=vd_aA.Items.indexOf(hid);if(p<0)return-1;if(!pos||pos<0)pos=0;if(pos>=vd_aA.Items.length-1)pos=vd_aA.Items.length-1;if(p==pos)return pos;vd_aA.Items.splice(p,1);vd_aA.Items.splice(pos,0,hid);return pos;};this.vd_fj=function(){var vd_t=vd_J();return vdConst.vd_EQ(vd_t);};this.AddFigureToCollection=function(vd_rI,ent){return vd_U.vd_by(vd_rI,ent,true);};this.vd_by=function(vd_rI,ent,vd_LS){if(!vd_rI.Items)return false;if(vd_J()[hid])return false;if((!vd_LS&& !ent.HandleId))return false;if(!ent.HandleId)ent.HandleId=vd_U.vd_fj();var hid='h_'+ent.HandleId.toString();vd_rI.Items.push(hid);vd_J()[hid]=ent;return true;};this.CopyObjects=function(entities){var vd_nK=[];var doc=vd_U.GetDocument();var layout=vd_U.GetActiveLayout();for(var i=0;i<entities.length;i++){var ent=entities[i];var obj=vdConst.cloneEntity(ent);obj.HandleId=vd_U.vd_fj();vd_U.vd_by(layout.Entities,obj);vd_nK.push(obj);var perc=i/entities.length*100;}return vd_nK;};this.ExplodeObjects=function(entities){var vd_nK=[];var j;for(var i=0;i<entities.length;i++){var entity=entities[i];if(entity._t===vdConst.vdInsert_code){vd_U.GetEntityBBox(entity);if(!entity.BlockRef)continue;if(entity.BlockRef.ExternalReferencePath)continue;if(!entity.EcsMatrix)continue;var isArray=entity.Columns>1||entity.Rows>1;var mat=entity.EcsMatrix;for(c=0;c<entity.Columns;c++){for(r=0;r<entity.Rows;r++){if(isArray){var offset=vdgeo.newpoint(c*entity.ColumnDist/entity.Xscale,r*entity.RowDist/entity.Yscale,0.0);var omat=vdgeo.vd_e();vdgeo.vd_x(omat,offset[X],offset[Y],offset[Z]);mat=vdgeo.vd_gW(omat,entity.EcsMatrix)}for(j=0;j<entity.BlockRef.Entities.Items.length;j++){var vd_rb=vd_U.GetEntityItem(entity.BlockRef.Entities.Items[j]);var vd_fL=null;if(vd_rb._t===vdConst.vdAttribDef_code){if(vd_rb.InVisibleMode!==true&&vd_rb.IsConstant==true){vd_fL=vdConst.cloneEntity(vd_rb);vd_fL.TextString=vd_fL.ValueString;vd_fL._t=vdConst.vdText_code;}}else{vd_fL=vdConst.cloneEntity(vd_rb);}if(!vd_fL)continue;vd_fL.HandleId=0;vd_q.vd_hg(mat,vd_fL,vd_U);vd_nK.push(vd_fL);}mat=vdgeo.vd_e();if(entity.Attributes&&entity.Attributes.Items&&entity.Attributes.Items.length>0){for(c=0;c<entity.Columns;c++){for(r=0;r<entity.Rows;r++){if(isArray){offset=vdgeo.pointPolar(vdgeo.newpoint(0,0,0),entity.Rotation,c*entity.ColumnDist);offset=vdgeo.pointPolar(offset,entity.Rotation+vdgeo.HALF_PI,r*entity.RowDist);omat=vdgeo.vd_e();vdgeo.vd_x(omat,offset[X],offset[Y],offset[Z]);mat=omat;}for(j=0;j<entity.Attributes.Items.length;j++){var vd_iG=entity.Attributes.Items[j];if(vd_iG.IsConstant==true|| !vd_U.vd_vO(vd_iG))continue;vd_fL=vdConst.cloneEntity(vd_iG);vd_fL._t=vdConst.vdText_code;vd_fL.HandleId=0;vd_q.vd_hg(mat,vd_fL,vd_U);vd_nK.push(vd_fL);}}}}}}}}return vd_nK;};this.vd_dv=function(vd_M,vd_t,vd_OV){if(!vd_OV)vd_M.HandleId=vd_U.vd_fj();vd_M.LineType=vd_t.ActiveLineType;vd_M.Layer=vd_t.ActiveLayer;vd_M.PenColor=vdConst.vd_sJ(vd_U.GetActivePenColor());vd_M.PenWidth=vd_t.ActivePenWidth;vd_M.LineWeight=vd_t.ActiveLineWeight;if(vd_t.vd_lC)vd_M.LineTypeScale=vd_t.vd_lC;};this.AddText=function(vd_HE,height,vd_kL,vd_Ap,vd_mu,rotation,vd_bA,entities){var layout=vd_U.GetActiveLayout();if(layout==null)return null;var vd_t=vd_J();var vd_M={};vd_U.vd_dv(vd_M,vd_t,entities&& !entities.Items);vd_M._t=vdConst.vdText_code;vd_M.InsertionPoint=vd_kL;vd_M.TextString=vd_HE;vd_M.Rotation=rotation;vd_M.Style=vd_t.ActiveTextStyle;var ts=vd_U.GetDictItem(vd_t.TextStyles,vd_t.ActiveTextStyle);if(ts){if(vd_Ap==undefined&&ts.HorJustify!=undefined)vd_M.HorJustify=ts.HorJustify;if(vd_mu==undefined&&ts.VerJustify!=undefined)vd_M.VerJustify=ts.VerJustify;}if(height)vd_M.Height=height;if(vd_Ap!=undefined)vd_M.HorJustify=vd_Ap;if(vd_mu!=undefined)vd_M.VerJustify=vd_mu;vd_M.Thickness=vd_U.GetActiveThickness();if(entities)vd_U.vd_by(entities,vd_M);else vd_U.vd_by(layout.Entities,vd_M);vd_U.UpdateLayout(layout);if(vd_bA){vd_bM(vd_M,vd_c,vd_t);vd_U.Refresh(false);}return vd_M;};this.AddCone=function(p1,BaseRadius,TopRadius,hei,num,vd_bA,entities){var VertexList=[];var FaceList=[];var i=0;var k=0;var vd_ie;var p2=[p1[X],p1[Y],p1[Z]];p2[Z]+=hei;for(i=0;i<num;i++){vd_ie=vdgeo.pointPolar(p1,i*vdgeo.VD_TWOPI/num,BaseRadius);VertexList.push(vd_ie);}for(i=0;i<num;i++){vd_ie=vdgeo.pointPolar(p2,i*vdgeo.VD_TWOPI/num,TopRadius);VertexList.push(vd_ie);}for(i=0;i<num-2;i++){k= -1;FaceList.push(k);k= -(i+2);FaceList.push(k);k= -(i+3);FaceList.push(k);FaceList.push(k);k= -1;FaceList.push(k);k= -(1+num);FaceList.push(k);k= -(i+2+num);FaceList.push(k);k= -(i+3+num);FaceList.push(k);FaceList.push(k);k= -1;FaceList.push(k);}for(i=0;i<num;i++){k=i+1;FaceList.push(k);k=(i+1)+num;FaceList.push(k);k=(i+2)+num;if(i==num-1)k=1+num;FaceList.push(k);k=i+2;if(i==num-1)k=1;FaceList.push(k);k= -1;FaceList.push(k);}return vd_U.AddPolyface(VertexList,FaceList,vd_bA,entities);};this.AddSphere=function(p1,rad,lon,lat,vd_bA,entities){var vd_xj=vdgeo.VD_TWOPI/lon;var vd_xp=vdgeo.PI/lat;var k=0,l=0,i=0;var a,sa,va,dp,dh;var pt;var VertexList=[];var FaceList=[];for(k=0;k<lon+1;k++){a=k*vd_xj;sa=vdgeo.PI/ -2.0;for(l=0;l<lat+1;l++){va=sa+l*vd_xp;dp=rad*Math.cos(va);dh=rad*Math.sin(va);pt=vdgeo.pointPolar(p1,a,dp);pt[Z]+=dh;VertexList.push(pt);}}for(k=0;k<lon;k++){for(l=0;l<lat;l++){i=l+(k*(lat+1));i+=1;FaceList.push(i);i=(l+1)+(k*(lat+1));i+=1;FaceList.push(i);i=(l+1)+(k+1)*(lat+1);i+=1;if(k==lon-1){i=(l+1);i+=1;}FaceList.push(i);i=l+(k+1)*(lat+1);i+=1;if(k==lon-1){i=l;i+=1;}FaceList.push(i);i= -1;FaceList.push(i);}}return vd_U.AddPolyface(VertexList,FaceList,vd_bA,entities);};this.AddBox=function(p1,len,wid,hei,rot,vd_bA,entities){var VertexList=[[0,0,0],[len,0,0],[len,wid,0],[0,wid,0],[0,0,hei],[len,0,hei],[len,wid,hei],[0,wid,hei]];var FaceList=[1,2,3,4,-1,5,6,7,8,-1,1,2,6,5,-1,2,3,7,6,-1,3,4,8,7,-1,4,1,5,8,-1];var mat=vdgeo.vd_e();vdgeo.vd_bw(mat,rot);vdgeo.vd_x(mat,p1[X],p1[Y],p1[Z]);VertexList=vdgeo.vd_fN(mat,VertexList);return vd_U.AddPolyface(VertexList,FaceList,vd_bA,entities);};this.TriangulatePolyface=function(vd_mm,precision){if(!vd_mm|| !vd_mm._t||vd_mm._t!=vdConst.vdPolyface_code)return false;if(!precision)precision=8;var ret=vd_yn.vd_Fq(vd_mm.VertexList.Items,precision);var vd_dX=[];for(var i=0;i<ret.length;i+=3){vd_dX.push(ret[i]+1);vd_dX.push(ret[i+1]+1);vd_dX.push(ret[i+2]+1);vd_dX.push(ret[i+2]+1);vd_dX.push(-1);}vd_mm.FaceList.Items=vd_dX;vd_U.UpdateFig(vd_mm);return true;};this.AddHeatMap=function(points,vd_xZ,precision,vd_bA,entities){var layout=vd_U.GetActiveLayout();if(layout==null)return null;var vd_t=vd_J();if(!precision)precision=8;var ret=vd_yn.vd_Fq(points,precision);var vd_dX=[];var i;for(i=0;i<ret.length;i+=3){vd_dX.push(ret[i]+1);vd_dX.push(ret[i+1]+1);vd_dX.push(ret[i+2]+1);vd_dX.push(ret[i+2]+1);vd_dX.push(-1);}var pf=vd_U.AddPolyface(points,vd_dX,false,entities);pf.GradientColors={Items:[]};for(i=0;i<vd_xZ.length;i+=2){pf.GradientColors.Items.push({Key:vd_xZ[i],Value:vd_xZ[i+1]});}pf.GradientColors.Items.sort(function(a,b){return a.Key-b.Key});if(vd_bA){vd_bM(pf,vd_c,vd_t);vd_U.Refresh(false);}return pf;};this.AddPolyface=function(points,vd_Np,vd_bA,entities){var layout=vd_U.GetActiveLayout();if(layout==null)return null;var vd_t=vd_J();var vd_M={};vd_U.vd_dv(vd_M,vd_t,entities&& !entities.Items);vd_M._t=vdConst.vdPolyface_code;vd_M.VertexList={Items:points};vd_M.FaceList={Items:vd_Np};if(entities)vd_U.vd_by(entities,vd_M);else vd_U.vd_by(layout.Entities,vd_M);vd_U.UpdateLayout(layout);if(vd_bA){vd_bM(vd_M,vd_c,vd_t);vd_U.Refresh(false);}return vd_M;};this.AddArc=function(center,radius,vd_yq,vd_xr,vd_bA,entities){var layout=vd_U.GetActiveLayout();if(layout==null)return null;var vd_t=vd_J();var vd_M={};vd_U.vd_dv(vd_M,vd_t,entities&& !entities.Items);vd_M._t=vdConst.vdArc_code;vd_M.Center=center;vd_M.Radius=radius;vd_M.StartAngle=vd_yq;vd_M.EndAngle=vd_xr;vd_M.HatchProperties=vd_U.vd_nO(vd_U.GetActiveHatchProperties());vd_M.Thickness=vd_U.GetActiveThickness();if(entities)vd_U.vd_by(entities,vd_M);else vd_U.vd_by(layout.Entities,vd_M);vd_U.UpdateLayout(layout);if(vd_bA){vd_bM(vd_M,vd_c,vd_t);vd_U.Refresh(false);}return vd_M;};this.AddCircle=function(center,radius,vd_bA,entities){var layout=vd_U.GetActiveLayout();if(layout==null)return null;var vd_t=vd_J();var vd_M={};vd_U.vd_dv(vd_M,vd_t,entities&& !entities.Items);vd_M._t=vdConst.vdCircle_code;vd_M.Center=center;vd_M.Radius=radius;vd_M.HatchProperties=vd_U.vd_nO(vd_U.GetActiveHatchProperties());vd_M.Thickness=vd_U.GetActiveThickness();if(entities)vd_U.vd_by(entities,vd_M);else vd_U.vd_by(layout.Entities,vd_M);vd_U.UpdateLayout(layout);if(vd_bA){vd_bM(vd_M,vd_c,vd_t);vd_U.Refresh(false);}return vd_M;};this.AddEllipse=function(center,vd_LZ,vd_Pl,vd_Ly,vd_yq,vd_xr,vd_bA,entities){var layout=vd_U.GetActiveLayout();if(layout==null)return null;var vd_t=vd_J();var vd_M={};vd_U.vd_dv(vd_M,vd_t,entities&& !entities.Items);vd_M._t=vdConst.vdEllipse_code;vd_M.Center=center;vd_M.MajorAngle=vd_Ly;vd_M.MajorLength=vd_LZ;vd_M.MinorLength=vd_Pl;vd_M.StartAngle=vd_yq;vd_M.EndAngle=vd_xr;vd_M.HatchProperties=vd_U.vd_nO(vd_U.GetActiveHatchProperties());vd_M.Thickness=vd_U.GetActiveThickness();if(entities)vd_U.vd_by(entities,vd_M);else vd_U.vd_by(layout.Entities,vd_M);vd_U.UpdateLayout(layout);if(vd_bA){vd_bM(vd_M,vd_c,vd_t);vd_U.Refresh(false);}return vd_M;};this.AddPointCloud=function(pts,vd_jA,vd_bA,entities){var layout=vd_U.GetActiveLayout();if(layout==null)return null;var vd_t=vd_J();var vd_M={};vd_U.vd_dv(vd_M,vd_t,entities&& !entities.Items);vd_M._t=vdConst.vdPointCloud_code;vd_M.points={Items:pts};vd_M.Colors={Items:vd_jA};if(entities)vd_U.vd_by(entities,vd_M);else vd_U.vd_by(layout.Entities,vd_M);vd_U.UpdateLayout(layout);if(vd_bA){vd_bM(vd_M,vd_c,vd_t);vd_U.Refresh(false);}return vd_M;};this.AddPoint=function(vd_JK,vd_bA,entities){var layout=vd_U.GetActiveLayout();if(layout==null)return null;var vd_t=vd_J();var vd_M={};vd_U.vd_dv(vd_M,vd_t,entities&& !entities.Items);vd_M._t=vdConst.vdPoint_code;vd_M.InsertionPoint=vd_JK;if(entities)vd_U.vd_by(entities,vd_M);else vd_U.vd_by(layout.Entities,vd_M);vd_U.UpdateLayout(layout);if(vd_bA){vd_bM(vd_M,vd_c,vd_t);vd_U.Refresh(false);}return vd_M;};this.AddInfinityLine=function(vd_JH,vd_KW,direction,vd_bA,entities){var layout=vd_U.GetActiveLayout();if(layout==null)return null;var vd_t=vd_J();var vd_M={};vd_U.vd_dv(vd_M,vd_t,entities&& !entities.Items);vd_M._t=vdConst.vdInfinityLine_code;vd_M.BasePoint=vd_KW;vd_M.Direction=direction;vd_M.InfinityType=vd_JH;if(entities)vd_U.vd_by(entities,vd_M);else vd_U.vd_by(layout.Entities,vd_M);vd_U.UpdateLayout(layout);if(vd_bA){vd_bM(vd_M,vd_c,vd_t);vd_U.Refresh(false);}return vd_M;};this.AddLine=function(vd_hM,vd_hW,vd_bA,entities){var layout=vd_U.GetActiveLayout();if(layout==null)return null;var vd_t=vd_J();var vd_M={};vd_U.vd_dv(vd_M,vd_t,entities&& !entities.Items);vd_M._t=vdConst.vdLine_code;vd_M.StartPoint=vd_hM;vd_M.EndPoint=vd_hW;vd_M.Thickness=vd_U.GetActiveThickness();if(entities)vd_U.vd_by(entities,vd_M);else vd_U.vd_by(layout.Entities,vd_M);vd_U.UpdateLayout(layout);if(vd_bA){vd_bM(vd_M,vd_c,vd_t);vd_U.Refresh(false);}return vd_M;};this.AddPolyHatch=function(vd_rB,OutLines,vd_bA,entities){var layout=vd_U.GetActiveLayout();if(layout==null)return null;var vd_t=vd_J();var vd_M={};vd_U.vd_dv(vd_M,vd_t,entities&& !entities.Items);vd_M._t=vdConst.vdPolyhatch_code;vd_M.HatchProperties=vd_U.vd_nO(vd_U.GetActiveHatchProperties());vd_M.Thickness=vd_U.GetActiveThickness();vd_M.Curves={Items:[]};var i,item,npts;if(vd_rB){for(i=0;i<vd_rB.length;i++){item=vd_rB[i];if(Array.isArray(item)){vd_M.Curves.Items.push({Items:item});}else if(typeof item==='object'&&(item._t===vdConst.vdPolyline_code||item._t===vdConst.vdRect_code||item._t===vdConst.vdCircle_code||item._t===vdConst.vdEllipse_code||item._t===vdConst.vdArc_code)){vd_U.GetEntityBBox(item);if(item.SamplePoints){if(item.EcsMatrix)npts=vdgeo.vd_fN(item.EcsMatrix,item.SamplePoints);else npts=item.SamplePoints;vd_M.Curves.Items.push({Items:npts});}}}}if(!OutLines)OutLines=vd_rB;if(OutLines){vd_M.OutLines={Items:[]};for(i=0;i<OutLines.length;i++){item=OutLines[i];if(Array.isArray(item)){vd_M.OutLines.Items.push({Items:item});}else if(typeof item==='object'&&(item._t===vdConst.vdLine_code||item._t===vdConst.vdPolyline_code||item._t===vdConst.vdRect_code||item._t===vdConst.vdCircle_code||item._t===vdConst.vdEllipse_code||item._t===vdConst.vdArc_code)){vd_U.GetEntityBBox(item);if(item.SamplePoints){if(item.EcsMatrix)npts=vdgeo.vd_fN(item.EcsMatrix,item.SamplePoints);else npts=item.SamplePoints;vd_M.OutLines.Items.push({Items:npts});}}}}if(entities)vd_U.vd_by(entities,vd_M);else vd_U.vd_by(layout.Entities,vd_M);vd_U.UpdateLayout(layout);if(vd_bA){vd_bM(vd_M,vd_c,vd_t);vd_U.Refresh(false);}return vd_M;};this.AddPolyline=function(vd_aq,vd_bA,entities){var layout=vd_U.GetActiveLayout();if(layout==null)return null;var vd_t=vd_J();var vd_M={};var k,i;var vd_g;vd_U.vd_dv(vd_M,vd_t,entities&& !entities.Items);vd_M._t=vdConst.vdPolyline_code;vd_M.VertexList={};vd_M.VertexList.Items=[];for(k=0;k<vd_aq.length;k++){vd_g=vd_aq[k];for(i=vd_g.length;i<4;i++)vd_g.push(0.0);vd_M.VertexList.Items.push(vd_g);}vd_M.HatchProperties=vd_U.vd_nO(vd_U.GetActiveHatchProperties());vd_M.Thickness=vd_U.GetActiveThickness();if(entities)vd_U.vd_by(entities,vd_M);else vd_U.vd_by(layout.Entities,vd_M);vd_U.UpdateLayout(layout);if(vd_bA){vd_bM(vd_M,vd_c,vd_t);vd_U.Refresh(false);}return vd_M;};this.AddRect2=function(insertion,width,height,rotation,vd_bA,entities){var layout=vd_U.GetActiveLayout();if(layout==null)return null;var vd_t=vd_J();var vd_M={};vd_U.vd_dv(vd_M,vd_t,entities&& !entities.Items);vd_M._t=vdConst.vdRect_code;vd_M.InsertionPoint=insertion;vd_M.Width=width;vd_M.Height=height;vd_M.Rotation=rotation;vd_M.HatchProperties=vd_U.vd_nO(vd_U.GetActiveHatchProperties());vd_M.Thickness=vd_U.GetActiveThickness();if(entities)vd_U.vd_by(entities,vd_M);else vd_U.vd_by(layout.Entities,vd_M);vd_U.UpdateLayout(layout);if(vd_bA){vd_bM(vd_M,vd_c,vd_t);vd_U.Refresh(false);}return vd_M;};this.AddRect=function(vd_xI,vd_Ck,vd_bA,entities){return vd_U.AddRect2(vd_xI,vd_Ck[X]-vd_xI[X],vd_Ck[Y]-vd_xI[Y],0,vd_bA,entities);};this.vd_vO=function(vd_oL){var vd_t=vd_J();if(vd_t.GlobalRenderProperties.AttributesMode===undefined)return vd_oL.InVisibleMode!==true;switch(vd_t.GlobalRenderProperties.AttributesMode){case vdConst.AttributesMode_Normal:return vd_oL.InVisibleMode!==true;case vdConst.AttributesMode_Off:return false;case vdConst.AttributesMode_On:return true;default:return vd_oL.InVisibleMode!==true;}};this.RecalculateBlockReferencesAttribs=function(block){var vd_mf=[];for(var i=0;i<block.Entities.Items.length;i++){var attribute=vd_U.GetEntityItem(block.Entities.Items[i]);if(attribute._t==vdConst.vdAttribDef_code){vd_mf.push(attribute);}}if(vd_mf.length==0)return[];var vd_Aw=vd_U.FilterEntities({block:block,vd_mf:vd_mf},function(args){if(!args.entity)return;args.cancel=true;if(args.entity._t!==vdConst.vdInsert_code)return;if(args.entity.Block!='h_'+args.customdata.block.HandleId.toString())return;if(!args.entity.Attributes)args.entity.Attributes={Items:[]};var si=args.entity.Attributes.Items.length;for(var i=si;i<args.customdata.vd_mf.length;i++){vd_EK(args.entity,args.customdata.vd_mf[i]);}args.cancel=args.customdata.vd_mf.length<=si;});for(var i=0;i<vd_Aw.length;i++){vd_U.UpdateFig(vd_Aw[i]);}return vd_Aw;};this.AddAttribDef=function(block,height,rotation,tag,value,vd_kL){if(!block|| !block._t||block._t!=vdConst.vdBlock_code)return null;var vd_t=vd_J();var vd_M={};vd_U.vd_dv(vd_M,vd_t);vd_M._t=vdConst.vdAttribDef_code;vd_M.AlignmentPoint=[0,0,0];vd_M.Style=vd_t.ActiveTextStyle;var ts=vd_U.GetDictItem(vd_t.TextStyles,vd_t.ActiveTextStyle);if(ts){if(ts.HorJustify!=undefined)vd_M.HorJustify=ts.HorJustify;if(ts.VerJustify!=undefined)vd_M.VerJustify=ts.VerJustify;}vd_M.PromptString="Prompt";vd_M.TagString=tag;vd_M.TextString=tag;vd_M.ValueString=value;if(height)vd_M.Height=height;vd_M.InsertionPoint=vd_kL;vd_M.Rotation=rotation;vd_U.vd_by(block.Entities,vd_M);return vd_M;};this.GetAttribValue=function(tag,vd_dI){if(!vd_dI|| !vd_dI._t||vd_dI._t!=vdConst.vdInsert_code)return null;if(!vd_dI.Attributes)return null;for(var i=0;i<vd_dI.Attributes.Items.length;i++){var vd_zB=vd_dI.Attributes.Items[i].TagString.toLowerCase();if(vd_zB==tag.toLowerCase())return vd_dI.Attributes.Items[i].ValueString;}return null;};this.SetAttribValue=function(tag,value,vd_dI){if(!vd_dI|| !vd_dI._t||vd_dI._t!=vdConst.vdInsert_code)return false;if(!vd_dI.Attributes)return false;for(var i=0;i<vd_dI.Attributes.Items.length;i++){var attr=vd_dI.Attributes.Items[i];var vd_zB=attr.TagString.toLowerCase();if(vd_zB==tag.toLowerCase()){attr.ValueString=value;attr.TextString=value;vd_U.UpdateFig(vd_dI);vd_U.UpdateFig(attr);vd_U.UpdateLayout(vd_U.GetActiveLayout());return true;}}return false;};this.AddBlockFromFile=function(filename,vd_hf,vd_BI,vd_wz,vd_ld,vd_iD){if(!filename|| !vd_hf)return null;var vd_M=vd_U.FindBlock(vd_hf);if(!vd_M){vd_M=vd_U.AddBlock(vd_hf);vd_BI=true;}if(!vd_M)return null;if(vd_BI){vd_M.ExternalReferencePath=filename;vd_M.ExternalReference=null;vd_M.vd_iD=vd_iD;}if(vd_M.ExternalReferencePath){if(vd_M.ExternalReference&&vd_M.ExternalReference.vdDocument){if(vd_wz){var args=new vd_Hx(vd_U,vd_hf.toLowerCase(),vd_M.ExternalReferencePath,vd_M);setTimeout(vd_wz(args),0);}}else{vd_M.vd_ld=vd_ld;vd_M.vd_nr=vd_wz;vd_U.AddBlockSymbol(vd_hf,[0,0,0],1.0,0.0,false,{});setTimeout(vd_CK(),0);}}return vd_M;};this.AddBlock=function(vd_hf,vd_BH){var vd_M=vd_U.FindBlock(vd_hf);if(vd_M)return vd_M;var vd_t=vd_J();vd_M={};vd_M.Name=vd_hf;vd_M.HandleId=vd_U.vd_fj();vd_M.Entities={Items:[]};if(vd_BH)vd_M.Origin=vd_BH;vd_M.StretchBlock=0;vd_M._t=vdConst.vdBlock_code;vd_U.vd_by(vd_t.Blocks,vd_M);return vd_M;};function vd_EK(vd_dI,attribute){if(!vd_dI.Attributes)vd_dI.Attributes={Items:[]};var vd_t=vd_J();var vd_M=vdConst.cloneEntity(attribute);if(attribute.ValueString)vd_M.TextString=attribute.ValueString;vd_M.HandleId=vd_U.vd_fj();vd_M._t=vdConst.vdAttrib_code;vd_dI.Attributes["h_"+vd_M.HandleId]=vd_dI.Attributes.Items.length;vd_dI.Attributes.Items.push(vd_M);if(!vd_M.IsConstant)vd_q.vd_hg(vd_U.GetEntityECSMatrix(vd_dI),vd_M,vd_U);vd_U.UpdateFig(vd_M);return vd_M;};this.AddBlockSymbol=function(vd_hf,vd_kL,scale,rotation,vd_bA,entities){var layout=vd_U.GetActiveLayout();if(layout==null)return null;var vd_t=vd_J();var block=vd_U.FindBlock(vd_hf);if(block==null)return null;var vd_M={};vd_U.vd_dv(vd_M,vd_t,entities&& !entities.Items);vd_M._t=vdConst.vdInsert_code;vd_M.InsertionPoint=vd_kL;vd_M.Xscale=scale;vd_M.Yscale=scale;vd_M.Rotation=rotation;vd_M.Block='h_'+block.HandleId.toString();vd_dA.clear();vd_bM(vd_M,vd_dA,vd_t);vd_M.BoundingBox=vd_dA.vd_gQ.vd_fD();for(var i=0;i<block.Entities.Items.length;i++){var attribute=vd_U.GetEntityItem(block.Entities.Items[i]);if(attribute._t==vdConst.vdAttribDef_code){vd_EK(vd_M,attribute);}}if(entities)vd_U.vd_by(entities,vd_M);else vd_U.vd_by(layout.Entities,vd_M);vd_U.UpdateLayout(layout);if(vd_bA){vd_bM(vd_M,vd_c,vd_t);vd_U.Refresh(false);}var bbox=vd_M.BoundingBox;vd_U.UpdateFig(vd_M);vd_M.BoundingBox=bbox;return vd_M;};this.GetEntityECSMatrix=function(vd_M){if(!vd_M.EcsMatrix){vd_dA.clear();vd_U.UpdateFig(vd_M,true);vd_bM(vd_M,vd_dA,vd_J());}if(!vd_M.EcsMatrix)return vdgeo.vd_e();return vd_M.EcsMatrix;};this.GetEntitySamplePoints=function(vd_M){if(!vd_M.SamplePoints){if(vd_M._t!==vdConst.vdLine_code&&vd_M._t!==vdConst.vdPolyline_code&&vd_M._t!==vdConst.vdRect_code&&vd_M._t!==vdConst.vdCircle_code&&vd_M._t!==vdConst.vdEllipse_code&&vd_M._t!==vdConst.vdArc_code)return[];vd_dA.clear();vd_U.UpdateFig(vd_M,true);vd_bM(vd_M,vd_dA,vd_J());}if(!vd_M.SamplePoints)return[];var mat=vd_M.EcsMatrix;if(!mat)mat=vdgeo.vd_e();return vdgeo.vd_fN(mat,vd_M.SamplePoints);};this.GetEntityBBox=function(vd_M){var ents=[];if(Array.isArray(vd_M))ents=vd_M;else ents=[vd_M];var vd_t=vd_J();vd_dA.clear();for(var i=0;i<ents.length;i++){var fig=ents[i];if(!fig.BoundingBox){vd_bM(fig,vd_dA,vd_t);fig.BoundingBox=vd_dA.vd_gQ.vd_fD();}else{vd_dA.vd_gQ.vd_hc(fig.BoundingBox);}}return vd_dA.vd_gQ.vd_fD();};this.AddImage=function(vd_rK,vd_eJ,vd_kL,vd_BJ,rotation,vd_bA,entities){var layout=vd_U.GetActiveLayout();if(layout==null)return null;var vd_t=vd_J();var vd_S=vd_U.AddImageDefinition(vd_rK);if(vd_S==null)return null;var vd_M={};vd_U.vd_dv(vd_M,vd_t,entities&& !entities.Items);vd_M._t=vdConst.vdImage_code;vd_M.InsertionPoint=vd_kL;vd_M.ImageDefinition='h_'+vd_S.HandleId.toString();vd_M.Display=5;vd_M.Rotation=rotation;vd_M.Width=vd_BJ;vd_M.ImageScale=vd_BJ;vd_M.Height=vd_M.Width*vd_S.height/vd_S.width;if(entities)vd_U.vd_by(entities,vd_M);else vd_U.vd_by(layout.Entities,vd_M);if(!vd_S.bytes&&vd_eJ&&vd_bg){var vd_eH=document.createElement("img");vd_eH.setAttribute("src",vd_eJ);vd_eH.onload=function(evt){vdConst.vd_ty(evt.target,vd_S);vd_M.Height=vd_M.Width*vd_S.height/vd_S.width;vd_U.UpdateLayout(layout);if(vd_bA){vd_bM(vd_M,vd_c,vd_t);vd_U.Refresh(false);}}}else{vd_U.UpdateLayout(layout);if(vd_bA){vd_bM(vd_M,vd_c,vd_t);vd_U.Refresh(false);}}return vd_M;};this.AddLayout=function(vd_tk){var vd_t=vd_J();if(!vd_t)return-1;if(vd_tk.toLowerCase()=="model"||vd_tk.toLowerCase()==vd_t.Model.Name.toLowerCase())return-1;var vd_pN=vd_U.FindLayout(vd_tk);if(vd_pN>=0)return vd_pN;if(!vd_t.LayOuts)vd_t.LayOuts={Items:[]};vd_pN=vd_t.LayOuts.Items.length;var vd_M={_t:vdConst.vdLayout_code,HandleId:vd_U.vd_fj(),Name:vd_tk,FocalLength:0.05,PerspectiveMod:0,LensAngle:60,ViewCenter:[0,0,0],RenderMode:0,ViewSize:1.0,World2ViewMatrix:vdgeo.vd_e(),BkColorEx:[0,0,0,0],ShowHidenEdges:false,Printer:{PrintWindow:[0,0,0,210,297,0],PrintScale:[1,1],HandleId:vd_U.vd_fj(),margins:[0,0,0,0],Resolution:96,paperSize:[0,0,827,1169],LandScape:false},Entities:{Items:[]}};vd_t.LayOuts.Items.push(vd_M);vd_t.LayOuts['h_'+vd_M.HandleId.toString()]=vd_pN;return vd_pN;};this.AddViewport=function(insertion,width,height,vd_B,vd_Z,vd_bA){var vd_t=vd_J();if(!vd_t)return null;var layout=vd_U.GetActiveLayout();if(layout==null||layout==vd_t.Model)return null;var vd_M={};var vd_si=insertion[X];var vd_rE=insertion[Y];var vd_ER=vd_si+width;var vd_Gs=vd_rE+height;if(width<0){vd_si=vd_si+width;vd_ER=insertion[X];}if(height<0){vd_rE=vd_rE+height;vd_Gs=insertion[Y];}vd_U.vd_dv(vd_M,vd_t);vd_M._t=vdConst.vdViewport_code;vd_M.InsertionPoint=insertion;vd_M.Width=width;vd_M.Height=height;vd_M.ViewSize=10.0;vd_M.ViewCenter=[0,0,0];if(vd_B)vd_M.ViewCenter=vd_B;if(vd_Z)vd_M.ViewSize=vd_Z;if(vd_t.Model.BoundingBox){if(!vd_B)vd_M.ViewCenter=[(vd_t.Model.BoundingBox[0]+vd_t.Model.BoundingBox[3])/2.0,(vd_t.Model.BoundingBox[1]+vd_t.Model.BoundingBox[4])/2.0,0];if(!vd_Z){var vd_Pf=vd_t.Model.BoundingBox[3]-vd_t.Model.BoundingBox[0];var vd_PN=vd_t.Model.BoundingBox[4]-vd_t.Model.BoundingBox[1];var l1=Math.abs(width)/vd_Pf;var l2=Math.abs(height)/vd_PN;var l=Math.min(l1,l2);vd_M.ViewSize=Math.abs(height)/l;}}vd_M.BoundingBox=[vd_si,vd_rE,0,vd_ER,vd_Gs,0];vd_M.LensAngle=60;vd_M.FocalLength=0.05;vd_M.PerspectiveMod=0;vd_M.ShowHidenEdges=false;vd_M.RenderMode=0;vd_M.World2ViewMatrix=vdgeo.vd_e();vd_M.BkColorEx=[0,0,0,0];vd_U.vd_by(layout.Entities,vd_M);vd_U.UpdateLayout(layout);if(vd_bA){vd_bM(vd_M,vd_c,vd_t);vd_U.Refresh(false);}return vd_M;};this.FindImageDefinition=function(name){var vd_t=vd_J();if(vd_t==null)return null;name=name.toLowerCase();for(var i=0;i<vd_t.Images.Items.length;i++){var vd_S=vd_U.GetDictItem(vd_t.Images,vd_t.Images.Items[i]);var vd_Jg=vd_S.Name.toLowerCase();if(vd_Jg==name)return vd_S;}return null;};this.AddImageDefinition=function(vd_rK,vd_eJ,vd_ir){var doc=vd_J();if(doc==null)return null;var vd_S=vd_U.FindImageDefinition(vd_rK);if(!vd_S){vd_S={};vd_S.HandleId=vd_U.vd_fj();vd_S.Name=vd_rK;vd_S._t=vdConst.vdImageDef_code;vd_S.Transparency=[0,0,0,0];vd_S.OriginalWidth=1;vd_S.OriginalHeight=1;vd_S.width=1;vd_S.height=1;vd_U.vd_by(doc.Images,vd_S);}if(!vd_S.bytes){if(vd_eJ&&vd_bg){var vd_eH=document.createElement("img");vd_eH.setAttribute("src",vd_eJ);vd_eH.onload=function(evt){vdConst.vd_ty(evt.target,vd_S);if(vd_ir)vd_ir(vd_U,vd_S);};vd_eH.onerror=function(evt){if(vd_ir)vd_ir(vd_U,vd_S);}}else{if(vd_ir)vd_ir(vd_U,vd_S);}}else{if(vd_ir)vd_ir(vd_U,vd_S);}return vd_S;};this.FindView=function(name){var vd_t=vd_J();if(vd_t==null)return null;if(!vd_t.Views|| !vd_t.Views.Items)return null;name=name.toLowerCase();for(var i=0;i<vd_t.Views.Items.length;i++){var view=vd_t.Views.Items[i];var vd_Js=view.Name.toLowerCase();if(vd_Js==name)return view;}return null;};this.AddView=function(vd_GD){var vd_t=vd_J();if(vd_t==null)return null;var layout=vd_U.GetActiveLayout();if(layout==null)return;var view=vd_U.FindView(vd_GD);if(view)return view;view={};view._t=vdConst.vdView_code;view.HandleId=vd_U.vd_fj();view.Name=vd_GD;view.ViewLayout='h_'+layout.HandleId.toString();view.ViewSize=layout.ViewSize;view.ViewWorldToViewMatrix=vdgeo.vd_dD(layout.World2ViewMatrix);view.ViewPerspectiveMod=layout.PerspectiveMod;view.ViewRenderMode=layout.RenderMode;view.ViewCenter=vdgeo.newpoint(layout.ViewCenter[X],layout.ViewCenter[Y],layout.ViewCenter[Z]);view.ViewFocalLength=layout.FocalLength;view.ViewLensAngle=layout.LensAngle;if(!vd_t.Views)vd_t.Views={};if(!vd_t.Views.Items)vd_t.Views.Items=[];vd_t.Views["h_"+view.HandleId.toString()]=vd_t.Views.Items.length;vd_t.Views.Items.push(view);return view;};this.SetActiveView=function(vd_pa){var vd_t=vd_J();if(vd_t==null)return null;var layout=vd_U.GetActiveLayout();var view=null;if(vd_pa){if(typeof vd_pa==='string')view=vd_U.FindView(vd_pa);else if(typeof vd_pa==='object')view=vd_pa;}if(view){vd_t.ActiveView='h_'+view.HandleId.toString();vd_t.vd_jM=view;if(vd_t.LayOuts&&view.ViewLayout&&vd_t.LayOuts[view.ViewLayout]!==undefined)layout=vd_t.LayOuts.Items[vd_t.LayOuts[view.ViewLayout]];else layout=vd_t.Model;layout.ViewSize=view.ViewSize;layout.World2ViewMatrix=vdgeo.vd_dD(view.ViewWorldToViewMatrix);layout.PerspectiveMod=view.ViewPerspectiveMod;layout.RenderMode=view.ViewRenderMode;layout.ViewCenter=vdgeo.newpoint(view.ViewCenter[X],view.ViewCenter[Y],view.ViewCenter[Z]);layout.FocalLength=view.ViewFocalLength;layout.LensAngle=view.ViewLensAngle;}else{vd_t.ActiveView='h_0';vd_t.vd_jM=null;}vd_U.SetActiveLayout(layout);};this.GetActiveView=function(){var vd_t=vd_J();if(vd_t==null)return null;if(!vd_t.vd_jM){if(vd_t.ActiveView&&vd_t.Views&&vd_t.Views.Items&&vd_t.Views[vd_t.ActiveView])vd_t.vd_jM=vd_t.Views.Items[vd_t.Views[vd_t.ActiveView]];}return vd_t.vd_jM;};this.vd_Eq=function(layer,vd_eZ,vd_t){if(!layer)return true;if(vd_eZ&&vd_eZ._t==vdConst.vdInsert_code&&layer.Name=="0")return false;var vd_mq=vd_t.vd_ya;if(!vd_mq)vd_mq=vd_t.vd_jM;if(vd_mq){if(vd_mq.FrozenLayers&&vd_mq.FrozenLayers['h_'+layer.HandleId.toString()])return true;if(vd_mq.IgnoreFrozenLayers)return false;}return layer.Frozen;};this.AddLayer=function(vd_mb){var doc=vd_J();if(doc==null)return null;var layer=vd_U.FindLayer(vd_mb);if(layer)return layer;layer={};layer.HandleId=vd_U.vd_fj();layer.LineType=doc.ActiveLineType;layer.LineWeight=doc.ActiveLineWeight;layer.Name=vd_mb;layer.PenColor=vdConst.vd_sJ(vd_U.GetActivePenColor());var vd_FX=vd_U.FindLineType('BYLAYER');var vd_FU=vd_U.FindLineType('SOLID');if(vd_FU&&vd_FX&&layer.LineType==('h_'+vd_FX.HandleId))layer.LineType=('h_'+vd_FU.HandleId);if(layer.LineWeight==vdConst.LW_BYLAYER)layer.LineWeight=vdConst.LW_DOCUMENTDEFAULT;if(layer.PenColor.ColorFlag==vdConst.COLOR_BYLAYER)layer.PenColor.ColorFlag=197;layer._t=vdConst.vdLayer_code;vd_U.vd_by(doc.Layers,layer);return layer;};function vd_MS(vd_ku){if(vd_Co(vd_ku))return true;if(vd_ku.constructor===Array){for(var i=0;i<vd_ku.length;i++)if(!vd_Co(vd_ku[i]))return false;}else return false;return true;};function vd_Co(vd_r){return(typeof vd_r==="string"||typeof vd_r==="number"||typeof vd_r==="boolean");};this.AddXProperty=function(entity,name,vd_r){if(!entity|| !name||vd_r==null||vd_r==undefined)return null;if(!entity.HandleId|| !entity._t||entity._t<1||entity._t>100)return null;if(!vd_MS(vd_r))return null;if(!entity.XProperties)entity.XProperties={Items:[]};var vd_ku={Name:name,PropValue:vd_r};entity.XProperties.Items.push(vd_ku);return vd_ku;};this.GetXProperty=function(entity,name){if(!entity|| !name)return null;if(!entity.XProperties||entity.XProperties.Items.length==0)return null;for(var i=0;i<entity.XProperties.Items.length;i++)if(entity.XProperties.Items[i].Name===name)return entity.XProperties.Items[i];return null;};this.GetEntitiesFromLayer=function(vd_mb){var ret=[];var layer=vd_U.FindLayer(vd_mb);if(!layer)return ret;vd_mb=vd_mb.toLowerCase();var vd_Le=vd_U.FindLayer("0");var vd_ta;var vd_wI=vd_U.GetDocument().LayOuts;var lNum=0;if(vd_wI)lNum=vd_wI.Items.length;var entities;for(var d=0;d<=lNum;d++){var layout;if(d==lNum)layout=vd_U.GetDocument().Model;else layout=vd_wI.Items[d];entities=layout.Entities;if(!entities)continue;for(var i=0;i<entities.Items.length;i++){vd_tB=vd_U.GetEntityItem(entities.Items[i]);if(!vd_tB)continue;if(!vd_tB.Layer)vd_ta=vd_Le;else vd_ta=vd_U.GetDocument()[vd_tB.Layer];if(!vd_ta)continue;if(vd_ta.Name.toLowerCase()==vd_mb)ret.push(vd_tB);}}return ret;};this.GetEntityFromPoint=function(x,y){return vd_c.GetEntityFromPoint(x,y,vd_U.PickSize,vd_U.IgnoreLockLayers);};this.GetEntitiesFromBox=function(xmin,ymin,xmax,ymax){return vd_c.GetEntitiesFromBox(vdgeo.vd_u(xmin),vdgeo.vd_u(ymin),vdgeo.vd_u(xmax),vdgeo.vd_u(ymax),vd_U.IgnoreLockLayers);};this.GetEntitiesInWindowBox=function(xmin,ymin,xmax,ymax){return vd_c.GetEntitiesInWindowBox(vdgeo.vd_u(xmin),vdgeo.vd_u(ymin),vdgeo.vd_u(xmax),vdgeo.vd_u(ymax),vd_U.IgnoreLockLayers);};this.GetEntitiesFromPolygon=function(_pts,vd_jf){var pts=_pts;if(!vd_jf)pts=_pts;else if(vd_jf===2)pts=vdgeo.vd_lO(vd_c.vd_dm,_pts);else pts=vdgeo.vd_lO(vd_c.vd_dZ(),_pts);var ret=vd_c.GetEntitiesFromPolygon(pts,vd_U.IgnoreLockLayers);if(ret==null)return[];return ret.entities;};this.GetEntitiesInWindowPolygon=function(_pts,vd_jf){var pts=_pts;if(!vd_jf)pts=_pts;else if(vd_jf===2)pts=vdgeo.vd_lO(vd_c.vd_dm,_pts);else pts=vdgeo.vd_lO(vd_c.vd_dZ(),_pts);return vd_c.GetEntitiesInWindowPolygon(pts,vd_U.IgnoreLockLayers);};this.GetEntitiesFence=function(vd_jv,vd_jf){var pts=vd_jv;if(!vd_jf)pts=vd_jv;else if(vd_jf===2)pts=vdgeo.vd_lO(vd_c.vd_dm,vd_jv);else pts=vdgeo.vd_lO(vd_c.vd_dZ(),vd_jv);return vd_c.GetEntitiesFence(pts,vd_U.IgnoreLockLayers);};this.PixelToWorld=function(ptX,ptY){var vd_Nc=vdgeo.vd_aR(vd_c.vd_dZ());return vdgeo.vd_bL(ptX,ptY,1,vd_Nc);};this.WorldToPixel=function(vd_HP){return vdgeo.vd_do(vd_HP,vd_c.vd_dZ());};this.WorldToView=function(pt){return vdgeo.matrixtransform(vd_c.vd_bE(),pt);};this.ViewToWorld=function(pt){var vd_xD=vdgeo.vd_aR(vd_c.vd_bE());return vdgeo.matrixtransform(vd_xD,pt);};this.ViewToPixel=function(pt){return vdgeo.vd_do(pt,vd_c.vd_dm);};this.PixelToView=function(pt){return vdgeo.vd_do(pt,vd_c.vd_aN);};this.PointAt_GPS=function(lat,lon){var doc=vd_U.GetDocument();if(!doc|| !doc.FileProperties|| !doc.FileProperties.Gps_Map)return null;var ne=vd_eq.vd_LU(lat,lon);return vdgeo.vd_bL(ne[0],ne[1],0,doc.FileProperties.Gps_Map.NorthEastToWorld);};this.GPS_AtPoint=function(pt){var doc=vd_U.GetDocument();if(!doc|| !doc.FileProperties|| !doc.FileProperties.Gps_Map)return null;var w2ne=vdgeo.vd_aR(doc.FileProperties.Gps_Map.NorthEastToWorld);var npt=vdgeo.vd_do(pt,w2ne);return vd_eq.vd_OE(npt[Y],npt[X]);};this.Refresh=function(blc){var img=null;if(blc!=false){var vd_t=vd_J();if(vd_t!=null)img=vd_t.Palette._lc;}vd_c.vd_H.vd_DK(img);vd_c.vd_H.Refresh();vd_Dr();};function vd_OY(){var vd_az=vd_U.canvas.width;var vd_bG=vd_U.canvas.height;if(vd_fB==null){vd_fB=document.createElement("CANVAS");vd_fB.setAttribute("width",vd_az);vd_fB.setAttribute("height",vd_bG);vd_iW=vd_fB.getContext("2d");}Action.hide();vd_iW.putImageData(vd_c.vd_H.vd_qu(),0,0,0,0,vd_az,vd_bG);};function vd_Px(vd_ih){if(!ctx)return;var vd_az=vd_U.canvas.width;var vd_bG=vd_U.canvas.height;ctx.fillStyle=vdgdi.vd_iU(vd_c.vd_fR(-1));ctx.fillRect(0,0,vd_az,vd_bG);var vd_iJ=vdgeo.matrixtransform(vd_ih,vdgeo.newpoint(0,0,0));var vd_lM=vdgeo.matrixtransform(vd_ih,vdgeo.newpoint(vd_az,vd_bG,0));ctx.drawImage(vd_fB,0,0,vd_az,vd_bG,vdgeo.vd_u(vd_iJ[X]),vdgeo.vd_u(vd_iJ[Y]),vdgeo.vd_u(vd_lM[X]-vd_iJ[X]),vdgeo.vd_u(vd_lM[Y]-vd_iJ[Y]));vd_c.vd_H.vd_Dm();Action.show();Action.draw();};this.viewcube=new function(){var vd_U=this;var vd_AF=1;var vd_wX=0;var vd_AQ=196;var vd_pB=1;var render=null;var vd_cm=null;var vd_du=null;var vd_cv=null;var w2v=null;var vd_By=[80,120,160];Object.defineProperty(vd_U,'size',{get:function(){return vd_AF;},set:function(newValue){vd_AF=newValue;}});Object.defineProperty(vd_U,'location',{get:function(){return vd_pB;},set:function(newValue){vd_pB=newValue;}});Object.defineProperty(vd_U,'opacity',{get:function(){return vd_AQ;},set:function(newValue){vd_AQ=Math.min(255,Math.max(0,newValue));}});Object.defineProperty(vd_U,'display',{get:function(){return vd_wX;},set:function(newValue){vd_wX=newValue;}});function vd_Cc(){return vd_By[Math.min(Math.max(0,vd_AF),vd_By.length-1)];};function vd_uU(vd_ew){vd_Jw();var vd_kR=vd_Cc();return vd_wX&&vd_cv!=null&&vd_kR<vd_ew.width&&vd_kR<vd_ew.height;};function vd_Jw(){var vd_kR=vd_Cc();if(!render||(vd_kR!=render.width&&vd_kR!=render.height)){render=new vd_rf(null,0,0,vd_kR,vd_kR,null);vd_cm=document.createElement("CANVAS");vd_cm.setAttribute("width",render.width);vd_cm.setAttribute("height",render.height);vd_du=vd_cm.getContext("2d");vd_cv=vd_du.createImageData(render.width,render.height);}};this.clear=function(){render=null;vd_cm=null;vd_du=null;vd_cv=null;w2v=null;};function vd_Og(vd_ew){if(w2v==null)return false;var rm=vd_ew.vd_bE();if(!vdgeo.AreEqual(vdgeo.vd_im([rm[A00]-w2v[A00],rm[A10]-w2v[A10],rm[A20]-w2v[A20]]),0.0,vdgeo.DefaultVectorEquality))return false;if(!vdgeo.AreEqual(vdgeo.vd_im([rm[A01]-w2v[A01],rm[A11]-w2v[A11],rm[A21]-w2v[A21]]),0.0,vdgeo.DefaultVectorEquality))return false;if(!vdgeo.AreEqual(vdgeo.vd_im([rm[A02]-w2v[A02],rm[A12]-w2v[A12],rm[A22]-w2v[A22]]),0.0,vdgeo.DefaultVectorEquality))return false;return true;};this.draw=function(vd_ew){if(!vd_uU(vd_ew))return null;if(!vd_Og(vd_ew)){var i=0;var vd_S=vdConst.vd_zj.vd_KM();if(!vd_S.bytes)return null;render.vd_H.vd_gl(vd_cv,render.width,render.height,true);for(i=0;i<vd_cv.data.length;i++)vd_cv.data[i]=0;render.vd_sZ(vd_ew);render.vd_H.vd_iH=vdConst.InterpolationMode_Bilinear;render.vd_bJ=false;render.vd_fx=true;render.vd_fl=true;w2v=vdgeo.vd_e();vdgeo.vd_mB(w2v,vd_ew.vd_bE());w2v[A03]=0;w2v[A13]=0;w2v[A23]=0;var vd_NI=[-2.5,-2.5,-1.2];var vd_Na=[2.5,2.5,1];var vs=5.2;var vc=[0,0,0];render.update(vs,vc,w2v,vd_NI.concat(vd_Na),0,0,false,vdConst.RENDERMODE_RENDER);render.vd_hK(vd_ew.palette);render.vd_et([[-1,-1,-1],[1,-1,-1],[1,1,-1],[-1,1,-1]],[0,0,1],[[0.195,0.660,0],[0.395,0.660,0],[0.395,1.005,0],[0.195,1.005,0]],vd_S,true);render.vd_et([[-1,-1,1],[1,-1,1],[1,1,1],[-1,1,1]],[0,0,1],[[0.005,0.667,0],[0.205,0.667,0],[0.205,1.000,0],[0.005,1.000,0]],vd_S,true);render.vd_et([[-1,1,-1],[-1,-1,-1],[-1,-1,1],[-1,1,1]],[1,0,0],[[0.005,0.333,0],[0.205,0.333,0],[0.205,0.667,0],[0.005,0.667,0]],vd_S,true);render.vd_et([[1,-1,-1],[1,1,-1],[1,1,1],[1,-1,1]],[1,0,0],[[0.200,0.333,0],[0.400,0.333,0],[0.400,0.667,0],[0.200,0.667,0]],vd_S,true);render.vd_et([[-1,-1,-1],[1,-1,-1],[1,-1,1],[-1,-1,1]],[0,1,0],[[0.005,0.000,0],[0.205,0.000,0],[0.205,0.333,0],[0.005,0.333,0]],vd_S,true);render.vd_et([[1,1,-1],[-1,1,-1],[-1,1,1],[1,1,1]],[0,1,0],[[0.200,0.000,0],[0.400,0.000,0],[0.400,0.333,0],[0.200,0.333,0]],vd_S,true);render.vd_H.vd_iH=vdConst.InterpolationMode_Nearest;render.vd_et([[-2.5,-2.5,-1.2],[2.5,-2.5,-1.2],[2.5,2.5,-1.2],[-2.5,2.5,-1.2]],[0,0,1],[[0.405,0.0,0],[1.000,0.0,0],[1.000,1.000,0],[0.405,1.000,0]],vd_S,true);for(i=3;i<vd_cv.data.length;i+=4){if(vd_cv.data[i]!=0)vd_cv.data[i]=vd_AQ;}render.vd_H.vd_gl(null);vd_du.putImageData(vd_cv,0,0);}var lpos=[0,0];if(vd_pB==1)lpos=[vd_ew.width-render.width,0];else if(vd_pB==2)lpos=[0,vd_ew.height-render.height];else if(vd_pB==3)lpos=[vd_ew.width-render.width,vd_ew.height-render.height];return[vd_cm,lpos];}};this.printToImageData=function(vd_uE,vd_Nt,vd_wT,vd_oK,vd_ac,vd_wJ,res){var layout=vd_U.GetActiveLayout();if(layout==null)return;var vd_t=vd_J();var vd_kJ=layout.Printer;var resolution=vd_kJ.Resolution;var margins=vd_kJ.margins;var vd_pz=vd_kJ.PrintScale;var vd_cu=vd_kJ.PrintWindow;var vd_Eb=vd_kJ.LandScape;if(res){resolution=res;}var vd_dT=vdgeo.vd_u(resolution*vd_kJ.paperSize[2]/100);var vd_iC=vdgeo.vd_u(resolution*vd_kJ.paperSize[3]/100);if(vd_wT!=undefined){vd_Eb=false;vd_dT=vdgeo.vd_u(resolution*vd_wT[0]/100);vd_iC=vdgeo.vd_u(resolution*vd_wT[1]/100);}if(vd_oK!=undefined){margins=[vd_oK,vd_oK,vd_oK,vd_oK];}if(vd_Eb){var tmp=vd_dT;vd_dT=vd_iC;vd_iC=tmp;}if(vd_uE==vdConst.PRINT_WINDOW_FLAG_EXTENTS){var vd_gP=vd_U.GetExtents();if(vd_gP!=null){var box=vdgeo.vd_ux(layout.World2ViewMatrix,vd_gP);vd_cu=box;if(vdgeo.AreEqual(box[3]-box[0],0.0,vdgeo.DefaultLinearEquality)||vdgeo.AreEqual(box[4]-box[1],0.0,vdgeo.DefaultLinearEquality))vd_uE=vdConst.PRINT_WINDOW_FLAG_VIEW;}}if(vd_uE==vdConst.PRINT_WINDOW_FLAG_VIEW){vd_cu=[vd_c.vd_bo.left,vd_c.vd_bo.bottom,0,vd_c.vd_bo.right,vd_c.vd_bo.top,0];}if(vd_Nt==vdConst.PRINT_SCALE_FLAG_FIT){var vd_sc=25.4*vd_dT/resolution;var vd_ru=25.4*vd_iC/resolution;vd_sc-=25.4*margins[0]/100;vd_sc-=25.4*margins[2]/100;vd_ru-=25.4*margins[1]/100;vd_ru-=25.4*margins[3]/100;var w=vd_cu[3]-vd_cu[0];var h=vd_cu[4]-vd_cu[1];if(vdgeo.AreEqual(w,0.0,vdgeo.DefaultScaleEquality)||vdgeo.AreEqual(h,0.0,vdgeo.DefaultScaleEquality)){vd_pz=[1,1];}else{if((vd_sc/w)<(vd_ru/h)){vd_pz=[1,w/vd_sc];}else{vd_pz=[1,h/vd_ru];}}}var vd_Ot=vd_pz[0]/vd_pz[1];var vd_yx=resolution*vd_Ot/25.4;var vd_Bq=1.0/vd_yx;var vd_in=vdgeo.vd_u(vd_yx*(vd_cu[3]-vd_cu[0]));var vd_jx=vdgeo.vd_u(vd_yx*(vd_cu[4]-vd_cu[1]));var vd_yo=vdgeo.vd_u(resolution*margins[0]/100);var vd_zd=vdgeo.vd_u(resolution*margins[1]/100);var vd_CE=vdgeo.vd_u(resolution*margins[2]/100);var vd_Gb=vdgeo.vd_u(resolution*margins[3]/100);if((vd_yo+vd_in)>(vd_dT-vd_CE))vd_in=vd_dT-vd_CE-vd_yo;if((vd_zd+vd_jx)>(vd_iC-vd_Gb))vd_jx=vd_jx-vd_Gb-vd_zd;var nw=vd_in*vd_Bq;var nh=vd_jx*vd_Bq;var vc=vdgeo.newpoint(vd_cu[0]+nw*0.5,vd_cu[1]+nh*0.5,0);var vs=nh;var vd_iX,vd_rm,vd_mo,vd_pI,vd_qM;var vd_qD=Math.abs(vd_cu[3]-vd_cu[0]);var vd_oE=Math.abs(vd_cu[4]-vd_cu[1]);var vd_km=0;var vd_jY=vd_in/vd_jx;if(!layout.FocalLength)layout.FocalLength=0.05;if(!layout.LensAngle)layout.LensAngle=60.0;if(vd_qD/vd_oE<vd_jY){vd_iX=vdgeo.DegreesToRadians(layout.LensAngle)/2;vd_rm=vd_oE/2;vd_km=vd_rm/Math.tan(vd_iX);}else{vd_mo=2.0*layout.FocalLength*Math.tan(vdgeo.DegreesToRadians(layout.LensAngle/2.0));vd_pI=vdgeo.RadiansToDegrees(Math.atan(vd_mo*vd_jY*0.5/layout.FocalLength))*2.0;vd_iX=vdgeo.DegreesToRadians(vd_pI)/2;vd_qM=vd_qD/2;vd_km=vd_qM/Math.tan(vd_iX);}vc[Z]=Math.max(vd_cu[5],vd_cu[2])+vd_km;if(vd_uE==vdConst.PRINT_WINDOW_FLAG_VIEW)vc=layout.ViewCenter;vd_dT=vdgeo.vd_vJ(vd_dT);vd_in=vdgeo.vd_vJ(vd_in);var vd_cm=null;var vd_du=null;var vd_cs=null;var vd_cv=null;try{vd_cm=document.createElement("CANVAS");vd_cm.setAttribute("width",vd_dT);vd_cm.setAttribute("height",vd_iC);vd_du=vd_cm.getContext("2d");vd_cs=new vd_rf(vd_U,0,0,vd_in,vd_jx,null);vd_cs.vd_sZ(vd_c);vd_cs.vd_bJ=false;vd_cv=vd_du.createImageData(vd_in,vd_jx);}catch(ex){vd_cm=null;vd_du=null;vd_cs=null;vd_cv=null;}if(vd_cv==null)return null;vd_cs.vd_H.vd_gl(vd_cv,vd_in,vd_jx,true);if(vd_ac==undefined)vd_ac=[255,255,255,255];vd_cs.update(vs,vc,layout.World2ViewMatrix,vd_oc(layout),layout.FocalLength,layout.LensAngle,layout.PerspectiveMod==1,layout.RenderMode,layout.Sections,vd_t.Lights);vd_cs.vd_hK(vd_t.Palette,vd_ac);vd_cs.clear(true);var vd_pO=vd_cs.vd_kv(layout.ShowHidenEdges);vd_ug(layout.Entities,true,vd_cs,vd_t);vd_cs.vd_kv(vd_pO);if(vd_U.AfterDrawInView){vd_zb.vd_vr(vd_U.AfterDrawInView,vd_cs.vd_H.vd_qu(),vd_U,vd_cs,2);}vd_cs.vd_H.vd_DK(vd_t.Palette._lc);vd_du.globalAlpha=vd_ac[3]/255.0;vd_du.fillStyle=vdgdi.vd_iU(vd_ac);vd_du.fillRect(0,0,vd_dT,vd_iC);vd_du.putImageData(vd_cv,vd_yo,vd_zd);if(vd_wJ!=undefined&&vd_wJ>0){vd_du.strokeStyle=vdgdi.vd_iU(vd_cs.vd_iN());vd_du.lineWidth=vd_wJ;vd_du.strokeRect(0,0,vd_dT,vd_iC);}if(vd_U.AfterDrawInView){vd_cv=vd_du.getImageData(0,0,vd_dT,vd_iC);vd_zb.vd_vr(vd_U.AfterDrawInView,vd_cv,vd_U,vd_cs,4);vd_du.putImageData(vd_cv,0,0);}vd_cs.vd_H.vd_gl(null);var ret=vd_cm.toDataURL();vd_cm=null;vd_du=null;vd_cs=null;vd_cv=null;vd_U.vd_aK.vd_CO(vd_c);return ret;};this.ActiveAction=function(){return Action;};this.SetActionOrthoMode=function(mode){return Action.vd_vt(mode);};this.SetActionOsnapColor=function(color){var ret=Action.vd_vN;if(color[3]===undefined)color[3]=255;Action.vd_vN=color;return ret;};this.SetActionOsnapSize=function(size){var ret=Action.vd_vZ;Action.vd_vZ=size;return ret;};this.SetActionLineColor=function(color){var ret=Action.vd_vF;Action.vd_vF=color;return ret;};this.SetActionLineWidth=function(lw){var ret=Action.vd_jB;Action.vd_jB=lw;return ret;};this.SetActionFillColor=function(vd_yl){var ret=Action.vd_on;Action.vd_on=vd_yl;return ret;};this.SetActionCrossFillColor=function(vd_yl){var ret=Action.vd_nX;Action.vd_nX=vd_yl;return ret;};this.GetUserPoint=function(vd_qU){Action.cancel();Action.vd_rj=vd_qU;Action.actionType=vdConst.ACTION_POINT_WORLD;Action.start();};this.GetUserLine=function(vd_qU,vd_lD){Action.cancel();Action.vd_rj=vd_qU;Action.actionType=vdConst.ACTION_LINE_WORLD;Action.vd_vE(vd_lD);Action.start(Action.actionCount);};this.GetUserRect=function(vd_qU,vd_lD){Action.cancel();Action.vd_rj=vd_qU;Action.actionType=vdConst.ACTION_RECT_VIEW;Action.vd_vE(vd_lD);Action.start(Action.actionCount);};this.CmdMove=function(entities,from,to,vd_ce){vd_lf(this,{vd_cE:1,entities:entities,vd_bV:from,vd_ax:to},vd_ce);};this.CmdScale=function(entities,from,scale,vd_ce){vd_lf(this,{vd_cE:2,entities:entities,vd_bV:from,vd_ax:scale},vd_ce);};this.CmdRotate=function(entities,from,rotation,vd_ce){vd_lf(this,{vd_cE:3,entities:entities,vd_bV:from,vd_ax:rotation},vd_ce);};this.CmdRotate3D=function(entities,from,rotation,axis,vd_ce){vd_lf(this,{vd_cE:3,entities:entities,vd_bV:from,vd_ax:rotation,axis:axis},vd_ce);};this.CmdCopy=function(entities,from,to,vd_ce){vd_lf(this,{vd_cE:4,entities:entities,vd_bV:from,vd_ax:to},vd_ce);};this.CmdMirror=function(entities,from,vd_OF,vd_ce){vd_lf(this,{vd_cE:5,entities:entities,vd_bV:from,vd_ax:vd_OF},vd_ce);};this.CmdSelect=function(vd_ce,entities){vd_lf(this,{vd_cE:0,entities:entities},vd_ce);};this.vd_np=function(action,status){if(action.vd_rj!=null)action.vd_rj(action,status);if(status==='draw'&&vd_U.vdActionDraw!=null)vd_U.vdActionDraw(action);};function vd_iP(layout,vd_sR){Action.hide();if(layout){var vd_t=vd_J();var vd_gP=vd_oc(layout);if(layout.GridMode){var vd_mI=new vd_hx();vd_mI.vd_hc(vd_gP);vd_mI.vd_hc(layout.Limits);vd_gP=vd_mI.vd_fD();}vd_c.update(layout.ViewSize,layout.ViewCenter,layout.World2ViewMatrix,vd_gP,layout.FocalLength,layout.LensAngle,layout.PerspectiveMod===1,(vd_sR===true? -1:layout.RenderMode),layout.Sections,vd_t.Lights);}else vd_c.update(10,vdgeo.newpoint(0,0,0),vdgeo.vd_e(),null,0.05,30,false,(vd_sR===true? -1:undefined));};this.vd_ik=function(){return ctx;};this.ActiveRender=function(){return vd_c;};this.SaveDocument=function(vd_nj){vd_cD.vd_nW(vd_U,vd_nj);};this.SelectDocument=function(vd_aC,vd_kZ,vd_oR){if(!vd_bg)return;vd_bg.vd_uW=vd_oR;vd_U.vd_wC(vd_bg,vd_aC,vd_kZ,vd_ws);};this.New=function(vd_oR){vd_U.SelectDocument(vdConst.vd_kd+'res/vddocument.vds',false,vd_oR);};function vd_BA(vd_jl){var vd_lS=vd_J();if(!vd_lS)return;var vd_t=vd_jl.vdDocument;if(!vd_t)return;var vd_vn=null;if(vd_jl.customdata.mergeFlags&vdConst.MERGEFLAGS_KEEP_BOTH)vd_vn=new vd_CQ(vd_t,vd_lS,vd_jl.customdata.mergeFlags);var vd_CW=vd_lS.Model.Entities.Items;var vd_Gi=vd_t.Model.Entities.Items;for(var i=0;i<vd_Gi.length;i++){var hid=vd_Gi[i];if(vd_vn){hid=vd_vn.vd_pR(hid);if(hid)vd_CW.push(hid);continue;}var entity=vd_t[hid];if(!entity)continue;if(!vd_lS[hid]){vd_lS[hid]=entity;vd_CW.push(hid);}else{if(vd_jl.customdata.mergeFlags&vdConst.MERGEFLAGS_REPLACE_EXISITING){vd_lS[hid]=entity;}}}vd_U.UpdateLayout(null,true);if(vd_jl.customdata.vd_uY)vd_jl.customdata.vd_uY({vdcanvas:vd_U,mergedoc:vd_t,mergeFlags:vd_jl.customdata.mergeFlags});if(vd_aw!=null)clearTimeout(vd_aw);vd_aw=setTimeout(vd_U.redraw,0);};this.MergeDocument=function(filename,vd_uY,mergeFlags,vd_lc){var documentdata=new vd_wk(vd_U);documentdata.customdata={mergeFlags:mergeFlags,vd_uY:vd_uY};if(!vd_lc)vd_U.vd_wC(documentdata,filename,false,vd_BA);else documentdata.LoadDocument(filename,false,vd_BA,vd_lc);};this.SelectDocumentBlob=function(vd_lc,vd_aC,vd_oR){if(!vd_bg)return;vd_bg.vd_uW=vd_oR;vd_bg.LoadDocument(vd_aC,false,vd_ws,vd_lc);};function vd_It(){if(typeof XMLHttpRequest!="undefined"){return new XMLHttpRequest();}else if(typeof ActiveXObject!="undefined"){return new ActiveXObject("Microsoft.XMLHTTP");}else{return null;}};this.vd_wC=function(vd_uo,vd_aC,vd_kZ,vd_iK){if(!vd_uo)return;var _url=vd_aC;var vd_qK=undefined;var vd_Bp=_url.lastIndexOf("?");if(vd_Bp>0){var vd_On=_url.substr(vd_Bp+1);var vd_Cw=vd_On.split("&");for(var k=0;k<vd_Cw.length;k++){var vd_pH=vd_Cw[k];if(vd_pH.vd_RT("vd_qK=")){vd_qK=vd_pH.substr("vd_qK=".length);break;}}if(vd_kZ)_url+="&timestamp="+new Date().getTime();}else{if(vd_kZ)_url+="?timestamp="+new Date().getTime();}var vd_dj=vd_It();if(!vd_dj)return;if(!vd_iK)vd_iK=vd_U.redraw;vd_U.vd_es.start(vd_U.MessagesDictionary.PROGRESS_DOWNLOAD,true);try{var done=false;vd_dj.onprogress=function(evt){if(evt.lengthComputable)vd_U.vd_es.Progress(evt.loaded,evt.total);else vd_U.vd_es.Progress(evt.loaded/100,1);};vd_dj.onreadystatechange=function(){if(vd_dj.readyState==4&& !done){done=true;vd_U.vd_es.end();if(vd_dj.status==200||vd_dj.status==0){vd_uo.LoadDocument(_url,false,vd_iK,vd_dj.responseText);}else{vd_uo.vd_uN(vd_dj.status);vd_U.vd_tG(vdConst.Err_LoadFile,vd_dj.status,_url);}}};vd_dj.open("GET",_url,true);if(vd_qK)vd_dj.setRequestHeader('Authorization','Bearer '+vd_qK);vd_dj.send();}catch(ex){done=true;vd_uo.LoadDocument(_url,false,vd_iK);}};function vd_tZ(){if(!vd_te)return vd_bg;return vd_te;};function vd_J(){if(vd_bg==null)return null;return vd_bg.vdDocument;};function vd_ws(vd_jl){vd_ei=0;vd_c.vd_sM();Action.cancel();var vd_t=vd_J();vd_U.scriptCommand=new vd_Bd(vd_U);if(vd_t!=null){var layout=vd_U.GetActiveLayout();vd_c.vd_hK(vd_t.Palette,layout.BkColorEx);if(vd_t.LineTypeScale==undefined)vd_t.LineTypeScale=1.0;if(vd_U.vdAfterOpenDocument!=null)vd_U.vdAfterOpenDocument(vd_U);vd_U.SetActiveLayout(layout);}};this.SetSize=function(width,height,vd_ac){if(vd_U.canvas==null)return;if(width){width=vdgeo.vd_vJ(width);vd_U.canvas.setAttribute("width",width);if(vd_U.canvas.style)vd_U.canvas.style.width=width.toString()+"px";}if(height){height=vdgeo.vd_u(height);vd_U.canvas.setAttribute("height",height);if(vd_U.canvas.style)vd_U.canvas.style.height=height.toString()+"px";}width=vd_U.canvas.clientWidth?vd_U.canvas.clientWidth:vd_U.canvas.width;height=vd_U.canvas.clientHeight?vd_U.canvas.clientHeight:vd_U.canvas.height;if(vd_c!=null&&width==vd_c.width&&height==vd_c.height)return;if(vd_c!=null){vd_c.vd_H.vd_gl(null);vd_c.destroy();}vd_U.canvas.setAttribute("width",width);vd_U.canvas.setAttribute("height",height);vd_fB=null;vd_iW=null;ctx=vd_U.canvas.getContext("2d");var vd_Ad=vd_c;vd_c=new vd_rf(vd_U,0,0,width,height,ctx);vd_dA.vd_OK(vd_c);vd_c.vd_sZ(vd_Ad);vd_Ad=null;vd_c.vd_H.vd_gl(ctx.getImageData(0,0,width,height),width,height);vd_c.vd_hK(null,vd_ac);Action.resize();setTimeout(vd_U.redraw);};function vd_eO(elem,vd_pM,vd_pf,vd_aL){if(elem.addEventListener)elem.addEventListener(vd_pM,vd_pf,vd_aL);else if(elem.attachEvent)elem.attachEvent('on'+vd_pM,vd_pf);};function vd_ey(elem,vd_pM,vd_pf,vd_aL){if(elem.removeEventListener)elem.removeEventListener(vd_pM,vd_pf,vd_aL);else if(elem.detachEvent)elem.detachEvent('on'+vd_pM,vd_pf);};function vd_Kp(){vd_eO(vd_U.canvas,'mousemove',vd_Gu,vd_aL);vd_eO(vd_U.canvas,'mouseout',vd_Gw,vd_aL);vd_eO(vd_U.canvas,'mouseover',vd_EV,vd_aL);vd_eO(vd_U.canvas,'mousedown',vd_EX,vd_aL);vd_eO(vd_U.canvas,'mouseup',vd_Ff,vd_aL);vd_eO(vd_U.canvas,vd_Gv,vd_FI,vd_aL);vd_eO(vd_U.canvas,'click',vd_zZ,vd_aL);vd_eO(vd_U.canvas,'contextmenu',vd_Fn,vd_aL);vd_xx=true;};function vd_AM(){if(!vd_xx)return;vd_ey(vd_U.canvas,'mousemove',vd_Gu,vd_aL);vd_ey(vd_U.canvas,'mouseout',vd_Gw,vd_aL);vd_ey(vd_U.canvas,'mouseover',vd_EV,vd_aL);vd_ey(vd_U.canvas,'mousedown',vd_EX,vd_aL);vd_ey(vd_U.canvas,'mouseup',vd_Ff,vd_aL);vd_ey(vd_U.canvas,vd_Gv,vd_FI,vd_aL);vd_ey(vd_U.canvas,'click',vd_zZ,vd_aL);vd_ey(vd_U.canvas,'contextmenu',vd_Fn,vd_aL);vd_xx=false;};function vd_CZ(e){vd_U.SetSize();};this.Init=function(vd_iA,width,height,vd_ac){vd_U.canvas=document.getElementById(vd_iA);vd_U.canvas.tabindex='0';vd_U.canvas.style.cursor="none";vd_eO(window,"resize",vd_CZ,vd_aL);vd_eO(vd_U.canvas,"touchstart",vd_Cx,vd_aL);vd_eO(vd_U.canvas,"touchend",vd_rD,vd_aL);vd_eO(vd_U.canvas,"touchcancel",vd_zE,vd_aL);vd_eO(vd_U.canvas,"touchleave",vd_zP,vd_aL);vd_eO(vd_U.canvas,"touchmove",vd_CD,vd_aL);vd_eO(window,"keydown",vd_zq,vd_aL);vd_Kp();vd_U.SetSize(width,height,vd_ac);if(vd_bg)vd_bg.vd_Ai();vd_bg=new vd_wk(vd_U);vd_te=vd_bg;};this.vd_HH=function(){vd_ey(window,"resize",vd_CZ,vd_aL);vd_ey(vd_U.canvas,"touchstart",vd_Cx,vd_aL);vd_ey(vd_U.canvas,"touchend",vd_rD,vd_aL);vd_ey(vd_U.canvas,"touchcancel",vd_zE,vd_aL);vd_ey(vd_U.canvas,"touchleave",vd_zP,vd_aL);vd_ey(vd_U.canvas,"touchmove",vd_CD,vd_aL);vd_ey(window,"keydown",vd_zq,vd_aL);vd_AM();vd_c.vd_H.vd_gl(null);vd_c.destroy();vd_c=null;vd_U.canvas=null;ctx=null;vd_fB=null;vd_iW=null;vd_U.viewcube.clear();if(vd_bg)vd_bg.vd_Ai();vd_bg=null;vd_te=null;};function vd_Rb(owner){this.target=owner;var vd_U=this;this.Info="";this.percent=1000;var vd_qt=0;var vd_qg=0;this.Cancel=false;var vd_wU=false;this.start=function(info,async,total){vd_wU=async;vd_U.Info=info;vd_U.Progress(-1000,1);if(total!=undefined)vd_qg=total;vd_qt=0;return vd_U.Cancel;};this.end=function(){if(vd_U.percent!==1000)vd_U.Progress(100,100);vd_qt=0;vd_qg=0;vd_U.percent=1000;vd_U.Info="";vd_wU=false;return vd_U.Cancel;};function vd_EZ(current,total){if(total!=undefined)vd_qg=total;if(current==undefined)vd_qt++;else vd_qt=current;var vd_As=0;if(vd_qg>0)vd_As=Number((100*vd_qt/vd_qg).toFixed(0));if(vd_As==vd_U.percent)return false;vd_U.percent=vd_As;return true;};function vd_Bl(){if(vd_kO!=null)clearTimeout(vd_kO);vd_kO=null;vd_U.Cancel=false;if(vd_U.target.vdprogress!=null)vd_U.target.vdprogress(vd_U);if(!vd_U.Cancel&&vd_wU===true){if(vd_U.percent<0||vd_U.percent>=100)vd_U.target.Refresh();else{var vd_Gx=24;var vd_EH=vdgeo.vd_u(vd_Gx/2);vd_U.target.vd_ik().globalAlpha=80/255;vd_U.target.vd_ik().lineWidth=vd_Gx;vd_U.target.vd_ik().strokeStyle=vdgdi.vd_iU([0,0,128]);vd_U.target.vd_ik().beginPath();vd_U.target.vd_ik().moveTo(0,vd_EH);vd_U.target.vd_ik().lineTo(vdgeo.vd_u(vd_U.target.canvas.width*vd_U.percent/100),vd_EH);vd_U.target.vd_ik().stroke();vd_U.target.vd_ik().globalAlpha=1;}}};var vd_kO=null;this.vd_RO=function(current,total){vd_EZ(current,total);if(vd_kO!=null)clearTimeout(vd_kO);vd_kO=null;vd_kO=setTimeout(vd_Bl,5);};this.Progress=function(current,total){var ret=vd_EZ(current,total);if(ret)vd_Bl();return ret;};return this;};function vd_OH(sender){this.target=sender;this.Cancel=false;var vd_U=this;this.NumTouchs=0;this.PrevPos1=null;this.PrevPos2=null;this.Pos1=null;this.Pos2=null;this.init=function(vd_QV,vd_NC,vd_MX,p1,p2){vd_U.Cancel=false;vd_U.NumTouchs=vd_QV;vd_U.PrevPos1=vd_NC;vd_U.PrevPos2=vd_MX;vd_U.Pos1=p1;vd_U.Pos2=p2;};this.toString=function(){var ret=vd_U.NumTouchs.toString();if(vd_U.PrevPos1!=null)ret+=(' , '+vd_U.PrevPos1[X].toString()+' , '+vd_U.PrevPos1[Y].toString());else ret+=", null";if(vd_U.Pos1!=null)ret+=(' , '+vd_U.Pos1[X].toString()+' , '+vd_U.Pos1[Y].toString());else ret+=", null";if(vd_U.PrevPos2!=null)ret+=(' , '+vd_U.PrevPos2[X].toString()+' , '+vd_U.PrevPos2[Y].toString());else ret+=", null";if(vd_U.Pos2!=null)ret+=(' , '+vd_U.Pos2[X].toString()+' , '+vd_U.Pos2[Y].toString());else ret+=", null";return ret;};return this;};function vd_Lp(sender){var vd_U=this;this.target=sender;this.Cancel=false;this.mousebutton=0;this.skey=0;this.istouched=false;this.xPix=0;this.yPix=0;this.prevPos=[0,0,0];this.Delta=0;this.x=0;this.y=0;this.z=0;this.init=function(button,vd_lV,pos,pPos,vd_pc,skey){vd_U.Cancel=false;vd_U.mousebutton=button;vd_U.skey=skey;vd_U.istouched=vd_lV;vd_U.xPix=vdgeo.vd_u(pos[X]);vd_U.yPix=vdgeo.vd_u(pos[Y]);vd_U.prevPos=pPos;vd_U.Delta=vd_pc;var vd_dd=vd_c.vd_sK(vd_U.xPix,vd_U.yPix);vd_U.x=vd_dd[X];vd_U.y=vd_dd[Y];vd_U.z=vd_dd[Z];};this.vd_HA=function(wpos){vd_U.x=wpos[X];vd_U.y=wpos[Y];vd_U.z=wpos[Z];var vd_cG=vd_U.target.WorldToPixel(wpos);vd_U.xPix=vd_cG[0];vd_U.yPix=vd_cG[1];};this.toString=function(){var ret="";ret+=(vd_U.mousebutton.toString()+' ,'+(vd_U.istouched===true?"true":"false")+' ,');ret+=(vd_U.xPix.toString()+' '+vd_U.yPix.toString()+' ,');ret+=((vd_U.prevPos!=null?(vd_U.prevPos[X].toString()+' '+vd_U.prevPos[Y].toString()):'null')+' ');return ret;};return this;};this.vdAfterOpenDocument=function(e){};this.vdAfterSaveDocument=function(e){};this.vdmousemoveAfter=function(e){};this.vdmousemove=function(e){};this.vdmousedown=function(e){};this.vdmouseup=function(e){};this.vdmousewheel=function(e){};this.vdmouseout=function(e){};this.vddblclick=function(e){};this.vdclick=function(e){};this.vdtouchMove=function(e){};this.vdprogress=function(e){};this.vdPrompt=function(e,msg){};this.vdKeyDown=function(e){};this.vdError=function(sender,vd_Ei,vd_zY,info){};this.vdLoadXref=function(e){};this.vdXrefLoaded=function(e){};this.vdSelectionModified=null;this.vdActionDraw=null;this.vdDrawCursor=null;this.vdFIlterActionPoint=null;function vd_nP(sender,vx,vy,vz,vs,vd_bD){this.target=sender;this.ViewCenterX=vx;this.ViewCenterY=vy;this.ViewCenterZ=vz;this.ViewSize=vs;this.vd_vc=vd_bD;this.Cancel=false;};this.vdUpdateView=function(e){};this.AfterDrawInView=null;this.AfterRedraw=function(e){};this.vd_tG=function(vd_Ei,vd_zY,info){if(vd_U.vdError!=null)vd_U.vdError(vd_U,vd_Ei,vd_zY,info);};this.Prompt=function(msg){if(vd_U.vdPrompt!=null)vd_U.vdPrompt(this,msg);};function vd_Iy(obj){if(obj==undefined)obj=vd_U.canvas;var vd_DW=0,vd_De=0;if(obj.offsetParent){do{vd_DW+=obj.offsetLeft;vd_De+=obj.offsetTop;obj=obj.offsetParent;}while(obj);return[vd_DW,vd_De];}return[obj.offsetLeft,obj.offsetTop];};function vd_dw(evt,target){if(evt.offsetX&&evt.offsetY)return[vdgeo.vd_u(evt.offsetX),vdgeo.vd_u(evt.offsetY)];var vd_EO=vd_Iy(target);return[vdgeo.vd_u(evt.pageX-vd_EO[X]),vdgeo.vd_u(evt.pageY-vd_EO[Y])];};this.vd_iR=function(pos){return pos[X]>=0&&pos[X]<vd_U.canvas.width&&pos[Y]>=0&&pos[Y]<vd_U.canvas.height;};function vd_th(){vd_td=false;vd_vX=false;vd_yz=false;};function vd_gy(e){var ret=0;if(e.altKey)ret+=1;if(e.ctrlKey)ret+=2;if(e.shiftKey)ret+=4;return ret;};function vd_kS(e){if(vd_td)return 1;if(vd_vX)return 2;if(vd_yz)return 3;return 0;};function vd_rQ(vd_IP){for(var i=0;i<vd_eS.length;i++){if(vd_IP==vd_eS[i][0])return i;}return-1;};function cancelBubble(e){var evt=e?e:window.event;if(evt.stopPropagation)evt.stopPropagation();if(evt.cancelBubble!=null)evt.cancelBubble=true;};function vd_lt(e){var evt=e?e:window.event;if(evt.preventDefault)evt.preventDefault();evt.returnValue=false;return false;};function vd_zZ(evt,vd_lV){var ret=false;var date=new Date();var vd_Ms=date.getTime();vd_so=(vd_Ms<=(vd_AI+500))?(vd_so+1):1;vd_AI=date.getTime();var vd_nS;if(vd_lV)vd_nS=vd_dw(evt.touches[0],evt.target);else vd_nS=vd_dw(evt,evt.target);if(vd_so===2){vd_so=0;vd_AI=0;if(vd_ob!=null){var xdif=Math.abs(vd_nS[X]-vd_ob[X]);var ydif=Math.abs(vd_nS[Y]-vd_ob[Y]);if((xdif<20)&&(ydif<20)){vd_ay.init(vd_kS(evt),vd_lV==true,vd_nS,null,0,vd_gy(evt));if(vd_U.vddblclick!=null)vd_U.vddblclick(vd_ay);if(!vd_ay.Cancel){Action.dblclick(vd_ay);}ret=true;}}}if(ret==false){vd_ay.init(vd_kS(evt),false,vd_nS,null,0,vd_gy(evt));if(vd_U.vdclick!=null)vd_U.vdclick(vd_ay);if(!vd_ay.Cancel){Action.click(vd_ay);ret=(vd_lV!==true);}}if(vd_lV)vd_ob=vd_dw(evt.touches[0],evt.target);else vd_ob=vd_dw(evt,evt.target);return ret;};function vd_Fn(e){e.preventDefault();return false;};function vd_Cx(evt){vd_uV(evt,true);vd_cU=null;vd_AM();Action.vd_wB();var touches=evt.touches;var pos;vd_eS.length=0;for(var i=0;i<touches.length;i++){pos=vd_dw(touches[i],evt.target);if(!vd_U.vd_iR(pos))continue;vd_eS.push([touches[i].identifier,pos]);}if(touches.length==1&&vd_eS.length==1){if(vd_zZ(evt,true))return vd_lt(evt);pos=vd_dw(touches[0],evt.target);vd_ay.init(1,true,pos,null,0,vd_gy(evt));if(vd_U.vdmousedown!=null)vd_U.vdmousedown(vd_ay);if(!vd_ay.Cancel){Action.mousedown(vd_ay);}}cancelBubble(evt);return vd_lt(evt);};function vd_rD(evt){vd_uV(evt,false);vd_cU=null;Action.vd_wB();var touches=evt.changedTouches;if(vd_eS.length==1&&touches.length==1&&evt.touches.length==0&&vd_rQ(touches[0].identifier)!= -1){pos=vd_dw(touches[0],evt.target);vd_ay.init(1,true,pos,null,0,vd_gy(evt));if(vd_U.vdmouseup!=null)vd_U.vdmouseup(vd_ay);if(!vd_ay.Cancel){if(vd_U.vdmouseout!=null)vd_U.vdmouseout(vd_ay);if(!vd_ay.Cancel)Action.mouseup(vd_ay);}}vd_eS.length=0;return vd_ea;};function vd_zP(evt){return vd_rD(evt);};function vd_zE(evt){return vd_rD(evt);};function vd_CD(evt){Action.vd_wB();var touches=evt.changedTouches;if(evt.touches.length==evt.targetTouches.length){if(evt.touches.length==1&&touches.length==1&&vd_eS.length==1&&vd_rQ(touches[0].identifier)!= -1){var pos=vd_dw(touches[0],evt.target);if(vd_cU==null)vd_cU=[pos[0],pos[1],vd_c.vd_H.vd_ko(pos[0],pos[1])];var distance=vdgeo.Distance2D(pos,vd_cU);if(!vdgeo.AreEqual(distance,0,0)){vd_ay.init(1,true,pos,vd_cU,0,vd_gy(evt));if(vd_U.vdmousemove!=null)vd_U.vdmousemove(vd_ay);if(!vd_ay.Cancel){Action.mousemove(vd_ay);if(vd_U.vdmousemoveAfter!=null)vd_U.vdmousemoveAfter(vd_ay);}}}else if(evt.touches.length==2&&touches.length==2&&vd_eS.length==2){var pos1=null;var pos2=null;var idx1= -1;var idx2= -1;var vd_jO=null;var vd_kx=null;idx1=vd_rQ(touches[0].identifier);idx2=vd_rQ(touches[1].identifier);if(idx1!== -1&&idx2!== -1){pos1=vd_dw(touches[0],evt.target);pos2=vd_dw(touches[1],evt.target);vd_jO=vd_eS[idx1][1];vd_kx=vd_eS[idx2][1];vd_eS.splice(idx1,1,[vd_eS[idx1][0],pos1]);vd_eS.splice(idx2,1,[vd_eS[idx2][0],pos2]);if(vd_U.vd_iR(pos1)&&vd_U.vd_iR(pos2)){vd_ts.init(2,vd_jO,vd_kx,pos1,pos2);if(vd_U.vdtouchMove!=null)vd_U.vdtouchMove(vd_ts);if(!vd_ts.Cancel){Action.vd_HO(vd_ts);}}}}cancelBubble(evt);return vd_lt(evt);}return vd_ea;};function vd_Gu(e){var pos=vd_dw(e,e.target);if(!vd_U.vd_iR(pos))return vd_ea;if(vd_cU==null)vd_cU=[pos[0],pos[1],vd_c.vd_H.vd_ko(pos[0],pos[1])];var distance=vdgeo.Distance2D(pos,vd_cU);if(!vdgeo.AreEqual(distance,0,0)){vd_ay.init(vd_kS(e),e.istouched,pos,vd_cU,0,vd_gy(e));if(vd_U.vdmousemove!=null)vd_U.vdmousemove(vd_ay);if(!vd_ay.Cancel){Action.mousemove(vd_ay);if(vd_U.vdmousemoveAfter!=null)vd_U.vdmousemoveAfter(vd_ay);cancelBubble(e);return vd_lt(e);}}return vd_ea;};function vd_FI(e){var pos=vd_dw(e,e.target);if(!vd_U.vd_iR(pos))return vd_ea;var Delta=e.detail?(e.detail* -1):e.wheelDelta;Delta=(Delta<0?vd_U.MouseWheelZoomScale:(1/vd_U.MouseWheelZoomScale));vd_ay.init(vd_kS(e),e.istouched,pos,null,Delta,vd_gy(e));if(vd_U.vdmousewheel!=null)vd_U.vdmousewheel(vd_ay);if(!vd_ay.Cancel){Action.mousewheel(vd_ay);cancelBubble(e);return vd_lt(e);}return vd_ea;};function vd_uV(e,vd_Rn){e.preventDefault();vd_th();if(('ontouchstart'in document.documentElement)||('ontouchstart'in window))vd_td=true;else if(e.which==1)vd_td=true;else if(e.which==2)vd_vX=true;else if(e.which==3)vd_yz=true;};function vd_EX(e){vd_uV(e,true);vd_cU=null;var pos=vd_dw(e,e.target);if(!vd_U.vd_iR(pos))return vd_ea;vd_ay.init(vd_kS(e),e.istouched,pos,null,0,vd_gy(e));if(vd_U.vdmousedown!=null)vd_U.vdmousedown(vd_ay);if(!vd_ay.Cancel){Action.mousedown(vd_ay);cancelBubble(e);return vd_lt(e);}return vd_ea;};function vd_Ff(e){vd_cU=null;var pos=vd_dw(e,e.target);if(!vd_U.vd_iR(pos)){Action.cancel();return vd_ea;}vd_uV(e,false);vd_ay.init(vd_kS(e),e.istouched,pos,null,0,vd_gy(e));if(vd_U.vdmouseup!=null)vd_U.vdmouseup(vd_ay);if(!vd_ay.Cancel){Action.mouseup(vd_ay);cancelBubble(e);vd_th();return vd_lt(e);}vd_th();return vd_ea;};function vd_EV(e){var pos=vd_dw(e,e.target);vd_ay.init(vd_kS(e),e.istouched,pos,null,0,vd_gy(e));Action.mouseover(vd_ay);return vd_ea;};function vd_Gw(e){vd_th();var pos=vd_dw(e,e.target);vd_ay.init(vd_kS(e),e.istouched,pos,null,0,vd_gy(e));if(vd_U.vdmouseout!=null)vd_U.vdmouseout(vd_ay);if(!vd_ay.Cancel){Action.mouseout(vd_ay);cancelBubble(e);return vd_lt(e);}return vd_ea;};function vd_zq(e){if(vd_U.vdKeyDown!=null)vd_U.vdKeyDown(e);if(e.Cancel!==true)Action.keydown(e);return vd_ea;};return this;};function vd_Hl(vd_xq){var vd_U=this;var vd_dB=vd_xq;var vd_ic=0;var vd_lq=false;this.Enable=true;var vd_cL=[];var vd_gX=[];function vd_lw(_obj,vd_kW,vd_Mh){this.obj=_obj;this.name=vd_kW;this.value=vd_Mh;};function vd_Fc(value){this.undogoup=value;};Object.defineProperty(vd_U,'UndoStack',{get:function(){return vd_cL;}});function vd_Fd(obj){if(!vdConst.vd_Md(obj))return;vd_dB.UpdateFig(obj);vd_lq=true;};function vd_Ow(){if(!vd_cL||vd_cL.length==0)return-1;var vd_R=vd_cL[vd_cL.length-1];vd_cL.length-=1;if(!vd_gX)vd_gX=[];if(vd_R.name==='special_transform'){vd_R.value.reverse();vd_gX.push(new vd_lw(vd_R.obj,vd_R.name,vd_R.value));vd_q.vd_hg(vd_R.value[0],vd_R.obj);}else if(vd_R.name==='special_movegrips'){vd_R.value[1][X]*= -1;vd_R.value[1][Y]*= -1;vd_R.value[1][Z]*= -1;vd_gX.push(new vd_lw(vd_R.obj,vd_R.name,vd_R.value));vd_Q.vd_mD(vd_R.obj,vd_R.value[0],vd_R.value[1],vd_dB);}else{vd_gX.push(new vd_lw(vd_R.obj,vd_R.name,vd_R.obj[vd_R.name]));vd_R.obj[vd_R.name]=vd_R.value;}vd_Fd(vd_R.obj);if(vd_R.obj['undogoup']!=undefined)vd_ic+=(vd_R.obj['undogoup']? -1:1);return vd_ic;};function vd_Qe(){if(!vd_gX||vd_gX.length==0)return-1;var vd_R=vd_gX[vd_gX.length-1];vd_gX.length-=1;if(!vd_cL)vd_cL=[];if(vd_R.name==='special_transform'){vd_R.value.reverse();vd_cL.push(new vd_lw(vd_R.obj,vd_R.name,vd_R.value));vd_q.vd_hg(vd_R.value[0],vd_R.obj);}else if(vd_R.name==='special_movegrips'){vd_R.value[1][X]*= -1;vd_R.value[1][Y]*= -1;vd_R.value[1][Z]*= -1;vd_cL.push(new vd_lw(vd_R.obj,vd_R.name,vd_R.value));vd_Q.vd_mD(vd_R.obj,vd_R.value[0],vd_R.value[1],vd_dB);}else{vd_cL.push(new vd_lw(vd_R.obj,vd_R.name,vd_R.obj[vd_R.name]));vd_R.obj[vd_R.name]=vd_R.value;}vd_Fd(vd_R.obj);if(vd_R.obj['undogoup']!=undefined)vd_ic+=(vd_R.obj['undogoup']? -1:1);return vd_ic;};this.Clear=function(){vd_cL=[];vd_gX=[];vd_ic=0;};this.store=function(obj,name,value){if(!vd_U.Enable)return;if(!vd_cL)vd_cL=[];if(value==undefined)value=obj[name];vd_cL.push(new vd_lw(obj,name,value));};this.group_start=function(){vd_U.store(new vd_Fc(false),'undogoup',true);};this.group_end=function(){if(vd_cL&&vd_cL.length>0&&vd_cL[vd_cL.length-1].name==='undogoup'&&vd_cL[vd_cL.length-1].value===true){vd_cL.pop();return;}vd_U.store(new vd_Fc(true),'undogoup',false);};this.undo=function(){vd_lq=false;do{}while(vd_Ow()>0);if(vd_lq)vd_dB.UpdateLayout();vd_lq=false;};this.redo=function(){vd_lq=false;do{}while(vd_Qe()>0);if(vd_lq)vd_dB.UpdateLayout();vd_lq=false;};return this;};var vd_Bm={};vd_Bm.chk=function(vd_dB,palette){var s;var k;if(palette._lc){var vl=[String.fromCharCode(104,116,116,112,58,47,47,100,101,118,46,118,100,114,97,119,46,99,111,109,47),String.fromCharCode(104,116,116,112,58,47,47,118,100,114,97,119,46,99,111,109,47),String.fromCharCode(104,116,116,112,115,58,47,47,118,100,114,97,119,46,99,111,109,47),String.fromCharCode(104,116,116,112,58,47,47,119,119,119,46,118,100,114,97,119,46,99,111,109,47),String.fromCharCode(104,116,116,112,115,58,47,47,119,119,119,46,118,100,114,97,119,46,99,111,109,47),String.fromCharCode(104,116,116,112,58,47,47,119,119,119,46,118,100,114,97,119,98,111,120,46,99,111,109,47),String.fromCharCode(104,116,116,112,115,58,47,47,119,119,119,46,118,100,114,97,119,98,111,120,46,99,111,109,47),String.fromCharCode(102,105,108,101,58,47,47,47,67,58,47,118,100,114,97,119,55,47,87,101,98,76,105,98,114,97,114,121,47),String.fromCharCode(104,116,116,112,58,47,47,102,105,108,101,115,46,118,100,114,97,119,46,99,111,109,47),];var u=decodeURI(document.location.href.split('?')[0]);for(k=0;k<vl.length;k++){palette._lc._a1=u.substring(0,vl[k].length)==vl[k];if(palette._lc._a1)break;}var lv=vd_dB[String.fromCharCode(108,105,99,118,97,108)];if(!palette._lc._a1&&lv){var suc1=false;for(k=0;k<lv.length;k++){s=base64.vd_FC(base64.vd_yy(lv[k].split('').reverse().join('')));suc1=document._lc.indexOf(s)>=0;if(suc1)break;}if(suc1){for(k=0;k<lv.length;k++){s=base64.vd_FC(base64.vd_yy(lv[k].split('').reverse().join('')));palette._lc._a1=u.indexOf(s)>=0;if(palette._lc._a1)break;}}}if(palette._lc._a2)palette._lc._a1=false;}};function vd_wk(vd_xq){var vd_U=this;var vd_dB=vd_xq;this.vd_Et=new vd_Sl();this.FileName="";this.vd_hL="";this.vdDocument=null;var vd_Rh=false;var vd_nw=null;var vd_ui=false;this.vd_uW=null;var vd_cK=[];function vd_Kg(){var vd_gv=document.getElementsByTagName('head')[0];for(var k=0;k<vd_cK.length;k++){vd_cK[k].onreadystatechange=null;vd_cK[k].onload=null;vd_cK[k].readyState='none';vd_cK[k].innerHTML="";vd_gv.removeChild(vd_cK[k]);}vd_cK=[];};function vd_Bn(e){var id= -1;for(var k=0;k<vd_cK.length;k++){if(vd_cK[k]===e.target){id=k;break;}}if(id=== -1)return;var vd_gv=document.getElementsByTagName('head')[0];vd_cK[id].onreadystatechange=null;vd_cK[id].onload=null;vd_cK[id].readyState='none';vd_cK[id].innerHTML="";vd_gv.removeChild(vd_cK[id]);vd_cK.splice(id,1);};this.vd_KS=function(item){return vd_U.vdDocument[item];};this.vd_Mu=function(vd_aA,vd_cV){if(!vd_cV)return null;return vd_aA.Items[vd_aA[vd_cV]];};this.vd_Fw=function(vd_aA,vd_cV){if(!vd_cV)return null;return vd_U.vdDocument[vd_cV];};this.vd_hs=vd_U.vd_Fw;this.vd_vx=false;function vd_Mz(){if(!vd_U.vdDocument.Lights)vd_U.vdDocument.Lights={};if(!vd_U.vdDocument.Lights.Default){vd_U.vdDocument.Lights.Default={};vd_U.vdDocument.Lights.Default.Enable=true;}if(!vd_U.vdDocument.Lights.Default.Name)vd_U.vdDocument.Lights.Default.Name='default';if(!vd_U.vdDocument.Lights.Default.SpotFallOff)vd_U.vdDocument.Lights.Default.SpotFallOff=0;if(!vd_U.vdDocument.Lights.Default.SpotAngle)vd_U.vdDocument.Lights.Default.SpotAngle=180;if(!vd_U.vdDocument.Lights.Default.TypeOfLight)vd_U.vdDocument.Lights.Default.TypeOfLight=1001;if(!vd_U.vdDocument.Lights.Default.color)vd_U.vdDocument.Lights.Default.color=[255,255,255,255];if(!vd_U.vdDocument.Lights.Default.Intensity)vd_U.vdDocument.Lights.Default.Intensity=1;if(!vd_U.vdDocument.Lights.Default.Position)vd_U.vdDocument.Lights.Default.Position=[0,0,0];if(!vd_U.vdDocument.Lights.Default.Direction)vd_U.vdDocument.Lights.Default.Direction=[0,0,-1];};function vd_Nf(){var vd_sk=vd_U.vdDocument.LineTypes;if(vd_sk==undefined)return;for(var i=0;i<vd_sk.Items.length;i++){var linetype=vd_U.vd_hs(vd_sk,vd_sk.Items[i]);if(!linetype||linetype.Segments==undefined)continue;for(var j=0;j<linetype.Segments.Items.length;j++){var vd_Y=linetype.Segments.Items[j];if(vd_Y.vd_cX!=undefined&&vd_Y.vd_cX!=null)continue;if(vd_Y.Flag!=vdConst.LINETYPE_FLAG_TTF_TEXT&&vd_Y.Flag!=vdConst.LINETYPE_FLAG_SHX_TEXT)continue;vd_Y.ShapeStyleRef=vd_U.vd_hs(vd_U.vdDocument.TextStyles,vd_Y.ShapeStyle);if(vd_Y.ShapeStyleRef==null||vd_Y.ShapeStyleRef.FontFileVDS==null)continue;if(vd_Y.ShapeStyleRef.FontFileVDS==null)continue;if(vd_Y.Flag==vdConst.LINETYPE_FLAG_SHX_TEXT){vd_Y.vd_pd=String.fromCharCode(vd_Y.Shapenumber);}else vd_Y.vd_pd=vd_Y.ShapeText;vd_Y.vd_cX=[0,0,0,0];for(var c=0;c<vd_Y.vd_pd.length;c++){var pos=vd_Y.vd_pd.charCodeAt(c);if(pos==10||pos==13){continue;}var vd_gS=vd_Y.ShapeStyleRef.FontFileVDS.Shapes['h_'+pos.toString()];var shape=null;if(vd_gS!=undefined)shape=vd_Y.ShapeStyleRef.FontFileVDS.Shapes.Items[vd_gS];if(c==0&&shape!=null)vd_Y.vd_cX[0]=shape.bb[0];if(shape!=null){vd_Y.vd_cX[1]+=(shape.AdvanceX);rsb=shape.AdvanceX-shape.bb[2];vd_Y.vd_cX[2]=Math.min(vd_Y.vd_cX[2],shape.bb[1]);vd_Y.vd_cX[3]=Math.max(vd_Y.vd_cX[3],shape.bb[3]);}else{vd_Y.vd_cX[1]+=vd_Y.ShapeStyleRef.FontFileVDS.Ascent*0.5;rsb=0;}}vd_Y.vd_cX[1]-=rsb;if(vd_Y.ShapeRotation==undefined)vd_Y.ShapeRotation=0.0;if(vd_Y.ShapeOffsetX==undefined)vd_Y.ShapeOffsetX=0.0;if(vd_Y.ShapeOffsetY==undefined)vd_Y.ShapeOffsetY=0.0;}}};var vd_mj=0;function vd_BM(vd_j){if(!vd_j)return;var vd_cR=(vd_j.Transparency&&vd_j.Transparency[3]===255)?vd_j.Transparency:null;var r,g,b,a;if(vd_j.bytes&& !vd_j.bytescount){var bytes=[];bytes.length=vd_j.height;for(var h=0;h<vd_j.height;h++){var vd_lI=[];vd_lI.length=vd_j.width*4;bytes[h]=vd_lI;var k=0;for(var w=0;w<vd_j.width;w++){b=vd_j.bytes[h][w*3];g=vd_j.bytes[h][w*3+1];r=vd_j.bytes[h][w*3+2];a=255;if(vd_cR&&r===vd_cR[0]&&g===vd_cR[1]&&b===vd_cR[2])a=0;vd_lI[k]=r;k++;vd_lI[k]=g;k++;vd_lI[k]=b;k++;vd_lI[k]=a;k++;}}vd_j.bytes=bytes;vd_j.bytescount=4;return;}if(!vd_j.jpegData||vd_j.bytes)return;vd_mj++;var vd_eH=document.createElement("img");var iformat=vd_j.iformat?vd_j.iformat:"jpg";vd_eH.setAttribute("src","data:image/"+iformat+";base64,"+vd_j.jpegData);vd_eH.setAttribute("width",vd_j.width);vd_eH.setAttribute("height",vd_j.height);vd_eH.vd_Au=vd_j;vd_eH.onload=function(evt){var vd_Au=evt.target.vd_Au;vdConst.vd_ty(evt.target,vd_Au);vd_mj--;if(vd_mj===0){if(vd_nw)vd_nw(vd_U);vd_sC();vd_U.vd_uN(0);}}};function vd_Nq(){var vd_rJ=vd_U.vdDocument.Images;if(!vd_rJ)return;for(var i=0;i<vd_rJ.Items.length;i++){var vd_j=vd_U.vd_hs(vd_rJ,vd_rJ.Items[i]);vd_BM(vd_j);}};function vd_Pc(){var palette=vd_U.vdDocument.Palette;vd_BM(palette._lc);for(var i=0;i<palette.Items.length;i++){if(palette.Items[i].MaterialImageRef!=undefined)continue;palette.Items[i].MaterialImageRef=vd_U.vd_hs(vd_U.vdDocument.Images,palette.Items[i].MaterialImage);}vd_Bm.chk(vd_dB,palette);};function vd_Si(){var vd_uf=vd_U.vdDocument.TextStyles;if(vd_uf==undefined)return;for(var i=0;i<vd_uf.Items.length;i++){var style;if(vd_U.vd_vx){style=vd_uf.Items[i];}else{style=vd_U.vdDocument[vd_uf.Items[i]];}if(style.FontFileVDS==null||style.FontFileVDS==undefined){try{style.FontFileVDS=vd_U.vdDocument[style.Font];}catch(ex){style.FontFileVDS=null;}}}};function vd_CG(layout){var box=new vd_hx();box.vd_hc(layout.BoundingBox);var vd_KT=[0,0,0,12,9,0];if(!layout.Limits){if(box.vd_bt||box.vd_Ew)layout.Limits=vd_KT;else layout.Limits=box.vd_fD();}if(!layout.GridSpaceX)layout.GridSpaceX=0.5;if(!layout.GridSpaceY)layout.GridSpaceY=0.5;if(!layout.SnapSpaceX)layout.SnapSpaceX=0.5;if(!layout.SnapSpaceY)layout.SnapSpaceY=0.5;if(!layout.SnapBase)layout.SnapBase=[0,0,0];if(layout.GridStyle===undefined)layout.GridStyle=vdConst.GridStyle_Solid;if(!box.vd_bt&& !box.vd_Ew)layout.BoundingBox=box.vd_fD();};function vd_Ha(){vd_U.vdDocument.vd_FW=new vd_LM(vd_U.vdDocument,vd_dB);vd_U.vdDocument.UndoHistory=new vd_Hl(vd_dB);vd_mj=0;vd_U.vdDocument.pathname=vd_U.vd_hL;if(vd_U.vdDocument.LineTypeScale==undefined)vd_U.vdDocument.LineTypeScale=1.0;if(vd_U.vdDocument.LayOuts==undefined||vd_U.vdDocument.LayOuts[vd_U.vdDocument.ActiveLayOut]==undefined)vd_U.vdDocument.ActiveLayOutRef=vd_U.vdDocument.Model;else vd_U.vdDocument.ActiveLayOutRef=vd_U.vdDocument.LayOuts.Items[vd_U.vdDocument.LayOuts[vd_U.vdDocument.ActiveLayOut]];vd_CG(vd_U.vdDocument.Model);if(vd_U.vdDocument.LayOuts)for(var i=0;i<vd_U.vdDocument.LayOuts.Items.length;i++)vd_CG(vd_U.vdDocument.LayOuts.Items[i]);if(!vd_U.vdDocument.GlobalRenderProperties){vd_U.vdDocument.GlobalRenderProperties={AxisSize:50,GridColor:[255,99,71,255],CursorAxisColor:[0,0,0,255],CursorPickColor:[0,0,0,255],AttributesMode:vdConst.AttributesMode_Normal};}if(vd_U.vdDocument.ActiveView&&vd_U.vdDocument.Views&&vd_U.vdDocument.Views.Items&&vd_U.vdDocument.Views[vd_U.vdDocument.ActiveView])vd_U.vdDocument.vd_jM=vd_U.vdDocument.Views.Items[vd_U.vdDocument.Views[vd_U.vdDocument.ActiveView]];if(vd_U.vdDocument.Images==undefined)vd_U.vdDocument.Images={Items:[]};vd_U.vdDocument.ActiveLineTypeRef=vd_U.vd_hs(vd_U.vdDocument.LineTypes,vd_U.vdDocument.ActiveLineType);vd_U.vdDocument.ActiveTextStyleRef=vd_U.vd_hs(vd_U.vdDocument.TextStyles,vd_U.vdDocument.ActiveTextStyle);vd_U.vdDocument.ActiveLayerRef=vd_U.vd_hs(vd_U.vdDocument.Layers,vd_U.vdDocument.ActiveLayer);vd_U.vdDocument.vd_he=vdConst.OsnapMode_DISABLE;vd_Si();vd_Nf();vd_Mz();vd_Pc();vd_Nq();vd_U.vd_Et.SelectDocument(vd_U.vdDocument);if(vd_mj===0){if(vd_nw)vd_nw(vd_U);vd_sC();vd_U.vd_uN(0);}};function vd_GG(){if(!vd_mg)vd_pr(null,5000);else{try{eval(vd_mg);if(_vdDocTmp){vd_U.vd_hs=vd_U.vd_Mu;vd_U.vd_vx=true;vd_FG();}vd_Du();}catch(ex){vd_pr(ex,6000);}}};this.Empty=function(){vd_sC();vd_Kg();if(vd_U.vd_jR){for(var idoc=0;idoc<vd_U.vd_jR.length;idoc++){if(vd_U.vd_jR[idoc].documentdata){vd_U.vd_jR[idoc].documentdata.Empty();}}vd_U.vd_jR=[];}vd_U.vdDocument=null;};this.vd_Ai=function(){vd_U.Empty();vd_dB=null;};function vd_Du(){vd_mg=null;if(vd_eW)vd_eW.length=0;vd_eW=null;_vdDocTmp=null;};function vd_pr(ex,timeout){vd_U.vdDocument=null;vd_dB.vd_es.end();vd_sC();vd_U.vd_uN(1000+timeout);vd_dB.vd_tG(vdConst.Err_LoadFile,1000+timeout,(ex?ex.message:vd_U.vd_hL));};this.vd_uN=function(vd_MT){var vd_bj=vd_U.vd_uW;vd_U.vd_uW=undefined;if(vd_bj)vd_bj({vdcanvas:vd_dB,errorcode:vd_MT});};function progress(i){vd_dB.vd_es.Progress(i,100);};function vd_FG(){if(!_vdDocument){vd_pr(null,-1101);return;}vd_dB.vd_es.end();vd_U.vdDocument=_vdDocument;vd_Ha();};function vd_sC(){vd_Du();vd_nw=null;_vdDocument=null;vd_mj=0;vd_ui=false;};function vd_Kt(vd_Hd,codetype){var vd_gv=document.getElementsByTagName('head')[0];var js1=document.createElement('script');js1.setAttribute('type','text/javascript');if(codetype===0){js1.setAttribute('src',vd_Hd);vd_U.vd_hL=decodeURI(js1.src);document._lc=vd_U.vd_hL;}else{js1.innerHTML=vd_Hd;}vd_gv.appendChild(js1);vd_cK.push(js1);js1.onerror=function(e){vd_Bn(e);vd_pr(null,1000);};js1.onreadystatechange=function(e){if(e.readyState=="loaded"||e.readyState=='complete'||e.target.readyState=="loaded"||e.target.readyState=='complete'){e.readyState="complete";vd_Bn(e);if(_vdDocTmp){vd_Ek(_vdDocTmp);}}};js1.onload=function(e){e.readyState='complete';e.target.onreadystatechange(e);}};this.vd_En=function(){return vd_ui;};this.LoadDocument=function(vd_aC,vd_kZ,vd_iK,vd_lc){if(vd_ui)return;vd_ui=true;vd_U.Empty();if(!vd_iK)vd_iK=vd_dB.redraw;vd_dB.vd_es.start(vd_dB.MessagesDictionary.PROGRESS_READ_DRAWING,true);vd_nw=vd_iK;vd_U.vd_hs=vd_U.vd_Fw;vd_U.vd_vx=false;vd_U.FileName=vd_aC;vd_U.vd_hL=vd_aC;document._p=progress;document._l=vd_FG;document._e=vd_pr;document._d=vd_Ek;var _url=vd_aC;if(vd_kZ)_url+="?timestamp="+new Date().getTime();if(vd_lc&&vd_lc!=""){var l=document.createElement("a");l.href=vd_aC;document._lc=decodeURI(l.href);vd_U.vd_hL=document._lc;eval(vd_lc);}else{vd_Kt(_url,0);}};function __a(vd_dQ,r,w){try{progress(vdgeo.vd_u(100*r/vd_dQ.length));if(r==vd_dQ.length){vd_GG();w=undefined;return;}for(var c=0;c<vd_dQ[r].length;c++){var entry="";var k=vd_dQ[r][c];if(r===0&&c===0){w=String.fromCharCode(k);vd_mg=w;continue;}if(vd_eW[k]){entry=vd_eW[k];}else{if(k===vd_eW.length){entry=w+w.charAt(0);}else{vd_mg=undefined;w=undefined;vd_GG();return;}}vd_mg+=entry;vd_eW.push(w+entry.charAt(0));w=entry;entry=undefined;}vd_dQ[r].length=0;vd_dQ[r]=null;r++;}catch(ex){vd_pr(ex,r);return;}setTimeout(function(){__a(vd_dQ,r,w)},0);};var vd_mg=undefined;var vd_eW=undefined;function vd_Ek(vd_dQ){var w,r=0;vd_mg=undefined;vd_eW=[];for(var i=0;i<256;i+=1)vd_eW[i]=String.fromCharCode(i);r=0;setTimeout(function(){__a(vd_dQ,r,w)},0);};return this;};function vd_CQ(vd_sI,vd_aW,vd_iD,prefix,vd_vb){var vd_U=this;var vd_Hh={};var vd_Fo={};var vd_Fa={};var vd_Bw={};var vd_Bh={};var vd_CV={};var vd_GH={};vd_aW.HandleCurrent=Math.max(vd_sI.HandleCurrent,vd_aW.HandleCurrent);function vd_Pk(vd_oZ){if(vd_oZ&& !vd_aW['h_'+vd_oZ.toString()]){if(vd_oZ>vd_aW.HandleCurrent)vd_aW.HandleCurrent=vd_oZ;return vd_oZ;}vd_aW.HandleCurrent++;while(vd_aW['h_'+vd_aW.HandleCurrent.toString()])vd_aW.HandleCurrent++;return vd_aW.HandleCurrent;};function vd_os(vd_aA,dict){var i;var tbl;var hid;for(i=0;i<vd_aA.Items.length;i++){hid=vd_aA.Items[i];tbl=vd_aW[hid];dict[tbl.Name]=tbl;}};function vd_Kx(){if(!prefix)prefix="XREF_"+vdConst.vd_Jd(vd_sI.pathname).replace('.','_');if(!vd_vb)vd_vb='';if(!(vd_iD&vdConst.MERGEFLAGS_USEDESTEXISTINGTABLES))return;vd_os(vd_aW.Layers,vd_Fo);vd_os(vd_aW.LineTypes,vd_Fa);vd_os(vd_aW.Images,vd_Bw);vd_os(vd_aW.TextStyles,vd_Bh);vd_os(vd_aW.HatchPatterns,vd_CV);vd_os(vd_aW.Blocks,vd_GH);};vd_Kx();this.vd_pR=function(obj){if(null==obj)return obj;if(typeof obj=='string'&&obj.substr(0,2)=='h_'){return vd_Pi(obj);}if("object"!=typeof obj)return obj;var copy=obj.constructor();if(obj==null)return obj;for(var attr in obj){if(typeof(obj[attr])=="function")continue;if(obj.hasOwnProperty(attr)&&(attr==='FontFileVDS'||(vdConst.vd_zA.indexOf(attr)=== -1&&vd_cD.vd_Ao.indexOf(attr)=== -1))){copy[attr]=vd_U.vd_pR(obj[attr]);if(attr==='FontFileVDS'){if(obj['Font']){if(!vd_aW[obj['Font']]){vd_aW[obj['Font']]=copy[attr];}else{var vd_EC=vd_aW[obj['Font']];var vd_Cy=vd_sI[obj['Font']];for(var vd_wm in vd_Cy){if(!vd_EC[vd_wm]){vd_EC[vd_wm]=vd_U.vd_pR(vd_Cy[vd_wm]);}}}}}}}return copy;};function vd_Pi(vd_zC){var tbl=vd_Hh[vd_zC];if(tbl)return tbl;var vd_cp=vd_sI[vd_zC];if(!vd_cp)return undefined;var vd_dM;var vd_hJ;if(vd_cp._t==vdConst.vdLayer_code){vd_dM=vd_Fo[vd_cp.Name];}else if(vd_cp._t==vdConst.vdLineType_code){vd_dM=vd_Fa[vd_cp.Name];}else if(vd_cp._t==vdConst.vdImageDef_code){vd_dM=vd_Bw[vd_cp.Name];}else if(vd_cp._t==vdConst.vdTextstyle_code){vd_dM=vd_Bh[vd_cp.Name];}else if(vd_cp._t==vdConst.vdHatchPattern_code){vd_dM=vd_CV[vd_cp.Name];}else if(vd_cp._t==vdConst.vdBlock_code){vd_dM=vd_GH[vd_cp.Name];}if(vd_dM)vd_hJ="h_"+vd_dM.HandleId.toString();else{vd_dM=vd_U.vd_pR(vd_cp);vd_dM.HandleId=vd_Pk(vd_dM.HandleId);vd_hJ="h_"+vd_dM.HandleId.toString();vd_Hh[vd_zC]=vd_hJ;vd_aW[vd_hJ]=vd_dM;var vd_jT=false;if(vd_cp._t==vdConst.vdLayer_code){vd_jT=true;vd_aW.Layers.Items.push(vd_hJ);}else if(vd_cp._t==vdConst.vdLineType_code){vd_jT=true;vd_aW.LineTypes.Items.push(vd_hJ);}else if(vd_cp._t==vdConst.vdImageDef_code){vd_jT=true;vd_aW.Images.Items.push(vd_hJ);}else if(vd_cp._t==vdConst.vdTextstyle_code){vd_jT=true;vd_aW.TextStyles.Items.push(vd_hJ);}else if(vd_cp._t==vdConst.vdHatchPattern_code){vd_jT=true;vd_aW.HatchPatterns.Items.push(vd_hJ);}else if(vd_cp._t==vdConst.vdBlock_code){vd_jT=true;vd_aW.Blocks.Items.push(vd_hJ);}if(vd_jT&& !(vd_iD&vdConst.MERGEFLAGS_USEDESTEXISTINGTABLES)&&vd_dM.Name){var vd_Fy=prefix+'#'+vd_dM.Name;if(vd_vb)vd_Fy+='#'+vd_vb;vd_dM.Name=vd_Fy;}}return vd_hJ;};return this;};var vd_Af={};vd_Af.vd_ET=function(vd_wF){var block=vd_wF.Block;var vd_wx=vd_wF.documentdata.vdDocument;if(!block|| !block.vd_iD|| !vd_wx)return false;var vd_t=vd_wF.target.GetDocument();block.Entities=new vd_CQ(vd_wx,vd_t,block.vd_iD,"XREF_"+block.Name+"_"+block.HandleId.toString()).vd_pR(vd_wx.Model.Entities);block.vd_iD=undefined;block.ExternalReference=null;block.ExternalReferencePath='';return true;};function vd_LX(){var vd_U=this;var vd_ge=[];this.AttachCanvas=function(vd_iA,width,height,vd_ac){vd_U.DettachCanvas(vd_iA);var vd_zQ=new vdraw();vd_zQ.Init(vd_iA,width,height,vd_ac);vd_ge.push(vd_zQ);return vd_zQ;};this.DettachCanvas=function(vd_iA){var id= -1;for(var i=0;i<vd_ge.length;i++){if(vd_ge[i].canvas.id===vd_iA){vd_ge[i].vd_HH();id=i;break;}}if(id=== -1)return;vd_ge.splice(id,1);};this.vdrawObject=function(vd_iA){if(!vd_iA){if(vd_ge.length>0)return vd_ge[vd_ge.length-1];return null;}for(var i=0;i<vd_ge.length;i++){if(vd_ge[i].canvas.id===vd_iA)return vd_ge[i];}return null;};return this;};var vdmanager=new vd_LX();var vd_q={};vd_q.vd_DD=new vddimmanager();vd_q.vd_hg=function(mat,entity,vdcanvas){if(vdgeo.vd_wj(mat))return;if(entity._t===vdConst.vdLine_code)vd_q.vd_Ro(mat,entity,vdcanvas);else if(entity._t===vdConst.vdPolyline_code)vd_q.vd_QC(mat,entity,vdcanvas);else if(entity._t===vdConst.vdText_code)vd_q.vd_xb(mat,entity,vdcanvas);else if(entity._t===vdConst.vdRect_code)vd_q.vd_HD(mat,entity,vdcanvas);else if(entity._t===vdConst.vdCircle_code)vd_q.vd_Rp(mat,entity,vdcanvas);else if(entity._t===vdConst.vdEllipse_code)vd_q.vd_RQ(mat,entity,vdcanvas);else if(entity._t===vdConst.vdArc_code)vd_q.vd_QL(mat,entity,vdcanvas);else if(entity._t===vdConst.vdImage_code)vd_q.vd_HD(mat,entity,vdcanvas);else if(entity._t===vdConst.vdInsert_code)vd_q.vd_QB(mat,entity,vdcanvas);else if(entity._t===vdConst.vd3DFace_code)vd_q.vd_Ng(mat,entity,vdcanvas);else if(entity._t===vdConst.vdPolyface_code)vd_q.vd_RR(mat,entity,vdcanvas);else if(entity._t===vdConst.vdAttrib_code)vd_q.vd_xb(mat,entity,vdcanvas);else if(entity._t===vdConst.vdAttribDef_code)vd_q.vd_xb(mat,entity,vdcanvas);else if(entity._t===vdConst.vdInfinityLine_code)vd_q.vd_Qr(mat,entity,vdcanvas);else if(entity._t===vdConst.vdPoint_code)vd_q.vd_OB(mat,entity,vdcanvas);else if(entity._t===vdConst.vdPointCloud_code)vd_q.vd_PX(mat,entity,vdcanvas);else if(entity._t===vdConst.vdPolyhatch_code)vd_q.vd_RC(mat,entity,vdcanvas);else if(entity._t===vdConst.vdDimension_code)vd_q.vd_DD.vd_FO(mat,entity,vdcanvas);else if(entity.Explode!=undefined)vd_q.vd_Iz(mat,entity,vdcanvas);if(vdcanvas)vdcanvas.UpdateFig(entity);};vd_q.vd_kC=function(mat,vd_ho,vdcanvas){if(vd_ho.Thickness){vd_ho.Thickness=vd_ho.Thickness*vdgeo.vd_ur(mat)[2];}if(!vd_ho.ExtrusionVector)vd_ho.ExtrusionVector=[0,0,1];vd_ho.ExtrusionVector=vdgeo.vd_id(mat,vd_ho.ExtrusionVector[0],vd_ho.ExtrusionVector[1],vd_ho.ExtrusionVector[2],true);};vd_q.vd_fw=function(mat,figure,vdcanvas){if(figure.PenWidth){figure.PenWidth=figure.PenWidth*vd_q.vd_qO(mat);}};vd_q.vd_oS=function(mat,entity,vdcanvas){if(!entity.HatchProperties)return;if(!vdgeo.vd_lN(mat)){var scale=vd_q.vd_qO(mat);var rotation=vdgeo.GetAngle(vdgeo.newpoint(0,0,0),vdgeo.vd_jH(mat));if(!entity.HatchProperties.HatchAngle)entity.HatchProperties.HatchAngle=0;entity.HatchProperties.HatchAngle=entity.HatchProperties.HatchAngle+rotation;if(!entity.HatchProperties.HatchScale)entity.HatchProperties.HatchScale=1;entity.HatchProperties.HatchScale=entity.HatchProperties.HatchScale*scale;}};vd_q.vd_Ro=function(mat,line,vdcanvas){line.StartPoint=vdgeo.matrixtransform(mat,line.StartPoint);line.EndPoint=vdgeo.matrixtransform(mat,line.EndPoint);vd_q.vd_fw(mat,line,vdcanvas);};vd_q.vd_QL=function(mat,arc,vdcanvas){arc.Center=vdgeo.matrixtransform(mat,arc.Center);arc.Radius=arc.Radius*vd_q.vd_qO(mat);if(!arc.StartAngle)arc.StartAngle=0.0;if(!arc.EndAngle)arc.EndAngle=0.0;if(vdgeo.vd_lN(mat)){var tmp=arc.StartAngle;arc.StartAngle=vdgeo.VD_TWOPI-arc.EndAngle;arc.EndAngle=vdgeo.VD_TWOPI-tmp;}var vd_eV=vdgeo.vd_ok(mat);arc.StartAngle=arc.StartAngle+vd_eV;arc.EndAngle=arc.EndAngle+vd_eV;vd_q.vd_oS(mat,arc,vdcanvas);vd_q.vd_kC(mat,arc,vdcanvas);vd_q.vd_fw(mat,arc,vdcanvas);};vd_q.vd_Rp=function(mat,circle,vdcanvas){circle.Center=vdgeo.matrixtransform(mat,circle.Center);circle.Radius=circle.Radius*vd_q.vd_qO(mat);vd_q.vd_oS(mat,circle,vdcanvas);vd_q.vd_kC(mat,circle,vdcanvas);vd_q.vd_fw(mat,circle,vdcanvas);};vd_q.vd_Mf=function(ellipse,vdcanvas){var tmp;if(ellipse.MinorLength>ellipse.MajorLength){tmp=ellipse.MajorLength;ellipse.MajorLength=ellipse.MinorLength;ellipse.MinorLength=tmp;ellipse.MajorAngle=ellipse.MajorAngle+vdgeo.vdgeo.VD_TWOPI;ellipse.StartAngle=ellipse.StartAngle-vdgeo.HALF_PI;vd_Sf.EndAngle=ellipse.EndAngle-vdgeo.HALF_PI;ellipse.MajorAngle=vdgeo.FixAngle(ellipse.MajorAngle);ellipse.StartAngle=vdgeo.FixAngle(ellipse.StartAngle);ellipse.EndAngle=vdgeo.FixAngle(ellipse.EndAngle);}};vd_q.vd_RQ=function(mat,ellipse,vdcanvas){if(!ellipse.MajorAngle)ellipse.MajorAngle=0.0;if(!ellipse.StartAngle)ellipse.StartAngle=0.0;if(!ellipse.EndAngle)ellipse.EndAngle=0.0;ellipse.Center=vdgeo.matrixtransform(mat,ellipse.Center);var vd_fA=vdgeo.vd_ur(mat);ellipse.MajorLength*=vd_fA[X];ellipse.MinorLength*=vd_fA[Y];if(vdgeo.vd_lN(mat)){var tmp=ellipse.StartAngle;ellipse.StartAngle=vdgeo.VD_TWOPI-ellipse.EndAngle;ellipse.EndAngle=vdgeo.VD_TWOPI-tmp;}var vd_eV=vdgeo.vd_ok(mat);ellipse.StartAngle=ellipse.StartAngle+vd_eV;ellipse.EndAngle=ellipse.EndAngle+vd_eV;ellipse.MajorAngle+=vd_eV;vd_q.vd_Mf(ellipse,vdcanvas);vd_q.vd_oS(mat,ellipse,vdcanvas);vd_q.vd_kC(mat,ellipse,vdcanvas);vd_q.vd_fw(mat,ellipse,vdcanvas);};vd_q.vd_HD=function(mat,rect,vdcanvas){if(!rect.Rotation)rect.Rotation=0.0;if(!rect.ExtrusionVector)rect.ExtrusionVector=[0,0,1];var vd_cN=vdgeo.vd_Ht(mat,rect.InsertionPoint,rect.Rotation,rect.Width,rect.Height,rect.Thickness?rect.Thickness:1.0,rect.ExtrusionVector);rect.Width=vd_cN.sx;rect.Height=vd_cN.sy;rect.Rotation=vd_cN.zrot;rect.InsertionPoint=[vd_cN.x,vd_cN.y,vd_cN.z];rect.ExtrusionVector=vd_cN.dir;if(rect.Thickness)rect.Thickness=vd_cN.sz;vd_q.vd_oS(mat,rect,vdcanvas);vd_q.vd_fw(mat,rect,vdcanvas);};vd_q.vd_Qr=function(mat,vd_it,vdcanvas){vd_it.BasePoint=vdgeo.matrixtransform(mat,vd_it.BasePoint);if(vd_it.Direction)vd_it.Direction=vdgeo.vd_id(mat,vd_it.Direction[0],vd_it.Direction[1],vd_it.Direction[2]);vd_q.vd_kC(mat,vd_it,vdcanvas);vd_q.vd_fw(mat,vd_it,vdcanvas);};vd_q.vd_QC=function(mat,polyline,vdcanvas){polyline.VertexList.Items=vdgeo.vd_st(mat,polyline.VertexList.Items);vd_q.vd_oS(mat,polyline,vdcanvas);vd_q.vd_kC(mat,polyline,vdcanvas);vd_q.vd_fw(mat,polyline,vdcanvas);};vd_q.vd_xb=function(mat,text,vdcanvas){if(!text.WidthFactor)text.WidthFactor=1.0;if(!text.Rotation)text.Rotation=0.0;var vd_fA=vdgeo.vd_ur(mat);var vd_eV=vdgeo.vd_ok(mat);text.InsertionPoint=vdgeo.matrixtransform(mat,text.InsertionPoint);if(text.Flag==vdConst.VdConstTextstyle_BACKWARD)vd_eV-=vdgeo.PI;text.Rotation+=vdgeo.FixAngle(vd_eV);if(!vdgeo.AreEqual(vd_fA[Y],1.0,vdgeo.DefaultLinearEquality))text.Height*=Math.abs(vd_fA[Y]);if(text.WidthFactor&& !((vdgeo.AreEqual(vd_fA[Y],1.0,vdgeo.DefaultLinearEquality))&&(vdgeo.AreEqual(vd_fA[X],1.0,vdgeo.DefaultScaleEquality))))text.WidthFactor*=Math.abs(vd_fA[X]/vd_fA[Y]);if(text.AlignmentPoint)text.AlignmentPoint=vdgeo.matrixtransform(mat,text.AlignmentPoint);vd_q.vd_kC(mat,text,vdcanvas);vd_q.vd_fw(mat,text,vdcanvas);};vd_q.vd_QB=function(mat,vd_aU,vdcanvas){var i=0;if(vd_aU.Attributes){for(i=0;i<vd_aU.Attributes.Items.length;i++){var vd_oL=vd_aU.Attributes.Items[i];if(vd_oL.IsConstant)continue;vd_q.vd_hg(mat,vd_oL,vdcanvas);}}if(!vd_aU.ExtrusionVector)vd_aU.ExtrusionVector=[0,0,1];if(!vd_aU.Xscale)vd_aU.Xscale=1.0;if(!vd_aU.Yscale)vd_aU.Yscale=1.0;if(!vd_aU.Zscale)vd_aU.Zscale=1.0;if(!vd_aU.Rotation)vd_aU.Rotation=0.0;if(!vd_aU.RowDist)vd_aU.RowDist=0;if(!vd_aU.ColumnDist)vd_aU.ColumnDist=0;var vd_cN=vdgeo.vd_Ht(mat,vd_aU.InsertionPoint,vd_aU.Rotation,1,1,1,vd_aU.ExtrusionVector);vd_aU.Xscale*=vd_cN.sx;vd_aU.Yscale*=vd_cN.sy;vd_aU.Zscale*=vd_cN.sz;vd_aU.Rotation=vd_cN.zrot;vd_aU.InsertionPoint=[vd_cN.x,vd_cN.y,vd_cN.z];vd_aU.ExtrusionVector=vd_cN.dir;vd_aU.RowDist*=vd_cN.sy;vd_aU.ColumnDist*=vd_cN.sx;vd_q.vd_fw(mat,vd_aU,vdcanvas);};vd_q.vd_Ng=function(mat,vd_wH,vdcanvas){vd_wH.VertexList.Items=vdgeo.vd_fN(mat,vd_wH.VertexList.Items);vd_q.vd_fw(mat,vd_wH,vdcanvas);};vd_q.vd_RR=function(mat,vd_yk,vdcanvas){vd_yk.VertexList.Items=vdgeo.vd_fN(mat,vd_yk.VertexList.Items);vd_q.vd_fw(mat,vd_yk,vdcanvas);};vd_q.vd_OB=function(mat,vd_dS,vdcanvas){vd_dS.InsertionPoint=vdgeo.matrixtransform(mat,vd_dS.InsertionPoint);if(!vd_dS.ExtrusionVector)vd_dS.ExtrusionVector=[0,0,1];vd_dS.ExtrusionVector=vdgeo.vd_id(mat,vd_dS.ExtrusionVector[0],vd_dS.ExtrusionVector[1],vd_dS.ExtrusionVector[2],true);vd_q.vd_fw(mat,vd_dS,vdcanvas);};vd_q.vd_PX=function(mat,vd_dS,vdcanvas){if(vd_dS.ECSMatrix==undefined)vd_dS.ECSMatrix=vdgeo.vd_e();vdgeo.vd_cr(vd_dS.ECSMatrix,mat);vd_q.vd_fw(mat,vd_dS,vdcanvas);};vd_q.vd_RC=function(mat,vd_op,vdcanvas){var temp;var i=0,j=0;for(i=0;i<vd_op.Curves.Items.length;i++){temp=vd_op.Curves.Items[i];for(j=0;j<temp.Items.length;j++)temp.Items[j]=vdgeo.matrixtransform(mat,temp.Items[j]);}for(i=0;i<vd_op.OutLines.Items.length;i++){temp=vd_op.OutLines.Items[i];for(j=0;j<temp.Items.length;j++)temp.Items[j]=vdgeo.matrixtransform(mat,temp.Items[j]);}vd_q.vd_kC(mat,vd_op,vdcanvas);vd_q.vd_fw(mat,vd_op,vdcanvas);};vd_q.vd_Iz=function(mat,entity,vdcanvas){var i=0;for(i=0;i<entity.Explode.Items.length;i++){vd_q.vd_hg(mat,entity.Explode.Items[i],vdcanvas);}vd_q.vd_fw(mat,entity,vdcanvas);};vd_q.vd_qO=function(mat){var vd_fA=vdgeo.vd_ur(mat);if(vdgeo.AreEqual(Math.abs(vd_fA[0]),Math.abs(vd_fA[1]),vdgeo.DefaultVectorEquality))return vd_fA[0];return 1.0;};var vd_Q={};vd_Q.update=function(entity){if(entity.vd_X)entity.vd_X=undefined;};vd_Q.vd_hB=function(entity,vdcanvas){if(!entity)return null;if(entity._t===vdConst.vdLine_code)return vd_Q.vd_JB(entity,vdcanvas);else if(entity._t===vdConst.vdPolyline_code)return vd_Q.vd_Ks(entity,vdcanvas);else if(entity._t===vdConst.vdText_code)return vd_Q.vd_yP(entity,vdcanvas);else if(entity._t===vdConst.vdRect_code)return vd_Q.vd_Da(entity,vdcanvas);else if(entity._t===vdConst.vdImage_code)return vd_Q.vd_Da(entity,vdcanvas);else if(entity._t===vdConst.vdInsert_code)return vd_Q.vd_JR(entity,vdcanvas);else if(entity._t===vdConst.vdAttrib_code)return vd_Q.vd_yP(entity,vdcanvas);else if(entity._t===vdConst.vdAttribDef_code)return vd_Q.vd_yP(entity,vdcanvas);else if(entity._t===vdConst.vdPoint_code)return vd_Q.vd_Kv(entity,vdcanvas);else if(entity._t===vdConst.vdCircle_code)return vd_Q.vd_NQ(entity,vdcanvas);else if(entity._t===vdConst.vdArc_code)return vd_Q.vd_Oa(entity,vdcanvas);else if(entity._t===vdConst.vdEllipse_code)return vd_Q.vd_Ld(entity,vdcanvas);else if(entity._t===vdConst.vdNote_code)return entity.vd_hB();return null;};vd_Q.vd_NQ=function(entity,vdcanvas){if(entity.vd_X===undefined){entity.vd_X=[entity.Center,vdgeo.pointPolar(entity.Center,0,entity.Radius),vdgeo.pointPolar(entity.Center,vdgeo.HALF_PI,entity.Radius),vdgeo.pointPolar(entity.Center,vdgeo.HALF_PI*2,entity.Radius),vdgeo.pointPolar(entity.Center,vdgeo.HALF_PI*3,entity.Radius)];}return entity.vd_X;};vd_Q.vd_Oa=function(entity,vdcanvas){if(entity.vd_X===undefined){entity.vd_X=[entity.Center,vdgeo.pointPolar(entity.Center,entity.StartAngle,entity.Radius),vdgeo.pointPolar(entity.Center,entity.EndAngle,entity.Radius),vdgeo.pointPolar(entity.Center,vdgeo.FixAngle(entity.StartAngle+vdgeo.FixAngle(entity.EndAngle-entity.StartAngle)/2),entity.Radius)];}return entity.vd_X;};vd_Q.vd_Ld=function(entity,vdcanvas){if(entity.vd_X===undefined){entity.vd_X=[entity.Center,vdgeo.pointPolar(entity.Center,entity.MajorAngle,entity.MajorLength),vdgeo.pointPolar(entity.Center,entity.MajorAngle+vdgeo.HALF_PI,entity.MinorLength),vdgeo.pointPolar(entity.Center,entity.MajorAngle+vdgeo.PI,entity.MajorLength),vdgeo.pointPolar(entity.Center,entity.MajorAngle-vdgeo.HALF_PI,entity.MinorLength)];}return entity.vd_X;};vd_Q.vd_JB=function(entity,vdcanvas){if(entity.vd_X===undefined){entity.vd_X=[entity.StartPoint,entity.EndPoint];}return entity.vd_X;};vd_Q.vd_Ks=function(entity,vdcanvas){if(entity.vd_X===undefined){entity.vd_X=[];for(var i=0;i<entity.VertexList.Items.length;i++){entity.vd_X.push(entity.VertexList.Items[i]);}}return entity.vd_X;};vd_Q.vd_yP=function(entity,vdcanvas){if(entity.vd_X===undefined){entity.vd_X=[entity.InsertionPoint];}return entity.vd_X;};vd_Q.vd_Da=function(entity,vdcanvas){if(entity.vd_X===undefined){entity.vd_X=[];entity.vd_X.push(entity.InsertionPoint);var pw=vdgeo.pointPolar(entity.InsertionPoint,entity.Rotation,entity.Width);var pwh=vdgeo.pointPolar(pw,entity.Rotation+vdgeo.HALF_PI,entity.Height);entity.vd_X.push(pwh);}return entity.vd_X;};vd_Q.vd_JR=function(entity,vdcanvas){if(entity.vd_X===undefined){entity.vd_X=[entity.InsertionPoint];if(entity.Attributes&&entity.Attributes.Items){for(var j=0;j<entity.Attributes.Items.length;j++){var vd_iG=entity.Attributes.Items[j];if(!vd_iG||vd_iG.IsConstant==true||vd_iG.IsLockedPosition!==false||(vdcanvas&& !vdcanvas.vd_vO(vd_iG)))continue;entity.vd_X.push(vd_iG.InsertionPoint);}}}return entity.vd_X;};vd_Q.vd_Kv=function(entity,vdcanvas){if(entity.vd_X===undefined){entity.vd_X=[entity.InsertionPoint];}return entity.vd_X;};vd_Q.vd_mD=function(entity,indexes,offset,vdcanvas){var ret=false;if(entity._t===vdConst.vdLine_code)ret=vd_Q.vd_PI(entity,indexes,offset,vdcanvas);else if(entity._t===vdConst.vdPolyline_code)ret=vd_Q.vd_OP(entity,indexes,offset,vdcanvas);else if(entity._t===vdConst.vdText_code)ret=vd_Q.vd_vA(entity,indexes,offset,vdcanvas);else if(entity._t===vdConst.vdRect_code)ret=vd_Q.vd_Fz(entity,indexes,offset,vdcanvas);else if(entity._t===vdConst.vdImage_code)ret=vd_Q.vd_Fz(entity,indexes,offset,vdcanvas);else if(entity._t===vdConst.vdInsert_code)ret=vd_Q.vd_Ox(entity,indexes,offset,vdcanvas);else if(entity._t===vdConst.vdAttrib_code)ret=vd_Q.vd_vA(entity,indexes,offset,vdcanvas);else if(entity._t===vdConst.vdAttribDef_code)ret=vd_Q.vd_vA(entity,indexes,offset,vdcanvas);else if(entity._t===vdConst.vdPoint_code)ret=vd_Q.vd_Qi(entity,indexes,offset,vdcanvas);else if(entity._t===vdConst.vdCircle_code)ret=vd_Q.vd_OJ(entity,indexes,offset,vdcanvas);else if(entity._t===vdConst.vdArc_code)ret=vd_Q.vd_OD(entity,indexes,offset,vdcanvas);else if(entity._t===vdConst.vdEllipse_code)ret=vd_Q.vd_PB(entity,indexes,offset,vdcanvas);else if(entity._t===vdConst.vdNote_code)ret=entity.vd_mD(indexes,offset,vdcanvas);return ret;};vd_Q.vd_pm=function(entity,indexes,offset,vdcanvas){var ret=false;var vd_X=vd_Q.vd_hB(entity,vdcanvas);for(var i=0;i<indexes.length;i++){vd_X[indexes[i]][X]+=offset[X];vd_X[indexes[i]][Y]+=offset[Y];vd_X[indexes[i]][Z]+=offset[Z];ret=true;}if(ret)vdcanvas.UpdateFig(entity);return ret;};vd_Q.vd_PI=function(entity,indexes,offset,vdcanvas){return vd_Q.vd_pm(entity,indexes,offset,vdcanvas);};vd_Q.vd_OP=function(entity,indexes,offset,vdcanvas){return vd_Q.vd_pm(entity,indexes,offset,vdcanvas);};vd_Q.vd_vA=function(entity,indexes,offset,vdcanvas){return vd_Q.vd_pm(entity,indexes,offset,vdcanvas);};vd_Q.vd_Fz=function(entity,indexes,offset,vdcanvas){var ret=false;var vd_X=vd_Q.vd_hB(entity,vdcanvas);for(var i=0;i<indexes.length;i++){if(indexes[i]===0){entity.InsertionPoint[X]+=offset[X];entity.InsertionPoint[Y]+=offset[Y];entity.InsertionPoint[Z]+=offset[Z];ret=true;}else if(indexes[i]===1){var p1=vd_X[1];var p2=[p1[X]+offset[X],p1[Y]+offset[Y],p1[Z]+offset[Z]];var ph=vdgeo.projectionPointOnLine(p2,entity.InsertionPoint,vdgeo.pointPolar(entity.InsertionPoint,entity.Rotation+vdgeo.HALF_PI,1.0));var pw=vdgeo.projectionPointOnLine(p2,entity.InsertionPoint,vdgeo.pointPolar(entity.InsertionPoint,entity.Rotation,1.0));var aw=vdgeo.FixAngle(vdgeo.GetAngle(entity.InsertionPoint,pw)-entity.Rotation);var ah=vdgeo.FixAngle(vdgeo.GetAngle(entity.InsertionPoint,ph)-entity.Rotation);entity.Width=vdgeo.Distance3D(entity.InsertionPoint,pw);if(aw>vdgeo.HALF_PI)entity.Width*= -1.0;entity.Height=vdgeo.Distance3D(entity.InsertionPoint,ph);if(ah>vdgeo.PI)entity.Height*= -1.0;ret=true;}}if(ret)vdcanvas.UpdateFig(entity);return ret;};vd_Q.vd_Ox=function(entity,indexes,offset,vdcanvas){if(indexes.length==1&&indexes[0]===0){var mat=vdgeo.vd_e();vdgeo.vd_x(mat,offset[X],offset[Y],offset[Z]);vd_q.vd_hg(mat,entity,vdcanvas);return true;}else{return vd_Q.vd_pm(entity,indexes,offset,vdcanvas);}};vd_Q.vd_Qi=function(entity,indexes,offset,vdcanvas){return vd_Q.vd_pm(entity,indexes,offset,vdcanvas);};vd_Q.vd_OJ=function(entity,indexes,offset,vdcanvas){var ret=false;var vd_X=vd_Q.vd_hB(entity,vdcanvas);for(var i=0;i<indexes.length;i++){if(indexes[i]===0){entity.Center[X]+=offset[X];entity.Center[Y]+=offset[Y];entity.Center[Z]+=offset[Z];}else{vd_X[indexes[i]][X]+=offset[X];vd_X[indexes[i]][Y]+=offset[Y];vd_X[indexes[i]][Z]+=offset[Z];entity.Radius=vdgeo.Distance3D(vd_X[indexes[i]],entity.Center);}ret=true;}if(ret)vdcanvas.UpdateFig(entity);return ret;};vd_Q.vd_PB=function(entity,indexes,offset,vdcanvas){var ret=false;var vd_X=vd_Q.vd_hB(entity,vdcanvas);for(var i=0;i<indexes.length;i++){if(indexes[i]===0){entity.Center[X]+=offset[X];entity.Center[Y]+=offset[Y];entity.Center[Z]+=offset[Z];}else if(indexes[i]===1||indexes[i]===3){vd_X[indexes[i]][X]+=offset[X];vd_X[indexes[i]][Y]+=offset[Y];vd_X[indexes[i]][Z]+=offset[Z];entity.MajorLength=vdgeo.Distance3D(vd_X[indexes[i]],entity.Center);}else if(indexes[i]===2||indexes[i]===4){vd_X[indexes[i]][X]+=offset[X];vd_X[indexes[i]][Y]+=offset[Y];vd_X[indexes[i]][Z]+=offset[Z];entity.MinorLength=vdgeo.Distance3D(vd_X[indexes[i]],entity.Center);}ret=true;}if(ret)vdcanvas.UpdateFig(entity);return ret;};vd_Q.vd_OD=function(entity,indexes,offset,vdcanvas){var ret=false;var vd_X=vd_Q.vd_hB(entity,vdcanvas);for(var i=0;i<indexes.length;i++){if(indexes[i]===0){entity.Center[X]+=offset[X];entity.Center[Y]+=offset[Y];entity.Center[Z]+=offset[Z];ret=true;}else{vd_X[indexes[i]][X]+=offset[X];vd_X[indexes[i]][Y]+=offset[Y];vd_X[indexes[i]][Z]+=offset[Z];var arc=vdgeo.vd_KX(vd_X[1],vd_X[2],vd_X[3]);if(arc!=null){ret=true;entity.Center=arc[0];entity.Radius=arc[1];entity.StartAngle=arc[2];entity.EndAngle=arc[3];}}}if(ret)vdcanvas.UpdateFig(entity);return ret;};vd_Q.GetEntityItem=function(vdcanvas,hid){if(hid.substr(0,2)=='n_'){if(vdcanvas.Notes)return vdcanvas.Notes[hid];else return null;}else return vdcanvas.GetEntityItem(hid);};vd_Q.vd_Mp=function(selection,vd_oj,vd_jE,render,vdcanvas){if(!selection)return;var vd_t=vdcanvas.GetDocument();if(!vd_t)return;vd_di=render.vd_ao(vd_oj);var vd_rh=0;for(var i=0;i<selection.length;i++){if(vd_rh>=vdcanvas.GripManager.MaxGrips){selection.length=i;break;}var fig=vd_Q.GetEntityItem(vdcanvas,selection[i]);vd_rh=vd_Q.draw(fig,vd_oj,vd_jE,render,vd_t,vdcanvas,vd_rh);}render.vd_ao(vd_di);};vd_Q.draw=function(entity,vd_oj,vd_jE,render,vd_t,vdcanvas,vd_rh){if(!entity)return 0;if(entity.Deleted===true)return 0;if(entity.visibility===1)return 0;if(entity.LayerRef&&vdcanvas.vd_Eq(entity.LayerRef,null,vd_t))return 0;var vd_X=vd_Q.vd_hB(entity,vdcanvas);if(!vd_X||vd_X.length===0)return 0;var ret=vd_rh;for(var i=0;i<vd_X.length;i++){if(ret>=vdcanvas.GripManager.MaxGrips)break;vd_Q.vd_LW(vd_X[i],vd_oj,vd_jE,render,vd_t,vdcanvas);ret++;}return ret;};vd_Q.vd_LW=function(pt,vd_oj,vd_jE,render,vd_t,vdcanvas){var p=vdgeo.vd_do(pt,render.vd_dZ());render.vd_H.vd_Or(p[X]-vd_jE*0.5,p[Y]-vd_jE*0.5,vd_jE,vd_jE);};vd_Q.vd_NY=function(box,vd_zt,vdcanvas){var ret=[];var items=0;var left=box[0];var right=box[0]+box[2];var top=box[1];var bottom=box[1]+box[3];if(!vd_zt)return ret;for(var i=0;i<vd_zt.length;i++){if(items>=vdcanvas.GripManager.MaxGrips)break;var fig=vd_Q.GetEntityItem(vdcanvas,vd_zt[i]);var indexes=[];var vd_X=vd_Q.vd_hB(fig,vdcanvas);if(vd_X){for(var k=0;k<vd_X.length;k++){if(items>=vdcanvas.GripManager.MaxGrips)break;items++;var p=vdcanvas.WorldToPixel(vd_X[k]);if(p[X]>=left&&p[X]<=right&&p[Y]>=top&&p[Y]<=bottom){indexes.push(k);}}}if(indexes.length>0)ret.push([fig,indexes]);}return ret;};function vd_PJ(vd_n){var vd_U=this;var vd_Ax=[0,0,255,255];var vd_kl=15;var vd_zO=100;var vd_sN=true;var vd_qE=0;this.filtergripentity=null;this.gripselectionchanged=null;this.beforemovegrip=null;this.aftermovegrip=null;this.vd_QE=function(entity){var ret=true;if(vd_U.filtergripentity){var e={sender:vd_n,entity:entity,cancel:false};vd_U.filtergripentity(e);ret= !e.cancel;}return ret;};this.vd_tn=function(){if(vd_U.gripselectionchanged)vd_U.gripselectionchanged({sender:vd_n});};this.vd_Qt=function(entity,indexes,offset){var ret=true;if(vd_U.beforemovegrip){var e={sender:vd_n,entity:entity,indexes:indexes,offset:offset,cancel:false};vd_U.beforemovegrip(e);ret= !e.cancel;}return ret;};this.vd_QU=function(entity,indexes,offset){if(vd_U.aftermovegrip)vd_U.aftermovegrip({sender:vd_n,entity:entity,indexes:indexes,offset:offset});};Object.defineProperty(vd_U,'MaxGrips',{get:function(){return vd_zO;},set:function(newValue){vd_zO=newValue;}});Object.defineProperty(vd_U,'GripColor',{get:function(){return vd_Ax;},set:function(newValue){vd_Ax=newValue;}});Object.defineProperty(vd_U,'GripSize',{get:function(){return vd_kl;},set:function(newValue){vd_kl=Math.max(newValue,0);}});Object.defineProperty(vd_U,'Enable',{get:function(){return vd_sN;},set:function(newValue){vd_sN=newValue;}});Object.defineProperty(vd_U,'SelectMode',{get:function(){return vd_qE;},set:function(newValue){vd_qE=newValue;}});this.count=function(){var vd_t=vd_n.GetDocument();if(!vd_t)return 0;if(!vd_t.vd_ad)return 0;return vd_t.vd_ad.length;};this.GetItem=function(index){var vd_t=vd_n.GetDocument();if(!vd_t)return null;if(!vd_t.vd_ad)return null;if(index<0||index>=vd_t.vd_ad.length)return null;return vd_Q.GetEntityItem(vd_n,vd_t.vd_ad[index]);};this.GetEntityGrips=function(entity){return vd_Q.vd_hB(entity,vd_n);};function vd_uD(fig){if(fig._t===vdConst.vdNote_code)return 'n_'+fig.HandleId.toString();else return 'h_'+fig.HandleId.toString();};this.AddItem=function(fig){if(!vd_sN)return;var vd_t=vd_n.GetDocument();if(!vd_t)return;var vd_cV=vd_uD(fig);if(!vd_t.vd_ad)vd_t.vd_ad=[];var index=vd_t.vd_ad.indexOf(vd_cV);if(index== -1)vd_Bu(vd_t,fig,vd_cV);};this.RemoveItem=function(fig){var vd_t=vd_n.GetDocument();if(!vd_t)return;var vd_cV=vd_uD(fig);if(!vd_t.vd_ad)return;var index=vd_t.vd_ad.indexOf(vd_cV);if(index>=0){vd_t.vd_ad.splice(index,1);vd_U.vd_tn();}};this.ContainsItem=function(fig){var vd_t=vd_n.GetDocument();if(!vd_t)return false;var vd_cV=vd_uD(fig);if(!vd_t.vd_ad)return false;var index=vd_t.vd_ad.indexOf(vd_cV);return index>=0;};this.clear=function(){var vd_t=vd_n.GetDocument();if(!vd_t)return false;var vd_qT=vd_t.vd_ad&&vd_t.vd_ad.length>0;vd_t.vd_ad=null;vd_t.vd_hi=null;if(vd_qT)vd_U.vd_tn();return vd_qT;};function vd_Bu(vd_t,fig,handle){if(!vd_U.vd_QE(fig))return false;if(vd_qE&vdConst.GRIPMODE_SINGLE)vd_t.vd_ad=[];vd_t.vd_ad.push(handle);vd_U.vd_tn();return true;};function vd_DM(fig,vd_t){var vd_cV=vd_uD(fig);if(!vd_t.vd_ad)vd_t.vd_ad=[];var index=vd_t.vd_ad.indexOf(vd_cV);if(index== -1){vd_Bu(vd_t,fig,vd_cV);}else{vd_t.vd_ad.splice(index,1);vd_U.vd_tn();}};this.vd_Es=function(vd_ip){var vd_t=vd_n.GetDocument();if(!vd_t)return false;if(!vd_ip){var vd_qT=vd_U.clear();if(vd_qT)vd_n.Refresh();return vd_qT;}if(!(vd_qE&vdConst.GRIPMODE_AUTO))return false;if(!vd_sN)return false;if(vd_zO<=0)return false;if(!vd_n.GetEnableSelection())return false;if(vd_kl==0)return false;var action=vd_n.ActiveAction();if(action.IsStarted())return false;if(vd_ip.mousebutton!=1&&vd_ip.mousebutton!=3)return false;var vd_yI=[vd_ip.x,vd_ip.y,vd_ip.z];var vd_cG=[vd_ip.xPix,vd_ip.yPix];var box=[vd_cG[X]-vd_kl/2.0,vd_cG[Y]-vd_kl/2.0,vd_kl,vd_kl];vd_t.vd_hi=vd_Q.vd_NY(box,vd_t.vd_ad,vd_n);if(vd_t.vd_hi.length>0){var vd_X=vd_Q.vd_hB(vd_t.vd_hi[0][0],vd_n);var index=vd_t.vd_hi[0][1][0];vd_yI=vd_X[index];vd_n.GetUserLine(vd_MK,vd_yI);return true;}else{var fig=vd_n.GetEntityFromPoint(vd_cG[X],vd_cG[Y]);if(fig){var ents=[];fig.vd_nV=undefined;vd_n.GroupsManager.vd_up(fig,ents);for(var i=0;i<ents.length;i++){fig=ents[i];fig.vd_nV=undefined;vd_DM(fig,vd_t);}vd_n.Refresh();return true;}else if((vd_qE&vdConst.vd_Dz)&&vd_ip.mousebutton==3){vd_n.GetUserRect(vd_Oh,vd_yI);return true;}}return false;};function vd_Oh(action,status,evt){if(status=='mouseup'){action.end();return true;}else if(status=='mousetimeout'){return true;}else if(status=='end'&& !action.IsCanceled()){var vd_t=vd_n.GetDocument();var p1=vd_n.ViewToPixel(action.ResValue[0]);var p2=vd_n.ViewToPixel(action.ResValue[1]);var ents=vd_n.GetEntitiesFromBox(Math.min(p1[X],p2[X]),Math.min(p1[Y],p2[Y]),Math.max(p1[X],p2[X]),Math.max(p1[Y],p2[Y]));if(ents){var vd_jb=[];for(var i=0;i<ents.length;i++){fig=ents[i];fig.vd_nV=undefined;vd_n.GroupsManager.vd_up(fig,vd_jb);}for(var i=0;i<vd_jb.length;i++){fig=vd_jb[i];fig.vd_nV=undefined;vd_DM(fig,vd_t);}vd_n.Refresh();}}};function vd_MK(action,status){var vd_t=vd_n.GetDocument();if(!vd_t)return;if(status=='end'){if(!action.IsCanceled()){var offset=[action.ResValue[1][X]-action.ResValue[0][X],action.ResValue[1][Y]-action.ResValue[0][Y],action.ResValue[1][Z]-action.ResValue[0][Z]];vd_n.UndoHistory().group_start();for(var i=0;i<vd_t.vd_hi.length;i++){var indexes=vd_t.vd_hi[i][1];var fig=vd_t.vd_hi[i][0];if(indexes.length===0)continue;vd_n.UndoHistory().store(fig,'special_movegrips',[indexes.concat([]),offset.concat([])]);if(vd_U.vd_Qt(fig,indexes,offset)){if(vd_Q.vd_mD(fig,indexes,offset,vd_n))vd_U.vd_QU(fig,indexes,offset);}}vd_n.UndoHistory().group_end();vd_n.UpdateLayout();vd_n.redraw();}else{vd_n.Refresh();}}else if(status=='draw'){var render=action.render;var offset=[action.DrawPoint()[X]-action.ReferencePoint[X],action.DrawPoint()[Y]-action.ReferencePoint[Y],action.DrawPoint()[Z]-action.ReferencePoint[Z]];for(var i=0;i<vd_t.vd_hi.length;i++){var indexes=vd_t.vd_hi[i][1];var vd_LD=vd_t.vd_hi[i][0];if(indexes.length===0)continue;var fig=vdConst.cloneEntity(vd_LD);vd_Q.vd_mD(fig,indexes,offset,vd_n);render.vd_rg(vdConst.ActionHighLightColor);vd_n.DrawEntity(fig,render);render.vd_pP();}}};this.vd_zc=function(){var vd_t=vd_n.GetDocument();if(!vd_t)return false;return(vd_t.vd_ad&&vd_t.vd_ad.length>0);};this.vd_pJ=function(render){var vd_t=vd_n.GetDocument();if(!vd_t)return;try{vd_Q.vd_Mp(vd_t.vd_ad,vd_Ax,vd_kl,render,vd_n);}catch(ex){}};return this;};function vd_LM(vd_t,vd_n){var arr=[];var vd_U=Object.create(arr);var vd_pK=0;var vd_jL=false;function vd_CN(vd_aC,onfinish,vd_mS){var vd_gv=document.getElementsByTagName('head')[0];var js1=document.createElement('script');js1.setAttribute('type','text/javascript');js1.setAttribute('src',vd_aC);vd_gv.appendChild(js1);try{js1.onerror=function(e){vd_gv.removeChild(js1);if(onfinish)onfinish(vd_n,1,vd_aC);};js1.onreadystatechange=function(e){if(e.readyState=="loaded"||e.readyState=='complete'||e.target.readyState=="loaded"||e.target.readyState=='complete'){e.readyState="complete";vd_gv.removeChild(js1);if(tmpnotes){vd_U.FromStreamData(tmpnotes,vd_mS);if(onfinish)onfinish(vd_n,0,vd_aC);}else{if(onfinish)onfinish(vd_n,2,vd_aC);}}};js1.onload=function(e){e.readyState='complete';e.target.onreadystatechange(e);}}catch(ex){vd_gv.removeChild(js1);if(onfinish)onfinish(vd_n,3,vd_aC);}};vd_U.LoadFromFile=function(vd_aC,onfinish,vd_mS,async,vd_kZ){tmpnotes=null;var _url=vd_aC;if(vd_kZ)_url+="?timestamp="+new Date().getTime();var vd_dj;if(window.XMLHttpRequest){vd_dj=new XMLHttpRequest();}else{vd_dj=new ActiveXObject("Microsoft.XMLHTTP");}if(!vd_dj){if(onfinish)onfinish(vd_n,4,vd_aC);return;}try{vd_dj.onreadystatechange=function(){if(vd_dj.readyState==4){if(vd_dj.status===200||vd_dj.status==0){var vd_hO=vd_dj.responseText;if(vd_hO){try{eval(vd_hO);if(tmpnotes){vd_U.FromStreamData(tmpnotes,vd_mS);if(onfinish)onfinish(vd_n,0,vd_aC);}else{if(onfinish)onfinish(vd_n,5,vd_aC);}}catch(ex){if(onfinish)onfinish(vd_n,6,vd_aC);}}else{vd_CN(vd_aC,onfinish,vd_mS);}}else{if(onfinish)onfinish(vd_n,7,vd_aC);}}};vd_dj.open("GET",_url,async?true:false);vd_dj.send();}catch(ex){vd_CN(vd_aC,onfinish,vd_mS);}};vd_U.FromStreamData=function(vd_hO,vd_mS){var items=vd_hO.split("'");if(items&&items.length>1){vd_hO=items[1];}vd_hO=base64.vd_yy(vd_hO);if(!vd_mS){vd_U.clear();}items=vd_hO.split('##');for(var i=0;i<items.length;i++){var note=new vd_vv();var vd_QG=note.vd_Nn(items[i]);if(vd_QG>0){vd_U.push(note);vd_Ga(note);}}tmpnotes=null;vd_jL=false;};vd_U.ToStreamData=function(){var ret="";for(var i=0;i<vd_U.length;i++){var note=vd_U[i];if(note.Deleted)continue;ret+=note.toString(8)+'##';}var str=base64.vd_Op(ret);return "tmpnotes ='"+str+"';";};Object.defineProperty(vd_U,'IsModified',{get:function(){return vd_jL;}});vd_U.clear=function(){for(var i=0;i<vd_U.length;i++){var note=vd_U[i];vd_U[('n_'+note.HandleId.toString())]=undefined;}vd_pK=0;vd_U.length=0;};vd_U.AddNote=function(title,description,viewtype,origin){var note=new vd_vv();if(title!==undefined)note.title=title.substr(0,vdConst.NOTE_LIMIT_TITLE);if(description!==undefined)note.description=description.substr(0,vdConst.NOTE_LIMIT_DESC);if(viewtype!==undefined)note.viewtype=viewtype;note.layout=vd_t.ActiveLayOut;var render=vd_n.ActiveRender();var vd_jV=origin;if(origin===undefined){origin=[render.vd_cc+render.width/2.0,render.vd_cc+render.height/2.0,1.0];origin[Z]=render.vd_H.vd_ko(origin[X],origin[Y]);vd_jV=render.vd_sK(origin[X],origin[Y],origin[Z]);}note.vd_wa(vd_jV);vd_U.push(note);vd_Ga(note);vd_jL=true;return vd_U.length-1;};function vd_Ga(note){if(!vd_pK)vd_pK=0;vd_pK++;note.HandleId=vd_pK;vd_U[('n_'+note.HandleId.toString())]=note;};vd_U.vd_pJ=function(render){if(vd_U.length==0)return;var vd_oD=render.vdraw.vd_fO;render.vdraw.vd_fO=false;var vd_fg=render.vd_fx;render.vd_fx=false;var vd_QQ=render.vdraw.GetImageInterpolationMode();render.vdraw.SetImageInterpolationMode(vdConst.InterpolationMode_Nearest);render.vd_H.vd_eo=true;var vd_wO=render.vd_bH;render.vd_bH=true;var vd_IL=render.vdraw.IgnoreLockLayers;render.vdraw.IgnoreLockLayers=true;render.vd_eT();var vd_fn=vdgeo.vd_aR(render.vd_bE());var vd_bD=vdgeo.vd_dD(render.vd_bE());var vd_di=render.vd_ao([255,255,255,vdConst.NOTE_TRANSPARENT]);render.vd_bh(vd_fn);try{for(var i=0;i<vd_U.length;i++){vd_U[i].draw(render,vd_bD);}}catch(ex){}render.vd_bC();render.vd_ao(vd_di);render.vdraw.SetImageInterpolationMode(vd_QQ);render.vdraw.IgnoreLockLayers=vd_IL;render.vd_bH=vd_wO;render.vd_fx=vd_fg;render.vdraw.vd_fO=vd_oD;render.vd_eT();};function vd_vv(){var vd_Mm=new vdConst.vd_Io();var vd_U=Object.create(vd_Mm);vd_U.clone=function(){var ret=new vd_vv();ret.HandleId=vd_U.HandleId;ret.layout=vd_U.layout;ret.vd_ja=vd_U.vd_ja;ret.vd_gK=vd_U.vd_gK;ret.vd_Z=vd_U.vd_Z;ret.viewtype=vd_jN;ret.title=vd_mH;ret.vd_mN=vd_mN;ret.position=vd_hF;ret.Deleted=vd_sp;return ret;};vd_U.HandleId=0;vd_U.layout='h_0';vd_U.vd_ja=[0,0,1];vd_U.vd_gK=0.0;vd_U.vd_Z=0.0;var vd_jN=1;var vd_mH='No title';var vd_mN='No description';var vd_hF=[0,0,0];var vd_sp=false;Object.defineProperty(vd_U,'ToolTip',{get:function(){return vd_mH;},vd_pk:true});Object.defineProperty(vd_U,'_t',{get:function(){return vdConst.vdNote_code;},vd_pk:true});Object.defineProperty(vd_U,'Deleted',{get:function(){return vd_sp;},set:function(vd_bl){vd_jL=true;vd_sp=vd_bl;},vd_pk:true,vd_sD:true});Object.defineProperty(vd_U,'viewtype',{get:function(){return vd_jN;},set:function(vd_bl){vd_jL=true;vd_jN=vd_bl;},vd_pk:true,vd_sD:true});Object.defineProperty(vd_U,'title',{get:function(){return vd_mH;},set:function(vd_bl){vd_jL=true;vd_mH=vd_bl;},vd_pk:true,vd_sD:true});Object.defineProperty(vd_U,'description',{get:function(){return vd_mN;},set:function(vd_bl){vd_jL=true;vd_mN=vd_bl;},vd_pk:true,vd_sD:true});Object.defineProperty(vd_U,'position',{get:function(){return vd_hF;},set:function(vd_bl){vd_jL=true;vd_U.vd_wa(vd_bl,true);vd_hF=vd_bl;},vd_pk:true,vd_sD:true});vd_U.vd_wa=function(vd_jV,vd_Nj){if(vd_n){var render=vd_n.ActiveRender();var vd_DR=render.vd_bE();var vd_EE=vdgeo.vd_aR(vd_DR);var vd_lF=render.vd_gT;var vd_kV=vdgeo.vd_aR(vd_lF);var vd_ja=vdgeo.vd_ha(vd_EE);var vd_gK=vdgeo.vd_ok(vd_EE);var vd_Kb=vdgeo.matrixtransform(vd_DR,vd_jV);var vd_CM=vdgeo.vd_do(vd_Kb,vd_lF);var z=1;z=vd_CM[Z];if(vd_Nj||z==1.0||vd_jV[Z]==0.0){var vd_cG=vdgeo.matrixtransform(render.vd_ml,vd_CM);z=render.vd_H.vd_ko(vd_cG[X],vd_cG[Y]);vd_jV=render.vd_sK(vd_cG[X],vd_cG[Y],z);}var p1=vdgeo.vd_bL(0,1,z,vd_kV);var p2=vdgeo.vd_bL(0,-1,z,vd_kV);var vd_Z=vdgeo.Distance2D(p1,p2);vd_U.vd_ja=vd_ja;vd_U.vd_gK=vd_gK;vd_U.vd_Z=vd_Z;}vd_hF=vd_jV;};vd_U.toString=function(precision){var ret='';ret+=vdConst.vd_BE(vd_mH)+'^';ret+=vdConst.vd_BE(vd_mN)+'^';ret+=vdgeo.vd_yp(vd_hF,precision)+'^';ret+=vdgeo.vd_yp(vd_U.vd_ja,precision)+'^';ret+=vdgeo.vd_yr(vd_U.vd_gK,precision)+'^';ret+=vdgeo.vd_yr(vd_U.vd_Z,precision)+'^';ret+=vd_jN.toString()+'^';ret+=vd_U.layout+'^';return ret;};vd_U.vd_Nn=function(str){str=str.trim();if(str.length==0)return 0;var items=str.split('^');var i=0;if(items.length>i){vd_mH=vdConst.vd_Cu(items[i]);i++;}else return i;if(items.length>i){vd_mN=vdConst.vd_Cu(items[i]);i++;}else return i;if(items.length>i){vd_hF=vdgeo.vd_xv(items[i]);i++;}else return i;if(items.length>i){vd_U.vd_ja=vdgeo.vd_xv(items[i]);i++;}else return i;if(items.length>i){vd_U.vd_gK=Number(items[i]);i++;}else return i;if(items.length>i){vd_U.vd_Z=Number(items[i]);i++;}else return i;if(items.length>i){vd_jN=Number(items[i]);i++;}else return i;if(items.length>i){vd_U.layout=items[i];i++;}else return i;return i;};vd_U.setview=function(){var vd_bD=vdgeo.vd_e();vdgeo.vd_gB(vd_bD,vd_U.vd_ja);vdgeo.vd_bw(vd_bD,vdgeo.VD_TWOPI-vd_U.vd_gK);var vd_ca=vdgeo.matrixtransform(vd_bD,vd_hF);vd_t.ActiveLayOut=vd_U.layout;var vd_ms=vd_n.GetActiveLayout();var offset=(vd_U.vd_Z*0.5)/Math.tan(vdgeo.DegreesToRadians(vd_ms.LensAngle/2.0));vd_ca[Z]+=offset;vd_ms.World2ViewMatrix=vd_bD;vd_ms.ViewCenter=vd_ca;vd_ms.ViewSize=vd_U.vd_Z;setTimeout(vd_n.redraw);};vd_U.vd_hB=function(){return[vd_hF];};vd_U.vd_mD=function(indexes,offset){for(var i=0;i<indexes.length;i++){if(indexes[i]===0){var pt=[0,0,0];vdgeo.vd_bn(pt,vd_hF);pt[X]+=offset[X];pt[Y]+=offset[Y];pt[Z]+=offset[Z];vd_U.vd_wa(pt,true);return true;}}return false;};vd_U.vd_MR=function(render){var vd_fn=vdgeo.vd_aR(render.vd_bE());var vd_bD=vdgeo.vd_dD(render.vd_bE());var vd_di=render.vd_ao([255,255,255,vdConst.NOTE_TRANSPARENT]);render.vd_bh(vd_fn);vd_U.draw(render,vd_bD);render.vd_bC();render.vd_ao(vd_di);};vd_U.draw=function(render,vd_bD){if(!render.vdraw||vd_jN<=0||vd_sp)return;if(!vd_U.layout||vd_U.layout=='h_0')vd_U.layout='h_'+vd_t.Model.HandleId.toString();var vd_El='h_0';var vd_ms=render.vdraw.GetActiveLayout();if(vd_ms)vd_El='h_'+vd_ms.HandleId.toString();if(vd_El!==vd_U.layout)return;var vd_dd=vd_hF;var vd_ca=vdgeo.matrixtransform(vd_bD,vd_dd);var vd_qj=vdgeo.vd_do(vd_ca,render.vd_dm);var vd_tq=vdConst.vd_zj.vd_Qf((vd_jN-1)%4,render.vdraw.Refresh);if(vd_tq!=null&&vd_tq.bytes&&render.vd_H.vd_Mb(vd_qj[X],vd_qj[Y],vd_qj[Z],false,0.001)){vd_tq.isNoteIcon=true;var vd_wO=render.vd_bH;render.vd_bH=false;render.vd_qY(vd_U);var size=render.pixelsize*vdConst.NOTE_SIZE/2.0;var z=vd_ca[Z];if(render.vd_ak){var vd_lF=render.vd_gT;var vd_kV=vdgeo.vd_aR(vd_lF);var p1=vdgeo.vd_bL(0,1,vd_qj[Z],vd_kV);var p2=vdgeo.vd_bL(0,-1,vd_qj[Z],vd_kV);var vd_Z=vdgeo.Distance2D(p1,p2);size=(vd_Z/render.height)*vdConst.NOTE_SIZE/2.0;}var pts=[[vd_ca[X]-size,vd_ca[Y]-size,z],[vd_ca[X]+size,vd_ca[Y]-size,z],[vd_ca[X]+size,vd_ca[Y]+size,z],[vd_ca[X]-size,vd_ca[Y]+size,z]];var vd_aV=[0,0,1];var uvs=[[0,0,0],[1,0,0],[1,1,0],[0,1,0]];render.vd_et(pts,vd_aV,uvs,vd_tq,true);render.vd_qY(null);render.vd_bH=vd_wO;}};return vd_U;};return vd_U;};function vd_lT(vd_pH){return vd_pH!==undefined&&vd_pH!==null;};function vd_lf(vdcanvas,vd_Nl,vd_ce){vdcanvas.ActiveAction().cancel();vd_rO=vd_ce;vdcanvas.ActiveAction().vd_bO=vd_Nl;vdcanvas.ActiveAction().customData=null;vdcanvas.GetUserPoint(vd_oB);};var vd_rO;function vd_rU(action){var vdcanvas=action.vdrawOwner();var customData=action.customData;if(!action.IsStarted()){action.vd_PV();if(action.vd_v==='select'&&action.IsCanceled())vd_rO=null;action.vd_v=null;}if(customData){for(var k=0;k<customData.length;k++){var fig=customData[k];fig.selected=false;}vdcanvas.redraw();if(vd_rO)vd_rO(action);}};function vd_Ee(mat,vd_cE,action,vd_bV,vd_ax,vdcanvas){var ret=vdgeo.vd_dD(mat);if(vd_cE==1||vd_cE==4)vdgeo.vd_x(ret,vd_ax[X]-vd_bV[X],vd_ax[Y]-vd_bV[Y],vd_ax[Z]-vd_bV[Z]);else if(vd_cE==2){var scale=[1,1,1];if(Array.isArray(vd_ax)){if(vd_ax.length==3){var vd_nm=vdgeo.Distance2D(vd_bV,vd_ax);scale=[vd_nm,vd_nm,vd_nm];}else if(vd_ax.length==4){scale=[vd_ax[0],vd_ax[1],vd_ax[2]];}if(vdcanvas.ActionScaleMode==1&&vd_ax.length==3){if(action.vd_bO&&action.vd_bO.entities){if(!action.vd_bO.vd_fG){var vd_oW=new vd_hx();for(var i=0;i<action.vd_bO.entities.length;i++){vd_oW.vd_hc(action.vd_bO.entities[i].BoundingBox);}if(vd_oW.vd_bt)action.vd_bO.vd_fG=1.0;else{action.vd_bO.vd_fG=1.0/Math.max(vd_oW.vd_as[0]-vd_oW.vd_aD[0],vd_oW.vd_as[1]-vd_oW.vd_aD[1]);}}scale[0]*=action.vd_bO.vd_fG;scale[1]*=action.vd_bO.vd_fG;scale[2]*=action.vd_bO.vd_fG;}}}else{scale=[vd_ax,vd_ax,vd_ax];}if(vdgeo.AreEqual(scale[0],0.0,vdgeo.DefaultLinearEquality))scale[0]=1.0;if(vdgeo.AreEqual(scale[1],0.0,vdgeo.DefaultLinearEquality))scale[1]=1.0;if(vdgeo.AreEqual(scale[2],0.0,vdgeo.DefaultLinearEquality))scale[2]=1.0;vdgeo.vd_x(ret,-vd_bV[X],-vd_bV[Y],-vd_bV[Z]);vdgeo.vd_aj(ret,scale[0],scale[1],scale[2]);vdgeo.vd_x(ret,vd_bV[X],vd_bV[Y],vd_bV[Z]);}else if(vd_cE==3){var angle;if(Array.isArray(vd_ax)){angle=vdgeo.GetAngle(vd_bV,vd_ax);vd_ax=angle;}else{angle=vd_ax;}if(action.vd_bO.axis){vdgeo.vd_x(ret,-vd_bV[X],-vd_bV[Y],-vd_bV[Z]);vdgeo.vd_gB(ret,action.vd_bO.axis);vdgeo.vd_bw(ret,angle);vdgeo.vd_dl(ret,action.vd_bO.axis);vdgeo.vd_x(ret,vd_bV[X],vd_bV[Y],vd_bV[Z]);}else{vdgeo.vd_x(ret,-vd_bV[X],-vd_bV[Y],-vd_bV[Z]);vdgeo.vd_bw(ret,angle);vdgeo.vd_x(ret,vd_bV[X],vd_bV[Y],vd_bV[Z]);}}else if(vd_cE==5){var angle;if(Array.isArray(vd_ax)){angle=vdgeo.GetAngle(vd_bV,vd_ax);vd_ax=angle;}else{angle=vd_ax;}vdgeo.vd_x(ret,-vd_bV[X],-vd_bV[Y],-vd_bV[Z]);vdgeo.vd_bw(ret,-angle);vdgeo.vd_aj(ret,1.0,-1.0,1.0);vdgeo.vd_bw(ret,vd_ax);vdgeo.vd_x(ret,vd_bV[X],vd_bV[Y],vd_bV[Z]);}return ret;};function vd_QM(){this.userselectedCount=0;this.ItemIndex= -1;this.selectedItem=null;this.cancel=false;this.finish=false;this.action=null;};function vd_oB(action,status){if(!action.vd_v)action.vd_v='select';var vdcanvas=action.vdrawOwner();var render=action.render;var vd_eh,from,to,vd_wd,fig,p1;var k,i;if(action.vd_v=='select'){if(status=='start'){if(!action.customData)action.customData=[];if(action.vd_bO&&action.vd_bO.entities){action.customData=action.vd_bO.entities;for(i=0;i<action.customData.length;i++){action.customData[i].selected=true;}if(!action.vd_bO.vd_bV|| !vd_lT(action.vd_bO.vd_ax)){render.vd_rg(vdConst.ActionHighLightColor);vdcanvas.ActionDrawEntities(action.customData,true);render.vd_pP();}action.cancel(1);}else vdcanvas.Prompt(vdcanvas.MessagesDictionary.SELECT_ENTITIES);}else if(status=='end'){vdcanvas.Prompt('');if(!action.IsCanceled()){var ret=null;if(action.actionType==vdConst.ACTION_POINT_WORLD){p1=vdcanvas.WorldToPixel(action.ResValue);fig=vdcanvas.GetEntityFromPoint(p1[X],p1[Y]);if(!fig){vdcanvas.GetUserRect(vd_oB,action.ResValue);}else{ret=[fig];}}else{p1=vdcanvas.ViewToPixel(action.ResValue[0]);var p2=vdcanvas.ViewToPixel(action.ResValue[1]);var vd_yt=(p1[X]>p2[X]);if(vd_yt)ret=vdcanvas.GetEntitiesFromBox(p1[X],p1[Y],p2[X],p2[Y]);else ret=vdcanvas.GetEntitiesInWindowBox(p1[X],p1[Y],p2[X],p2[Y]);}var vd_hU=new vd_QM();if(ret&&ret.length>0){var vd_jb=[];for(i=0;i<ret.length;i++){vdcanvas.GroupsManager.vd_up(ret[i],vd_jb);}if(!action.customData)action.customData=[];for(i=0;i<vd_jb.length;i++){var fig=vd_jb[i];fig.vd_nV=undefined;if(fig.selected)continue;if(vdcanvas.vdSelectionModified){vd_hU.userselectedCount=vd_jb.length;vd_hU.ItemIndex=i;vd_hU.action=action;vd_hU.selectedItem=fig;vd_hU.cancel=false;vdcanvas.vdSelectionModified(vd_hU);if(vd_hU.cancel)continue;}fig.selected=true;action.customData.push(fig);if(vd_hU.finish)break;}render.vd_rg(vdConst.ActionHighLightColor);vdcanvas.ActionDrawEntities(action.customData,true);render.vd_pP();}if(vd_hU.finish){if(!action.customData||action.vd_bO.vd_cE==0){vd_rU(action);return;}action.vd_v='PickReference';}if(!action.IsStarted())vdcanvas.GetUserPoint(vd_oB);}else{if(!action.customData||action.vd_bO.vd_cE==0){vd_rU(action);return;}action.vd_v='PickReference';vdcanvas.GetUserPoint(vd_oB);}}}else if(action.vd_v=='PickReference'){if(status=='start'){if(action.vd_bO.vd_bV){action.cancel();}else vdcanvas.Prompt(vdcanvas.MessagesDictionary.SPECIFY_REFERENCE_POINT);}else if(status=='end'){vdcanvas.Prompt('');if(action.vd_bO.vd_bV){action.vd_v='PickPoint2';vdcanvas.GetUserLine(vd_oB,action.vd_bO.vd_bV);}else if(!action.IsCanceled()){action.vd_v='PickPoint2';vdcanvas.GetUserLine(vd_oB,action.ResValue);}else{vd_rU(action);}}}else if(action.vd_v=='PickPoint2'){if(status=='start'){if(vd_lT(action.vd_bO.vd_ax))action.cancel();else vdcanvas.Prompt(vdcanvas.MessagesDictionary.SPECIFY_SECOND_POINT);}else if(status=='draw'){to=action.DrawPoint();from=action.ReferencePoint;vd_eh=vdgeo.vd_e();vd_eh=vd_Ee(vd_eh,action.vd_bO.vd_cE,action,from,to,vdcanvas);render.vd_bh(vd_eh);render.vd_rg();for(k=0;k<action.customData.length;k++){fig=action.customData[k];vdcanvas.DrawEntity(fig,render);}render.vd_pP();render.vd_bC();}else if(status=='end'){vdcanvas.Prompt('');if(!action.IsCanceled()||vd_lT(action.vd_bO.vd_ax)){if(action.vd_bO.vd_bV)from=action.vd_bO.vd_bV;else if(action.ResValue&&Array.isArray(action.ResValue[0]))from=action.ResValue[0];else from=action.ResValue;if(vd_lT(action.vd_bO.vd_ax))to=action.vd_bO.vd_ax;else if(action.ResValue&&Array.isArray(action.ResValue[1]))to=action.ResValue[1];else to=action.ResValue;vd_eh=vdgeo.vd_e();vd_eh=vd_Ee(vd_eh,action.vd_bO.vd_cE,action,from,to,vdcanvas);if(action.vd_bO.vd_cE==4){var entities=vdcanvas.CopyObjects(action.customData);if(action.customData){for(var k=0;k<action.customData.length;k++){var fig=action.customData[k];fig.selected=false;}}action.customData=entities;}else{if(action.vd_bO.vd_cE==2){if(action.ResValue){if(Array.isArray(to))action.ResValue[1]=vdgeo.Distance2D(from,to);else action.ResValue[1]=to;}}else if(action.vd_bO.vd_cE==3||action.vd_bO.vd_cE==5){if(action.ResValue){if(Array.isArray(to))action.ResValue[1]=vdgeo.GetAngle(from,to);else action.ResValue[1]=to;}}}action.vd_bO.matrix=vd_eh;for(k=0;k<action.customData.length;k++){fig=action.customData[k];vd_q.vd_hg(vd_eh,fig,vdcanvas);vdcanvas.UpdateFig(fig);}vdcanvas.UpdateLayout();}vd_rU(action);}}};function vd_Bd(vdcanvas){var vd_U=this;var vd_n=vdcanvas;var vd_bs=[];var vd_FH=[];var vd_bi=true;var vd_kc=[];var vd_ju=null;var vd_aQ=null;this.enableScript=function(vd_AD){var ret=vd_bi;vd_bi=vd_AD;return ret;};this.isActive=function(){return vd_bi;};this.getCommands=function(){return vd_bs;};this.clearCommands=function(){return vd_bs=[];};this.parseCommands=function(vd_gF){if(!vd_gF)vd_gF=vd_bs;for(var i=0;i<vd_gF.length;i++){vd_MQ(vd_gF[i],false);}};function vd_Gd(entities,replace){var k=0,index=0;var fig;var h='';var command='';if(replace)vd_U.clearSelection();if(entities&&entities.length>0){if(vd_bi)command+='select ';for(k=0;k<entities.length;k++){fig=entities[k];h='h_'+fig.HandleId.toString();index=vd_kc.indexOf(h);if(index== -1){if(vd_bi)command+=h+' ';vd_kc.push(h);}if(vd_bi){if(((k+1)%10)==0){vd_bs.push(command);command='select ';}}}if(vd_bi)vd_bs.push(command);}};this.clearSelection=function(){vd_kc=[];if(vd_bi)vd_bs.push('select -all');};this.select=function(entities,vd_bj){vd_ju=vd_bj;vd_n.CmdSelect(vd_ce,entities);};this.erase=function(){var k;var selection=vd_U.ActiveSelection();if(selection.length==0)return;vd_n.UndoHistory().group_start();for(k=0;k<selection.length;k++){fig=selection[k];vd_n.UndoHistory().store(fig,"Deleted");fig.Deleted=true;}vd_n.UndoHistory().group_end();vd_n.UpdateLayout();if(vd_bi){vd_bs.push("erase");}vd_U.clearSelection();};this.move=function(from,to,vd_bj){var selection=vd_U.ActiveSelection();if(selection.length==0)return;vd_ju=vd_bj;vd_n.CmdMove(selection,from,to,vd_ce);};this.scale=function(from,scale,vd_bj){var selection=vd_U.ActiveSelection();if(selection.length==0)return;vd_ju=vd_bj;vd_n.CmdScale(selection,from,scale,vd_ce);};this.rotate=function(from,rotation,vd_bj){var selection=vd_U.ActiveSelection();if(selection.length==0)return;vd_ju=vd_bj;vd_n.CmdRotate(selection,from,rotation,vd_ce);};this.rotate3d=function(from,rotation,axis,vd_bj){var selection=vd_U.ActiveSelection();if(selection.length==0)return;vd_ju=vd_bj;vd_n.CmdRotate3D(selection,from,rotation,axis,vd_ce);};this.mirror=function(from,rotation,vd_bj){var selection=vd_U.ActiveSelection();if(selection.length==0)return;vd_ju=vd_bj;vd_n.CmdMirror(selection,from,rotation,vd_ce);};this.copy=function(from,to,vd_bj){var selection=vd_U.ActiveSelection();if(selection.length==0)return;vd_ju=vd_bj;vd_n.CmdCopy(selection,from,to,vd_ce);};this.ActiveSelection=function(){var ret=[];var fig;for(k=0;k<vd_kc.length;k++){fig=vd_n.GetEntityItem(vd_kc[k]);if(!fig)continue;ret.push(fig);}return ret;};function vd_ce(action){var fig;var h='';var k=0;var index=0;var command='';if(action.vd_bO.vd_cE==0){vd_Gd(action.customData,true);}else{if(!action.customData||action.customData.length==0)return;if(vd_n.UndoHistory().Enable&&action.vd_bO.matrix){var vd_eh=action.vd_bO.matrix;var vd_wd=vdgeo.vd_aR(vd_eh);vd_n.UndoHistory().group_start();for(k=0;k<action.customData.length;k++){fig=action.customData[k];if(action.vd_bO.vd_cE==4)vd_n.UndoHistory().store(fig,"Deleted",true);else vd_n.UndoHistory().store(fig,'special_transform',[vd_eh,vd_wd]);}vd_n.UndoHistory().group_end();}if(vd_bi){var vd_sT=null;var vd_rv=null;if(action.vd_bO.vd_cE===4){var vd_t=vd_n.GetDocument();vd_bs.push("chandle "+(vd_t.HandleCurrent-action.customData.length).toString());}if(!action.ResValue){if(action.vd_bO){vd_Gd(action.customData,true);vd_sT=action.vd_bO.vd_bV;vd_rv=action.vd_bO.vd_ax;}}else{vd_sT=action.ResValue[0];vd_rv=action.ResValue[1];}if(vd_lT(vd_sT)&&vd_lT(vd_rv)){command=vd_PS(action.vd_bO.vd_cE,[action.customData,vd_sT,vd_rv,action.vd_bO.axis]);vd_bs.push(command);}}}if(vd_ju)vd_ju(vd_n);};function vd_PS(actionType,vd_P){var command;switch(actionType){case 1:command="move {0} {1}";command=command.replace("{0}",vd_aX(vd_P[1]));command=command.replace("{1}",vd_aX(vd_P[2]));break;case 2:command="scale {0} {1}";command=command.replace("{0}",vd_aX(vd_P[1]));command=command.replace("{1}",vd_P[2].toString());break;case 3:if(vd_P[2]){command="rotate3d {0} {1} {2}";command=command.replace("{0}",vd_aX(vd_P[1]));command=command.replace("{1}",vdgeo.RadiansToDegrees(vd_P[2]).toString());command=command.replace("{2}",vd_aX(vd_P[2]));}else{command="rotate {0} {1}";command=command.replace("{0}",vd_aX(vd_P[1]));command=command.replace("{1}",vdgeo.RadiansToDegrees(vd_P[2]).toString());}break;case 4:command="copy {0} {1}";command=command.replace("{0}",vd_aX(vd_P[1]));command=command.replace("{1}",vd_aX(vd_P[2]));break;case 5:command="mirror {0} {1}";command=command.replace("{0}",vd_aX(vd_P[1]));command=command.replace("{1}",vdgeo.RadiansToDegrees(vd_P[2]).toString());break;default:return;}return command;};function vd_PT(points){var ret="";var point;for(var i=0;i<points.length;i++){point=points[i];ret+=vd_aX(point);if(i!=points.length-1)ret+=" ";}return ret;};function vd_aX(point){return vdgeo.vd_yp(point);};function vd_MU(vd_BV,vd_ma,vd_mc){var h,i,index;var vd_qI=vd_BV[0]=='-';var vd_eL=vd_BV;if(vd_qI)vd_eL=vd_eL.substr(1);if(vd_eL.search("all")==0){if(vd_qI){vd_mc=[];return;}for(i=0;i<vd_ma.Items.length;i++){h=vd_ma.Items[i];index=vd_mc.indexOf(h);if(index>=0)continue;vd_mc.push(vd_ma.Items[i]);}}else if(vd_eL.search("last")==0){if(vd_ma.Items.length>0){h=vd_ma.Items[vd_ma.Items.length-1];vd_n.GroupsManager.vd_vh(h,vd_mc,vd_qI);}}else if(vd_eL.search("h_")==0){vd_n.GroupsManager.vd_vh(vd_eL,vd_mc,vd_qI);}else if(vd_eL.search("w_")==0||vd_eL.search("c_")==0){var items=vd_eL.split("_");var p1=vd_n.ViewToPixel(vd_aO(items[1]));var p2=vd_n.ViewToPixel(vd_aO(items[2]));var xmin=Math.min(p1[X],p2[X]);var xmax=Math.max(p1[X],p2[X]);var ymin=Math.min(p1[Y],p2[Y]);var ymax=Math.max(p1[Y],p2[Y]);var ents;if(vd_eL.search("c_")==0)ents=vd_n.GetEntitiesFromBox(xmin,ymin,xmax,ymax);else ents=vd_n.GetEntitiesInWindowBox(xmin,ymin,xmax,ymax);for(i=0;i<ents.length;i++){h='h_'+ents[i].HandleId.toString();vd_n.GroupsManager.vd_vh(h,vd_mc,vd_qI);}}};function vd_aO(point){return vdgeo.vd_xv(point);};this.layer=function(name){var vd_t=vd_n.GetDocument();if(vd_t==null)return;var vd_yF=vd_n.FindLayer(name);if(vd_yF==null)return;var vd_LF=vd_n.GetDictItem(vd_t.Layers,vd_t.ActiveLayer);if(vd_yF==vd_LF)return;vd_n.UndoHistory().store(vd_t,"ActiveLayer");vd_n.SetActiveLayer(vd_yF);if(vd_bi)vd_bs.push("layer "+name);};this.layout=function(name){var vd_t=vd_n.GetDocument();if(vd_t==null)return;var clid=vd_n.GetActiveLayoutId();var nlid=vd_n.FindLayout(name);if(clid==nlid)return;vd_n.UndoHistory().group_start();vd_n.UndoHistory().store(vd_t,"ActiveLayOut");vd_n.UndoHistory().store(vd_t,"ActiveLayOutRef");vd_n.UndoHistory().group_end();vd_n.SetActiveLayoutId(nlid);vd_kc=[];if(vd_bi)vd_bs.push("layout "+name);};this.color=function(vd_KJ){var vd_t=vd_n.GetDocument();if(vd_t==null)return;var vd_LN=vdConst.colorToString(vd_t.ActivePenColor);var color=vdConst.colorFromString(vd_KJ);var vd_FD=vdConst.colorToString(color);if(vd_LN==vd_FD)return;vd_n.UndoHistory().store(vd_t,"ActivePenColor");vd_n.SetActivePenColor(color);if(vd_bi)vd_bs.push("color "+vd_FD);};this.linetype=function(name){var vd_t=vd_n.GetDocument();if(vd_t==null)return;var vd_AV=vd_n.FindLineType(name);if(vd_AV==null)return;var vd_Mt=vd_n.GetDictItem(vd_t.LineTypes,vd_t.ActiveLineType);if(vd_AV==vd_Mt)return;vd_n.UndoHistory().store(vd_t,"ActiveLineType");vd_n.SetActiveLineType(vd_AV);if(vd_bi)vd_bs.push("linetype "+name);};this.lineweight=function(vd_bl){var vd_t=vd_n.GetDocument();if(vd_t==null)return;if(vd_t.ActiveLineWeight==vd_bl)return;vd_n.UndoHistory().store(vd_t,"ActiveLineWeight");vd_n.SetActiveLineWeight(vd_bl);if(vd_bi)vd_bs.push("lineweight "+vd_bl.toString());};this.ltscale=function(vd_bl){var vd_t=vd_n.GetDocument();if(vd_t==null)return;if(!vd_t.vd_lC)vd_t.vd_lC=1.0;if(vd_t.vd_lC==vd_bl)return;vd_n.UndoHistory().store(vd_t,"vd_lC");vd_t.vd_lC=vd_bl;if(vd_bi)vd_bs.push("ltscale "+vd_bl.toString());};this.penwidth=function(vd_bl){var vd_t=vd_n.GetDocument();if(vd_t==null)return;if(vd_t.ActivePenWidth==vd_bl)return;vd_n.UndoHistory().store(vd_t,"ActivePenWidth");vd_n.SetActivePenWidth(vd_bl);if(vd_bi)vd_bs.push("penwidth "+vd_bl.toString());};this.thickness=function(vd_bl){var vd_t=vd_n.GetDocument();if(vd_t==null)return;if(vd_t.vd_rs==vd_bl)return;vd_n.UndoHistory().store(vd_t,"vd_rs");vd_n.SetActiveThickness(vd_bl);if(vd_bi)vd_bs.push("thickness "+vd_bl.toString());};var vd_mW=false;function vd_iY(){if(!vd_mW)return 0.0;var vd_t=vd_n.GetDocument();if(vd_t==null)return 0.0;if(vd_t.doublelinewidth===undefined)vd_t.doublelinewidth=0.25;return vd_t.doublelinewidth;};this.doublelinewidth=function(vd_bl){var vd_t=vd_n.GetDocument();if(vd_t==null)return;if(vd_t.doublelinewidth==vd_bl)return;vd_n.UndoHistory().store(vd_t,"doublelinewidth");vd_t.doublelinewidth=vd_bl;if(vd_bi)vd_bs.push("doublelinewidth "+vd_bl.toString());};this.hatch=function(vd_iS,FillBkColor,FillColor,vd_jD,vd_iy,vd_cR,vd_kK){var vd_t=vd_n.GetDocument();if(vd_t==null)return;if(vd_iS==undefined)vd_iS='none';if(!FillBkColor)FillBkColor='byblock';if(!FillColor)FillColor='byblock';if(vd_iy==undefined)vd_iy=0;if(vd_jD==undefined)vd_jD=1;var vd_Nx=vdConst.colorFromString(FillBkColor);var vd_Ol=vdConst.colorFromString(FillColor);var nh=vd_n.createNewHatchProperties(vd_iS,vd_Nx,vd_Ol,vd_jD,vd_iy);if(nh&&vd_cR!==undefined)nh.Solid2dTransparency=vd_cR;if(nh&&vd_kK!==undefined)nh.DrawBoundary=vd_kK==1;if(vd_t.ActiveHatchProperties===nh)return;vd_n.UndoHistory().store(vd_t,"ActiveHatchProperties");vd_t.ActiveHatchProperties=nh;if(vd_bi)vd_bs.push("hatch "+vd_iS+" "+FillBkColor+" "+FillColor+" "+vd_jD.toString()+" "+vd_iy.toString()+" "+(vd_cR!==undefined?vd_cR.toString():"255")+" "+(vd_kK?"1":"0"));};this.textstyle=function(name,height,vd_Cd,vd_DU){var vd_t=vd_n.GetDocument();if(vd_t==null)return;var vd_Eh=vd_n.GetDictItem(vd_t.TextStyles,vd_t.ActiveTextStyle);var vd_gc=false;vd_n.UndoHistory().group_start();var ts=vd_n.FindTextStyle(name);if(ts&&ts!=vd_Eh){vd_n.UndoHistory().store(vd_t,"ActiveTextStyle");vd_n.SetActiveTextStyle(ts);vd_gc=true;}else{ts=vd_Eh;}if(ts.Height!=height){vd_n.UndoHistory().store(ts,"Height");ts.Height=height;vd_gc=true;}switch(vd_Cd){case "left":if(ts.HorJustify!=vdConst.VdConstHorJust_VdTextHorLeft){vd_n.UndoHistory().store(ts,"HorJustify");ts.HorJustify=vdConst.VdConstHorJust_VdTextHorLeft;vd_gc=true;}break;case "right":if(ts.HorJustify!=vdConst.VdConstHorJust_VdTextHorRight){vd_n.UndoHistory().store(ts,"HorJustify");ts.HorJustify=vdConst.VdConstHorJust_VdTextHorRight;vd_gc=true;}break;case "center":if(ts.HorJustify!=vdConst.VdConstHorJust_VdTextHorCenter){vd_n.UndoHistory().store(ts,"HorJustify");ts.HorJustify=vdConst.VdConstHorJust_VdTextHorCenter;vd_gc=true;}break;}switch(vd_DU){case "bottom":if(ts.VerJustify!=vdConst.VdConstVerJust_VdTextVerBottom){vd_n.UndoHistory().store(ts,"VerJustify");ts.VerJustify=vdConst.VdConstVerJust_VdTextVerBottom;vd_gc=true;}break;case "top":if(ts.VerJustify!=vdConst.VdConstVerJust_VdTextVerTop){vd_n.UndoHistory().store(ts,"VerJustify");ts.VerJustify=vdConst.VdConstVerJust_VdTextVerTop;vd_gc=true;}break;case "center":if(ts.VerJustify!=vdConst.VdConstVerJust_VdTextVerCen){vd_n.UndoHistory().store(ts,"VerJustify");ts.VerJustify=vdConst.VdConstVerJust_VdTextVerCen;vd_gc=true;}break;case "base":if(ts.VerJustify!=vdConst.VdConstVerJust_VdTextVerBaseLine){vd_n.UndoHistory().store(ts,"VerJustify");ts.VerJustify=vdConst.VdConstVerJust_VdTextVerBaseLine;vd_gc=true;}break;}vd_n.UndoHistory().group_end();if(vd_gc&&vd_bi)vd_bs.push("textstyle "+" "+ts.Name+" "+ts.Height.toString()+" "+vd_Cd+" "+vd_DU);};this.tooltip=function(name){var vd_t=vd_n.GetDocument();if(vd_t==null)return;if(vd_t.vd_lG==undefined)vd_t.vd_lG="";if(vd_t.vd_lG==name)return;vd_n.UndoHistory().store(vd_t,"vd_lG");vd_t.vd_lG=name;if(vd_bi)vd_bs.push("tooltip "+name);};function vd_Fv(vd_Kj){var vd_Ct=vd_Kj.split(" ");var vd_m=[];var val,i;for(i=0;i<vd_Ct.length;i++){val=vd_Ct[i].trim();if(val=="")continue;vd_m.push(val);}return vd_m;};function vd_MQ(vd_eL,vd_bA){var vd_t=vd_n.GetDocument();if(vd_t==null)return;var layout=vd_n.GetActiveLayout();if(layout==null)return;var vd_aq=[];var vd_g;var from,to,mat,k,i,fig,base,vd_wd;var vd_m=vd_Fv(vd_eL);if(vd_m.length==0)return;var command="__"+vd_m[0].toLowerCase();switch(command){case "__layer":vd_U.layer(vd_m[1]);break;case "__color":vd_U.color(vd_m[1]);break;case "__linetype":vd_U.linetype(vd_m[1]);break;case "__ltscale":vd_U.ltscale(Number(vd_m[1]));break;case "__lineweight":vd_U.lineweight(Number(vd_m[1]));break;case "__penwidth":vd_U.penwidth(Number(vd_m[1]));break;case "__thickness":vd_U.thickness(Number(vd_m[1]));break;case "__doublelinewidth":vd_U.doublelinewidth(Number(vd_m[1]));break;case "__tooltip":vd_U.tooltip(vd_m[1]);break;case "__textstyle":vd_U.textstyle(vd_m[1],Number(vd_m[2]),vd_m[3],vd_m[4]);break;case "__hatch":vd_U.hatch(vd_m[1],vd_m[2],vd_m[3],Number(vd_m[4]),vdgeo.DegreesToRadians(Number(vd_m[5])),Number(vd_m[6]),Number(vd_m[7]));break;case "__layout":vd_U.layout(vd_m[1]);break;case "__chandle":vd_t.HandleCurrent=Math.max(vd_t.HandleCurrent,Number(vd_m[1]));break;case "__line":vd_U.line([vd_aO(vd_m[1]),vd_aO(vd_m[2])]);break;case "__xline":vd_U.xline([vd_aO(vd_m[1]),vd_aO(vd_m[2])]);break;case "__ray":vd_U.ray([vd_aO(vd_m[1]),vd_aO(vd_m[2])]);break;case "__polyline":{vd_aq=[];for(i=1;i<vd_m.length;i++){vd_g=vd_aO(vd_m[i]);while(vd_g.length<4)vd_g.push(0);vd_aq.push(vd_g);}vd_U.polyline(vd_aq);}break;case "__doubleline":{vd_aq=[];for(i=1;i<vd_m.length;i++){vd_g=vd_aO(vd_m[i]);while(vd_g.length<4)vd_g.push(0);vd_aq.push(vd_g);}vd_U.doubleline(vd_aq);}break;case "__doublelinerect":vd_U.doublelinerect([vd_aO(vd_m[1]),Number(vd_m[2]),Number(vd_m[3]),vdgeo.DegreesToRadians(Number(vd_m[4]))]);break;case "__spline1":{vd_aq=[];for(i=1;i<vd_m.length;i++){vd_g=vd_aO(vd_m[i]);while(vd_g.length<4)vd_g.push(0);vd_aq.push(vd_g);}vd_U.polyline(vd_aq,0,1);}break;case "__spline2":{vd_aq=[];for(i=1;i<vd_m.length;i++){vd_g=vd_aO(vd_m[i]);while(vd_g.length<4)vd_g.push(0);vd_aq.push(vd_g);}vd_U.polyline(vd_aq,0,2);}break;case "__spline4":{vd_aq=[];for(i=1;i<vd_m.length;i++){vd_g=vd_aO(vd_m[i]);while(vd_g.length<4)vd_g.push(0);vd_aq.push(vd_g);}vd_U.polyline(vd_aq,0,4);}break;case "__box":vd_U.box([vd_aO(vd_m[1]),Number(vd_m[2]),Number(vd_m[3]),Number(vd_m[4]),vdgeo.DegreesToRadians(Number(vd_m[5]))]);break;case "__sphere":vd_U.sphere([vd_aO(vd_m[1]),Number(vd_m[2]),Number(vd_m[3]),Number(vd_m[4])]);break;case "__cone":vd_U.cone([vd_aO(vd_m[1]),Number(vd_m[2]),Number(vd_m[3]),Number(vd_m[4]),Number(vd_m[5])]);break;case "__rect":vd_U.rect([vd_aO(vd_m[1]),Number(vd_m[2]),Number(vd_m[3]),vdgeo.DegreesToRadians(Number(vd_m[4]))]);break;case "__circle":vd_U.circle([vd_aO(vd_m[1]),Number(vd_m[2])]);break;case "__arc":vd_U.arc([vd_aO(vd_m[1]),Number(vd_m[2]),vdgeo.DegreesToRadians(Number(vd_m[3])),vdgeo.DegreesToRadians(Number(vd_m[4]))]);break;case "__ellipse":vd_U.ellipse([vd_aO(vd_m[1]),Number(vd_m[2]),Number(vd_m[3]),vdgeo.DegreesToRadians(Number(vd_m[4])),vdgeo.DegreesToRadians(Number(vd_m[5])),vdgeo.DegreesToRadians(Number(vd_m[6]))]);break;case "__text":vd_U.text(vd_m[1],[vd_aO(vd_m[2]),vdgeo.DegreesToRadians(Number(vd_m[3]))]);break;case "__image":vd_U.image(vd_m[1],vd_m[2],[vd_aO(vd_m[3]),Number(vd_m[4]),vdgeo.DegreesToRadians(Number(vd_m[5]))]);break;case "__dimvar":vd_U.dimvar(vd_m[1],vd_m[2]);break;case "__dim":vd_U.dim([vd_aO(vd_m[1]),vd_aO(vd_m[2]),vd_aO(vd_m[3]),vd_m[4]]);break;case "__blockref":vd_U.blockref(vd_m[1],[vd_aO(vd_m[2]),Number(vd_m[3]),vdgeo.DegreesToRadians(Number(vd_m[4]))]);break;case "__select":{var entities=layout.Entities;for(i=1;i<vd_m.length;i++){vd_MU(vd_m[i].toLowerCase(),entities,vd_kc);}}break;case "__erase":vd_U.erase();break;case "__move":vd_U.move(vd_aO(vd_m[1]),vd_aO(vd_m[2]));break;case "__rotate":vd_U.rotate(vd_aO(vd_m[1]),vdgeo.DegreesToRadians(Number(vd_m[2])));break;case "__mirror":vd_U.mirror(vd_aO(vd_m[1]),vdgeo.DegreesToRadians(Number(vd_m[2])));break;case "__rotate3d":vd_U.rotate3d(vd_aO(vd_m[1]),vdgeo.DegreesToRadians(Number(vd_m[2])),vd_aO(vd_m[3]));break;case "__scale":vd_U.scale(vd_aO(vd_m[1]),Number(vd_m[2]));break;case "__copy":vd_U.copy(vd_aO(vd_m[1]),vd_aO(vd_m[2]));break;case "__undogroup":vd_U.undogroup(vd_m[1]);break;default:vd_n.Prompt("Wrong script command : "+command);break;}};this.undogroup=function(value){if(value.toLowerCase()=='begin'){vd_n.UndoHistory().group_start();}else{vd_n.UndoHistory().group_end();}if(vd_bi)vd_bs.push("undogroup "+value);};function vd_Be(vd_gF,vd_Hg){var vd_ic=0;while(vd_gF.length>0){var vd_pL=vd_gF[vd_gF.length-1].toLowerCase();if(vd_pL.substr(0,9)=='undogroup'){var vd_m=vd_Fv(vd_pL);vd_ic+=vd_m[1].toLowerCase()=='begin'? -1:1;}vd_Hg.push(vd_gF.pop());if(vd_gF.length==0)break;vd_pL=vd_gF[vd_gF.length-1].toLowerCase();if(vd_ic==0&&vd_pL.substr(0,6)!='select'&&vd_pL.substr(0,7)!='chandle')break;}};this.undo=function(){vd_n.UndoHistory().undo();if(vd_bi){vd_Be(vd_bs,vd_FH);}};this.redo=function(){vd_n.UndoHistory().redo();if(vd_bi){vd_Be(vd_FH,vd_bs);}};this.RegisterFigure=function(Figure,vd_bA,refresh){vd_aE(Figure,vd_bA,refresh);};function vd_aE(Figure,vd_bA,refresh){if(!Figure)return;var vd_t=vd_n.GetDocument();if(!Figure.HandleId){var layout=vd_n.GetActiveLayout();Figure.HandleId=vd_n.vd_fj();if(vd_t.vd_lG)Figure.ToolTip=vd_t.vd_lG;vd_n.vd_by(layout.Entities,Figure);}vd_n.UpdateFig(Figure);vd_n.UndoHistory().store(Figure,"Deleted",true);if(vd_bi){vd_bs.push("chandle "+(vd_t.HandleCurrent-1).toString());if(Figure._t==vdConst.vdLine_code){vd_bs.push("line "+vd_aX(Figure.StartPoint)+" "+vd_aX(Figure.EndPoint));}else if(Figure._t==vdConst.vdInfinityLine_code){if(Figure.InfinityType==vdConst.InfinityTypes_XLine){vd_bs.push("xline "+vd_aX(Figure.BasePoint)+" "+vd_aX(Figure.Direction));}else{vd_bs.push("ray "+vd_aX(Figure.BasePoint)+" "+vd_aX(Figure.Direction));}}else if(Figure._t==vdConst.vdPolyline_code){var vd_oO=vd_PT(Figure.VertexList.Items);if(Figure.Flag===1)vd_oO+=" "+vd_aX(Figure.VertexList.Items[0]);if(Figure.SPlineFlag===vdConst.SplineFlagSTANDARD){var vd_gn="polyline ";if(vd_iY()!=0)vd_gn="doubleline ";vd_bs.push(vd_gn+vd_oO);}else if(Figure.SPlineFlag===vdConst.SplineFlagFITTING){vd_bs.push("spline1 "+vd_oO);}else if(Figure.SPlineFlag===vdConst.SplineFlagCONTROLPOINTS){vd_bs.push("spline2 "+vd_oO);}else if(Figure.SPlineFlag===vdConst.SplineFlagQUADRATIC){vd_bs.push("spline4 "+vd_oO);}}else if(Figure._t==vdConst.vdRect_code){var vd_gn="rect ";if(vd_iY()!=0)vd_gn="doublelinerect ";vd_bs.push(vd_gn+vd_aX(Figure.InsertionPoint)+" "+Figure.Width.toString()+" "+Figure.Height.toString()+" "+vdgeo.RadiansToDegrees(Figure.Rotation).toString());}else if(Figure._t==vdConst.vdCircle_code){vd_bs.push("circle "+vd_aX(Figure.Center)+" "+Figure.Radius.toString());}else if(Figure._t==vdConst.vdArc_code){vd_bs.push("arc "+vd_aX(Figure.Center)+" "+Figure.Radius.toString()+" "+vdgeo.RadiansToDegrees(Figure.StartAngle).toString()+" "+vdgeo.RadiansToDegrees(Figure.EndAngle).toString());}else if(Figure._t==vdConst.vdEllipse_code){vd_bs.push("ellipse "+vd_aX(Figure.Center)+" "+Figure.MajorLength.toString()+" "+Figure.MinorLength.toString()+" "+vdgeo.RadiansToDegrees(Figure.MajorAngle).toString()+" "+vdgeo.RadiansToDegrees(Figure.StartAngle).toString()+" "+vdgeo.RadiansToDegrees(Figure.EndAngle).toString());}else if(Figure._t==vdConst.vdText_code){vd_bs.push("text "+Figure.TextString+" "+vd_aX(Figure.InsertionPoint)+" "+vdgeo.RadiansToDegrees(Figure.Rotation).toString());}else if(Figure._t==vdConst.vdImage_code){var vd_S=vd_n.GetDictItem(vd_t.Images,Figure.ImageDefinition);vd_bs.push("image "+vd_S.Name+" "+(vd_S.FileName?vd_S.FileName:"@")+" "+vd_aX(Figure.InsertionPoint)+" "+Figure.ImageScale.toString()+" "+vdgeo.RadiansToDegrees(Figure.Rotation).toString());}else if(Figure._t==vdConst.vdInsert_code){var bdef=vd_n.GetDictItem(vd_t.Blocks,Figure.Block);vd_bs.push("blockref "+bdef.Name+" "+vd_aX(Figure.InsertionPoint)+" "+Figure.Xscale.toString()+" "+vdgeo.RadiansToDegrees(Figure.Rotation).toString());}else if(Figure._t==vdConst.vdDimension_code){vd_bs.push("dim "+vd_aX(vd_bx.vd_qi)+" "+vd_aX(vd_bx.vd_qe)+" "+vd_aX(vd_bx.vd_sg)+" "+vd_bx.text);}else{var action=vd_n.ActiveAction();if(action.vd_z){if(action.vd_z[action.vd_z.length-1]=="box"){var vd_gn="box ";vd_bs.push(vd_gn+vd_aX(action.vd_z[0])+" "+action.vd_z[1].toString()+" "+action.vd_z[2].toString()+" "+action.vd_z[3].toString()+" "+vdgeo.RadiansToDegrees(action.vd_z[4]).toString());}else if(action.vd_z[action.vd_z.length-1]=="sphere"){var vd_gn="sphere ";vd_bs.push(vd_gn+vd_aX(action.vd_z[0])+" "+action.vd_z[1].toString()+" "+action.vd_z[2].toString()+" "+action.vd_z[3].toString());}else if(action.vd_z[action.vd_z.length-1]=="cone"){var vd_gn="cone ";vd_bs.push(vd_gn+vd_aX(action.vd_z[0])+" "+action.vd_z[1].toString()+" "+action.vd_z[2].toString()+" "+action.vd_z[3].toString()+" "+action.vd_z[4].toString());}}}}if(vd_bA)vd_n.DrawEntity(Figure);if(refresh)vd_n.Refresh();};function vd_aM(action){vd_mW=false;if(action){var fig=action.Figure;action.Figure=null;action.vd_z=null;action.vd_v=null;action.vd_fG=1.0;if(vd_aQ)vd_aQ(vd_n,fig);}};this.doubleline=function(vd_P,closed,vd_oF,vd_bj){vd_mW=true;vd_U.polyline(vd_P,closed,vd_oF,vd_bj);};this.polyline=function(vd_P,closed,vd_oF,vd_bj){vd_n.ActiveAction().cancel();vd_aQ=vd_bj;var vd_dg=vd_iY();if(vd_P){var Figure=vd_n.AddPolyline(vd_P,false,{});if(vd_dg!=0){var vd_ix=[];for(var i=0;i<Figure.VertexList.Items.length;i++){vd_ix.push(vd_dg);vd_ix.push(vd_dg);}Figure.Widths={Items:vd_ix};}if(vd_oF)Figure.SPlineFlag=vd_oF;if(closed)Figure.Flag=1;vd_mW=false;vd_aE(Figure,false,false);if(vd_aQ)vd_aQ(vd_n,Figure);return;}var fig=vd_n.AddPolyline([],false,{});if(vd_dg!=0){fig.Widths={Items:[]};}fig.SPlineFlag=0;if(vd_oF)fig.SPlineFlag=vd_oF;if(closed)fig.Flag=1;vd_n.ActiveAction().Figure=fig;vd_n.GetUserPoint(vd_Ef);};function vd_Ef(action,status){var pt;if(status=='start'){if(action.Figure.VertexList.Items.length==0)vd_n.Prompt(vd_n.MessagesDictionary.SPECIFY_START_POINT);else{action.show();action.draw();vd_n.Prompt(vd_n.MessagesDictionary.SPECIFY_NEXT_POINT);}}else if(status=='end'){vd_n.Prompt('');if(!action.IsCanceled()){pt=action.SelectedPoint(true);var vd_xX=false;if(action.Figure.VertexList.Items.length==0){action.Figure.VertexList.Items=[pt];vd_xX=true;}else{if(!vdgeo.vd_fH(pt,action.Figure.VertexList.Items[action.Figure.VertexList.Items.length-1],vd_n.GetPixelSize())){action.Figure.VertexList.Items.push(pt);vd_xX=true;}}if(vd_xX&&action.Figure.Widths){var vd_dg=vd_iY();action.Figure.Widths.Items.push(vd_dg);action.Figure.Widths.Items.push(vd_dg);}action.DrawActionDefault=false;vd_n.GetUserLine(vd_Ef,pt);}else{if(action.vd_Li==0)action.Figure=null;if(action.Figure!=null&&((action.Figure.SPlineFlag==0&&action.Figure.VertexList.Items.length>1)||action.Figure.VertexList.Items.length>2))vd_aE(action.Figure,true,true);vd_aM(action);}}else if(status=='draw'){if(action.Figure.VertexList.Items.length>0){var render=action.render;var vd_Pq=action.Figure.SPlineFlag;if(action.Figure.VertexList.Items.length<2)action.Figure.SPlineFlag=0;pt=[action.DrawPoint()[X],action.DrawPoint()[Y],action.DrawPoint()[Z],0.0];var vd_Bg= !vdgeo.vd_fH(pt,action.Figure.VertexList.Items[action.Figure.VertexList.Items.length-1],vd_n.GetPixelSize());if(vd_Bg){action.Figure.VertexList.Items.push(pt);if(action.Figure.Widths){var vd_dg=vd_iY();action.Figure.Widths.Items.push(vd_dg);action.Figure.Widths.Items.push(vd_dg);}}vd_n.UpdateFig(action.Figure);vd_n.DrawEntity(action.Figure,render);if(vd_Bg){action.Figure.VertexList.Items.pop();if(action.Figure.Widths){action.Figure.Widths.Items.pop();action.Figure.Widths.Items.pop();}}action.Figure.SPlineFlag=vd_Pq;vd_n.UpdateFig(action.Figure);}}};this.circle=function(vd_P,vd_bj){vd_n.ActiveAction().cancel();vd_aQ=vd_bj;if(vd_P){var Figure=vd_n.AddCircle(vd_P[0],vd_P[1],false,{});vd_aE(Figure,false,false);if(vd_aQ)vd_aQ(vd_n,Figure);return;}vd_n.GetUserPoint(vd_Gc);};function vd_Gc(action,status){if(!action.vd_v)action.vd_v='PickCenter';if(action.vd_v=='PickCenter'){if(status=='start'){vd_n.Prompt(vd_n.MessagesDictionary.SPECIFY_CENTER_POINT);}else if(status=='end'){vd_n.Prompt('');if(!action.IsCanceled()){action.Figure=vd_n.AddCircle(action.ResValue,0.0,false,{});action.vd_v='PickRadius';vd_n.GetUserLine(vd_Gc,action.ResValue);}else{vd_aM(action);}}}else if(action.vd_v=='PickRadius'){if(status=='start'){vd_n.Prompt(vd_n.MessagesDictionary.SPECIFY_RADIUS);}else if(status=='end'){vd_n.Prompt('');if(!action.IsCanceled()){action.Figure.Radius=vdgeo.Distance2D(action.SelectedPoint(),action.ReferencePoint);vd_aE(action.Figure,true,true);}vd_aM(action);}else if(status=='draw'){if(action.Figure){var render=action.render;action.Figure.Radius=vdgeo.Distance2D(action.DrawPoint(),action.ReferencePoint);vd_n.UpdateFig(action.Figure);vd_n.DrawEntity(action.Figure,render);}}}};this.xline=function(vd_P,vd_bj){vd_n.ActiveAction().cancel();vd_aQ=vd_bj;if(vd_P){var Figure=vd_n.AddInfinityLine(vdConst.InfinityTypes_XLine,vd_P[0],vd_P[1],false,{});vd_aE(Figure,false,false);if(vd_aQ)vd_aQ(vd_n,Figure);return;}vd_n.GetUserPoint(vd_Cb);};function vd_Cb(action,status){if(!action.vd_v)action.vd_v='PickStart';if(action.vd_v=='PickStart'){if(status=='start'){vd_n.Prompt(vd_n.MessagesDictionary.SPECIFY_START_POINT);}else if(status=='end'){vd_n.Prompt('');if(!action.IsCanceled()){action.vd_v='PickNext';var pt=action.SelectedPoint();action.Figure=vd_n.AddInfinityLine(vdConst.InfinityTypes_XLine,pt,[1,0,0],false,{});vd_n.GetUserLine(vd_Cb,pt);}else{vd_aM(action);}}}else if(action.vd_v=='PickNext'){if(status=='start'){action.DrawActionDefault=false;vd_n.Prompt(vd_n.MessagesDictionary.SPECIFY_SECOND_POINT);}else if(status=='draw'){if(action.Figure){var render=action.render;action.Figure.Direction=vdgeo.VectorDirection(action.ReferencePoint,action.DrawPoint());vd_n.UpdateFig(action.Figure);vd_n.DrawEntity(action.Figure,render);}}else if(status=='end'){action.DrawActionDefault=true;vd_n.Prompt('');if(!action.IsCanceled()){action.Figure.Direction=vdgeo.VectorDirection(action.ReferencePoint,action.SelectedPoint());vd_aE(action.Figure,true,true);}vd_aM(action);}}};this.ray=function(vd_P,vd_bj){vd_n.ActiveAction().cancel();vd_aQ=vd_bj;if(vd_P){var Figure=vd_n.AddInfinityLine(vdConst.InfinityTypes_Ray,vd_P[0],vd_P[1],false,{});vd_aE(Figure,false,false);if(vd_aQ)vd_aQ(vd_n,Figure);return;}vd_n.GetUserPoint(vd_Do);};function vd_Do(action,status){if(!action.vd_v)action.vd_v='PickStart';if(action.vd_v=='PickStart'){if(status=='start'){vd_n.Prompt(vd_n.MessagesDictionary.SPECIFY_START_POINT);}else if(status=='end'){vd_n.Prompt('');if(!action.IsCanceled()){action.vd_v='PickNext';var pt=action.SelectedPoint();action.Figure=vd_n.AddInfinityLine(vdConst.InfinityTypes_Ray,pt,[1,0,0],false,{});vd_n.GetUserLine(vd_Do,pt);}else{vd_aM(action);}}}else if(action.vd_v=='PickNext'){if(status=='start'){action.DrawActionDefault=false;vd_n.Prompt(vd_n.MessagesDictionary.SPECIFY_SECOND_POINT);}else if(status=='draw'){if(action.Figure){var render=action.render;action.Figure.Direction=vdgeo.VectorDirection(action.ReferencePoint,action.DrawPoint());vd_n.UpdateFig(action.Figure);vd_n.DrawEntity(action.Figure,render);}}else if(status=='end'){action.DrawActionDefault=true;vd_n.Prompt('');if(!action.IsCanceled()){action.Figure.Direction=vdgeo.VectorDirection(action.ReferencePoint,action.SelectedPoint());vd_aE(action.Figure,true,true);}vd_aM(action);}}};this.line=function(vd_P,vd_bj){vd_n.ActiveAction().cancel();vd_aQ=vd_bj;if(vd_P){var Figure=vd_n.AddLine(vd_P[0],vd_P[1],false,{});vd_aE(Figure,false,false);if(vd_aQ)vd_aQ(vd_n,Figure);return;}vd_n.GetUserPoint(vd_zh);};function vd_zh(action,status){if(!action.vd_v)action.vd_v='PickStart';if(action.vd_v=='PickStart'){if(status=='start'){vd_n.Prompt(vd_n.MessagesDictionary.SPECIFY_START_POINT);}else if(status=='end'){vd_n.Prompt('');if(!action.IsCanceled()){action.vd_v='PickNext';vd_n.GetUserLine(vd_zh,action.SelectedPoint());}else{vd_aM(action);}}}else if(action.vd_v=='PickNext'){if(status=='start'){vd_n.Prompt(vd_n.MessagesDictionary.SPECIFY_NEXT_POINT);}else if(status=='end'){vd_n.Prompt('');if(!action.IsCanceled()){action.Figure=vd_n.AddLine(action.ReferencePoint,action.SelectedPoint(),false,{});vd_aE(action.Figure,true,true);vd_n.GetUserLine(vd_zh,action.SelectedPoint());}else{vd_aM(action);}}}};this.arc=function(vd_P,vd_bj){vd_n.ActiveAction().cancel();vd_aQ=vd_bj;if(vd_P){var Figure=vd_n.AddArc(vd_P[0],vd_P[1],vd_P[2],vd_P[3],false,{});vd_aE(Figure,false,false);if(vd_aQ)vd_aQ(vd_n,Figure);return;}vd_n.GetUserPoint(vd_vR);};function vd_vR(action,status){if(!action.vd_v)action.vd_v='PickCenter';if(action.vd_v=='PickCenter'){if(status=='start'){vd_n.Prompt(vd_n.MessagesDictionary.SPECIFY_CENTER_POINT);}else if(status=='end'){vd_n.Prompt('');if(!action.IsCanceled()){action.Figure=vd_n.AddArc(action.ResValue,0.0,0.0,0.0,false,{});action.vd_v='PickStartPoint';vd_n.GetUserLine(vd_vR,action.ResValue);}else{vd_aM(action);}}}else if(action.vd_v=='PickStartPoint'){if(status=='start'){vd_n.Prompt(vd_n.MessagesDictionary.SPECIFY_START_POINT);}else if(status=='end'){vd_n.Prompt('');if(!action.IsCanceled()){action.Figure.Radius=vdgeo.Distance2D(action.ReferencePoint,action.SelectedPoint());action.Figure.StartAngle=vdgeo.GetAngle(action.ReferencePoint,action.SelectedPoint());action.vd_v='PickEndPoint';vd_n.GetUserLine(vd_vR,action.ReferencePoint);}else{vd_aM(action);}}}else if(action.vd_v=='PickEndPoint'){if(status=='start'){vd_n.Prompt(vd_n.MessagesDictionary.SPECIFY_END_POINT);}else if(status=='end'){vd_n.Prompt('');if(!action.IsCanceled()){action.Figure.EndAngle=vdgeo.GetAngle(action.ReferencePoint,action.SelectedPoint());vd_aE(action.Figure,true,true);}vd_aM(action);}else if(status=='draw'){if(action.Figure){var render=action.render;action.Figure.EndAngle=vdgeo.GetAngle(action.ReferencePoint,action.DrawPoint());vd_n.UpdateFig(action.Figure);vd_n.DrawEntity(action.Figure,render);}}}};this.doublelinerect=function(vd_P,vd_bj){vd_mW=true;vd_U.rect(vd_P,vd_bj);};function vd_zS(rect){var vd_af=[[0,0,0],[1,0,0],[1,1,0],[0,1,0]];var mat=vdgeo.vd_e();vdgeo.vd_aj(mat,rect.Width,rect.Height,1.0);vdgeo.vd_bw(mat,rect.Rotation);vdgeo.vd_x(mat,rect.InsertionPoint[X],rect.InsertionPoint[Y],rect.InsertionPoint[Z]);vd_af=vdgeo.vd_fN(mat,vd_af);var Figure=vd_n.AddPolyline(vd_af,false,{});Figure.HatchProperties=rect.HatchProperties;Figure.Thickness=rect.Thickness;Figure.LineType=rect.LineType;Figure.Layer=rect.Layer;Figure.PenColor=rect.PenColor;Figure.PenWidth=rect.PenWidth;Figure.LineWeight=rect.LineWeight;Figure.LineTypeScale=rect.LineTypeScale;var vd_dg=vd_iY();Figure.Widths={Items:[vd_dg,vd_dg,vd_dg,vd_dg,vd_dg,vd_dg,vd_dg,vd_dg]};Figure.Flag=1;return Figure;};this.rect=function(vd_P,vd_bj){vd_n.ActiveAction().cancel();vd_aQ=vd_bj;if(vd_P){var Figure=vd_n.AddRect2(vd_P[0],vd_P[1],vd_P[2],vd_P[3],false,{});if(vd_iY()!=0)Figure=vd_zS(Figure);vd_mW=false;vd_aE(Figure,false,false);if(vd_aQ)vd_aQ(vd_n,Figure);return;}vd_n.GetUserPoint(vd_Ep);};function vd_Ep(action,status){if(!action.vd_v)action.vd_v='Pick1';var render;if(action.vd_v=='Pick1'){if(status=='start'){vd_n.Prompt(vd_n.MessagesDictionary.SPECIFY_FIRST_CORNER);}else if(status=='end'){vd_n.Prompt('');if(!action.IsCanceled()){action.Figure=vd_n.AddRect(action.ResValue,action.ResValue,false,{});action.vd_v='Pick2';vd_n.GetUserLine(vd_Ep,action.ResValue);}else{vd_aM(action);}}}else if(action.vd_v=='Pick2'){if(status=='start'){action.vd_OL=action.vd_vt(false);action.DrawActionDefault=false;vd_n.Prompt(vd_n.MessagesDictionary.SPECIFY_OTHER_CORNER);}else if(status=='end'){action.vd_vt(action.vd_OL);vd_n.Prompt('');if(!action.IsCanceled()){action.Figure.Width=action.SelectedPoint()[X]-action.ReferencePoint[X];action.Figure.Height=action.SelectedPoint()[Y]-action.ReferencePoint[Y];if(vd_iY()!=0)action.Figure=vd_zS(action.Figure);vd_aE(action.Figure,true,true);}vd_aM(action);}else if(status=='draw'){if(action.Figure){render=action.render;action.Figure.Width=action.DrawPoint()[X]-action.ReferencePoint[X];action.Figure.Height=action.DrawPoint()[Y]-action.ReferencePoint[Y];var vd_wt=action.Figure;if(vd_iY()!=0)vd_wt=vd_zS(action.Figure);vd_n.UpdateFig(vd_wt);vd_n.DrawEntity(vd_wt,render);}}}};this.blockref=function(name,vd_P,vd_bj){var action=vd_n.ActiveAction();action.cancel();vd_aQ=vd_bj;if(vd_P){var Figure=vd_n.AddBlockSymbol(name,vd_P[0],vd_P[1],vd_P[2]);vd_aE(Figure,false,false);if(vd_aQ)vd_aQ(vd_n,Figure);return;}action.Figure=vd_n.AddBlockSymbol(name,[0,0,0],1.0,0.0,false,{});var bbox=vd_n.GetEntityBBox(action.Figure);action.vd_fG=1.0;if(vd_n.ActionScaleMode==1&&bbox)action.vd_fG=1.0/Math.max(bbox[3]-bbox[0],bbox[4]-bbox[1]);vd_n.GetUserPoint(vd_vB);};function vd_nn(vdcanvas,fig,vd_A,vd_sY,vd_rH,vd_sU,rotation){if(vdgeo.AreEqual(vd_sY,0.0,vdgeo.DefaultScaleEquality))vd_sY=fig.Xscale;if(vdgeo.AreEqual(vd_rH,0.0,vdgeo.DefaultScaleEquality))vd_rH=fig.Yscale;if(vdgeo.AreEqual(vd_sU,0.0,vdgeo.DefaultScaleEquality))vd_sU=fig.Zscale;if(fig.Attributes&&fig.Attributes.Items.length>0){var mat=vdgeo.vd_e();vdgeo.vd_x(mat,-fig.InsertionPoint[X],-fig.InsertionPoint[Y],-fig.InsertionPoint[Z]);vdgeo.vd_gB(mat,fig.ExtrusionVector);vdgeo.vd_bw(mat,-fig.Rotation);vdgeo.vd_aj(mat,1.0/fig.Xscale,1.0/fig.Yscale,1.0/fig.Zscale);vdgeo.vd_aj(mat,vd_sY,vd_rH,vd_sU);vdgeo.vd_bw(mat,rotation);vdgeo.vd_dl(mat,fig.ExtrusionVector);vdgeo.vd_x(mat,vd_A[X],vd_A[Y],vd_A[Z]);vd_q.vd_hg(mat,fig,vdcanvas);}else{fig.InsertionPoint=vd_A;fig.Xscale=vd_sY;fig.Yscale=vd_rH;fig.Zscale=vd_sU;fig.Rotation=rotation;}};function vd_vB(action,status){if(!action.vd_v)action.vd_v='PickInsertion';var scale;var render;var rotation;if(action.vd_v=='PickInsertion'){if(status=='start'){vd_n.Prompt(vd_n.MessagesDictionary.SPECIFY_INSERTION_POINT);}else if(status=='end'){vd_n.Prompt('');if(!action.IsCanceled()){action.Figure.InsertionPoint=action.ResValue;action.vd_v='PickScale';vd_n.GetUserLine(vd_vB,action.ResValue);}else{vd_aM(action);}}else if(status=='draw'){if(action.Figure){render=action.render;vd_nn(vdcanvas,action.Figure,action.DrawPoint(),action.Figure.Xscale,action.Figure.Yscale,action.Figure.Zscale,action.Figure.Rotation);vd_n.UpdateFig(action.Figure);vd_n.DrawEntity(action.Figure,render);}}}else if(action.vd_v=='PickScale'){if(status=='start'){action.show();action.draw();vd_n.Prompt(vd_n.MessagesDictionary.SPECIFY_SCALE);}else if(status=='end'){vd_n.Prompt('');if(!action.IsCanceled()){if(!action.vd_fG)action.vd_fG=1.0;scale=vdgeo.Distance2D(action.ReferencePoint,action.SelectedPoint())*action.vd_fG;vd_nn(vdcanvas,action.Figure,action.Figure.InsertionPoint,scale,scale,action.Figure.Zscale,action.Figure.Rotation);action.vd_v='PickRotation';vd_n.GetUserLine(vd_vB,action.ReferencePoint);}else{vd_nn(vdcanvas,action.Figure,action.Figure.InsertionPoint,1.0,1.0,action.Figure.Zscale,action.Figure.Rotation);vd_aE(action.Figure,true,true);vd_aM(action);}}else if(status=='draw'){if(action.Figure){render=action.render;if(!action.vd_fG)action.vd_fG=1.0;scale=vdgeo.Distance2D(action.ReferencePoint,action.DrawPoint())*action.vd_fG;vd_nn(vdcanvas,action.Figure,action.Figure.InsertionPoint,scale,scale,action.Figure.Zscale,action.Figure.Rotation);vd_n.UpdateFig(action.Figure);vd_n.DrawEntity(action.Figure,render);}}}else if(action.vd_v=='PickRotation'){if(status=='start'){action.show();action.draw();vd_n.Prompt(vd_n.MessagesDictionary.SPECIFY_ROTATION);}else if(status=='end'){vd_n.Prompt('');if(!action.IsCanceled()){rotation=vdgeo.GetAngle(action.ReferencePoint,action.SelectedPoint());vd_nn(vdcanvas,action.Figure,action.Figure.InsertionPoint,action.Figure.Xscale,action.Figure.Yscale,action.Figure.Zscale,rotation);}else{vd_nn(vdcanvas,action.Figure,action.Figure.InsertionPoint,action.Figure.Xscale,action.Figure.Yscale,action.Figure.Zscale,0.0);}vd_aE(action.Figure,true,true);vd_aM(action);}else if(status=='draw'){if(action.Figure){render=action.render;rotation=vdgeo.GetAngle(action.ReferencePoint,action.DrawPoint());vd_nn(vdcanvas,action.Figure,action.Figure.InsertionPoint,action.Figure.Xscale,action.Figure.Yscale,action.Figure.Zscale,rotation);vd_n.UpdateFig(action.Figure);vd_n.DrawEntity(action.Figure,render);}}}};this.text=function(vd_bk,vd_P,vd_bj){vd_n.ActiveAction().cancel();vd_aQ=vd_bj;if(vd_P){var Figure=vd_n.AddText(vd_bk,0,vd_P[0],undefined,undefined,vd_P[1]);vd_aE(Figure,false,false);if(vd_aQ)vd_aQ(vd_n,Figure);return;}vd_n.ActiveAction().Figure=vd_n.AddText(vd_bk,0,[0,0,0],undefined,undefined,0.0,false,{});vd_n.GetUserPoint(vd_Cv);};function vd_Cv(action,status){if(!action.vd_v)action.vd_v='PickInsertion';var scale;var render;if(action.vd_v=='PickInsertion'){if(status=='start'){vd_n.Prompt(vd_n.MessagesDictionary.SPECIFY_INSERTION_POINT);}else if(status=='end'){vd_n.Prompt('');if(!action.IsCanceled()){action.Figure.InsertionPoint=action.ResValue;action.vd_v='PickRotation';vd_n.GetUserLine(vd_Cv,action.ResValue);}else{vd_aM(action);}}else if(status=='draw'){if(action.Figure){render=action.render;action.Figure.InsertionPoint=action.DrawPoint();vd_n.UpdateFig(action.Figure);vd_n.DrawEntity(action.Figure,render);}}}else if(action.vd_v=='PickRotation'){if(status=='start'){action.show();action.draw();vd_n.Prompt(vd_n.MessagesDictionary.SPECIFY_ROTATION);}else if(status=='end'){vd_n.Prompt('');if(!action.IsCanceled()){action.Figure.Rotation=vdgeo.GetAngle(action.ReferencePoint,action.SelectedPoint());}else{action.Figure.Rotation=0.0;}vd_aE(action.Figure,true,true);vd_aM(action);}else if(status=='draw'){if(action.Figure){render=action.render;action.Figure.Rotation=vdgeo.GetAngle(action.ReferencePoint,action.DrawPoint());vd_n.UpdateFig(action.Figure);vd_n.DrawEntity(action.Figure,render);}}}};this.image=function(vd_Cf,vd_eJ,vd_P,vd_bj){vd_n.ActiveAction().cancel();vd_aQ=vd_bj;var Figure;if(vd_P){Figure=vd_n.AddImage(vd_Cf,vd_eJ,vd_P[0],vd_P[1],vd_P[2],false,{});Figure.FileName=vd_eJ;vd_aE(Figure,false,false);if(vd_aQ)vd_aQ(vd_n,Figure);return;}Figure=vd_n.AddImage(vd_Cf,vd_eJ,[0,0,0],1.0,0.0,false,{});Figure.FileName=vd_eJ;vd_n.ActiveAction().Figure=Figure;vd_n.GetUserPoint(vd_zl);};function vd_zl(action,status){if(!action.vd_v)action.vd_v='Pick1';var vd_t=vd_n.GetDocument();var vd_S=null;var render;if(action.vd_v=='Pick1'){if(status=='start'){vd_n.Prompt(vd_n.MessagesDictionary.SPECIFY_FIRST_CORNER);}else if(status=='end'){vd_n.Prompt('');if(!action.IsCanceled()){action.Figure.InsertionPoint=action.ResValue;action.vd_v='Pick2';vd_n.GetUserLine(vd_zl,action.ResValue);}else{vd_aM(action);}}}else if(action.vd_v=='Pick2'){if(status=='start'){vd_n.Prompt(vd_n.MessagesDictionary.SPECIFY_OTHER_CORNER);}else if(status=='end'){vd_n.Prompt('');if(!action.IsCanceled()){action.Figure.Width=action.SelectedPoint()[X]-action.ReferencePoint[X];action.Figure.ImageScale=action.Figure.Width;if(vd_t)vd_S=vd_n.GetDictItem(vd_t.Images,action.Figure.ImageDefinition);if(vd_S)action.Figure.Height=action.Figure.Width*vd_S.height/vd_S.width;else action.Figure.Height=action.SelectedPoint()[Y]-action.ReferencePoint[Y];action.vd_FS=vdgeo.GetAngle(action.ReferencePoint,action.SelectedPoint());action.vd_v='Pick3';vd_n.GetUserLine(vd_zl,action.ReferencePoint);}else{vd_aM(action);}}else if(status=='draw'){if(action.Figure){render=action.render;action.Figure.Width=action.DrawPoint()[X]-action.ReferencePoint[X];action.Figure.ImageScale=action.Figure.Width;if(vd_t)vd_S=vd_n.GetDictItem(vd_t.Images,action.Figure.ImageDefinition);if(vd_S)action.Figure.Height=action.Figure.Width*vd_S.height/vd_S.width;else action.Figure.Height=action.DrawPoint()[Y]-action.ReferencePoint[Y];vd_n.UpdateFig(action.Figure);vd_n.DrawEntity(action.Figure,render);}}}else if(action.vd_v=='Pick3'){if(status=='start'){action.show();action.draw();vd_n.Prompt(vd_n.MessagesDictionary.SPECIFY_ROTATION);}else if(status=='end'){vd_n.Prompt('');if(!action.IsCanceled()){action.Figure.Rotation=vdgeo.GetAngle(action.ReferencePoint,action.SelectedPoint())-action.vd_FS;}else{action.Figure.Rotation=0.0;}vd_aE(action.Figure,true,true);vd_aM(action);}else if(status=='draw'){if(action.Figure){render=action.render;action.Figure.Rotation=vdgeo.GetAngle(action.ReferencePoint,action.DrawPoint())-action.vd_FS;vd_n.UpdateFig(action.Figure);vd_n.DrawEntity(action.Figure,render);}}}};var vd_bx={vd_qH:new vddimmanager()};this.dimvar=function(name,value){name=name.toUpperCase();vd_n.UndoHistory().store(vd_bx.vd_qH,name);vd_bx.vd_qH[name]=value;if(vd_bi)vd_bs.push("dimvar "+name+" "+value);};this.dim=function(vd_P,vd_bj){vd_n.ActiveAction().cancel();vd_aQ=vd_bj;var Figure;if(vd_P&&vd_P[0]&&vd_P[1]){vd_bx.vd_qi=vd_P[0];vd_bx.vd_qe=vd_P[1];vd_bx.vd_sg=vd_P[2];vd_bx.text=vd_P[3];if(!vd_bx.text)vd_bx.text='';Figure=vd_bx.vd_qH.Create(vd_n,vd_bx.vd_qi,vd_bx.vd_qe,vd_bx.vd_sg,vd_bx.text,{});vd_aE(Figure,false,false);if(vd_aQ)vd_aQ(vd_n,Figure);return;}vd_n.GetUserPoint(vd_za);};function vd_za(action,status){if(!action.vd_v)action.vd_v='Pick1';var vd_t=vd_n.GetDocument();var vd_S=null;var render;if(action.vd_v=='Pick1'){if(status=='start'){vd_n.Prompt(vd_n.MessagesDictionary.SPECIFY_START_POINT);}else if(status=='end'){vd_n.Prompt('');if(!action.IsCanceled()){action.vd_v='Pick2';vd_n.GetUserLine(vd_za,action.ResValue);}else{vd_aM(action);}}}else if(action.vd_v=='Pick2'){if(status=='start'){vd_n.Prompt(vd_n.MessagesDictionary.SPECIFY_END_POINT);}else if(status=='end'){vd_n.Prompt('');if(!action.IsCanceled()){vd_bx.vd_qi=action.ReferencePoint;vd_bx.vd_qe=action.SelectedPoint();action.vd_v='Pick3';vd_n.GetUserLine(vd_za,action.SelectedPoint());}else{vd_aM(action);}}}else if(action.vd_v=='Pick3'){if(status=='start'){vd_n.Prompt(vd_n.MessagesDictionary.SPECIFY_INSERTION_POINT);}else if(status=='end'){vd_n.Prompt('');if(!action.IsCanceled()){vd_bx.vd_sg=action.SelectedPoint();vd_bx.text='';action.Figure=vd_bx.vd_qH.Create(vd_n,vd_bx.vd_qi,vd_bx.vd_qe,vd_bx.vd_sg,vd_bx.text,{});}else{action.Figure=null;}vd_aE(action.Figure,true,true);vd_aM(action);}else if(status=='draw'){render=action.render;var figure=vd_bx.vd_qH.Create(vd_n,vd_bx.vd_qi,vd_bx.vd_qe,action.DrawPoint(),'',{});vd_n.DrawEntity(figure,render);}}};function vd_Sc(pl,p1,p2){vd_n.UndoHistory().group_start();vd_n.UndoHistory().store(pl,"VertexList");vd_n.UndoHistory().store(pl,"Flag");var ins1=vdgeo.vd_CY(pl,p1);if(!ins1)return null;var ins2=vdgeo.vd_CY(pl,p2);if(!ins2)return null;if(ins1[0]>=ins2[0]){ins1[0]+=1;}if(ins1[0]>ins2[0]){var tmp=ins1;ins1=ins2;ins2=tmp;}var vd_GB=[];var vd_ss=[];if(pl.Falg==1){for(var i=ins2[0];i<pl.vd_pS.Items.length;i++){vd_ss.push(pl.vd_pS.Items[i]);}for(var i=0;i<=ins1[0];i++){vd_ss.push(pl.vd_pS.Items[i]);}}else{for(var i=0;i<=ins1[0];i++){vd_ss.push(pl.vd_pS.Items[i]);}for(var i=ins2[0];i<pl.vd_pS.Items.length;i++){vd_GB.push(pl.vd_pS.Items[i]);}}pl.VertexList.Items=vd_ss;pl.Flag=0;vd_n.UpdateFig(pl);var vd_uX=vdConst.cloneEntity(pl);vd_uX.VertexList.Items=vd_GB;vd_uX.HandleId=vd_n.vd_fj();vd_n.vd_by(vd_n.GetActiveLayout().Entities,vd_uX);vd_n.UndoHistory().store(vd_uX,"Deleted",true);vd_n.UndoHistory().group_end();};this.box=function(vd_P,vd_bj){var action=vd_n.ActiveAction();action.cancel();vd_aQ=vd_bj;if(vd_P){action.vd_z=vd_P.concat("box");action.Figure=vd_n.AddBox(vd_P[0],vd_P[1],vd_P[2],vd_P[3],vd_P[4],false,{});vd_aE(action.Figure,false,false);vd_aM(action);return;}vd_n.GetUserPoint(vd_tm);};function vd_rP(ip,width,length,height,rotation){var p0=ip;var p1=vdgeo.pointPolar(p0,rotation,width);var p2=vdgeo.pointPolar(p1,rotation+vdgeo.HALF_PI,length);var p3=vdgeo.pointPolar(p2,rotation+vdgeo.PI,width);var p4=[p0[X],p0[Y],p0[Z]+height];var p5=[p1[X],p1[Y],p1[Z]+height];var p6=[p2[X],p2[Y],p2[Z]+height];var p7=[p3[X],p3[Y],p3[Z]+height];return[p0,p1,p2,p3,p4,p5,p6,p7];};function vd_tm(action,status){if(!action.vd_v)action.vd_v='Pick1';if(action.vd_v=='Pick1'){if(status=='start'){action.vdrawOwner().Prompt("SPECIFY_FIRST_CORNER");}else if(status=='end'){action.vdrawOwner().Prompt("");if(action.IsCanceled()){vd_aM(action);}else{var cp0=action.SelectedPoint();action.vd_z=[cp0,1,1,1,0,"box"];action.Figure=vd_n.AddBox(cp0,1,1,1,0,false,{});action.vd_v='Pick2';action.vdrawOwner().GetUserLine(vd_tm,cp0);}}else if(status=='draw'){}}else if(action.vd_v=='Pick2'){if(status=='start'){action.DrawActionDefault=true;action.vdrawOwner().Prompt("SPECIFY_OTHER_CORNER");}else if(status=='end'){action.vdrawOwner().Prompt("");if(action.IsCanceled()){vd_aM(action);}else{var vd_A=action.vd_z[0];var cp1=action.SelectedPoint();var width=cp1[X]-vd_A[X];var length=cp1[Y]-vd_A[Y];action.vd_z[1]=width;action.vd_z[2]=length;action.vd_v='Pick3';action.vdrawOwner().GetUserLine(vd_tm,vd_A);}}else if(status=='draw'){var vd_A=action.vd_z[0];var cp1=action.DrawPoint();var width=cp1[X]-vd_A[X];var length=cp1[Y]-vd_A[Y];action.Figure.VertexList.Items=vd_rP(vd_A,width,length,0.0,0.0);action.vdrawOwner().UpdateFig(action.Figure);action.vdrawOwner().DrawEntity(action.Figure,action.render);}}else if(action.vd_v=='Pick3'){if(status=='start'){action.DrawActionDefault=true;action.vdrawOwner().Prompt("SPECIFY_HEIGHT");}else if(status=='end'){action.vdrawOwner().Prompt("");if(action.IsCanceled()){vd_aM(action);}else{var vd_A=action.vd_z[0];var cp1=action.SelectedPoint();var height=vdgeo.Distance3D(vd_A,cp1);action.vd_z[3]=height;action.vd_v='Pick4';action.vdrawOwner().GetUserLine(vd_tm,vd_A);}}else if(status=='draw'){var vd_A=action.vd_z[0];var width=action.vd_z[1];var length=action.vd_z[2];var cp1=action.DrawPoint();var height=vdgeo.Distance3D(vd_A,cp1);action.Figure.VertexList.Items=vd_rP(vd_A,width,length,height,0.0);action.vdrawOwner().UpdateFig(action.Figure);action.vdrawOwner().DrawEntity(action.Figure,action.render);}}else if(action.vd_v=='Pick4'){if(status=='start'){action.DrawActionDefault=true;action.vdrawOwner().Prompt("SPECIFY_ROTATION");}else if(status=='end'){action.vdrawOwner().Prompt("");if(action.IsCanceled()){vd_aM(action);}else{var vd_A=action.vd_z[0];var width=action.vd_z[1];var length=action.vd_z[2];var height=action.vd_z[3];var cp1=action.SelectedPoint();var angle=vdgeo.GetAngle(vd_A,cp1);action.Figure.VertexList.Items=vd_rP(vd_A,width,length,height,angle);vd_aE(action.Figure,true,true);vd_aM(action);}}else if(status=='draw'){var vd_A=action.vd_z[0];var width=action.vd_z[1];var length=action.vd_z[2];var height=action.vd_z[3];var cp1=action.DrawPoint();var angle=vdgeo.GetAngle(vd_A,cp1);action.vd_z[4]=angle;action.Figure.VertexList.Items=vd_rP(vd_A,width,length,height,angle);action.vdrawOwner().UpdateFig(action.Figure);action.vdrawOwner().DrawEntity(action.Figure,action.render);}}};this.sphere=function(vd_P,vd_bj){var action=vd_n.ActiveAction();action.cancel();vd_aQ=vd_bj;if(!vd_P)vd_P=[null,1,10,10];action.vd_z=vd_P.concat("sphere");if(vd_P[0]&&vd_P[1]){action.Figure=vd_n.AddSphere(vd_P[0],vd_P[1],vd_P[2],vd_P[3],false,{});vd_aE(action.Figure,false,false);vd_aM(action);return;}vdcanvas.GetUserPoint(vd_Az);};function vd_Az(action,status){if(!action.vd_v)action.vd_v='Pick1';if(action.vd_v=='Pick1'){if(status=='start'){action.vdrawOwner().Prompt('SPECIFY CENTER POINT');action.DrawActionDefault=true;}else if(status=='end'){action.vdrawOwner().Prompt('');if(action.IsCanceled()){vd_aM(action);}else{var p1=action.SelectedPoint();action.vd_z[0]=p1;action.Figure=action.vdrawOwner().AddCircle(p1,0.0,false,{});action.vdrawOwner().UpdateFig(action.Figure);action.vdrawOwner().DrawEntity(action.Figure,action.render);action.vd_v='Pick2';action.vdrawOwner().GetUserLine(vd_Az,action.vd_z[0]);}}else if(status=='draw'){}}else if(action.vd_v=='Pick2'){if(status=='start'){action.vdrawOwner().Prompt('SPECIFY RADIUS');action.DrawActionDefault=true;}else if(status=='end'){action.vdrawOwner().Prompt('');if(action.IsCanceled()){vd_aM(action);}else{var p2=action.SelectedPoint();action.Figure.Radius=vdgeo.Distance2D(action.vd_z[0],p2);action.vd_z[1]=action.Figure.Radius;var lon=action.vd_z[2];var lat=action.vd_z[3];var vd_xj=vdgeo.VD_TWOPI/lon;var vd_xp=vdgeo.PI/lat;var k=0,l=0,i=0;var a,sa,va,dp,dh;var pt;var VertexList=[];var FaceList=[];var rad=action.vd_z[1];for(k=0;k<lon+1;k++){a=k*vd_xj;sa=vdgeo.PI/ -2.0;for(l=0;l<lat+1;l++){va=sa+l*vd_xp;dp=rad*Math.cos(va);dh=rad*Math.sin(va);pt=vdgeo.pointPolar(action.vd_z[0],a,dp);pt[Z]+=dh;VertexList.push(pt);}}for(k=0;k<lon;k++){for(l=0;l<lat;l++){i=l+(k*(lat+1));i+=1;FaceList.push(i);i=(l+1)+(k*(lat+1));i+=1;FaceList.push(i);i=(l+1)+(k+1)*(lat+1);i+=1;if(k==lon-1){i=(l+1);i+=1;}FaceList.push(i);i=l+(k+1)*(lat+1);i+=1;if(k==lon-1){i=l;i+=1;}FaceList.push(i);i= -1;FaceList.push(i);}}action.Figure=action.vdrawOwner().AddPolyface(VertexList,FaceList,true);vd_aE(action.Figure,true,true);vd_aM(action);}}else if(status=='draw'){var p2=action.DrawPoint();action.Figure.Radius=vdgeo.Distance2D(action.vd_z[0],p2);action.vd_z[1]=action.Figure.Radius;action.vdrawOwner().UpdateFig(action.Figure);action.vdrawOwner().DrawEntity(action.Figure,action.render);}}};this.cone=function(vd_P,vd_bj){var action=vd_n.ActiveAction();action.cancel();vd_aQ=vd_bj;if(!vd_P)vd_P=[null,1,1,1,10];action.vd_z=vd_P.concat("cone");if(vd_P[0]){action.Figure=vd_n.AddCone(vd_P[0],vd_P[1],vd_P[2],vd_P[3],vd_P[4],false,{});vd_aE(action.Figure,false,false);vd_aM(action);return;}vdcanvas.GetUserPoint(vd_uL);};function vd_uL(action,status){if(!action.vd_v)action.vd_v='Pick1';if(action.vd_v=='Pick1'){if(status=='start'){action.vdrawOwner().Prompt('SPECIFY CENTER POINT');action.DrawActionDefault=true;}else if(status=='end'){action.vdrawOwner().Prompt('');if(action.IsCanceled()){vd_aM(action);}else{var cp0=action.SelectedPoint();action.vd_z[0]=cp0;action.Figure=action.vdrawOwner().AddCircle(cp0,0.0,false,{});action.vdrawOwner().UpdateFig(action.Figure);action.vdrawOwner().DrawEntity(action.Figure,action.render);action.vd_v='Pick2';action.vdrawOwner().GetUserLine(vd_uL,action.vd_z[0]);}}else if(status=='draw'){}}else if(action.vd_v=='Pick2'){if(status=='start'){action.vdrawOwner().Prompt('SPECIFY BASE RADIUS');action.DrawActionDefault=true;}else if(status=='end'){action.vdrawOwner().Prompt('');if(action.IsCanceled()){vd_aM(action);}else{var p1=action.SelectedPoint();action.Figure.Radius=vdgeo.Distance2D(action.vd_z[0],p1);action.vd_z[1]=action.Figure.Radius;action.vd_v='Pick3';action.vdrawOwner().GetUserLine(vd_uL,action.vd_z[0]);}}else if(status=='draw'){var p1=action.DrawPoint();action.Figure.Radius=vdgeo.Distance2D(action.vd_z[0],p1);action.vd_z[1]=action.Figure.Radius;action.vdrawOwner().UpdateFig(action.Figure);action.vdrawOwner().DrawEntity(action.Figure,action.render);}}else if(action.vd_v=='Pick3'){if(status=='start'){action.vdrawOwner().Prompt('SPECIFY TOP RADIUS');}else if(status=='end'){action.vdrawOwner().Prompt('');if(action.IsCanceled()){vd_aM(action);}else{var p2=action.SelectedPoint();action.Figure.Radius=vdgeo.Distance2D(action.vd_z[0],p2);action.vd_v='Pick4';action.vdrawOwner().GetUserLine(vd_uL,action.vd_z[0]);}}else if(status=='draw'){var p2=action.DrawPoint();action.Figure.Radius=vdgeo.Distance2D(action.vd_z[0],p2);action.vd_z[2]=action.Figure.Radius;action.vdrawOwner().UpdateFig(action.Figure);action.vdrawOwner().DrawEntity(action.Figure,action.render);}}else if(action.vd_v=='Pick4'){if(status=='start'){action.vdrawOwner().Prompt('SPECIFY HEIGHT');action.DrawActionDefault=true;}else if(status=='end'){action.vdrawOwner().Prompt('');if(action.IsCanceled()){vd_aM(action);}else{var p3=action.SelectedPoint();var height=vdgeo.Distance2D(action.vd_z[0],p3);action.vd_z[3]=height;var VertexList=[];var i=0;var k=0;var vd_ie;var num=action.vd_z[4];var deg=360/num;var angle=vdgeo.DegreesToRadians(deg);var p2=[action.vd_z[0][X],action.vd_z[0][Y],action.vd_z[0][Z]];p2[Z]+=action.vd_z[3];for(i=0;i<num;i++){vd_ie=vdgeo.pointPolar(action.vd_z[0],i*angle,action.vd_z[1]);VertexList.push(vd_ie);}for(i=0;i<num;i++){vd_ie=vdgeo.pointPolar(p2,i*angle,action.vd_z[2]);VertexList.push(vd_ie);}var FaceList=[];for(i=0;i<num-2;i++){k= -1;FaceList.push(k);k= -(i+2);FaceList.push(k);k= -(i+3);FaceList.push(k);FaceList.push(k);k= -1;FaceList.push(k);k= -(1+num);FaceList.push(k);k= -(i+2+num);FaceList.push(k);k= -(i+3+num);FaceList.push(k);FaceList.push(k);k= -1;FaceList.push(k);}for(i=0;i<num;i++){k=i+1;FaceList.push(k);k=(i+1)+num;FaceList.push(k);k=(i+2)+num;if(i==num-1)k=1+num;FaceList.push(k);k=i+2;if(i==num-1)k=1;FaceList.push(k);k= -1;FaceList.push(k);}action.Figure=action.vdrawOwner().AddPolyface(VertexList,FaceList,true);vd_aE(action.Figure,true,true);vd_aM(action);}}else if(status=='draw'){}}};this.ellipse=function(vd_P,vd_bj){vd_n.ActiveAction().cancel();vd_aQ=vd_bj;if(vd_P){var Figure=vd_n.AddEllipse(vd_P[0],vd_P[1],vd_P[2],vd_P[3],vd_P[4],vd_P[5],false,{});vd_aE(Figure,false,false);if(vd_aQ)vd_aQ(vd_n,Figure);return;}vd_n.GetUserPoint(vd_xK);};function vd_xK(action,status){if(!action.vd_v)action.vd_v='PickCenter';if(action.vd_v=='PickCenter'){if(status=='start'){vd_n.Prompt(vd_n.MessagesDictionary.SPECIFY_CENTER_POINT);}else if(status=='end'){vd_n.Prompt('');if(!action.IsCanceled()){action.Figure=vd_n.AddEllipse(action.ResValue,0.0,0.0,0.0,0.0,0.0,false,{});action.vd_v='PickAxisEndPoint';vd_n.GetUserLine(vd_xK,action.ResValue);}else{vd_aM(action);}}}else if(action.vd_v=='PickAxisEndPoint'){if(status=='start'){vd_n.Prompt(vd_n.MessagesDictionary.vd_HT);}else if(status=='end'){vd_n.Prompt('');if(!action.IsCanceled()){action.Figure.MajorLength=vdgeo.Distance2D(action.ReferencePoint,action.SelectedPoint());action.Figure.MajorAngle=vdgeo.GetAngle(action.ReferencePoint,action.SelectedPoint());action.vd_v='PickSecondAxis';vd_n.GetUserLine(vd_xK,action.ReferencePoint);}else{vd_aM(action);}}}else if(action.vd_v=='PickSecondAxis'){if(status=='start'){vd_n.Prompt(vd_n.MessagesDictionary.vd_Hw);}else if(status=='end'){vd_n.Prompt('');if(!action.IsCanceled()){action.Figure.MinorLength=vdgeo.Distance2D(action.ReferencePoint,action.SelectedPoint());vd_aE(action.Figure,true,true);}vd_aM(action);}else if(status=='draw'){if(action.Figure){var render=action.render;action.Figure.MinorLength=vdgeo.Distance2D(action.ReferencePoint,action.DrawPoint());vd_n.UpdateFig(action.Figure);vd_n.DrawEntity(action.Figure,render);}}}};return this;} 